---
layout: post
title: "【转】keytool - 密钥和证书管理工具"
date: 2011-06-30 10:11:16.000000000 +01:00
type: post
published: true
status: publish
categories:
- java
tags:
- java
- "安全"
- "证书"
meta:
  views: '211'
author:
  login: ig2net
  email: ig2net@ig2net.info
  display_name: "农夫一号"
  first_name: ''
  last_name: ''
---
<p class="MsoNormal">
<p>好文章，转载以备份</p></p>
<p class="MsoNormal">
<p> 原文见<a title="http://www.sheca.com/service/newDoc/KeyTool%20MYHZSGLGJSYSC.doc" href="http://www.sheca.com/service/newDoc/KeyTool%20MYHZSGLGJSYSC.doc">http://www.sheca.com/service/newDoc/KeyTool%20MYHZSGLGJSYSC.doc</a></p></p>
<p style="text-align: center;text-indent: 38.05pt" class="MsoNormal" align="center">&#160;</p>
<p class="MsoNormal">keytool - <span lang="ZH-CN">密钥和证书管理工具：</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">管理由私钥和认证相关公钥的</span> X.509 <span lang="ZH-CN">证书链组成的密钥仓库（数据库）。还管理来自可信任实体的证书。</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">语法结构：</span></p>
<p style="text-indent: 21pt" class="MsoNormal">keytool [ <span lang="ZH-CN">命令</span> ]</p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">说明：</span></p>
<p style="text-indent: 21pt" class="MsoNormal">keytool <span lang="ZH-CN">是个密钥和证书管理工具。它使用户能够管理自己的公钥</span>/<span lang="ZH-CN">私钥对及相关证书，用于（通过数字签名）自我认证（用户向别的用户</span>/<span lang="ZH-CN">服务认证自己）或数据完整性以及认证服务。它还允许用户储存他们的通信对等者的公钥（以证书形式）。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">证书是来自一个实体（个人、公司等）的经数字签名的声明，它声明某些其它实体的公钥（及其它信息）具有某一的特定值（参见证书）。当数据被数字化签名后，校验签名即可检查数据的完整性和真实性。完整性的意思是数据没有被修改或损坏过，真实性的意思是数据的确是来自声称创建了该数据和对它进行了签名的实体。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">keytool <span lang="ZH-CN">将密钥和证书储存在一个所谓的密钥仓库中。缺省的密钥仓库实现将密钥仓库实现为一个文件。它用口令来保护私钥。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">请注意：</span>keytool<span lang="ZH-CN">工具完全取代了</span><span>&#160; </span>JDK 1.1 <span lang="ZH-CN">中提供的</span> javakey <span lang="ZH-CN">工具。新工具所提供的功能比</span> javakey <span lang="ZH-CN">提供的多，包括能够用口令来保护密钥仓库和私钥，以及除了能够生成签名外还可以校验它们。新的密钥仓库体系结构取代了</span> javakey <span lang="ZH-CN">所创建和管理的身份数据库。可以利用</span> - identitydb keytool <span lang="ZH-CN">命令将信息从身份数据库导入密钥仓库。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">在密钥仓库中有两种不同类型的项：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">密钥项</span> - <span lang="ZH-CN">每项存放极为敏感的加密密钥信息，这种信息以一种受保护的格式储存以防止未授权的访问。通常，储存在这类项中的密钥是机密密钥，或是伴有用于认证相应公钥用的证书“链”的私钥。</span>keytool<span lang="ZH-CN">只处理后一类型的项，即私钥及其关联的证书链。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">可信任的证书项</span> - <span lang="ZH-CN">每项包含一个属于另一团体的公钥证书。它之所以叫做“可信任的证书”，是因为密钥仓库的拥有者相信证书中的公钥确实属于证书“主体”（拥有者）识别的身份。证书签发人通过对证书签名来保证这点。</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">对所有的密钥仓库项（密钥项和可信任的证书项）的访问都要通过唯一的别名来进行。别名不区分大小写，即别名</span> SHECA <span lang="ZH-CN">和</span> sheca <span lang="ZH-CN">指的是同一密钥仓库项。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">当用</span> -genkey <span lang="ZH-CN">命令来生成密钥对（公钥和私钥）或用</span> -import <span lang="ZH-CN">命令来将证书或证书链加到可信任证书的清单中，以增加一个实体到密钥仓库中，必须指定了一个别名。后续</span> keytool <span lang="ZH-CN">命令必须使用这一相同的别名来引用该实体。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">例如，假设您用别名</span>sheca<span lang="ZH-CN">生成了新的公钥</span>/<span lang="ZH-CN">私钥密钥对并将公钥用以下命令打包到自签名证书中：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -genkey -alias sheca –keypasss shecakeypasswd</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">这指定了一个初始口令“</span>shecakeypasswd<span lang="ZH-CN">”，接下来的命令都要使用该口令才能访问与别名</span>sheca <span lang="ZH-CN">相关联的私钥。以后如果您想更改</span>sheca<span lang="ZH-CN">的私钥口令，可用类似下述的命令：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -keypasswd -alias sheca -keypass shecakeypasswd -new newpass</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">这将把口令从“</span>shecakeypasswd<span lang="ZH-CN">”改为“</span>newpass<span lang="ZH-CN">”。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">请注意：实际上，除非是作为测试目的或是在安全的系统上，否则不应在命令行或脚本中指定口令。如果没有在命令行上指定所要求的口令选项，您将会得到要求输入口令的提示。当在口令提示符下键入口令时，口令将被即时显示出来（键入什么就显示什么），因此，要小心，不要当着任何人的面键入口令。</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">每个</span> keytool <span lang="ZH-CN">命令都有一个</span> -keystore <span lang="ZH-CN">选项，用于指定</span> keytool <span lang="ZH-CN">管理的密钥仓库的永久密钥仓库文件名称及其位置。缺省情况下，密钥仓库储存在用户宿主目录（由系统属性的“</span>user.home<span lang="ZH-CN">”决定）中名为</span> .keystore <span lang="ZH-CN">的文件中。在</span> Solaris <span lang="ZH-CN">系统中</span><span lang="ZH-CN"> </span><span lang="ZH-CN">“</span>user.home<span lang="ZH-CN">”缺省为用户的宿主目录。</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">密钥仓库的创建，当用</span> -genkey<span lang="ZH-CN">、</span>-import <span lang="ZH-CN">或</span> -identitydb <span lang="ZH-CN">命令向某个尚不存在的密钥仓库添加数据时，就创建了一个密钥仓库。</span> </p>
<p class="MsoNormal"><span lang="ZH-CN">具体地说，如果在</span> -keystore <span lang="ZH-CN">选项中指定了一个并不存在的密钥仓库，则该密钥仓库将被创建。如果不指定</span> -keystore <span lang="ZH-CN">选项，则缺省密钥仓库将是宿主目录中名为</span> .keystore <span lang="ZH-CN">的文件。如果该文件并不存在，则它将被创建。</span></p>
<p style="text-indent: 21pt" class="MsoNormal">java.security <span lang="ZH-CN">包中提供的</span> KeyStore <span lang="ZH-CN">类为访问和修改密钥仓库中的信息提供了相当固定的接口。可以有多个不同的具体实现，其中每个实现都是对某个特定类型的密钥仓库的具体实现。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">Sun Microsystems <span lang="ZH-CN">公司提供了一个内置的缺省实现。它利用名为“</span>JKS<span lang="ZH-CN">”</span><span lang="ZH-CN"> </span><span lang="ZH-CN">的专用密钥仓库类型（格式），将密钥仓库实现为一个文件。它用个人口令保护每个私钥，也用口令（可能为另一个口令）保护整个密钥仓库的完整性。</span></p>
<p style="text-indent: 21pt" class="MsoNormal">keytool<span lang="ZH-CN">允许用户指定任何注册了的加密服务提供者所提供的密钥对生成和签名算法。也就是说，各种命令中的</span> keyalg <span lang="ZH-CN">和</span> sigalg <span lang="ZH-CN">选项必须得到提供者的实现的支持。缺省的密钥对生成算法是“</span>DSA<span lang="ZH-CN">”。签名算法是从所涉及私钥的算法推导来的：如果所涉及的私钥是“</span>DSA<span lang="ZH-CN">”类型，则缺省的签名算法为</span><span lang="ZH-CN"> </span><span lang="ZH-CN">“</span>SHA1withDSA<span lang="ZH-CN">”，如果所涉及的私钥是“</span>RSA<span lang="ZH-CN">”类型，则缺省的签名算法为“</span>MD5withRSA<span lang="ZH-CN">”。在生成</span> DSA <span lang="ZH-CN">密钥对时，密钥大小的范围必须在</span> 512 <span lang="ZH-CN">到</span> 1024 <span lang="ZH-CN">位之间，且必须是</span> 64 <span lang="ZH-CN">的倍数。缺省的密钥大小为</span> 1024 <span lang="ZH-CN">位。</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">使用</span> keytool <span lang="ZH-CN">可以显示、导入和导出证书。还可以产生自签名证书。</span>keytool <span lang="ZH-CN">目前处理</span> X.509 <span lang="ZH-CN">证书。</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">主要内容：</span></p>
<p style="text-indent: 21pt" class="MsoNormal">1<span lang="ZH-CN">、</span>X.509 <span lang="ZH-CN">证书：</span></p>
<p style="text-indent: 21pt" class="MsoNormal">X.509 <span lang="ZH-CN">标准规定了证书可以包含什么信息，并说明了记录信息的方法（数据格式）。除了签名外，所有</span> X.509 <span lang="ZH-CN">证书还包含以下数据：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">2<span lang="ZH-CN">、版本：</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">识别用于该证书的</span> X.509 <span lang="ZH-CN">标准的版本，该版本影响证书中所能指定的信息。迄今为止，已定义的版本有三个。</span>keytool <span lang="ZH-CN">可导入和导出</span> v1<span lang="ZH-CN">、</span>v2 <span lang="ZH-CN">和</span> v3 <span lang="ZH-CN">版的证书。它只能生成</span> v1 <span lang="ZH-CN">版证书。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">3<span lang="ZH-CN">、序列号：</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">发放证书的实体有责任为证书指定序列号，以使其区别于该实体发放的其它证书。此信息用途很多。例如，如果某一证书被撤消，其序列号将放到证书撤消清单</span> (CRL) <span lang="ZH-CN">中。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">4<span lang="ZH-CN">、签名算法标识符：</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">用于标识</span> CA <span lang="ZH-CN">签名证书时所用的算法。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">5<span lang="ZH-CN">、签发人名称：</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">签名证书的实体的</span> X.500 <span lang="ZH-CN">特征名。它通常为一个</span> CA<span lang="ZH-CN">。使用该证书意味着信任签名该证书的实体。注意：有些情况下（例如根或顶层</span> CA <span lang="ZH-CN">证书），签发人会签名自己的证书。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">6<span lang="ZH-CN">、有效期：</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">每个证书均只能在一个有限的时间段内有效。该有效期以起始日期和时间及终止日期和时间表示，可以短至几秒或长至一世纪。所选有效期取决于许多因素，例如用于签名证书的私钥的使用频率及愿为证书支付的金钱等。它是在没有危及相关私钥的条件下，实体可以依赖公钥值的预计时间。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">7<span lang="ZH-CN">、主体名：</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">证书可以识别其公钥的实体名。此名称使用</span> X.500 <span lang="ZH-CN">标准，因此在</span>Internet<span lang="ZH-CN">中应是唯一的。它是实体的</span> X.500 <span lang="ZH-CN">特征名</span> (DN)<span lang="ZH-CN">，例如：</span></p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>CN=Java SHECA, OU=Java Software Division, O=Sun Microsystems Inc, C=US</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">（这些指主体的通用名、组织单位、组织和国家。）</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">8<span lang="ZH-CN">、主体公钥信息</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">这是被命名实体的公钥，同时包括指定该密钥所属公钥密码系统的算法标识符及所有相关的密钥参数。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">证书中的所有数据均用两个名为</span> ASN.1/DER <span lang="ZH-CN">的相关标准进行编码。抽象语法注释</span> 1 (Abstract Syntax Notation 1) <span lang="ZH-CN">描述数据。确定性编码规则</span> (Definite Encoding Rules) <span lang="ZH-CN">描述储存和传输该数据的唯一方式。</span></p>
<p style="text-indent: 21pt" class="MsoNormal">Keytool<span lang="ZH-CN">使用</span>-import <span lang="ZH-CN">和</span> -printcert <span lang="ZH-CN">命令读入的证书可以是这种格式的编码或是二进制格式的编码。</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">缺省情况下，</span>-export <span lang="ZH-CN">命令将以二进制编码格式输出证书，但如果指定了</span> -rfc <span lang="ZH-CN">选项，则将以可打印的编码格式输出证书。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">缺省情况下，</span>-list <span lang="ZH-CN">命令打印证书的</span> MD5 <span lang="ZH-CN">指纹。而如果指定了</span> -v <span lang="ZH-CN">选项，将以可读格式打印证书，如果指定了</span> -rfc <span lang="ZH-CN">选项，将以可打印的编码格式输出证书。</span><span lang="ZH-CN"> </span><span lang="ZH-CN">在其可打印的编码格式中，已编码证书的起始行是：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">-----BEGIN CERTIFICATE-----</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">结束行是：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">-----END CERTIFICATE-----</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">证书链</span></p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">keytool <span lang="ZH-CN">可创建和管理密钥仓库的“密钥”项，每个密钥项都含有私钥和相关证书“链”。链中的第一个证书含有与私钥对应的公钥。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">当第一次产生密钥时，链中只含有一个元素，即自签名证书。自签名证书是一个这样的证书：其签发人（签名人）与主体（证书所认证的公钥所属的实体）相同。当调用</span> -genkey <span lang="ZH-CN">命令来生成新的公钥</span>/<span lang="ZH-CN">私钥对时，它同时也把公钥打包进自签名证书中。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">之后，当证书签名请求</span> (CSR)<span lang="ZH-CN">被生成并送至认证机构</span> (CA) <span lang="ZH-CN">后，</span>CA <span lang="ZH-CN">的答复将被导入，证书链将取代自签名证书。在链的底部是认证主体公钥的</span>CA <span lang="ZH-CN">所发放的证书（答复）。链中下一个证书是用于认证</span> CA <span lang="ZH-CN">公钥的证书。</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">在许多情况下，这是个自签名证书（即来自认证其自身公钥的</span> CA <span lang="ZH-CN">的证书）且是链中的最后一个证书。在其它情况下，</span>CA <span lang="ZH-CN">也许将返回证书链。这种情况下，链中底部的证书是相同的（由</span> CA <span lang="ZH-CN">签名的证书，对密钥项的公钥进行认证），但链中第二个证书是由不同的</span> CA <span lang="ZH-CN">所签名的，对您向其发送</span> CSR <span lang="ZH-CN">的</span> CA <span lang="ZH-CN">的公钥进行认证。然后，链中的下一个证书将是对第二个</span> CA <span lang="ZH-CN">的公钥进行认证的证书，以此类推，直至到达自签名的“根”证书为止。因此，链中的每个证书（从第一个以后）都对链中前一个证书的签名人的公钥进行认证。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">许多</span> CA <span lang="ZH-CN">只返回所发放的证书，而不支持链，特别是当层次结构较简单时（无中介</span> CA<span lang="ZH-CN">）。这种情况下，必须用储存在密钥仓库中的可信任的证书信息来建立证书链。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">另一种答复格式（由</span> PKCS#7 <span lang="ZH-CN">标准所定义）除了包含所签发的证书外，还支持证书链。两种答复格式都可由</span> keytool <span lang="ZH-CN">处理。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">顶层（根）</span>CA <span lang="ZH-CN">证书是自签名的。但是，对根公钥的信任并非来自根证书本身，而是来自报纸之类的其它来源。根</span> CA<span lang="ZH-CN">的公钥是广为人知的。它被储存在证书中的唯一原因是因为这是大多数工具所能理解的格式，因此这种情况下的证书只是作为一种传输根</span> CA <span lang="ZH-CN">的公钥用的“交通工具”。在将根</span> CA <span lang="ZH-CN">证书加到您的密钥仓库中之前，应该先对它进行查看（用</span> - printcert <span lang="ZH-CN">选项）并将所显示的指纹与已知的指纹（从报纸、根</span> CA <span lang="ZH-CN">的网页等中获取）进行比较。</span></p>
<p style="text-indent: 15.75pt" class="MsoNormal"><span lang="ZH-CN">导入证书：</span></p>
<p style="text-indent: 15.75pt" class="MsoNormal"><span lang="ZH-CN">要从一个文件中导入某个证书，可用</span> -import <span lang="ZH-CN">命令，如下所示：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -import -alias sheca -file jcertfile.cer</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">此样本命令导入文件</span> jcertfile.cer <span lang="ZH-CN">中的证书并将其存储在由别名</span>sheca<span lang="ZH-CN">标识的密钥仓库项中。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">导入证书的两个理由如下：</span></p>
<p style="text-indent: -0.25in;margin-left: 39pt" class="ListParagraph"><span><span>1、<span>&#160; </span></span></span><span lang="ZH-CN">为将其添加到可信任的证书清单中；</span></p>
<p style="text-indent: -0.25in;margin-left: 39pt" class="ListParagraph"><span><span>2、<span>&#160; </span></span></span><span lang="ZH-CN">为导入因向</span> CA <span lang="ZH-CN">提交证书签名请求而收到的来自该</span> CA <span lang="ZH-CN">的认证答复。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">-alias<span>&#160; </span><span lang="ZH-CN">选项的值指明要进行何种类型的导入。如果数据库中存在别名，且该别名标识具有私钥的项，则将假定您要导入认证答复。</span>keytool <span lang="ZH-CN">将检查认证答复中的公钥是否与用别名储存的私钥相匹配，如果两者不同，则程序退出。如果别名标识另一种类型的密钥仓库项，则不导入该证书。如果该别名不存在，则它将被创建并与导入的证书关联。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">有关导入可信任证书的警告：</span></p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">重要：将证书作为可信任的证书导入之前，请务必先仔细检查该证书！</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">先查看一下（用</span><span>&#160; </span>-printcert <span lang="ZH-CN">命令，或用不带</span> -noprompt <span lang="ZH-CN">选项的</span> -import <span lang="ZH-CN">命令），确保所显示的证书指纹与所预计的相匹配。例如，假设某人给您送来或用电子邮件发来一个证书，您将它放在名为</span> /tmp/cert <span lang="ZH-CN">的文件中。在将它加到可信任证书的清单中之前，可通过执行</span> - printcert <span lang="ZH-CN">命令来查看它的指纹，如下所示：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160; </span>keytool -printcert -file /tmp/cert</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>Owner: CN=ll, OU=ll, O=ll, L=ll, S=ll, C=ll</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>Issuer: CN=ll, OU=ll, O=ll, L=ll, S=ll, C=ll</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>Serial Number: 59092b58</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>Valid from: Thu Sep 25 18:01:13 PDT 2007 until: Wed Dec 24 17:01:13 PST 2007</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>Certificate Fingerprints:</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>MD5<span lang="ZH-CN">：</span>11:81:AD:92:C8:E5:0E:A2:01:2E:D4:7A:D7:5F:07:6F</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>SHA1<span lang="ZH-CN">：</span>20:B6:17:FA:EF:E5:55:8A:D0:71:1F:E8:D6:9D:C0:37:13:0E:5E:FE</p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">然后给向您发送证书的人打电话或用其它方式联系，将您将您所看到的指纹与他们所提供的比较。只有两者相等才可保证证书在传送途中没有被其它人（例如，攻击者）的证书所更换。如果发生了这样的攻击，而您未检查证书即将其导入，您就会信任攻击者所签名的任何东西（例如，一个含有恶意类文件的</span> JAR <span lang="ZH-CN">文件）。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">并不要求在导入证书前执行</span> -printcert <span lang="ZH-CN">命令，因为在将证书添加到密钥仓库中可信任证书的清单中之前，</span>-import <span lang="ZH-CN">命令将会打印出该证书的信息，并提示您进行校验。这时，您可选择中止导入操作。但是注意，只有在调用不带</span> -noprompt <span lang="ZH-CN">选项的</span> -import <span lang="ZH-CN">命令时才能这样做。如果给出了</span> -noprompt <span lang="ZH-CN">选项，则不存在与用户的交互</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">导出证书：</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">要将证书导出到文件中，请用</span> -export <span lang="ZH-CN">命令，如下所示：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -export -alias sheca -file shecacertfile.cer</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">该样本命令将</span> jane <span lang="ZH-CN">的证书导出到文件</span> shecacertfile.cer <span lang="ZH-CN">中。也就是说，如果</span> sheca <span lang="ZH-CN">是某个密钥项的别名，该命令将导出该密钥仓库项中所含证书链底部的证书。这是认证</span>sheca <span lang="ZH-CN">的公钥用的证书。相反如果</span>sheca<span lang="ZH-CN">是某个可信任证书项的别名，则导出的是该可信任的证书。</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">显示证书：</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">要打印某个密钥仓库项的内容，请用</span> -list <span lang="ZH-CN">命令，如下所示：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -list -alias joe</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">如果未指定别名，如下所示：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -list</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">则打印整个密钥仓库的内容。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">要显示储存在文件中的证书的内容，请用</span> -printcert <span lang="ZH-CN">命令，如下所示：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -printcert -file certfile.cer</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">这将打印储存在文件</span> certfile.cer <span lang="ZH-CN">中的有关证书的信息。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">注意：此操作与密钥仓库无关，也就是说，不需要密钥仓库即可显示储存在文件中的证书。</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">要生成自签名证书，请用</span> -selfcert <span lang="ZH-CN">命令，如下所示：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -selfcert -alias shecaNew -keypass sheca123</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160;&#160;&#160; </span>-dname &quot;cn=James, ou=SHECA, o=Soft, c=CN&quot;</p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">所生成的证书作为指定别名（本例中为“</span>shecaNew<span lang="ZH-CN">”）所标识的密钥仓库项中的单元素证书来存储，它将取代现有的证书链。</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">下面列出各种命令及其选项，并对它们进行描述。</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">注意：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">1<span lang="ZH-CN">、所有的命令和选项名之前都有减号</span> (-) <span lang="ZH-CN">。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">2<span lang="ZH-CN">、每个命令的选项都可按任意顺序提供。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">3<span lang="ZH-CN">、所有非斜体项或不在花括号和方括号内的项都不能改动。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">4<span lang="ZH-CN">、选项周围的花括号通常表示如果在命令行中没有指定该选项，则使用缺省值。花括号还用在</span> -v<span lang="ZH-CN">、</span>-rfc <span lang="ZH-CN">和</span> -J <span lang="ZH-CN">选项周围，这些选项只有在命令行中出现时才有意义（也就是说，它们没有任何缺省值，不然就是不存在该选项）。</span></p>
<p style="text-indent: 21pt" class="MsoNormal">5<span lang="ZH-CN">、选项周围的方括号表示如果在命令行中没有指定该选项，则用户将得到要求输入其值的提示。（对于</span> -keypass <span lang="ZH-CN">选项，如果在命令行中没有指定该选项，</span>keytool <span lang="ZH-CN">将先是尝试用密钥仓库口令来访问私钥，如果失败，再提示您输入私钥口令。）</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">6<span lang="ZH-CN">、斜体项（选项）代表必须提供实际值。例如，下面是</span> -printcert <span lang="ZH-CN">命令的格式：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160; </span>keytool -printcert {-file cert_file} {-v}</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">当指定</span> -printcert <span lang="ZH-CN">命令时，请用实际文件名来替代</span> cert_file<span lang="ZH-CN">，如下所示：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160; </span>keytool -printcert -file VScert.cer</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">如果选项值含有空白（空格），必须用引号把它们括起来。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">-help <span lang="ZH-CN">命令是缺省命令。因此，命令行</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160; </span>keytool</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">等价于</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160; </span>keytool -help</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">选项缺省值</span></p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">下面是各选项的缺省值：</span></p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">-alias &quot;mykey&quot;</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">-keyalg &quot;DSA&quot;</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">-keysize 1024</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">-validity 90</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">-keystore <span lang="ZH-CN">用户宿主目录中名为</span> .keystore <span lang="ZH-CN">的文件</span></p>
<p style="text-indent: 21pt" class="MsoNormal">-file <span lang="ZH-CN">读时为标准输入，写时为标准输出</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">签名算法（</span>-sigalg <span lang="ZH-CN">选项）是由所涉及私钥的算法推导而来的：如果所涉及的私钥是“</span>DSA<span lang="ZH-CN">”类型，则</span> -sigalg <span lang="ZH-CN">选项将缺省为“带</span> DSA <span lang="ZH-CN">的</span> SHA1<span lang="ZH-CN">”，如果所涉及的私钥是“</span>RSA<span lang="ZH-CN">”类型，则</span> -sigalg <span lang="ZH-CN">选项将缺省为“带</span> RSA <span lang="ZH-CN">的</span> MD5<span lang="ZH-CN">”。</span></p>
<p style="text-indent: 21pt" class="MsoNormal">-v <span lang="ZH-CN">选项可出现在除</span> -help <span lang="ZH-CN">之外的所有命令中。如果出现该选项，表示处在“长格式”模式下；将输出详细的证书信息。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">-javaoption<span>&#160; </span><span lang="ZH-CN">选项也可在任何命令中出现。如果出现该选项，则所指定的</span> javaoption <span lang="ZH-CN">字符串将被直接传给</span> Java <span lang="ZH-CN">解释器。（</span>keytool <span lang="ZH-CN">实际上是解释器周围的一个</span><span lang="ZH-CN"> </span><span lang="ZH-CN">“</span>wrapper<span lang="ZH-CN">”。）</span><span lang="ZH-CN"> </span><span lang="ZH-CN">该选项不应含有任何空格。它有助于调整执行环境或内存使用。要获得可用的解释器选项的清单，可在命令行键入</span><span>&#160; </span>java -h <span lang="ZH-CN">或</span> java -X<span lang="ZH-CN">。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">有三个选项可出现在用于操作密钥仓库的所有命令中：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">-storetype storetype </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">此限定符指定将被实例化的密钥仓库类型。缺省的密钥仓库类型是安全属性文件中“</span>keystore.type<span lang="ZH-CN">”属性值所指定的那个类型，由</span> java.security.KeyStore <span lang="ZH-CN">中的静态方法</span> getDefaultType <span lang="ZH-CN">返回。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">-keystore keystore </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">密钥仓库（数据库文件）的位置。缺省情况下，密钥仓库指的是用户宿主目录的</span> .keystore <span lang="ZH-CN">文件，它是由“</span>user.home<span lang="ZH-CN">”的系统属性确定的。在</span> Solaris <span lang="ZH-CN">系统中，“</span>user.home<span lang="ZH-CN">”缺省为用户宿主目录。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">-storepass storepass </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">口令，用来保护密钥仓库的完整性。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">storepass <span lang="ZH-CN">的长度必须至少为</span> 6 <span lang="ZH-CN">个字符。所有访问密钥仓库内容的命令都必须提供这一选项。对于这些命令，如果没有给出</span> -storepass <span lang="ZH-CN">选项，则用户将得到要求输入该选项的提示。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">当从密钥仓库中检索信息时，口令属于可选项；如果未给出口令，就不能检查所检索信息的完整性，而且将出现警告。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">大多数对密钥仓库操作的命令都要求仓库口令。一些命令要求私钥口令。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">生成密钥：</span></p>
<p style="text-indent: 21pt" class="MsoNormal">-genkey {-alias alias} {-keyalg keyalg} {-keysize keysize} {-sigalg sigalg} [-dname dname] [-keypass keypass] {-validity valDays} {-storetype storetype} {-keystore keystore} [-storepass storepass] {-v} {-Jjavaoption} </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">该命令产生密钥对（公钥和与之关联的私钥）。将公钥打包进</span> X.509 v1 <span lang="ZH-CN">的自签名证书中，该证书以单元素证书链的形式储存。该证书链和私钥将储存于</span> alias <span lang="ZH-CN">所标识的新密钥仓库项中。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">keyalg <span lang="ZH-CN">指定了用于生成密钥对的算法，而</span> keysize <span lang="ZH-CN">指定要生成的每个密钥的大小。</span>sigalg <span lang="ZH-CN">指定签名自签名证书所用的算法；这一算法必须与</span> keyalg <span lang="ZH-CN">兼容。参见支持的算法和密钥大小。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">dname <span lang="ZH-CN">指定与</span> alias <span lang="ZH-CN">关联的</span> X.500 <span lang="ZH-CN">特征名，并用作自签名证书中的</span> issuer <span lang="ZH-CN">和</span> subject <span lang="ZH-CN">域。如果在命令行中没有提供特征名，用户将得到要求输入该信息的提示。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">keypass<span>&#160; </span><span lang="ZH-CN">是口令，用来保护所生成密钥对中的私钥。如果没有提供口令，用户将得到要求输入口令的提示。如果在提示符下按</span> RETURN <span lang="ZH-CN">键，则密钥口令将被设置为与密钥仓库所用的口令相同。</span>keypass <span lang="ZH-CN">的长度必须至少为</span> 6 <span lang="ZH-CN">个字符。使用口令时必须小心</span> - <span lang="ZH-CN">参见</span><span lang="ZH-CN"> </span><span lang="ZH-CN">与口令有关的警告。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">valDays <span lang="ZH-CN">指定证书的有效期。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">导入证书：</span></p>
<p style="text-indent: 21pt" class="MsoNormal">-import {-alias alias} {-file cert_file} [-keypass keypass] {-noprompt} {-trustcacerts} {-storetype storetype} {-keystore keystore} [-storepass storepass] {-v} {-Jjavaoption} </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">从文件</span> cert_file <span lang="ZH-CN">中读取证书或证书链（后者在</span> PKCS#7 <span lang="ZH-CN">格式的答复所给出）并将其储存在</span> alias <span lang="ZH-CN">所标识的密钥仓库项中。如果没有给出文件，则从标准输入设备中读取证书或</span> PKCS#7 <span lang="ZH-CN">答复。</span>keytool <span lang="ZH-CN">可导入</span> X.509 v1<span lang="ZH-CN">、</span>v2 <span lang="ZH-CN">和</span> v3 <span lang="ZH-CN">的证书以及由该类证书所组成的</span><span lang="ZH-CN"> </span><span>&#160;</span>PKCS#7 <span lang="ZH-CN">格式的证书链。要导入的数据必须是二进制编码格式或</span> Internet RFC 1421 <span lang="ZH-CN">标准所定义的可打印的编码格式（也称</span><span>&#160; </span>Base64 <span lang="ZH-CN">编码）。在后一种情况下，编码必须用以“</span>-----BEGIN<span lang="ZH-CN">”开头的字符串开始，用以“</span>-----END<span lang="ZH-CN">”结尾的字符串来结束。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">当导入新的可信任证书时，密钥仓库中还没有</span> alias<span lang="ZH-CN">。在把证书添加到密钥仓库中之前，</span>keytool <span lang="ZH-CN">将尝试用密钥仓库中已有的可信任证书来构造从该证书到自签名证书（属于根</span> CA<span lang="ZH-CN">）的信任链，以对证书进行校验。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">如果指定了</span> -trustcacerts <span lang="ZH-CN">选项，则将为该信任链考虑其它证书，即考虑名为“</span>cacerts<span lang="ZH-CN">”的文件中的证书，该文件位于</span> JDK <span lang="ZH-CN">安全属性目录</span> java.home\lib\security <span lang="ZH-CN">中，其中</span> java.home <span lang="ZH-CN">为</span> JDK <span lang="ZH-CN">安装目录。“</span>cacerts<span lang="ZH-CN">”文件代表含有</span> CA <span lang="ZH-CN">证书的系统范围的密钥仓库。通过指定密钥仓库类型为“</span>jks<span lang="ZH-CN">”，系统管理员可用</span> keytool <span lang="ZH-CN">来配置和管理该文件。“</span>cacerts<span lang="ZH-CN">”密钥仓库文件发送时附有五个</span> VeriSign <span lang="ZH-CN">根</span> CA <span lang="ZH-CN">证书，其</span> X.500 <span lang="ZH-CN">特征名如下：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">1. OU=Class 1 Public Primary Certification Authority, O=&quot;VeriSign, Inc.&quot;,</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">C=US</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">2. OU=Class 2 Public Primary Certification Authority, O=&quot;VeriSign,</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">Inc.&quot;, C=US</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">3. OU=Class 3 Public Primary Certification Authority,</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">O=&quot;VeriSign, Inc.&quot;, C=US</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">4. OU=Class 4 Public Primary Certification</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">Authority, O=&quot;VeriSign, Inc.&quot;, C=US</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">5. OU=Secure Server Certification</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">Authority, O=&quot;RSA Data Security, Inc.&quot;, C=US</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">“</span>cacerts<span lang="ZH-CN">”密钥仓库文件的初始口令为“</span>changeit<span lang="ZH-CN">”</span><span lang="ZH-CN"> </span><span lang="ZH-CN">。系统管理员在安装</span> JDK <span lang="ZH-CN">后，就应该立即更改这个口令以及该文件的缺省访问权限。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">如果</span> keytool <span lang="ZH-CN">无法建立从要导入的证书到自签名证书的信任路径（利用密钥仓库或“</span>cacerts<span lang="ZH-CN">”文件），则打印出该证书的信息，而用户将得到要求校验的提示，例如，系统将通知用户通过比较显示出的指纹和得自其它（可信任的）信息来源的指纹来进行校验，信息来源可能是证书拥有者本人。在将证书作为一个“可信任”证书导入之前，要十分小心，务必保证该证书是有效的！然后，用户可以选择中止导入操作。但是，如果给了</span> -noprompt <span lang="ZH-CN">选项，则不会有与用户的交互。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">当导入认证答复时，该认证答复将用密钥仓库中可信任的证书来确认，有时也使用在“</span>cacerts<span lang="ZH-CN">”密钥仓库文件中配置的证书（如果指定了</span> -trustcacerts <span lang="ZH-CN">选项）。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">如果答复是一个</span> X.509 <span lang="ZH-CN">证书，</span>keytool <span lang="ZH-CN">将尝试建立信任链，以该认证答复为头，以属于根</span> CA <span lang="ZH-CN">的自签名证书为尾。该认证答复和用于认证该认证答复的证书层次形成了</span> alias <span lang="ZH-CN">的新证书链。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">如果答复是</span> PKCS#7 <span lang="ZH-CN">格式的证书链，则该链应首先被排序（用户证书在最前面，自签名的根</span> CA <span lang="ZH-CN">证书在最后面），然后</span> keytool <span lang="ZH-CN">尝试将答复中的根</span> CA <span lang="ZH-CN">证书与密钥仓库或“</span>cacerts<span lang="ZH-CN">”密钥仓库文件（如果指定了</span> -trustcacerts <span lang="ZH-CN">选项）中的任何可信任证书进行匹配。如果找不到匹配，则打印出该根</span> CA <span lang="ZH-CN">证书的信息，而用户将得到要求校验它的提示，例如，系统将通知用户通过比较显示出的指纹和得自其它（可信任的）信息来源的指纹来进行校验，信息来源可能是证书拥有者本人。因此，用户可以选择中止导入操作。但是，如果给了</span> -noprompt <span lang="ZH-CN">选项，则不会有与用户的交互。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">alias<span>&#160; </span><span lang="ZH-CN">的新证书链将取代与该项关联的旧证书链。只有提供了有效的</span> keypass<span lang="ZH-CN">，即提供了用于保护该项的私钥的口令时，旧链才可被取代。如果没有提供口令，而且私钥口令与密钥仓库口令不同，用户将得到要求输入口令的提示。</span></p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">-selfcert {-alias alias} {-sigalg sigalg} {-dname dname} {-validity valDays} [-keypass keypass] {-storetype storetype} {-keystore keystore} [-storepass storepass] {-v} {-Jjavaoption} </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">利用密钥仓库信息（包括与</span> alias <span lang="ZH-CN">关联的私钥和公钥）产生</span> X.509 v1 <span lang="ZH-CN">自签名证书。如果在命令行提供了</span> dname<span lang="ZH-CN">，它将同时用作该证书的签发人和主体的</span> X.500 <span lang="ZH-CN">特征名。否则，将使用与</span> alias <span lang="ZH-CN">关联的</span> X.500 <span lang="ZH-CN">特征名（位于其现有证书链底部）。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">所生成的证书作为</span> alias <span lang="ZH-CN">所标识的密钥仓库项中的单元素证书链来存储，它将取代现有的证书链。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">sigalg <span lang="ZH-CN">指定签名证书用的算法。参见支持的算法和密钥大小。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">要访问私钥，必须提供正确的口令，因为私钥在密钥仓库中是受口令保护的。如果在命令行中没有提供</span> keypass<span lang="ZH-CN">，且私钥口令与保护密钥仓库完整性所用的口令不同，则用户将得到要求输入该口令的提示。</span></p>
<p style="text-indent: 21pt" class="MsoNormal">valDays <span lang="ZH-CN">指定证书的有效期。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">-identitydb {-file idb_file} {-storetype storetype} {-keystore keystore} [-storepass storepass] {-v} {-Jjavaoption} </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">从</span> idb_file <span lang="ZH-CN">文件中读取</span> JDK 1.1.x <span lang="ZH-CN">格式的身份数据库，并将它的项加到密钥仓库中。如果没有给出文件名，则从标准输入设备中读取身份数据库。如果不存在密钥仓库，则创建它。</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">只有被标记为可信任的身份数据库项（“身份”）才能被导入密钥仓库中。所有其它身份都将被略去。对每个可信任的身份，将创建一个密钥仓库项。身份名用作该密钥仓库项的“别名”。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">所有可信任身份的私钥都将在相同的口令</span> storepass <span lang="ZH-CN">下得到加密。该口令与保护密钥仓库完整性所用的口令相同。用户随后可用</span> keytool <span lang="ZH-CN">命令选项“</span>-keypasswd<span lang="ZH-CN">”来对各私钥赋予单独的口令。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">身份数据库中的一个身份可以存放多个证书，各证书所认证的都是同一公钥。但一个私钥的密钥仓库密钥项含有该私钥和单一的“证书链”（该链最初只有一个证书），链中的第一个证书含有与该私钥对应的公钥。当从身份导入信息时，只有该身份中的第一个证书被储存到密钥仓库中。这是因为身份数据库中的身份名被用作其相应密钥仓库项的别名，而别名在密钥仓库中是唯一的。</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">导出数据：</span></p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">-certreq {-alias alias} {-sigalg sigalg} {-file certreq_file} [-keypass keypass] {-storetype storetype} {-keystore keystore} [-storepass storepass] {-v} {-Jjavaoption} </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">生成</span> PKCS#10 <span lang="ZH-CN">格式的证书签名请求</span> (CSR)<span lang="ZH-CN">。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">CSR <span lang="ZH-CN">用来发送给认证机构</span> (CA)<span lang="ZH-CN">。</span>CA <span lang="ZH-CN">对认证请求者进行认证（通常是离线的），并返回证书或证书链，以取代密钥仓库中现有的证书链（该证书链最初只含有自签名证书）。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">私钥和与</span> alias <span lang="ZH-CN">关联的</span> X.500 <span lang="ZH-CN">特征名用于创建</span> PKCS#10 <span lang="ZH-CN">证书请求。要访问私钥，必须提供正确的口令，因为私钥在库中是受口令保护的。如果在命令行没有提供</span> keypass<span lang="ZH-CN">，且私钥口令与保护密钥仓库完整性所用的口令不同，则用户将得到要求输入口令的提示。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">sigalg <span lang="ZH-CN">指定签名</span> CSR <span lang="ZH-CN">时用的算法。参见支持的算法和密钥大小。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">CSR <span lang="ZH-CN">存储在文件</span> certreq_file <span lang="ZH-CN">中。如果没有给出文件名，</span>CSR <span lang="ZH-CN">将被输出到标准输出设备中。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">用</span> import <span lang="ZH-CN">命令来导入</span> CA <span lang="ZH-CN">所返回的答复。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">-export {-alias alias} {-file cert_file} {-storetype storetype} {-keystore keystore} [-storepass storepass] {-rfc} {-v} {-Jjavaoption} </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">从密钥仓库中读取与</span> alias <span lang="ZH-CN">关联的证书，并将其储存在文件</span> cert_file <span lang="ZH-CN">中。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">如果没有给出文件名，证书将被输出到标准输出设备中。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">缺省情况下，证书被输出为二进制编码格式，但如果指定了</span> -rfc <span lang="ZH-CN">选项，则将被输出为</span> Internet RFC 1421 <span lang="ZH-CN">标准中定义的可打印格式。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">如果</span> alias <span lang="ZH-CN">引用的是可信任证书，则该证书将被输出。否则，</span>alias <span lang="ZH-CN">引用的是含有相关证书链的密钥项。在这种情况下，链中的第一个证书将被返回。该证书对由</span> alias <span lang="ZH-CN">所指定的实体的公钥进行认证。</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">显示数据：</span></p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">-list {-alias alias} {-storetype storetype} {-keystore keystore} [-storepass storepass] {-v | -rfc} {-Jjavaoption} </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">打印（到标准输出设备中）</span>alias <span lang="ZH-CN">所标识的密钥仓库项的内容。如果没有指定别名，则将打印整个密钥仓库的内容。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">缺省情况下，该命令打印证书的</span> MD5 <span lang="ZH-CN">指纹。如果指定了</span> -v <span lang="ZH-CN">选项，证书将以可读格式打印，同时包含拥有者、签发人和序列号等附加信息。如果指定了</span>??-rfc <span lang="ZH-CN">选项，证书将以</span> Internet RFC 1421 <span lang="ZH-CN">标准所定义的可打印的编码格式打印。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">不能同时指定</span> -v <span lang="ZH-CN">和</span> -rfc <span lang="ZH-CN">两个选项。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">-printcert {-file cert_file} {-v} {-Jjavaoption} </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">从文件</span> cert_file <span lang="ZH-CN">中读取证书将以可读格式打印其内容。如果没有给出文件名，则从标准输入设备中读取证书。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">证书可以是用二进制编码或</span> Internet RFC 1421 <span lang="ZH-CN">标准所定义的可打印编码格式。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">注意：该选项的使用与密钥仓库无关。</span></p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">管理密钥仓库：</span></p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">-keyclone {-alias alias} [-dest dest_alias] [-keypass keypass] [-new new_keypass] {-storetype storetype} {-keystore keystore} [-storepass storepass] {-v} {-Jjavaoption} </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">生成新的密钥仓库项，该项含有的私钥和证书链与原始项的相同。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">原始项由</span> alias <span lang="ZH-CN">（如果没有提供别名，则其值缺省为“</span>mykey<span lang="ZH-CN">”）标识。新（目标）项由</span> dest_alias <span lang="ZH-CN">标识。如果没有在命令行中提供目标别名，用户将得到要求输入该信息的提示。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">如果私钥口令与密钥仓库口令不同，那么，只有提供了有效的</span> keypass <span lang="ZH-CN">时该项才能被复制。</span>keypass <span lang="ZH-CN">是用于保护与</span> alias <span lang="ZH-CN">关联的私钥的口令。如果没有在命令行提供密钥口令，且私钥口令与密钥仓库口令不同，用户将得到要求输入口令的提示。如果愿意，可用不同的口令来保护复制项中的私钥。如果没有在命令行提供</span> -new <span lang="ZH-CN">选项，用户将得到提示要求输入新项的口令（可以选择让该口令与被复制项的私钥所用的口令相同）。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">该命令可用于建立多个与给定密钥对相对应的证书链，或用于备份。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">-storepasswd [-new new_storepass] {-storetype storetype} {-keystore keystore} [-storepass storepass] {-v} {-Jjavaoption} </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">更改保护密钥仓库内容的完整性所用的口令。新口令为</span> new_storepass<span lang="ZH-CN">，其长度必须至少是</span> 6 <span lang="ZH-CN">个字符。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">-keypasswd {-alias alias} [-keypass old_keypass] [-new new_keypass] {-storetype storetype} {-keystore keystore} [-storepass storepass] {-v} {-Jjavaoption} </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">把保护</span> alias <span lang="ZH-CN">所标识的私钥的口令从</span> old_keypass <span lang="ZH-CN">更改为</span> new_keypass<span lang="ZH-CN">。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">如果没有在命令行提供</span> keypass <span lang="ZH-CN">选项，且私钥口令与密钥仓库口令不同，则用户将得到要求输入该口令的提示。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">如果没有在命令行给出</span> -new <span lang="ZH-CN">选项，则用户将得到要求输入新口令的提示。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">-delete [-alias alias] {-storetype storetype} {-keystore keystore} [-storepass storepass] {-v} {-Jjavaoption} </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">从密钥仓库中删除</span> alias <span lang="ZH-CN">所标识的项。如果没有在命令行上提供别名，则用户将得到要求输入别名的提示。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">获取帮助：</span></p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">-help </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">列出所有的命令及其选项及示例。</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">假设您要创建一个密钥仓库以管理您的公钥</span>/<span lang="ZH-CN">私钥对来自您所信任实体的证书。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">1<span lang="ZH-CN">、您首先要做的是创建一个密钥仓库和生成密钥对。您可以使用以下命令：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -genkey -dname &quot;cn=Mark Jones, ou=JavaSoft, o=Sun, c=US&quot;</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160;&#160;&#160; </span>-alias business -keypass kpi135 -keystore /working/mykeystore</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160;&#160;&#160; </span>-storepass ab987c -validity 180</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">（请注意：键入该命令时必须使其成为一行。此处用多行来显示，主要是为了可读性。）</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">该命令将在</span> C <span lang="ZH-CN">盘的“</span>working<span lang="ZH-CN">”目录（假设它还不存在）中创建名为“</span>mykeystore<span lang="ZH-CN">”的密钥仓库，并赋予它口令“</span>ab987c<span lang="ZH-CN">”。它将为实体生成公钥</span>/<span lang="ZH-CN">私钥对，该实体的“特征名”为：常用名“</span>Mark Jones<span lang="ZH-CN">”、组织单位“</span>JavaSoft<span lang="ZH-CN">”、组织“</span>Sun<span lang="ZH-CN">”和两个字母的国家代码</span><span lang="ZH-CN"> </span><span lang="ZH-CN">“</span>US<span lang="ZH-CN">”。它使用缺省的“</span>DSA<span lang="ZH-CN">”密钥生成算法来创建密钥，两个密钥（公钥与私钥）的长度都是</span> 1024 <span lang="ZH-CN">位。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">它创建自签名证书（使用缺省的“带</span> DSA <span lang="ZH-CN">的</span> SHA1<span lang="ZH-CN">”签名算法），该证书包括公钥和特征名信息。该证书的有效期为</span> 180 <span lang="ZH-CN">天，且与别名“</span>business<span lang="ZH-CN">”所代表的密钥仓库项关联。私钥被赋予口令“</span>kpi135<span lang="ZH-CN">”。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">如果采用选项的缺省值，可以大大缩短该命令。实际上，这些选项并不是必需的；对于有缺省值的选项，未指定时将使用缺省值，对于任何被要求的值，您将会得到要求输入它的提示。因此，您可以只使用下面的命令：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -genkey</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">这种情况下，将创建一个具有别名“</span>mykey<span lang="ZH-CN">”的密钥仓库项，它含有新生成的密钥对和有效期为</span> 90 <span lang="ZH-CN">天的证书。该项被放在您的宿主目录下一个名为</span><span lang="ZH-CN"> </span><span lang="ZH-CN">“</span>.keystore<span lang="ZH-CN">”的密钥仓库中（如果该密钥仓库并不存在，则将创建它）。您将得到要求输入特征名信息、密钥仓库口令和私钥口令的提示。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">其余示例假设您执行了未指定选项的</span> -genkey <span lang="ZH-CN">命令，且用上述第一个</span> -genkey <span lang="ZH-CN">命令中给出的值来回答提示要求（私钥口令为“</span>kpi135<span lang="ZH-CN">”等等）。</span></p>
<p style="text-indent: 21pt" class="MsoNormal">2<span lang="ZH-CN">、从认证机构请求已签名的证书</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">目前为止我们所具有的就是自签名证书。证书如果由认证机构</span> (CA) <span lang="ZH-CN">签名，将更有可能得到别人的信任。要得到这样的签名，首先要用以下命令生成证书签名请求</span> (CSR)<span lang="ZH-CN">：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -certreq -file MarkJ.csr</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">这将为缺省别名“</span>mykey<span lang="ZH-CN">”所标识的实体生成</span> CSR<span lang="ZH-CN">，并将此请求放在名为“</span>MarkJ.csr<span lang="ZH-CN">”的文件中。将此文件提交给某个</span> CA<span lang="ZH-CN">（例如</span><span>&#160; </span>VeriSign, Inc.<span lang="ZH-CN">）。该</span> CA <span lang="ZH-CN">将对您这个请求者进行认证（通常是离线的），然后返回它们所签名的证书，用于认证您的公钥。（某些情况下，它们实际上将返回证书链，链中每个证书都认证前一个证书的签名人的公钥。）</span></p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">3<span lang="ZH-CN">、导入</span> CA <span lang="ZH-CN">的证书</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">自签名证书必须用证书链代替，链中的每个证书都认证前一个证书的签名人的公钥，直到“根”</span>CA <span lang="ZH-CN">为止。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">在导入</span> CA <span lang="ZH-CN">的答复之前，在您的密钥仓库中或</span> cacerts <span lang="ZH-CN">密钥仓库文件（如导入命令中所述）中需要有一个或多个“可信任”证书：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">如果该认证答复是个证书链，您只需要链中最顶部的证书（即用于认证根</span> CA <span lang="ZH-CN">的公钥的“根”</span> CA <span lang="ZH-CN">证书）。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">如果该认证答复是单个证书，您需要发放</span> CA<span lang="ZH-CN">（即签名该证书的认证机构）的证书，如果此证书不是自签名的，则需其签名人的证书，以此类推，直到自签名的“根”</span> CA <span lang="ZH-CN">证书为止。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">“</span>cacerts<span lang="ZH-CN">”</span><span lang="ZH-CN"> </span><span lang="ZH-CN">密钥仓库文件发送时附有五个</span> VeriSign <span lang="ZH-CN">根</span> CA <span lang="ZH-CN">证书，因此您可能并不需要导入</span> VeriSign <span lang="ZH-CN">证书以作为密钥仓库中的可信任证书。但如果您请求由另一个</span> CA <span lang="ZH-CN">签名的证书，而认证该</span> CA <span lang="ZH-CN">的公钥的证书未被加到“</span>cacerts<span lang="ZH-CN">”中，则您需要将来自该</span> CA <span lang="ZH-CN">的证书作为“可信任证书”导入。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">来自</span> CA <span lang="ZH-CN">的证书通常是自签名的或是由另一个</span> CA <span lang="ZH-CN">签名的（这种情况下您还需要认证该</span> CA <span lang="ZH-CN">的公钥的证书）。假设</span> ABC, Inc. <span lang="ZH-CN">公司是</span> CA<span lang="ZH-CN">，而您从该公司获得一个声称是自签名证书的名为“</span>ABCCA.cer<span lang="ZH-CN">”的文件，它用于认证该</span> CA <span lang="ZH-CN">的公钥。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">在将证书作为一个“可信任”证书导入之前，要十分小心，务必保证该证书是有效的！先查看一下（用</span> keytool -printcert <span lang="ZH-CN">命令，或用不带</span><span>&#160; </span>-noprompt <span lang="ZH-CN">选项的</span> keytool -import <span lang="ZH-CN">命令）以确保所显示的证书指纹与所预计的相匹配。然后可以给发送证书的人打电话，将您所看到的指纹与他们所提供的（或安全公钥储存库所显示的）进行比较。只有两者相等才可保证证书在传送途中没有被其它人（例如，攻击者）的证书所更换。如果发生了这样的攻击，而您未检查证书即将其导入，那么您就会信任攻击者所签名的任何东西。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">如果您相信证书是有效的，则您可以用以下命令将其加到密钥仓库中：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -import -alias abc -file ABCCA.cer</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">这将在密钥仓库中用文件“</span>ABCCA.cer<span lang="ZH-CN">”中的数据创建“可信任证书”项，并将别名“</span>abc<span lang="ZH-CN">”赋予该项。</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">导入来自</span> CA <span lang="ZH-CN">的认证答复</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">一旦导入了用于认证</span> CA<span lang="ZH-CN">（该</span> CA <span lang="ZH-CN">是您将证书签名请求送往之处）公钥的证书后，或在“</span>cacerts<span lang="ZH-CN">”文件中已有这种证书时，就可以导入该认证答复，从而用证书链取代您的自签名证书。如果</span> CA <span lang="ZH-CN">的答复是证书链，则该链是</span> CA <span lang="ZH-CN">响应您的请求而返回的证书链；如果</span> CA <span lang="ZH-CN">的答复是一个证书，则该链是用认证答复和可信任证书建立的证书链，这些可信任证书是密钥仓库（您要将认证答复导入之处）或“</span>cacerts<span lang="ZH-CN">”密钥仓库文件中已有的。</span> </p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">例如，假设您将证书签名请求送往</span> VeriSign<span lang="ZH-CN">。您可用以下命令来导入认证答复，该命令假定所返回的证书名为“</span>VSMarkJ.cer<span lang="ZH-CN">”：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -import -trustcacerts -file VSMarkJ.cer</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">导出用于认证您的公钥的证书</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">认证签名的一种方法是先将您的公钥证书作为“可信任”项导入它们的密钥仓库中。您可以将证书导出并将其提供给客户机。例如，假设项的别名为“</span>mykey<span lang="ZH-CN">”，您可以用以下命令将您的证书导出到名为</span> MJ.cer <span lang="ZH-CN">的文件中：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -export -alias mykey -file MJ.cer</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal">4<span lang="ZH-CN">、更改特征名但保留密钥对</span></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">假设，譬如说因为您换了部门或搬到另一个城市去了而改变了您的特征名。如果愿意，您仍然可以使用您先前使用的公钥</span>/<span lang="ZH-CN">私钥对而只对特征名进行更新。例如，假设您的名字叫</span> Susan Miller<span lang="ZH-CN">，并用别名</span> sMiller <span lang="ZH-CN">和以下的特征名创建了初始密钥项：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160; </span>&quot;cn=Susan Miller, ou=Finance Department, o=BlueSoft, c=us&quot;</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">假设您从财务部门换到了会计部门。您仍然可使用先前所生成的公钥</span>/<span lang="ZH-CN">私钥对，而用以下方法对特征名进行更新。首先，复制您的密钥项：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -keyclone -alias sMiller -dest sMillerNew</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">（您将得到要求输入密钥仓库口令和初始密钥口令及目标密钥口令的提示，因为在命令行没有提供这些信息。）现在，您需要更改与复制项关联的证书链以使链中的第一个证书使用您的新特征名。先用相应名称生成自签名证书：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -selfcert -alias sMillerNew</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160;&#160;&#160; </span>-dname &quot;cn=Susan Miller, ou=Accounting Department, o=BlueSoft, c=us&quot;</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">然后根据该新证书中的信息生成证书签名请求：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -certreq -alias sMillerNew</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">当您得到</span> CA <span lang="ZH-CN">认证答复后，将其导入：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -import -alias sMillerNew -file VSSMillerNew.cer</p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span lang="ZH-CN">导入认证答复后，您也许会要删除使用旧特征名的初始密钥项：</span> </p>
<p style="text-indent: 21pt" class="MsoNormal">
<p>&#160;</p></p>
<p style="text-indent: 21pt" class="MsoNormal"><span>&#160;&#160;&#160; </span>keytool -delete -alias sMiller</p>
