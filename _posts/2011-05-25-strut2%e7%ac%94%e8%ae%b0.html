---
layout: post
title: strut2笔记
date: 2011-05-25 08:36:57.000000000 +01:00
type: post
published: true
status: publish
categories:
- java
tags:
- struts2 java
meta:
  views: '32'
author:
  login: ig2net
  email: ig2net@ig2net.info
  display_name: "农夫一号"
  first_name: ''
  last_name: ''
---
<p>1:plugin-tiles在jdk1.4下面有问题，ServletContextListener重写一下可以解决问题。代码如下：（注意使用 RETROTRANSLATOR转换jdk5 编译的包时需要指明classpath=&quot;jdk1.4/rt.jar的路径&quot;）   <br /><a href="https://issues.apache.org/struts/browse/WW-2897">https://issues.apache.org/struts/browse/WW-2897</a>    <br />package co.ntelagent.client.web.ps.application;    <br />import java.util.HashMap;    <br />import java.util.Map;    <br />import javax.servlet.ServletContext;    <br />import javax.servlet.ServletContextEvent;    <br />import javax.servlet.ServletContextListener;    <br />import org.apache.commons.logging.Log;    <br />import org.apache.commons.logging.LogFactory;    <br />import org.apache.struts2.tiles.ConfiguredServletContext;    <br />import org.apache.struts2.tiles.StrutsTilesContainerFactory;    <br />import org.apache.tiles.TilesContainer;    <br />import org.apache.tiles.TilesException;    <br />import org.apache.tiles.access.TilesAccess;    <br />import org.apache.tiles.factory.TilesContainerFactory;    <br />public class MyStrutsTilesListener implements ServletContextListener    <br />{    <br />&#160;&#160;&#160; /**    <br />&#160;&#160;&#160;&#160; * Log instance.    <br />&#160;&#160;&#160;&#160; */    <br />&#160;&#160;&#160; protected static final Log LOG =    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; LogFactory.getLog(MyStrutsTilesListener.class);    <br />&#160;&#160;&#160; private static final Map INIT;    <br />&#160;&#160;&#160; static     <br />&#160;&#160;&#160; {    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; INIT = new HashMap();    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; INIT.put(TilesContainerFactory.CONTAINER_FACTORY_INIT_PARAM,    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; StrutsTilesContainerFactory.class.getName());    <br />&#160;&#160;&#160; }    <br />&#160;&#160;&#160; /**    <br />&#160;&#160;&#160;&#160; * Initialize the TilesContainer and place it    <br />&#160;&#160;&#160;&#160; * into service.    <br />&#160;&#160;&#160;&#160; *    <br />&#160;&#160;&#160;&#160; * @param event The intercepted event.    <br />&#160;&#160;&#160;&#160; */    <br />&#160;&#160;&#160; public void contextInitialized(ServletContextEvent event)     <br />&#160;&#160;&#160; {    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ServletContext servletContext = event.getServletContext();    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; try     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; TilesContainer container = createContainer(servletContext);    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; TilesAccess.setContainer(servletContext, container);    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; catch (TilesException e)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; throw new IllegalStateException(&quot;Unable to instantiate container.&quot;);    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }    <br />&#160;&#160;&#160; }    <br />&#160;&#160;&#160; /**    <br />&#160;&#160;&#160;&#160; * Remove the tiles container from service.    <br />&#160;&#160;&#160;&#160; *    <br />&#160;&#160;&#160;&#160; * @param event The intercepted event.    <br />&#160;&#160;&#160;&#160; */    <br />&#160;&#160;&#160; public void contextDestroyed(ServletContextEvent event) {    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ServletContext servletContext = event.getServletContext();    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; try     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; TilesAccess.setContainer(servletContext, null);    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; catch (TilesException e) {    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LOG.warn(&quot;Unable to remove tiles container from service.&quot;);    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }    <br />&#160;&#160;&#160; }    <br />&#160;&#160;&#160; /**    <br />&#160;&#160;&#160;&#160; * Creates a Tiles container.    <br />&#160;&#160;&#160;&#160; *    <br />&#160;&#160;&#160;&#160; * @param context The servlet context to use.    <br />&#160;&#160;&#160;&#160; * @return The created container    <br />&#160;&#160;&#160;&#160; * @throws TilesException If something goes wrong during creation.    <br />&#160;&#160;&#160;&#160; */    <br />&#160;&#160;&#160; protected TilesContainer createContainer(ServletContext context)    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; throws TilesException     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(context.getInitParameter(TilesContainerFactory.CONTEXT_FACTORY_INIT_PARAM) == null) {    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; context = decorate(context);    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; else     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LOG.warn(&quot;Tiles container factory is explicitly set.&#160; Not injecting struts configuration.&quot;);    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; TilesContainerFactory factory =    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; TilesContainerFactory.getFactory(context);    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; return factory.createContainer(context);    <br />&#160;&#160;&#160; }    <br />&#160;&#160;&#160; protected ServletContext decorate(ServletContext context)     <br />&#160;&#160;&#160; {    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; return new ConfiguredServletContext(context, INIT);    <br />&#160;&#160;&#160; }    <br />}    <br />2:plugin-tiles此时还不支持velocity视图，但支持freemarker(必须以ftl做扩展名)和jsp混用    <br />3:action 配置后不需要明确指明method,使用时直接指向这个action,再指定method名称即可，调用时是只调用method方法。注意如果form指明了action,那么这个form的excute会执行，但是不会影响其内部元素的method的最终结果(而且会抛异常)，这样不好，一般不要再 form上指明action</p>
