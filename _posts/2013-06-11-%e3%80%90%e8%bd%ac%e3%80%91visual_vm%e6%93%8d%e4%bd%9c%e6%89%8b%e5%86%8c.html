---
layout: post
title: "【转】Visual_VM操作手册"
date: 2013-06-11 10:43:04.000000000 +01:00
type: post
published: true
status: publish
categories:
- java
tags:
- "内存泄露"
- "性能"
meta:
  views: '47'
author:
  login: ig2net
  email: ig2net@ig2net.info
  display_name: "农夫一号"
  first_name: ''
  last_name: ''
---
<div style="line-height: normal" class="Section1">
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: &#39;Book Antiqua&#39;" lang="EN-US">资源来自互联网，原作者不知出处，如果你觉得此转载侵犯了你的权益，请于管理员联系: <a href="mailto:admin@ureshika.com">admin@ureshika.com</a></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: &#39;Book Antiqua&#39;" lang="EN-US"><font face="Book Antiqua"><font style="font-size: 56pt"></font></font></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: &#39;Book Antiqua&#39;" lang="EN-US"><font face="Book Antiqua"><font style="font-size: 56pt">1 </font></font></span></b><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: &#39;Book Antiqua&#39;; mso-bidi-font-family: 黑体"><font face="黑体"><font style="font-size: 21.5pt">什么是 </font></font></span><font style="font-size: 21.5pt"><b><span style="font-family: ; color: ; mso-fareast-font-family: 黑体; mso-font-kerning: 0pt" lang="EN-US"><font face="Calibri">Visual VM</font></span></b></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 黑体"><font face="黑体"><font style="font-size: 21.5pt">？</font><span lang="EN-US"><font style="font-size: 21.5pt"> </font></span></font></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-outline-level: 1" class="MsoNormal" align="left"><font face="Cambria"><b><span style="font-family: ; color: ; mso-fareast-font-family: 黑体; mso-font-kerning: 0pt; mso-bidi-font-family: cambria" lang="EN-US"><font style="font-size: 15.5pt">1.1 </font></span></b><font style="font-size: 15.5pt"><span style="font-family: ; color: ; mso-fareast-font-family: 黑体; mso-font-kerning: 0pt; mso-bidi-font-family: cambria; mso-bidi-font-weight: bold" lang="EN-US">Visual VM</span></font></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: cambria; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 15.5pt">简介 </font><span lang="EN-US"></span></font></span></p>
<p style="text-indent: 24pt; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-char-indent-count: 2.0" class="MsoNormal" align="left"><font face="宋体"><font color="#323232"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: cambria; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">VisualVM </font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: cambria; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">提供在<span lang="EN-US"> Java </span>虚拟机<span lang="EN-US"> (Java Virutal Machine, JVM) </span>上运行的<span lang="EN-US"> Java </span>应用程序的详细信息。在<span lang="EN-US"> VisualVM </span>的图形用户界面中，您可以方便、快捷地查看多个<span lang="EN-US"> Java </span>应用程序的相关信息。（摘自官方） 简单说来，<span lang="EN-US">VisualVM</span>是一种集成了多个<span lang="EN-US">JDK</span>命令行工具的可视化工具，它能为您提供强大的分析能力。所有这些都是免费的！它囊括的命令行工具包括<span lang="EN-US">jstat, JConsole, jstack, jmap </span>和<span lang="EN-US"> jinfo</span>，这些工具与<span lang="EN-US">JDK</span>的标准版本是一致的。 可以使用<span lang="EN-US">VisualVM</span>生成和分析海量数据、跟踪内存泄漏、监控垃圾回收器、执行内存和<span lang="EN-US">CPU</span>分析，同时它还支持在<span lang="EN-US">MBeans</span>上进行浏览和操作。尽管<span lang="EN-US">VisualVM</span>自身要在<span lang="EN-US">JDK6</span>这个版本上运行，但是<span lang="EN-US">JDK1.4</span>以上版本的程序它都能监控。</font><span lang="EN-US"></span></span></font></font></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: cambria; mso-bidi-font-family: 宋体" lang="EN-US"><font face="宋体"><font style="font-size: 12pt" color="#323232">&#160;</font></font></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-outline-level: 1" class="MsoNormal" align="left"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: cambria" lang="EN-US"><font face="Cambria"><font style="font-size: 15.5pt">1.2 </font></font></span></b><font style="font-size: 15.5pt"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: cambria; mso-bidi-font-family: 宋体"><font face="宋体">如何获取</font></span></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: cambria; mso-bidi-font-weight: bold" lang="EN-US"><font face="Cambria"><font style="font-size: 15.5pt">VisualVM</font><b><font style="font-size: 15.5pt"> </font></b></font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: cambria" lang="EN-US"></span></p>
<p style="text-indent: 24pt; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-char-indent-count: 2.0" class="MsoNormal" align="left"><font face="宋体"><font color="#323232"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: cambria; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">VisualVM</font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: cambria; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">的一个最大好处就是，它已经在你的<span lang="EN-US">JDK bin</span>目录里了，只要你使用的是<span lang="EN-US">JDK1.6 Update7</span>之后的版本。点击一下<span lang="EN-US">jvisualvm.exe</span>图标它就可以运行了。</font><span lang="EN-US"><font style="font-size: 12pt"> </font></span></span></font></font></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><font face="宋体"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: cambria; mso-bidi-font-family: 宋体"><font color="#323232"><font style="font-size: 12pt">这里是<span lang="EN-US">VisualVM </span>的官方网站：</font></font></span><font style="font-size: 12pt"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: &#39;Book Antiqua&#39;; mso-bidi-font-family: 宋体" lang="EN-US"><font color="#0000ff">https://visualvm.dev.java.net</font></span></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: &#39;Book Antiqua&#39;; mso-bidi-font-family: 宋体"><font style="font-size: 12pt" color="#323232">，资料很全，同时提供<span lang="EN-US">VisualVM</span>最近版本下载。</font><span lang="EN-US"></span></span></font></p>
</p></div>
<p> <span style="line-height: normal; font-family: ; color: ; mso-hansi-font-family: &#39;Book Antiqua&#39;; mso-bidi-font-family: 宋体; mso-ansi-language: en-us; mso-fareast-language: zh-cn; mso-bidi-language: ar-sa" lang="EN-US">   <br style="page-break-before: auto; mso-break-type: section-break" clear="all" /></span>
<div style="line-height: normal" class="Section2">
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: &#39;Book Antiqua&#39;" lang="EN-US"><font face="Book Antiqua"><font style="font-size: 9pt" color="#323232">&#160;</font></font></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-outline-level: 1" class="MsoNormal" align="left"><font color="#323232"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: &#39;Book Antiqua&#39;" lang="EN-US"><font face="Book Antiqua"><font style="font-size: 56pt">2 </font></font></span></b><b><span style="font-family: ; color: ; mso-font-kerning: 0pt" lang="EN-US"><font face="Calibri"><font style="font-size: 21.5pt">Visual VM</font></font></span></b><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 黑体"><font face="黑体"><font style="font-size: 21.5pt">实战 </font><span lang="EN-US"></span></font></span></font></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-outline-level: 1" class="MsoNormal" align="left"><font color="#323232"><b><span style="font-family: ; color: ; mso-fareast-font-family: 黑体; mso-font-kerning: 0pt; mso-bidi-font-family: cambria" lang="EN-US"><font face="Cambria"><font style="font-size: 15.5pt">2.1 </font></font></span></b><font style="font-size: 15.5pt"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: cambria; mso-bidi-font-family: 宋体"><font face="宋体">开启</font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: cambria; mso-bidi-font-weight: bold" lang="EN-US"><font face="Cambria">Visual VM</font></span></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: cambria; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 15.5pt">之旅 </font><span lang="EN-US"></span></font></span></font></p>
<p style="text-indent: 24pt; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-char-indent-count: 2.0" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: cambria; mso-bidi-font-family: 宋体"><font face="宋体"><font color="#323232"><font style="font-size: 12pt">如果你使用的是<span lang="EN-US">JDK</span>是<span lang="EN-US">1.6Update7</span>之后的版本，那么<span lang="EN-US">Visual VM</span>已经包含在<span lang="EN-US">bin</span>目录下了，否则需要去官方下载。</font><span lang="EN-US"><font style="font-size: 12pt"> </font></span></font></font></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-outline-level: 1" class="MsoNormal" align="left"><font face="Calibri"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt" lang="EN-US"><font style="font-size: 15.5pt">2.1.1</font></span></b><font style="font-size: 15.5pt"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt" lang="EN-US"> </span></b></font></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 15.5pt">启动问题 </font><span lang="EN-US"></span></font></span></p>
<p style="text-indent: 24pt; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-char-indent-count: 2.0" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font color="#323232"><font style="font-size: 12pt">如果你在<span lang="EN-US">windows</span>上使用<span lang="EN-US">Visual VM</span>，需要做的只是点一下<span lang="EN-US">jvisualvm.exe</span>，就能启动它；绿色，好用。但是<span lang="EN-US">Visual VM</span>所在的分区如果是<span lang="EN-US">NTFS</span>格式，那么第一个问题就出现了：<span lang="EN-US">sun</span>对<span lang="EN-US">NTFS</span>格式的硬盘支持有问题！但可通过参数可避免，并完成启动。步骤如下：</font><span lang="EN-US"><font style="font-size: 12pt"> </font></span></font></font></span></p>
<p style="text-indent: 0cm; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-list: l4 level1 lfo1" class="MsoNormal" align="left"><font color="#323232"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><span style="mso-list: ignore"><span style="line-height: normal; font-family: "><font style="font-size: 7pt">&#160;&#160;&#160;&#160;&#160; </font></span></span></span><font face="宋体"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">1. </font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">创建一个<span lang="EN-US">visualvm.exe</span>的快捷方式</font><span lang="EN-US"><font style="font-size: 12pt"> </font></span></span></font></font></p>
<p style="text-indent: 0cm; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-list: l4 level1 lfo1" class="MsoNormal" align="left"><font color="#323232"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><span style="mso-list: ignore"><span style="line-height: normal; font-family: "><font style="font-size: 7pt">&#160;&#160;&#160;&#160;&#160; </font></span></span></span><font face="宋体"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">2. </font></span><font style="font-size: 12pt"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体">在</span></font></font><font style="font-size: 12pt"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-ascii-font-family: 宋体; mso-bidi-font-family: 宋体" lang="EN-US"><font face="Calibri">“</font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体">目标</font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-ascii-font-family: 宋体; mso-bidi-font-family: 宋体" lang="EN-US"><font face="Calibri">”</font></span></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt">中添加如下参数</font><span lang="EN-US"><font style="font-size: 12pt"> </font></span></font></span></font></p>
<p style="text-indent: 68.25pt; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-char-indent-count: 6.5" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-bidi-font-size: 10.5pt; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><font face="宋体"><font color="#323232">-XX:+PerfBypassFileSystemCheck</font></font></span></p>
</p></div>
<p> <span style="line-height: normal; font-family: ; color: ; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体; mso-ansi-language: en-us; mso-fareast-language: zh-cn; mso-bidi-language: ar-sa" lang="EN-US">   <br style="page-break-before: auto; mso-break-type: section-break" clear="all" /></span>
<div style="line-height: normal" class="Section3">
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: &#39;Book Antiqua&#39;" lang="EN-US"><a href="http://blog.ureshika.com/wp-content/uploads/2013/06/clip_image0024.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image002[4]" border="0" alt="clip_image002[4]" src="{{ site.baseurl }}/assets/clip_image0024_thumb.jpg" width="280" height="364" /></a></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: &#39;Book Antiqua&#39;" lang="EN-US"><font face="Book Antiqua"><font style="font-size: 9pt" color="#323232">&#160;</font></font></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-outline-level: 1" class="MsoNormal" align="left"><font color="#323232"><font face="Calibri"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt" lang="EN-US"><font style="font-size: 15.5pt">2.1.2</font></span></b><font style="font-size: 15.5pt"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt" lang="EN-US"> </span></b></font></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 15.5pt">界面简介 </font><span lang="EN-US"></span></font></span></font></p>
<p style="text-indent: 24pt; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-char-indent-count: 2.0" class="MsoNormal" align="left"><font face="宋体"><font color="#323232"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">Visual VM</font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">启动成功！可以看到<span lang="EN-US">Visual VM</span>的界面了。通过<span lang="EN-US">Visual VM</span>可以看到本机运行中的所有<span lang="EN-US">Java</span>应用。你会发现根本不需要在<span lang="EN-US">VisualVM </span>里为<span lang="EN-US">Java</span>应用程序注册，它们就会自动显示出来。甚至还可以在导航栏里查看到远程的<span lang="EN-US">Java</span>应用。导航栏即为<span lang="EN-US">Applications</span>，其中分为<span lang="EN-US">Local</span>（本地<span lang="EN-US">Java</span>应用）和<span lang="EN-US">Remote</span>（远程<span lang="EN-US">Java</span>应用）。 </font><span lang="EN-US"></span></span></font></font></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><a href="http://blog.ureshika.com/wp-content/uploads/2013/06/clip_image0044.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image004[4]" border="0" alt="clip_image004[4]" src="{{ site.baseurl }}/assets/clip_image0044_thumb.jpg" width="576" height="376" /></a></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-outline-level: 1" class="MsoNormal" align="left"><font face="Calibri"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt" lang="EN-US"><font style="font-size: 15.5pt">2.1.3</font></span></b><font style="font-size: 15.5pt"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt" lang="EN-US"> </span></b></font></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 15.5pt">安装插件 </font><span lang="EN-US"></span></font></span></p>
<p style="text-indent: 24pt; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-char-indent-count: 2.0" class="MsoNormal" align="left"><font face="宋体"><font color="#323232"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">Visual VM</font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">有很多好用的插件<span lang="EN-US">,</span>步骤如下：</font><span lang="EN-US"><font style="font-size: 12pt"> </font></span></span></font></font></p>
<p style="text-indent: 0cm; margin: 0cm 0cm 0pt 21pt; text-autospace: ; mso-layout-grid-align: none; mso-list: l1 level1 lfo2; mso-para-margin-left: 2.0gd" class="MsoNormal" align="left"><font color="#323232"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><span style="mso-list: ignore"><span style="line-height: normal; font-family: "><font style="font-size: 7pt">&#160;&#160;&#160;&#160;&#160; </font></span></span></span><font face="宋体"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">1. </font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">点击</font><span lang="EN-US"><font style="font-size: 12pt">Tools -&gt; Plugins</font></span></span></font></font></p>
</p></div>
<p> <span style="line-height: normal; font-family: ; color: ; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体; mso-ansi-language: en-us; mso-fareast-language: zh-cn; mso-bidi-language: ar-sa" lang="EN-US">   <br style="page-break-before: auto; mso-break-type: section-break" clear="all" /></span>
<div style="line-height: normal" class="Section4">
<p style="text-indent: 0cm; margin: 0cm 0cm 0pt 21pt; text-autospace: ; mso-layout-grid-align: none; mso-list: l0 level1 lfo3; mso-para-margin-left: 2.0gd" class="MsoNormal" align="left"><font color="#323232"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: &#39;Book Antiqua&#39;; mso-bidi-font-family: 宋体" lang="EN-US"><span style="mso-list: ignore"><span style="line-height: normal; font-family: "><font style="font-size: 7pt">&#160;&#160;&#160;&#160;&#160; </font></span></span></span><font face="宋体"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: &#39;Book Antiqua&#39;; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">2. </font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: &#39;Book Antiqua&#39;; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">推荐安装全部插件</font><span lang="EN-US"><font style="font-size: 12pt"> </font></span></span></font></font></p>
</p></div>
<p> <span style="line-height: normal; font-family: ; color: ; mso-hansi-font-family: &#39;Book Antiqua&#39;; mso-bidi-font-family: 宋体; mso-ansi-language: en-us; mso-fareast-language: zh-cn; mso-bidi-language: ar-sa" lang="EN-US">   <br style="page-break-before: auto; mso-break-type: section-break" clear="all" /></span>
<div style="line-height: normal" class="Section5">
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: &#39;Book Antiqua&#39;" lang="EN-US"><a href="http://blog.ureshika.com/wp-content/uploads/2013/06/clip_image0064.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image006[4]" border="0" alt="clip_image006[4]" src="{{ site.baseurl }}/assets/clip_image0064_thumb.jpg" width="576" height="383" /></a></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: &#39;Book Antiqua&#39;" lang="EN-US"><font face="Book Antiqua"><font style="font-size: 9pt" color="#323232">&#160;</font></font></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-outline-level: 1" class="MsoNormal" align="left"><font color="#323232"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt" lang="EN-US"><font face="Calibri"><font style="font-size: 15.5pt">2.2 </font></font></span></b><font style="font-size: 15.5pt"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体">监控本地</font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-weight: bold" lang="EN-US"><font face="Calibri">Java</font></span></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 15.5pt">应用 </font><span lang="EN-US"></span></font></span></font></p>
<p style="text-indent: 24pt; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-char-indent-count: 2.0" class="MsoNormal" align="left"><font face="宋体"><font color="#323232"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">Visual VM</font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">本身就是一个<span lang="EN-US">Java</span>应用，所以打开<span lang="EN-US">Visual VM</span>看到的第一个可监控应用就是<span lang="EN-US">Visual VM</span>本身；可以用它热热身，小试下牛刀。在<span lang="EN-US">Visual VM</span>可视化界面中可以监控到<span lang="EN-US">Visual VM</span>本身的内存使用情况、线程情况、<span lang="EN-US">Jvm</span>启动参数、<span lang="EN-US">cpu</span>消耗情况、垃圾回收情况等很多参数。当然如果在本地启一个<span lang="EN-US">Tomcat</span>一样可以看到这些参数，可以方便我们在本地对<span lang="EN-US">JVM</span>进行调优。但是且接如果你是在<span lang="EN-US">windows</span>下起应用，如果你的<span lang="EN-US">Java</span>应用是在<span lang="EN-US">NTFS</span>格式的盘附上，记得加参数：</font></span><span style="font-family: ; color: ; mso-bidi-font-size: 10.5pt; mso-font-kerning: 0pt; mso-hansi-font-family: &#39;Book Antiqua&#39;; mso-bidi-font-family: 宋体" lang="EN-US">-XX:+PerfBypassFileSystemCheck </span></font></font></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: &#39;Book Antiqua&#39;; mso-bidi-font-family: 宋体" lang="EN-US"><a href="http://blog.ureshika.com/wp-content/uploads/2013/06/clip_image0084.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image008[4]" border="0" alt="clip_image008[4]" src="{{ site.baseurl }}/assets/clip_image0084_thumb.jpg" width="575" height="367" /></a></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: &#39;Book Antiqua&#39;; mso-bidi-font-family: 宋体" lang="EN-US"><font face="宋体"><font style="font-size: 12pt" color="#323232">&#160;</font></font></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><font face="Cambria"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: cambria" lang="EN-US"><font style="font-size: 15.5pt">2.2.1</font></span></b><font style="font-size: 15.5pt"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: cambria" lang="EN-US"> </span></b></font></font><font style="font-size: 15.5pt"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: cambria; mso-bidi-font-family: 宋体"><font face="宋体">使用</font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: cambria; mso-bidi-font-weight: bold" lang="EN-US"><font face="Cambria">Visual VM</font></span></font><font face="宋体"><font style="font-size: 15.5pt"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-ascii-font-family: cambria; mso-hansi-font-family: cambria; mso-bidi-font-family: cambria; mso-bidi-font-weight: bold">监测内存泄漏</span></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: cambria; mso-bidi-font-family: 宋体"><font style="font-size: 15.5pt">、解决内存溢出问题</font><span lang="EN-US"></span></span></font></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-outline-level: 1" class="MsoNormal" align="left"><font face="Cambria"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: cambria" lang="EN-US"><font style="font-size: 15.5pt">2.2.1</font></span></b><font style="font-size: 15.5pt"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: cambria" lang="EN-US">.1<span style="mso-spacerun: yes">&#160; </span></span></b></font></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-ascii-font-family: cambria; mso-hansi-font-family: cambria; mso-bidi-font-family: cambria; mso-bidi-font-weight: bold"><font face="宋体"><font style="font-size: 15.5pt">内存泄露、溢出的异同</font></font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: cambria; mso-bidi-font-weight: bold" lang="EN-US"></span></p>
<p style="margin: 0cm 0cm 0pt 63pt; text-autospace: ; mso-layout-grid-align: none; mso-para-margin-left: 6.0gd" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt" color="#323232">同：都会导致应用程序运行出现问题，性能下降或挂起。</font><span lang="EN-US"></span></font></span></p>
<p style="margin: 0cm 0cm 0pt 63pt; text-autospace: ; mso-layout-grid-align: none; mso-para-margin-left: 6.0gd" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt" color="#323232">异：</font><span lang="EN-US"></span></font></span></p>
<p style="text-indent: -18pt; margin: 0cm 0cm 0pt 112.5pt; text-autospace: ; mso-layout-grid-align: none; mso-char-indent-count: -1.5; mso-para-margin-left: 9.0gd" class="MsoNormal" align="left"><font color="#323232"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><font face="宋体"><font style="font-size: 12pt">1)</font></font></span><font style="font-size: 12pt"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-ascii-font-family: 宋体; mso-bidi-font-family: 宋体" lang="EN-US"><font face="Calibri">&#160;</font></span></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt">内存泄露是导致内存溢出的原因之一；内存泄露积累起来将导致内存溢出。</font><span lang="EN-US"></span></font></span></font></p>
<p style="text-indent: -18pt; margin: 0cm 0cm 0pt 112.5pt; text-autospace: ; mso-layout-grid-align: none; mso-char-indent-count: -1.5; mso-para-margin-left: 9.0gd" class="MsoNormal" align="left"><font face="宋体"><font color="#323232"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">2) </font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">内存泄露可以通过完善代码来避免；内存溢出可以通过调整配置来减少发生频率，但无法彻底避免。</font><span lang="EN-US"></span></span></font></font></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-outline-level: 1" class="MsoNormal" align="left"><font face="Cambria"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: cambria" lang="EN-US"><font style="font-size: 15.5pt">2.2.1</font></span></b><font style="font-size: 15.5pt"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: cambria" lang="EN-US">.2<span style="mso-spacerun: yes">&#160; </span></span></b></font></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-ascii-font-family: cambria; mso-hansi-font-family: cambria; mso-bidi-font-family: cambria; mso-bidi-font-weight: bold"><font face="宋体"><font style="font-size: 15.5pt">监测内存泄漏</font></font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: &#39;Book Antiqua&#39;; mso-bidi-font-family: 宋体" lang="EN-US"></span></p>
<ul style="list-style-type: disc; margin-bottom: 0cm; margin-left: 30pt" type="disc">
<li style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-list: l5 level1 lfo4; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; tab-stops: list 36.0pt" class="MsoNormal"><font face="宋体"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font color="#ff0000"><font style="font-size: 12pt">内存泄漏</font></font></span><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">是指程序中间动态分配了内存，但在程序结束时没有释放这部分内存，从而造成那部分内存不可用的情况，重启计算机可以解决，但也有可能再次发生内存泄露，内存泄露和硬件没有关系，它是由软件设计缺陷引起的。</font><span lang="EN-US"><font style="font-size: 12pt">&#160; </font></span></span></font></li>
<li style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-list: l5 level1 lfo4; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; tab-stops: list 36.0pt" class="MsoNormal"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt">内存泄漏可以分为<span lang="EN-US">4</span>类：</font><span lang="EN-US"><font style="font-size: 12pt"> </font></span></font></span></li>
</ul>
<p style="margin: 0cm 0cm 0pt 36pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><font color="#339966"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">1) </font></span><font style="font-size: 12pt"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体">常发性内存泄漏</span></font></font><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">。发生内存泄漏的代码会被多次执行到，每次被执行的时候都会导致一块内存泄漏。</font><span lang="EN-US"><font style="font-size: 12pt"> </font></span></span></font></p>
<p style="margin: 0cm 0cm 0pt 36pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><font color="#339966"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">2) </font></span><font style="font-size: 12pt"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体">偶发性内存泄漏</span></font></font><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">。发生内存泄漏的代码只有在某些特定环境或操作过程下才会发生。常发性和偶发性是相对的。对于特定的环境，偶发性的也许就变成了常发性的。所以测试环境和测试方法对检测内存泄漏至关重要。</font><span lang="EN-US"><font style="font-size: 12pt"> </font></span></span></font></p>
<p style="margin: 0cm 0cm 0pt 36pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><font color="#339966"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">3) </font></span><font style="font-size: 12pt"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体">一次性内存泄漏</span></font></font><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">。发生内存泄漏的代码只会被执行一次，或者由于算法上的缺陷，导致总会有一块仅且一块内存发生泄漏。比如，在类的构造函数中分配内存，在析构函数中却没有释放该内存，所以内存泄漏只会发生一次。</font><span lang="EN-US"></span></span></font></p>
<p style="margin: 0cm 0cm 0pt 36pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><font color="#339966"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">4) </font></span><font style="font-size: 12pt"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体">隐式内存泄漏</span></font></font><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">。程序在运行过程中不停的分配内存，但是直到结束的时候才释放内存。严格的说这里并没有发生内存泄漏，因为最终程序释放了所有申请的内存。但是对于一个服务器程序，需要运行几天，几周甚至几个月，不及时释放内存也可能导致最终耗尽系统的所有内存。所以，我们称这类内存泄漏为隐式内存泄漏。</font><span lang="EN-US"></span></span></font></p>
<p style="text-justify: inter-ideograph; margin: 0cm 0cm 0pt" class="MsoNormal" align="justify"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt" color="#323232">每隔一段时间给所监测的<span lang="EN-US">Java</span>应用来一个<span lang="EN-US">heap dump</span>，如下面三图所示：</font><span lang="EN-US"></span></font></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: " lang="EN-US"><a href="http://blog.ureshika.com/wp-content/uploads/2013/06/clip_image0104.gif"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image010[4]" border="0" alt="clip_image010[4]" src="{{ site.baseurl }}/assets/clip_image0104_thumb.gif" width="594" height="433" /></a></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: " lang="EN-US"><font face="Verdana"><font style="font-size: 9pt" color="#4563b9">&#160;</font></font></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: " lang="EN-US"><a href="http://blog.ureshika.com/wp-content/uploads/2013/06/clip_image0124.gif"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image012[4]" border="0" alt="clip_image012[4]" src="{{ site.baseurl }}/assets/clip_image0124_thumb.gif" width="592" height="305" /></a></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: " lang="EN-US"><font face="Verdana"><font style="font-size: 9pt" color="#4563b9">&#160;</font></font></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: " lang="EN-US"><a href="http://blog.ureshika.com/wp-content/uploads/2013/06/clip_image0144.gif"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image014[4]" border="0" alt="clip_image014[4]" src="{{ site.baseurl }}/assets/clip_image0144_thumb.gif" width="589" height="301" /></a></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: " lang="EN-US"><font face="Verdana"><font style="font-size: 9pt" color="#4563b9">&#160;</font></font></span></p>
<p style="text-justify: inter-ideograph; text-indent: 24pt; margin: 0cm 0cm 0pt; mso-char-indent-count: 2.0" class="MsoNormal" align="justify"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt" color="#323232">对比上面三个截图，发现似乎有个东西在急速飙升，仔细一看是这个对象：<span lang="EN-US">org.eclipse.swt.graphics.Image </span>在第一章图中这个还没排的上，第二次<span lang="EN-US">dump</span>已经上升到<span lang="EN-US">5181</span>个，第三次就是<span lang="EN-US">7845</span>个了。涨速相当快，而且和任务管理器里面看到的<span lang="EN-US">GDI</span>数量增涨一致，就是它了。</font><span lang="EN-US"></span></font></span></p>
<p style="text-justify: inter-ideograph; text-indent: 24pt; margin: 0cm 0cm 0pt; mso-char-indent-count: 2.0" class="MsoNormal" align="justify"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt" color="#323232">问题到这儿就比较清楚了，回到代码里面仔细一看可以发现，是某个地方反复的用图片来创建<span lang="EN-US">Image</span>对象导致的，改掉以后搞定问题。</font><span lang="EN-US"></span></font></span></p>
<p style="text-justify: inter-ideograph; text-indent: 24pt; margin: 0cm 0cm 0pt; mso-char-indent-count: 2.0" class="MsoNormal" align="justify"><font color="#323232"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt">到这里其实我想说的是，<span lang="EN-US">Java</span>使用起来其实要比<span lang="EN-US">C++</span>更容易导致内存泄漏。对于<span lang="EN-US">C++</span>来说，每一个申请的对象都必须明确释放，任何没有释放的对象都会导致<span lang="EN-US">memleak</span>，这是不可饶恕的，而且这类问题已经有很多工具和方法来解决。但是到了<span lang="EN-US">Java</span>里面情况就不同了，对于<span lang="EN-US">Java</span>程序员来说对象都是不需要也无法主动销毁的，所以一般的思路是：随用随<span lang="EN-US">new</span>，用完即丢。很多对象具体的生命周期可能连写代码的人自己也不清楚，或者不需要清楚，只知道某个时刻垃圾收集器会去做的，不用管。但很可能某个对象在</font></font></span><font style="font-size: 12pt"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-ascii-font-family: 宋体; mso-bidi-font-family: 宋体" lang="EN-US"><font face="Calibri">“</font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体">用完即丢</font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-ascii-font-family: 宋体; mso-bidi-font-family: 宋体" lang="EN-US"><font face="Calibri">”</font></span></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt">的时候在另一个不容易发现的地方被保存了一个引用，那么这个对象就永远不会被回收。更加糟糕的是整个程序从设计之初就没有考虑过对象回收的问题，对于<span lang="EN-US">C++</span>程序员来说<span lang="EN-US">memleak</span>必然是一个设计错误，但是对<span lang="EN-US">Java</span>程序员来说这只是一个疏忽，而且似乎没有什么好的办法来避免。今天看到的这个问题是因为<span lang="EN-US">GDI</span>泄漏会造成严重后果才被重视，但如果仅仅是造成内存泄漏，那这个程序可能得连续跑上个十天半个月才会发现问题。最后就是，对于<span lang="EN-US">c++</span>，错误的代码在测试阶段就可以快速的侦测出哪怕一个<span lang="EN-US">byte</span>的<span lang="EN-US">memleak</span>并加以改正，但是对于<span lang="EN-US">java</span>程序，理论上没有哪个工具能够知道是不是有泄漏，因为除了作者自己以外没有人能够知道一个被引用的对象是不是应该被销毁，只有通过大量的，长期的压力测试才能发现问题，这是很危险的一件事情。</font><span lang="EN-US"></span></font></span></font></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><font face="宋体"><font style="font-size: 12pt" color="#323232">&#160;</font></font></span></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-outline-level: 1" class="MsoNormal" align="left"><font face="Cambria"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: cambria" lang="EN-US"><font style="font-size: 15.5pt">2.2.1</font></span></b><font style="font-size: 15.5pt"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: cambria" lang="EN-US">.3<span style="mso-spacerun: yes">&#160; </span></span></b></font></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: cambria; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 15.5pt">解决内存溢出问题</font></font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: &#39;Book Antiqua&#39;; mso-bidi-font-family: 宋体" lang="EN-US"></span></p>
<p style="text-justify: inter-ideograph; margin: 0cm 0cm 0pt" class="MsoNormal" align="justify"><font face="宋体"><font color="#323232"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">1</font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">、</font><span lang="EN-US"><font style="font-size: 12pt">java.lang.OutOfMemoryError: PermGen space </font></span></span></font></font></p>
<p style="text-justify: inter-ideograph; text-indent: 24pt; margin: 0cm 0cm 0pt; mso-char-indent-count: 2.0" class="MsoNormal" align="justify"><font face="宋体"><font color="#323232"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">JVM</font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">管理两种类型的内存，堆和非堆。堆是在<span lang="EN-US">JVM</span>启动时创建；非堆是留给<span lang="EN-US">JVM</span>自己用的，用来存放类的信息的。它和堆不同，运行期内<span lang="EN-US">GC</span>不会释放空间。如果<span lang="EN-US">web app</span>用了大量的第三方<span lang="EN-US">jar</span>或者应用有太多的<span lang="EN-US">class</span>文件而恰好<span lang="EN-US">MaxPermSize</span>设置较小，超出了也会导致这块内存的占用过多造成溢出，或者<span lang="EN-US">tomcat</span>热部署时侯不会清理前面加载的环境，只会将<span lang="EN-US">context</span>更改为新部署的，非堆存的内容就会越来越多。</font><span lang="EN-US"></span></span></font></font></p>
<p style="text-justify: inter-ideograph; text-indent: 24pt; margin: 0cm 0cm 0pt; mso-char-indent-count: 2.0" class="MsoNormal" align="justify"><font face="宋体"><font color="#323232"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">PermGen space</font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">的全称是<span lang="EN-US">Permanent Generation space</span>，是指内存的永久保存区域，这块内存主要是被<span lang="EN-US">JVM</span>存放<span lang="EN-US">Class</span>和<span lang="EN-US">Meta</span>信息的，<span lang="EN-US">Class</span>在被<span lang="EN-US">Loader</span>时就会被放到<span lang="EN-US">PermGen space</span>中，它和存放类实例<span lang="EN-US">(Instance)</span>的<span lang="EN-US">Heap</span>区域不同，<span lang="EN-US">GC(Garbage Collection)</span>不会在主程序运行期对<span lang="EN-US">PermGen space</span>进行清理，所以如果你的应用中有很<span lang="EN-US">CLASS</span>的话，就很可能出现<span lang="EN-US">PermGen space</span>错误，这种错误常见在<span lang="EN-US">web</span>服务器对<span lang="EN-US">JSP</span>进行<span lang="EN-US">pre compile</span>的时候。如果你的<span lang="EN-US">WEB APP</span>下都用了大量的第三方<span lang="EN-US">jar, </span>其大小超过了<span lang="EN-US">jvm</span>默认的大小<span lang="EN-US">(4M)</span>那么就会产生此错误信息了。</font></span></font></font></p>
<p style="margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span lang="EN-US">&#160;</span></p>
<p style="text-indent: 21pt; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-char-indent-count: 2.0" class="MsoNormal" align="left"><span lang="EN-US"><a href="http://blog.ureshika.com/wp-content/uploads/2013/06/clip_image0164.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image016[4]" border="0" alt="clip_image016[4]" src="{{ site.baseurl }}/assets/clip_image0164_thumb.jpg" width="576" height="411" /></a></span></p>
<p style="text-indent: 21pt; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-char-indent-count: 2.0" class="MsoNormal" align="left"><span lang="EN-US">&#160;</span></p>
<p style="text-indent: 24pt; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-char-indent-count: 2.0" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: &#39;Book Antiqua&#39;; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt">如上图所示，<span lang="EN-US">PermGen</span>在程序运行一段时间后超出了我们指定的<span lang="EN-US">128MB</span>，通过<span lang="EN-US">Classes</span>视图看到，<span lang="EN-US">Java</span>在运行的同时加载了大量的类到内存中。<span lang="EN-US">PermGen</span>会存储<span lang="EN-US">Jar</span>或者<span lang="EN-US">Class</span>的描述信息；所以在<span lang="EN-US">class</span>大量增加的同时<span lang="EN-US">PermGen</span>超出了我们指定的范围。为了让应用稳定，我们需要探寻新的<span lang="EN-US">PermGen</span>范围。检测时段时候后（如下图）发现<span lang="EN-US">PermGen</span>在<span lang="EN-US">145MB</span>左右稳定，那么我们就得到了稳定的新参数；这样<span lang="EN-US">PermGen</span>内存溢出的问题得到解决。</font><span lang="EN-US"></span></font></span></p>
<p style="text-indent: 21pt; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-char-indent-count: 2.0" class="MsoNormal" align="left"><span lang="EN-US"><a href="http://blog.ureshika.com/wp-content/uploads/2013/06/clip_image0184.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image018[4]" border="0" alt="clip_image018[4]" src="{{ site.baseurl }}/assets/clip_image0184_thumb.jpg" width="576" height="421" /></a></span></p>
<p style="text-indent: 21pt; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-char-indent-count: 2.0" class="MsoNormal" align="left"><span lang="EN-US">&#160;</span></p>
<p style="text-justify: inter-ideograph; margin: 0cm 0cm 0pt" class="MsoNormal" align="justify"><font face="宋体"><font color="#323232"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">2</font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">、</font><span lang="EN-US"><font style="font-size: 12pt">java.lang.OutOfMemoryError: Java heap space </font></span></span></font></font></p>
<p style="text-justify: inter-ideograph; text-indent: 24pt; margin: 0cm 0cm 0pt; mso-char-indent-count: 2.0" class="MsoNormal" align="justify"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt" color="#323232">第一种情况是个补充，主要存在问题就是出现在这个情况中。其默认空间<span lang="EN-US">(</span>即<span lang="EN-US">-Xms)</span>是物理内存的<span lang="EN-US">1/64</span>，最大空间<span lang="EN-US">(-Xmx)</span>是物理内存的<span lang="EN-US">1/4</span>。如果内存剩余不到<span lang="EN-US">40</span>％，<span lang="EN-US">JVM</span>就会增大堆到<span lang="EN-US">Xmx</span>设置的值，内存剩余超过<span lang="EN-US">70</span>％，<span lang="EN-US">JVM</span>就会减小堆到<span lang="EN-US">Xms</span>设置的值。所以服务器的<span lang="EN-US">Xmx</span>和<span lang="EN-US">Xms</span>设置一般应该设置相同避免每次<span lang="EN-US">GC</span>后都要调整虚拟机堆的大小。假设物理内存无限大，那么<span lang="EN-US">JVM</span>内存的最大值跟操作系统有关，一般<span lang="EN-US">32</span>位机是<span lang="EN-US">1.5g</span>到<span lang="EN-US">3g</span>之间，而<span lang="EN-US">64</span>位的就不会有限制了。 </font><span lang="EN-US"></span></font></span></p>
<p style="text-justify: inter-ideograph; text-indent: 24pt; margin: 0cm 0cm 0pt; mso-char-indent-count: 2.0" class="MsoNormal" align="justify"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt" color="#323232">注意：如果<span lang="EN-US">Xms</span>超过了<span lang="EN-US">Xmx</span>值，或者堆最大值和非堆最大值的总和超过了物理内存或者操作系统的最大限制都会引起服务器启动不起来。</font><span lang="EN-US"></span></font></span></p>
<p style="text-justify: inter-ideograph; text-indent: 24pt; margin: 0cm 0cm 0pt; mso-char-indent-count: 2.0" class="MsoNormal" align="justify"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><font face="宋体"><font style="font-size: 12pt" color="#323232">&#160;</font></font></span></p>
<p style="text-justify: inter-ideograph; text-indent: 24pt; margin: 0cm 0cm 0pt; mso-char-indent-count: 2.0" class="MsoNormal" align="justify"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt" color="#323232">垃圾回收<span lang="EN-US">GC</span>的角色，<span lang="EN-US">JVM</span>调用<span lang="EN-US">GC</span>的频度还是很高的，主要两种情况下进行垃圾回收：</font><span lang="EN-US"></span></font></span></p>
<p style="text-justify: inter-ideograph; text-indent: 24pt; margin: 0cm 0cm 0pt; mso-char-indent-count: 2.0" class="MsoNormal" align="justify"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt" color="#323232">一个是当应用程序线程空闲；另一个是<span lang="EN-US">java</span>内存堆不足时，会不断调用<span lang="EN-US">GC</span>，若连续回收都解决不了内存堆不足的问题时，就会报<span lang="EN-US">out of memory</span>错误。因为这个异常根据系统运行环境决定，所以无法预期它何时出现。</font><span lang="EN-US"></span></font></span></p>
<p style="text-justify: inter-ideograph; text-indent: 24pt; margin: 0cm 0cm 0pt; mso-char-indent-count: 2.0" class="MsoNormal" align="justify"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt" color="#323232">根据<span lang="EN-US">GC</span>的机制，程序的运行会引起系统运行环境的变化，增加<span lang="EN-US">GC</span>的触发机会。</font><span lang="EN-US"></span></font></span></p>
<p style="text-justify: inter-ideograph; text-indent: 24pt; margin: 0cm 0cm 0pt; mso-char-indent-count: 2.0" class="MsoNormal" align="justify"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt" color="#323232">为了避免这些问题，程序的设计和编写就应避免垃圾对象的内存占用和<span lang="EN-US">GC</span>的开销。显示调用<span lang="EN-US">System.GC()</span>只能建议<span lang="EN-US">JVM</span>需要在内存中对垃圾对象进行回收，但不是必须马上回收。一个是并不能解决内存资源耗空的局面，另外也会增加<span lang="EN-US">GC</span>的消耗。</font><span lang="EN-US"></span></font></span></p>
<p style="text-justify: inter-ideograph; text-indent: 24pt; margin: 0cm 0cm 0pt; mso-char-indent-count: 2.0" class="MsoNormal" align="justify"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><font face="宋体"><font style="font-size: 12pt" color="#323232">&#160;</font></font></span></p>
<p style="text-indent: 24pt; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-char-indent-count: 2.0" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: &#39;Book Antiqua&#39;; mso-bidi-font-family: 宋体" lang="EN-US"><a href="http://blog.ureshika.com/wp-content/uploads/2013/06/clip_image0204.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image020[4]" border="0" alt="clip_image020[4]" src="{{ site.baseurl }}/assets/clip_image0204_thumb.jpg" width="575" height="366" /></a></span></p>
</p></div>
<p> <span style="line-height: normal; font-family: ; color: ; mso-hansi-font-family: &#39;Book Antiqua&#39;; mso-bidi-font-family: 宋体; mso-ansi-language: en-us; mso-fareast-language: zh-cn; mso-bidi-language: ar-sa" lang="EN-US">   <br style="page-break-before: auto; mso-break-type: section-break" clear="all" /></span>
<p style="line-height: normal; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: &#39;Book Antiqua&#39;" lang="EN-US"><font face="Book Antiqua"><font style="font-size: 9pt">&#160;</font></font></span></p>
<p style="text-justify: inter-ideograph; line-height: normal; text-indent: 24pt; margin: 0cm 0cm 0pt; mso-char-indent-count: 2.0" class="MsoNormal" align="justify"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 12pt" color="#323232">如上图所示，<span lang="EN-US">used heap</span>的折线图呈峰状，说明垃圾对象及时被回收了，内存得以释放。如果<span lang="EN-US">used heap</span>的值只增不减说明存在内存泄漏了，如果超过<span lang="EN-US">heap size</span>的值，会报内存溢出的错误。</font><span lang="EN-US"></span></font></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal" align="left"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: calibri; mso-bidi-font-family: 宋体" lang="EN-US"><font face="宋体"><font style="font-size: 12pt" color="#323232">&#160;</font></font></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; text-autospace: ; mso-layout-grid-align: none; mso-outline-level: 1" class="MsoNormal" align="left"><font face="Cambria"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: cambria" lang="EN-US"><font style="font-size: 15.5pt">2.2.1</font></span></b><font style="font-size: 15.5pt"><b><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: cambria" lang="EN-US">.4<span style="mso-spacerun: yes">&#160; </span></span></b></font></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: cambria; mso-bidi-font-family: 宋体"><font face="宋体"><font style="font-size: 15.5pt">如何避免内存泄漏、溢出</font></font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-hansi-font-family: &#39;Book Antiqua&#39;; mso-bidi-font-family: 宋体" lang="EN-US"></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-outline-level: 1; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><font style="background-color: #ffff99"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; font-family: ; background-position: 0% 0%; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">1) </font></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; font-family: ; background-position: 0% 0%; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">尽早释放无用对象的引用。</font></span></font></font><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">好的办法是使用临时变量的时候，让引用变量在退出活动域后自动设置为<span lang="EN-US">null</span>，暗示垃圾收集器来收集该对象，防止发生内存泄露。</font></span></font><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-outline-level: 1; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><font style="background-color: #ffff99"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; font-family: ; background-position: 0% 0%; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">2) </font></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; font-family: ; background-position: 0% 0%; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">程序进行字符串处理时，尽量避免使用<span lang="EN-US">String</span>，而应使用<span lang="EN-US">StringBuffer</span>。</font></span></font></font><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">因为每一个<span lang="EN-US">String</span>对象都会独立占用内存一块区域，如：</font></span></font><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"></span></p>
<ol style="line-height: normal; list-style-type: decimal; margin-bottom: 0cm; margin-left: 30pt" type="1">
<li style="text-align: left; margin: 0cm 0cm 0pt; color: ; mso-pagination: widow-orphan; mso-list: l3 level1 lfo5; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; tab-stops: list 36.0pt" class="MsoNormal"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font face="宋体"><font style="font-size: 12pt">String str = &quot;aaa&quot;;&#160;&#160;&#160; </font></font></span></li>
<li style="text-align: left; margin: 0cm 0cm 0pt; color: ; mso-pagination: widow-orphan; mso-list: l3 level1 lfo5; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; tab-stops: list 36.0pt" class="MsoNormal"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font face="宋体"><font style="font-size: 12pt">String str2 = &quot;bbb&quot;;&#160;&#160;&#160; </font></font></span><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"></span></li>
<li style="text-align: left; margin: 0cm 0cm 0pt; color: ; mso-pagination: widow-orphan; mso-list: l3 level1 lfo5; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; tab-stops: list 36.0pt" class="MsoNormal"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font face="宋体"><font style="font-size: 12pt" color="#ff0000">String str3 = str + str2;&#160;&#160;&#160; </font></font></span></li>
<li style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-list: l3 level1 lfo5; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; tab-stops: list 36.0pt" class="MsoNormal"><font face="宋体"><font color="#ff0000"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">// </font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">假如执行此次之后<span lang="EN-US">str , str2</span>再不被调用，那么它们就会在内存中等待<span lang="EN-US">GC</span>回收；</font><span lang="EN-US"><font style="font-size: 12pt">&#160;&#160;&#160; </font></span></span></font></font><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"></span></li>
<li style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-list: l3 level1 lfo5; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; tab-stops: list 36.0pt" class="MsoNormal"><font face="宋体"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">// </font></span><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">假如程序中存在过多的类似情况就会出现内存错误；</font><span lang="EN-US"><font style="font-size: 12pt">&#160;&#160; </font></span></span></font></li>
</ol>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt" class="MsoNormal" align="left"><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all" lang="EN-US"><font style="font-size: 12pt">String str = &quot;aaa&quot;; </font></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt" class="MsoNormal" align="left"><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all" lang="EN-US"><font style="font-size: 12pt">String str2 = &quot;bbb&quot;; </font></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt" class="MsoNormal" align="left"><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all" lang="EN-US"><font style="font-size: 12pt">String str3 = str + str2; </font></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt" class="MsoNormal" align="left"><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all" lang="EN-US"><font style="font-size: 12pt">// </font></span><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all"><font style="font-size: 12pt">假如执行此次之后<span lang="EN-US">str , str2</span>再不被调用，那么它们就会在内存中等待<span lang="EN-US">GC</span>回收；</font><span lang="EN-US"><font style="font-size: 12pt"> </font></span></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt" class="MsoNormal" align="left"><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all" lang="EN-US"><font style="font-size: 12pt">// </font></span><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all"><font style="font-size: 12pt">假如程序中存在过多的类似情况就会出现内存错误；</font><span lang="EN-US"><font style="font-size: 12pt"> </font></span></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font face="宋体"><font style="font-size: 12pt">&#160;</font></font></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-outline-level: 1; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><font style="background-color: #ffff99"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; font-family: ; background-position: 0% 0%; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">3) </font></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; font-family: ; background-position: 0% 0%; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">尽量少用静态变量。</font></span></font></font><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">因为静态变量是全局的，<span lang="EN-US">GC</span>不会回收。</font><span lang="EN-US"></span></span></font></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-outline-level: 1; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><font style="background-color: #ffff99"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; font-family: ; background-position: 0% 0%; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">4) </font></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; font-family: ; background-position: 0% 0%; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">避免集中创建对象尤其是大对象，如果可以的话尽量使用流操作。</font></span></font></font><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; JVM</font></span><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">会突然需要大量内存，这时会触发<span lang="EN-US">GC</span>优化系统内存环境； 一个案例如下：</font><span lang="EN-US"><font style="font-size: 12pt">&#160;</font></span></span></font></p>
<ol style="line-height: normal; list-style-type: decimal; margin-bottom: 0cm; margin-left: 30pt" type="1">
<li style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-list: l2 level1 lfo6; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; tab-stops: list 36.0pt" class="MsoNormal"><font face="宋体"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">// </font></span><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">使用<span lang="EN-US">jspsmartUpload</span>作文件上传，运行过程中经常出现<span lang="EN-US">java.outofMemoryError</span>的错误，</font><span lang="EN-US"><font style="font-size: 12pt">&#160;&#160;&#160; </font></span></span></font></li>
<li style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-list: l2 level1 lfo6; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; tab-stops: list 36.0pt" class="MsoNormal"><font face="宋体"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">// </font></span><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">检查之后发现问题：组件里的代码</font><span lang="EN-US"><font style="font-size: 12pt">&#160;&#160;&#160; </font></span></span></font></li>
<li style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-list: l2 level1 lfo6; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; tab-stops: list 36.0pt" class="MsoNormal"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font face="宋体"><font style="font-size: 12pt">m_totalBytes = m_request.getContentLength();&#160;&#160;&#160; </font></font></span></li>
<li style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-list: l2 level1 lfo6; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; tab-stops: list 36.0pt" class="MsoNormal"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font face="宋体"><font style="font-size: 12pt">m_binArray = new byte[m_totalBytes];&#160;&#160;&#160; </font></font></span></li>
<li style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-list: l2 level1 lfo6; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; tab-stops: list 36.0pt" class="MsoNormal"><font face="宋体"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">// totalBytes</font></span><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">这个变量得到的数极大，导致该数组分配了很多内存空间，而且该数组不能及时释放。</font><span lang="EN-US"><font style="font-size: 12pt">&#160;&#160;&#160; </font></span></span></font></li>
<li style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-list: l2 level1 lfo6; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; tab-stops: list 36.0pt" class="MsoNormal"><font face="宋体"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">// </font></span><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">解决办法只能换一种更合适的办法，至少是不会引发<span lang="EN-US">outofMemoryError</span>的方式解决。</font><span lang="EN-US"><font style="font-size: 12pt">&#160;&#160;&#160; </font></span></span></font></li>
<li style="text-align: left; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-list: l2 level1 lfo6; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; tab-stops: list 36.0pt" class="MsoNormal"><font face="宋体"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">// </font></span><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">参考：</font><span lang="EN-US"><font style="font-size: 12pt">http://bbs.xml.org.cn/blog/more.asp?name=hongrui&amp;id=3747&#160;&#160; </font></span></span></font></li>
</ol>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt" class="MsoNormal" align="left"><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all" lang="EN-US"><font style="font-size: 12pt">// </font></span><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all"><font style="font-size: 12pt">使用<span lang="EN-US">jspsmartUpload</span>作文件上传，运行过程中经常出现<span lang="EN-US">java.outofMemoryError</span>的错误，</font><span lang="EN-US"><font style="font-size: 12pt"> </font></span></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt" class="MsoNormal" align="left"><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all" lang="EN-US"><font style="font-size: 12pt">// </font></span><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all"><font style="font-size: 12pt">检查之后发现问题：组件里的代码</font><span lang="EN-US"><font style="font-size: 12pt"> </font></span></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt" class="MsoNormal" align="left"><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all" lang="EN-US"><font style="font-size: 12pt">m_totalBytes = m_request.getContentLength(); </font></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt" class="MsoNormal" align="left"><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all" lang="EN-US"><font style="font-size: 12pt">m_binArray = new byte[m_totalBytes]; </font></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt" class="MsoNormal" align="left"><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all" lang="EN-US"><font style="font-size: 12pt">// totalBytes</font></span><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all"><font style="font-size: 12pt">这个变量得到的数极大，导致该数组分配了很多内存空间，而且该数组不能及时释放。</font><span lang="EN-US"><font style="font-size: 12pt"> </font></span></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt" class="MsoNormal" align="left"><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all" lang="EN-US"><font style="font-size: 12pt">// </font></span><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all"><font style="font-size: 12pt">解决办法只能换一种更合适的办法，至少是不会引发<span lang="EN-US">outofMemoryError</span>的方式解决。</font><span lang="EN-US"><font style="font-size: 12pt"> </font></span></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt" class="MsoNormal" align="left"><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all" lang="EN-US"><font style="font-size: 12pt">// </font></span><span style="display: none; font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-hide: all"><font style="font-size: 12pt">参考：</font><span lang="EN-US"><font style="font-size: 12pt">http://bbs.xml.org.cn/blog/more.asp?name=hongrui&amp;id=3747 </font></span></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font face="宋体"><font style="font-size: 12pt">&#160;&#160; </font></font></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-outline-level: 1; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><font style="background-color: #ffff99"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; font-family: ; background-position: 0% 0%; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">5) </font></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; font-family: ; background-position: 0% 0%; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">尽量运用对象池技术以提高系统性能。</font></span></font></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">生命周期长的对象拥有生命周期短的对象时容易引发内存泄漏，例如大集合对象拥有大数据量的业务对象的时候，可以考虑分块进行处理，然后解决一块释放一块的策略。</font><span lang="EN-US"></span></span></font></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-outline-level: 1; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><font style="background-color: #ffff99"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; font-family: ; background-position: 0% 0%; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">6) </font></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; font-family: ; background-position: 0% 0%; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">不要在经常调用的方法中创建对象，尤其是忌讳在循环中创建对象。</font></span></font></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">可以适当的使用<span lang="EN-US">hashtable</span>，<span lang="EN-US">vector </span>创建一组对象容器，然后从容器中去取那些对象，而不用每次<span lang="EN-US">new</span>之后又丢弃。</font><span lang="EN-US"></span></span></font></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-outline-level: 1; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><font style="background-color: #ffff99"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; font-family: ; background-position: 0% 0%; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">7) </font></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; font-family: ; background-position: 0% 0%; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">优化配置。</font></span></font></font><span style="font-family: ; color: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"></span></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1</font></span><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">、<span lang="EN-US">&#160;</span>设置<span lang="EN-US">-Xms</span>、<span lang="EN-US">-Xmx</span>相等；</font><span lang="EN-US"></span></span></font></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 2</font></span><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">、 设置<span lang="EN-US">NewSize</span>、<span lang="EN-US">MaxNewSize</span>相等；</font><span lang="EN-US"></span></span></font></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 3</font></span><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">、 设置</font><span lang="EN-US"><font style="font-size: 12pt">Heap size, PermGen space: </font></span></span></font></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><font face="宋体"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Tomcat </font></span><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">的配置示例：修改</font><span lang="EN-US"><font style="font-size: 12pt"> %TOMCAT_HOME%/bin/catalina.bat or catalina.sh </font></span></span></font></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt; mso-pagination: widow-orphan" class="MsoNormal" align="left"><font face="宋体"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font style="font-size: 12pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体"><font style="font-size: 12pt">在<span lang="EN-US">“echo &quot;Using CATALINA_BASE: $CATALINA_BASE&quot;”</span>上面加入以下行：</font><span lang="EN-US"><font style="font-size: 12pt"> </font></span></span></font></p>
<p style="line-height: normal; margin: 0cm 0cm 0pt 18pt; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class="MsoNormal" align="left"><span style="font-family: ; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体" lang="EN-US"><font face="宋体"><font style="font-size: 12pt">set JAVA_OPTS=-Xms800m -Xmx800m -XX:PermSize=128M -XX:MaxNewSize=256m -XX:MaxPermSize=256m&#160; </font></font></span></p>
