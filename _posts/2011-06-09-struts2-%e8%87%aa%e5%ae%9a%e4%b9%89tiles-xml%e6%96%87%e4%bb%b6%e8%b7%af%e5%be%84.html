---
layout: post
title: struts2 自定义tiles.xml文件路径
date: 2011-06-09 11:41:25.000000000 +01:00
type: post
published: true
status: publish
categories:
- java
tags:
- javascript web 前端
- web
meta:
  views: '238'
author:
  login: ig2net
  email: ig2net@ig2net.info
  display_name: "农夫一号"
  first_name: ''
  last_name: ''
---
<p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none" id="internal-source-marker_0.6469215794347075">struts2+tiles时，tiles.xml默认是放在文件夹/web-inf/下面，使用ServletContext的方法查找,一般不需要改动，但是遇到BT的要求需要自定义这个titles的路径查找方式时，可以使用如下方法：</span>   <br /><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">1:在web.xml里面配置自定义监听器:</span>   <br /><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"></span>  <br /><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"></span>  <br /><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Xml代码</span>
<ol>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&lt;listener&gt;&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160; &lt;listener-class&gt;demo.MyStrutsTilesListener&lt;/listener-class&gt;&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160; &lt;/listener&gt;&#160; </span></li>
</ol>
<p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">2:实现demo.MyStrutsTilesListener这个类,它继承自org.apache.struts2.tiles.StrutsTilesListener,重载方法</span>   <br /><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"></span>  <br /><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"></span>  <br /><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Java代码</span>
<ol>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">protected ServletContext decorate(ServletContext context)&#160;&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">{&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160; Map&lt;String, String&gt; INIT = new HashMap&lt;String, String&gt;();&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160; INIT.put(TilesContainerFactory.CONTAINER_FACTORY_INIT_PARAM,&#160; StrutsTilesContainerFactory.class.getName());&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160; ServletContext servletContext = new MyTilesContext(context,INIT);&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160; return servletContext;&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">}&#160; </span></li>
</ol>
<p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">3:实现MyTilesContext:</span>   <br /><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"></span>  <br /><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Java代码</span>
<ol>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">public class CyberTilesContext extends ConfiguredServletContext&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">{&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160; public static final String PREFIX = &quot;file:///&quot;;&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160; public CyberTilesContext(ServletContext context, Map&lt;String, String&gt; initParameters)&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160; {&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160; super(context, initParameters);&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160; }&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;</span> </li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160; @Override&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160; public URL getResource(String string) throws MalformedURLException&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160; {&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160; if (!string.startsWith(PREFIX))&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160; {&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return super.getResource(string);&#160;&#160;&#160;&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160; }&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160; String path = string.substring(PREFIX.length());&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160; File file = new File(path);&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160; if (!file.exists())&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160; {&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; throw new RuntimeException(&quot;file &quot; + path + &quot; not founded.&quot;);&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160; }&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160; return file.toURI().toURL();&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">&#160;&#160; }&#160; </span></li>
<li style="background-color: transparent; list-style-type: decimal; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">}&#160; </span></li>
</ol>
<p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">通过重载getResource方法可以定制自己所需要的查找tiles.xml的方法，上面的例子就是实现以file:///开头查找绝对路径下的tiles.xml。</span>   <br /><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"></span>  <br /><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"><font color="#0000ff">PS:很不喜欢struts2,对于我来讲，它不适合快速开发，它也不适合大型网站。</font></span>   <br /><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"></span></p>
