---
layout: post
title: "【转】Comet is Always Better Than Polling"
date: 2011-05-30 08:41:35.000000000 +01:00
type: post
published: true
status: publish
categories:
- Web
- Web前端
tags:
- javascript web 前端
- web
meta:
  views: '28'
author:
  login: ig2net
  email: ig2net@ig2net.info
  display_name: "农夫一号"
  first_name: ''
  last_name: ''
---
<h2 id="internal-source-marker_0.6080792066130787"><a href="http://cometdaily.com/2007/11/06/comet-is-always-better-than-polling/"><span style="background-color: transparent;font-style: normal;font-family: arial;color: #000099;font-size: 18pt;vertical-align: baseline;font-weight: bold;text-decoration: underline">Comet is Always Better Than Polling</span></a></h2>
<p> <span style="background-color: transparent;font-style: normal;font-family: arial;color: #000000;font-size: 11pt;vertical-align: baseline;font-weight: normal;text-decoration: none">by</span><a href="http://cometdaily.com/people/greg_wilkins"><span style="background-color: transparent;font-style: normal;font-family: arial;color: #000000;font-size: 11pt;vertical-align: baseline;font-weight: normal;text-decoration: none"> </span><span style="background-color: transparent;font-style: normal;font-family: arial;color: #000099;font-size: 11pt;vertical-align: baseline;font-weight: normal;text-decoration: underline">Greg Wilkins</span></a><span style="background-color: transparent;font-style: normal;font-family: arial;color: #000000;font-size: 11pt;vertical-align: baseline;font-weight: normal;text-decoration: none">November 6th, 2007&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>  <br /> 
<p style="text-align: justify;margin-top: 0pt;margin-bottom: 0pt"><span style="background-color: transparent;font-style: normal;font-family: arial;color: #000000;font-size: 11pt;vertical-align: baseline;font-weight: normal;text-decoration: none">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></p>
<p style="text-align: justify;margin-top: 0pt;margin-bottom: 0pt"><span style="background-color: transparent;font-style: normal;font-family: arial;color: #000000;font-size: 11pt;vertical-align: baseline;font-weight: normal;text-decoration: none">Comet techniques are advocated when your application needs low latency events to be delivered from the server to the browser. Comet can deliver sub-second latency for messages making possible web applications like chat, games and real-time monitoring of prices and states.</span></p>
<p style="text-align: justify;margin-top: 0pt;margin-bottom: 0pt"><span style="background-color: transparent;font-style: normal;font-family: arial;color: #000000;font-size: 11pt;vertical-align: baseline;font-weight: normal;text-decoration: none">It is often asserted that for applications that don’t need low latency (e.g. email readers), traditional polling is a better alternative. However, some rudimentary analysis shows this assertion to be wrong, and that Comet techniques can be applied to all required latencies and event rates to provide improved data rates and average latencies.</span></p>
<p style="text-align: justify;margin-top: 0pt;margin-bottom: 0pt"><span style="background-color: transparent;font-style: normal;font-family: arial;color: #000000;font-size: 11pt;vertical-align: baseline;font-weight: normal;text-decoration: none">For this analysis, I have considered polling vs. the long-polling technique where a server may hold a poll request for a period of time while waiting for events/messages to be delivered to the browser. In order to ensure that we are comparing apples with apples and oranges with oranges, I have compared configurations that provide the same maximum latency. For example, for a maximum latency of 10s, the polling technique must issue a poll every 10s and the average latency is half that. For the Comet technique long polling, a long poll needs to be issued 10s after the last long poll completes, but the server may hold the long poll for up to 300s while waiting for an event.</span></p>
<p style="text-align: justify;margin-top: 0pt;margin-bottom: 0pt"><span style="background-color: transparent;font-style: normal;font-family: arial;color: #000000;font-size: 11pt;vertical-align: baseline;font-weight: normal;text-decoration: none">The attached spreadsheet contains the calculations, which I have graphed for 1s, 10s and 100s maximum latency for message rates of 1, 10, 100 and 1000 messages per second for 1000 users. The results show that the Comet long polling technique uses less bandwidth than polling in all situations, and uses significantly less bandwidth when the average period between messages is longer than the maximum latency:</span><img src="{{ site.baseurl }}/assets/dC4zo6qV1PepTCLEWorOvpEHZD2KLSRBw3HaZ2GHIGkGcz_GZfgwbpnSHK-bBHpW8nBOHVByZbSkHKcwS5CS66hxa5MxyjMyrGcJhy8odB-LhLJ9syE" width="800" height="451" /></p>
<p style="text-align: justify;margin-top: 0pt;margin-bottom: 0pt"><span style="background-color: transparent;font-style: normal;font-family: arial;color: #000000;font-size: 11pt;vertical-align: baseline;font-weight: normal;text-decoration: none">Not only does Comet long-polling provide superior data rates, it also provides superior average latency. The Comet technique allows the average latency to be lower than the maximum latency because once the pause between polls is complete, the long poll is ready to respond immediately to events.</span><img src="{{ site.baseurl }}/assets/AV7lCv_oqKXYHtmpt41pD5R8KYws52Xgn_pW-gXAuBYWAvUryE3TKJmWR19Fzop_qjU8SAW3KBLmxmsTOtPfSOBsFZOPPROnSb3-sDqXyNdaIef9BGI" width="800" height="451" /></p>
<p> <span style="background-color: transparent;font-style: normal;font-family: arial;color: #000000;font-size: 11pt;vertical-align: baseline;font-weight: normal;text-decoration: none">This analysis shows that for the worst case, when the message rate is high, load and latency for Comet long-polling are identical to traditional polling, and for most cases the load and latency are significantly better than traditional polling.</span>  <br /><span style="background-color: transparent;font-style: normal;font-family: arial;color: #000000;font-size: 11pt;vertical-align: baseline;font-weight: normal;text-decoration: none">The calculations for these graphs are in this</span><a href="http://cometdaily.com/wp-content/uploads/2007/11/comet-polling.xls"><span style="background-color: transparent;font-style: normal;font-family: arial;color: #000000;font-size: 11pt;vertical-align: baseline;font-weight: normal;text-decoration: none"> </span><span style="background-color: transparent;font-style: normal;font-family: arial;color: #000099;font-size: 11pt;vertical-align: baseline;font-weight: normal;text-decoration: underline">Comet vs Polling spreadsheet</span></a><span style="background-color: transparent;font-style: normal;font-family: arial;color: #000000;font-size: 11pt;vertical-align: baseline;font-weight: normal;text-decoration: none">. The assumptions made are that all messages are equal in size (150Bytes) and that the message arrival times are randomly but uniformly distributed. A maximum long poll timeout of 240s is assumed. The Y axis of the graphs is logarithmic so larger differences appear smaller.</span>  <br /><span style="background-color: transparent;font-style: normal;font-family: arial;color: #000000;font-size: 11pt;vertical-align: baseline;font-weight: normal;text-decoration: none"></span></p>
