<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v6.6.1 <https://qwtel.com/hydejack/>
--><head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="format-detection" content="telephone=no"> <meta http-equiv="x-ua-compatible" content="ie=edge"> <title>Ka's Blog &middot; Ka's Blog</title> <meta name="description" content="Ka’s blog description… "> <link rel="canonical" href="http://localhost:4000/page-67/"> <link rel="alternate" type="application/atom+xml" title="Ka's Blog Feed" href="http://localhost:4000/feed.xml"> <link rel="apple-touch-icon" href="/apple-touch-icon.png"> <!-- Place favicon.ico in the root directory --> <link rel="stylesheet" href="/assets/style.css"> <link id="_katexJS" rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.js"> <link id="_katexCSS" rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css"> <!--[if gt IE 8]><!----> <script> WebFontConfig = { google: { families: 'Roboto+Slab:700|Noto+Sans:400,400i,700,700i'.split('|') }, custom: { families: ['icomoon'], urls: ['/assets/icomoon/style.css'] } }; </script> <!--<![endif]--> <script> !function(n,e){function t(n,e){n.onload=function(){this.onerror=this.onload=null,e(null,n)},n.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),n)}}function o(n,e){n.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,e(null,n))}}n._loaded=!1,n.loadJSDeferred=function(a,d){function r(){n._loaded=!0;var r=e.createElement("script");r.src=a,d&&(("onload"in r?t:o)(r,d),r.onload||t(r,d));var l=e.getElementsByTagName("script")[0];l.parentNode.insertBefore(r,l)}n._loaded?r():n.addEventListener?n.addEventListener("load",r,!1):n.attachEvent?n.attachEvent("onload",r):n.onload=r}}(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); window.disablePushState = false; window.disableDrawer = false; </script> <!--[if lt IE 9]> <script src="/assets/bower_components/html5shiv/dist/html5shiv.min.js"></script> <![endif]--> <!--[if gt IE 8]><!----> <style> article, aside, dialog, figcaption, figure, footer, header, hgroup, main, nav, section { display: block; } mark { background: #FF0; color: #000; } * { box-sizing: border-box; } html, body { margin: 0; padding: 0; } html { font-size: 16px; line-height: 1.75; } body { color: #333; background-color: #fff; overflow-y: scroll; } a { text-decoration: none; } .lead { margin-left: -1rem; margin-right: -1rem; } img, .img { display: block; max-width: 100%; margin-bottom: 1rem; border: none; } img.lead, .img.lead { max-width: calc(100% + 2rem); width: calc(100% + 2rem); } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-weight: bold; text-rendering: optimizeLegibility; } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 { margin: 3rem 0 1rem; line-height: 1.6; } h1, .h1 { font-size: 2rem; line-height: 1.25; } h2, .h2 { font-size: 1.5rem; } h3, .h3 { font-size: 1.17em; } p { margin-top: 0; margin-bottom: 1rem; } p.lead { font-size: 1.25rem; font-weight: 300; padding: 0 1rem; } ul, ol, dl { margin-top: 0; margin-bottom: 1rem; } ul, ol { padding-left: 1.25rem; } hr { position: relative; margin: 1.5rem 0; border: 0; border-top: 1px solid #eee; } .hr { padding-bottom: .5rem; border-bottom: 1px solid #eee; margin-bottom: 1.5rem; } h4, h5, h6, .h4, .h5, .h6 { margin-bottom: 0.5rem; font-size: 1rem; } table { margin-bottom: 1rem; width: 100%; width: calc(100% + 2rem); margin-left: -1rem; border: 1px solid #e5e5e5; border-collapse: collapse; border-spacing: 0; } td, th { padding: .25rem .5rem; border: 1px solid #e5e5e5; } td:first-child, th:first-child { padding-left: 1rem; } td:last-child, th:last-child { padding-right: 1rem; } thead + tbody, tbody + tbody, tfoot { border-top: 3px double #e5e5e5; } tbody tr:nth-child(odd) td, tbody tr:nth-child(odd) th { background-color: #f9f9f9; } footer { margin-bottom: 2rem; } .page, .post { margin-bottom: 3em; } .page li + li, .post li + li { margin-top: .25rem; } .page > header, .post > header { margin-bottom: 2rem; } .page-title, .post-title { margin-top: 0; } .post-date { display: block; margin-top: -0.5rem; margin-bottom: 1rem; color: #9a9a9a; } .related-posts { padding-left: 0; list-style: none; } .related-posts > li, .related-posts > li + li { margin-top: 1rem; } .related-posts > li > small, .related-posts > li + li > small { font-size: 75%; color: #9a9a9a; } .message { margin-bottom: 1rem; padding: 1rem; color: #787878; background-color: #f9f9f9; margin-left: -1rem; margin-right: -1rem; } /* * Global resets * * Update the foundational and global aspects of the page. */ body, main { /* Prevent side-scrolling on mobile */ position: relative; overflow-x: hidden; } @media screen { body::before { content: ''; width: .5rem; background: #e5e5e5; position: absolute; left: 0; top: 0; bottom: 0; } } @media screen and (min-width: 40em) { html { font-size: 17px; } } @media screen and (min-width: 54em) { html { font-size: 16px; } } @media screen and (min-width: 72em) { html { font-size: 17px; } } @media screen and (min-width: 125em) { html { font-size: 18px; } } .sr-only { display: none; } .clearfix, .sidebar-social::after, .clearafter::after { content: ""; display: table; clear: both; } a, .a { position: relative; padding-bottom: .15rem; border-bottom: 1px solid; } .img { overflow: hidden; background-color: #f9f9f9; } .img > img { margin: 0; width: 100%; height: 100%; } .sixteen-nine { position: relative; } .sixteen-nine::before { display: block; content: ""; width: 100%; padding-top: 56.25%; } .sixteen-nine > * { position: absolute; top: 0; left: 0; right: 0; bottom: 0; } h1 + hr, h2 + hr, h3 + hr, h4 + hr, h5 + hr, h6 + hr { margin-top: 0; } .fade-in { animation-duration: 500ms; animation-name: fade-in; animation-fill-mode: forwards; } @keyframes fade-in { from { transform: translateY(-2rem); opacity: 0; } 50% { transform: translateY(-2rem); opacity: 0; } to { transform: translateY(0); opacity: 1; } } .mb6 { margin-bottom: 6rem; } .sidebar { color: rgba(255, 255, 255, 0.75); text-align: left; /* Sidebar links */ } .sidebar::before { /* make sidebar slightly darker to increase text readability (when using a background image) */ content: ""; position: absolute; z-index: 2; top: 0; left: 0; bottom: 0; right: 0; background: linear-gradient(to bottom, rgba(32, 32, 32, 0) 0%, rgba(32, 32, 32, 0.5) 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */ } .sidebar a { color: #fff; border-bottom-color: rgba(255, 255, 255, 0.2); } #_yDrawer { position: relative; padding: 1rem 0; } @media screen { #_yDrawer { padding: 2rem 1rem; min-height: 640px; min-height: 100vh; } } @media screen and (min-width: 54em) { #_yDrawer { position: fixed; top: 0; left: 0; bottom: 0; width: 18rem; margin-left: 0; } } @media screen and (min-width: 97.5em) { #_yDrawer { width: calc(50% - 28rem); } } @media screen { #_yDrawer.loaded { min-height: 0; padding: 0; } } .sidebar-bg { position: absolute; top: 0; right: 0; bottom: 0; left: 0; background: #202020 center / cover; } .sidebar-sticky { position: relative; z-index: 3; } @media screen { .sidebar-sticky { position: absolute; right: 2rem; bottom: 1rem; left: auto; max-width: 14rem; } } @media print { .sidebar-sticky { padding: 0 2rem; } } /* About section */ .sidebar-about > h1 { color: #fff; font-size: 2rem; } .sidebar-nav > ul { list-style: none; padding-left: 0; margin-bottom: .5rem; } a.sidebar-nav-item { font-weight: bold; display: block; line-height: 1.75; padding: .25rem 0; border-bottom: 1px solid rgba(255, 255, 255, 0.2); } @media screen { .y-drawer-scrim { z-index: 2; } .y-drawer-content { width: 18rem; left: -17.5rem; z-index: 3; } } @media screen and (min-width: 97.5em) { .y-drawer-content { width: calc(50% - 28rem); } } .sidebar-social { margin-bottom: .5rem; } .sidebar-social > ul { list-style: none; padding-left: 0; margin: 0 -.25rem; } .sidebar-social > ul > li { float: left; margin: 0 .25rem; } .sidebar-social > ul > li > a { display: inline-block; text-align: center; font-size: 1.6rem; line-height: 3rem; width: 3.1249rem; height: 4rem; padding: .5rem 0; } .sidebar-social > ul li + li { margin-top: 0; } .fixed-top { position: fixed; top: 0; left: 0; width: 100%; z-index: 1; } .navbar > .content { padding-top: 0; padding-bottom: 0; min-height: 0; height: 0; } .menu { display: inline-block; padding: 1.75rem 1.5rem; border-bottom: none; margin-left: -1.5rem; color: #9a9a9a !important; } .menu::after { content: "\2630"; } @media screen and (min-width: 54em) { .menu { padding: 1.25rem 1.5rem; position: absolute; left: -9999px; } .menu:focus { position: static; } } .animation-main { pointer-events: none; } .loading { display: none; } @media print { .menu { display: none; } } .animation-main { opacity: 0; will-change: opacity; } .loading { position: absolute; top: 0; right: 0; padding: 5.25rem 4.5rem; transform-origin: top right; transform: scale(0.33); } .content { position: relative; margin-left: auto; margin-right: auto; padding: 5rem 1rem 12rem; } @media screen { .content { max-width: 38rem; padding-left: 1.5rem; min-height: 100vh; } } @media screen and (min-width: 54em) { .content { max-width: 42rem; padding: 4rem 1rem 12rem; margin-left: 22rem; margin-right: 4rem; } } @media screen and (min-width: 72em) { .content { margin-left: 22rem; margin-right: 4rem; } } @media screen and (min-width: 92em) { .content { max-width: 48rem; } } @media screen and (min-width: 97.5em) { .content { margin: auto; } } .me { float: right; width: 6.5rem; height: 6.5rem; margin-left: 1rem; margin-bottom: .5rem; border-radius: 100%; position: relative; } @media screen and (min-width: 40em) { .me { width: 7rem; height: 7rem; } } @media screen and (min-width: 54em) { .me { width: 6.5rem; height: 6.5rem; } } @media screen and (min-width: 60em) { .me { width: 7rem; height: 7rem; } } main > footer { position: absolute; bottom: 0; left: 0; right: 0; padding: 0 1rem; color: #9a9a9a; font-size: smaller; text-align: center; } main > footer > p { margin-bottom: 0; } /* .card, .pagination-item { border-radius: 0!important; } */ /* @media screen { .sidebar-sticky { left: 2rem; max-width: none; } } */ html { font-family: Helvetica, Arial, sans-serif; } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: Helvetica, Arial, sans-serif; } </style> <link id="_stylePreload" rel="preload" as="style" href="/assets/css/hydejack.css?v=6.6.1"> <script>document.getElementById('_stylePreload').onload=function(){this.rel='stylesheet'}</script> <!-- NOTE: These styles interact with JavsScript, so they MUST NOT be changed --> <style id="_pageStyle"> .content a { color: #4f86aa; border-color: rgba(79, 134, 170, 0.2); } .content a:hover { border-color: #4f86aa; } :focus { outline-color: #4f86aa; } ::selection { color: #fff; background: #4f86aa; } ::-moz-selection { color: #fff; background: #4f86aa; } </style> <noscript> <link rel="stylesheet" href="/assets/css/hydejack.css?v=6.6.1"> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700|Noto+Sans:400,400i,700,700i"> <style> html { font-family: 'Noto Sans', Helvetica, Arial, sans-serif } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: 'Roboto Slab', Helvetica, Arial, sans-serif } </style> <link rel="stylesheet" href="/assets/icomoon/style.css"> </noscript> <!--<![endif]--> <!--[if gt IE 8]><!----> <script async src="/assets/bower_components/webfontloader/webfontloader.js"></script> <!--<![endif]--> </head> <body> <div class="navbar fixed-top"> <div class="content"> <span class="sr-only">Jump to:</span> <a id="_menu" class="menu no-hover" href="#_title"> <span class="sr-only">Menu</span> </a> </div> </div> <div id="_yPushState"> <div class="fade-in"> <main id="_main" class="content" role="main" data-color="#4f86aa" data-image=""> <article id="post-web%E5%89%8D%E7%AB%AF/2011/05/25/%e5%a6%82%e4%bd%95%e4%bf%ae%e6%ad%a3div-float%e4%b9%8b%e5%90%8e%e5%af%bc%e8%87%b4%e7%9a%84%e5%a4%96%e9%83%a8%e5%ae%b9%e5%99%a8%e4%b8%8d%e8%83%bd%e6%92%91%e5%bc%80%e7%9a%84%e9%97%ae%e9%a2%98" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web%E5%89%8D%E7%AB%AF/2011/05/25/e5-a6-82-e4-bd-95-e4-bf-ae-e6-ad-a3div-float-e4-b9-8b-e5-90-8e-e5-af-bc-e8-87-b4-e7-9a-84-e5-a4-96-e9-83-a8-e5-ae-b9-e5-99-a8-e4-b8-8d-e8-83-bd-e6-92-91-e5-bc-80-e7-9a-84-e9-97-ae-e9-a2-98.html" data-flip="title"> 如何修正DIV float之后导致的外部容器不能撑开的问题 </a> </h1> <p class="post-date heading"> <time datetime="2011-05-25T16:18:08+08:00">25 May 2011</time> in <span>Web前端</span> on <span>Web css</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p> <ol></ol> <ol></ol> <p>如何修正DIV float之后导致的外部容器不能撑开的问题</p> <p>在写HTML代码的时候，发现在Firefox等符合W3C标准的浏览器中，如果有一个DIV作为外部容器，内部的DIV如果设置了float样式，则外部的容器DIV因为内部没有clear，导致不能被撑开。看下面的例子：</p> <p>HTML4STRICT代码：</p> <ol></ol> <ol></ol> <h4> <ol> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;width:200px;border:1px solid red;&quot;&gt;</p> </li> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;float:left;width:80px;height:80px;border:1px solid blue;&quot;&gt;TEST DIV&lt;/div&gt;</p> </li> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;float:left;width:80px;height:80px;border:1px solid blue;&quot;&gt;TEST DIV&lt;/div&gt;</p> </li> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;float:left;width:80px;height:80px;border:1px solid blue;&quot;&gt;TEST DIV&lt;/div&gt;</p> </li> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;float:left;width:80px;height:80px;border:1px solid blue;&quot;&gt;TEST DIV&lt;/div&gt;</p> </li> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;float:left;width:80px;height:80px;border:1px solid blue;&quot;&gt;TEST DIV&lt;/div&gt;</p> </li> <li> <p>&lt;/div&gt;</p> </li> </ol> <ol></ol> </h4> <ol></ol> <ol></ol> <p>显示的结果如下：</p> <p><img alt="P_1160709253_0.gif" src="/assets/P_1160709253_0.gif" width="209" height="254" /></p> <p>容器DIV没有被撑开</p> <p>大家可以看到，作为外部容器的边框为红色的DIV，没有被撑开。这是因为内部的DIV因为float:left之后，就丢失了clear:both和display:block的样式，所以外部的DIV不会被撑开。</p> <p>我们想让外部容器的DIV随着内部DIV增多而增加高度，要怎么解决呢？</p> <p>以前我都是用这样的方法来解决：</p> <p>HTML4STRICT代码：</p> <ol></ol> <ol> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;width:200px;border:1px solid red;&quot;&gt;</p> </li> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;float:left;width:80px;height:80px;border:1px solid blue;&quot;&gt;TEST DIV&lt;/div&gt;</p> </li> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;float:left;width:80px;height:80px;border:1px solid blue;&quot;&gt;TEST DIV&lt;/div&gt;</p> </li> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;float:left;width:80px;height:80px;border:1px solid blue;&quot;&gt;TEST DIV&lt;/div&gt;</p> </li> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;float:left;width:80px;height:80px;border:1px solid blue;&quot;&gt;TEST DIV&lt;/div&gt;</p> </li> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;float:left;width:80px;height:80px;border:1px solid blue;&quot;&gt;TEST DIV&lt;/div&gt;</p> </li> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;clear:both;&quot;&gt;&lt;/div&gt;</p> </li> <li> <p>&lt;/div&gt;</p> </li> </ol> <p>显示的结果如下：</p> <p><img alt="P_1160709321_0.gif" src="/assets/P_1160709321_0.gif" width="207" height="248" /></p> <p>显示正常了</p> <p>我们看到，在容器DIV内要显示出来的float:left的所有的DIV之后，我们添加了这样的一个DIV：&lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt;&#160; 。这样，其实就在最后增加了clear的动作。</p> <p>但是，我总觉得，这么多加一个DIV有点不妥。一是多了一个没有意义的DIV，二是在用dojo做Drag &amp; Drop的时候，由于这个DIV是容器DIV的一个字节点，如果这个节点被移动，则会造成排版上的Bug：如果要显示的蓝框的DIV被移到这个DIV之后，则因为clear:both，它会被强制换一行显示。所以，我一直在寻找更好的解决办法。</p> <p>昨天在无数次的询问了Google大仙后，我终于找到了<a href="http://www.positioniseverything.net/easyclearing.html"><u><i>How To Clear Floats Without Structural Markup</i></u></a> 这篇文章，找到了解决的办法。</p> <p>首先设置这样的CSS：</p> <p>CSS代码：</p> <ol> <li> <p>.clearfix:after {</p> </li> <li> <p>content: &quot;.&quot;;</p> </li> <li> <p>display: block;</p> </li> <li> <p>height: 0;</p> </li> <li> <p>clear: both;</p> </li> <li> <p>visibility: hidden;</p> </li> <li> <p>}</p> </li> </ol> <p>然后，我们再修改原来的HTML代码，让外部的容器DIV来使用这个CSS：</p> <p>HTML4STRICT代码：</p> <ol> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;width:200px;border:1px solid red;&quot; class=&quot;clearfix&quot;&gt;</p> </li> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;float:left;width:80px;height:80px;border:1px solid blue;&quot;&gt;TEST DIV&lt;/div&gt;</p> </li> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;float:left;width:80px;height:80px;border:1px solid blue;&quot;&gt;TEST DIV&lt;/div&gt;</p> </li> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;float:left;width:80px;height:80px;border:1px solid blue;&quot;&gt;TEST DIV&lt;/div&gt;</p> </li> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;float:left;width:80px;height:80px;border:1px solid blue;&quot;&gt;TEST DIV&lt;/div&gt;</p> </li> <li> <p><a href="http://december.com/html/4/element/div.html"><u>&lt;div</u></a> style=&quot;float:left;width:80px;height:80px;border:1px solid blue;&quot;&gt;TEST DIV&lt;/div&gt;</p> </li> <li> <p>&lt;/div&gt;</p> </li> </ol> <p>在 Firefox里测试一下，哈哈，这样做的确很有效，显示正常，而且dojo的 Drag &amp; Drop 也不会有问题了。原来，这个clearfix的CSS使用了after这个伪对象，它将在应用clearfix的元素的结尾添加content中的内容。在这里添加了一个句号&quot;.&quot;，并且把它的display设置成block；高度设为0；clear设为both；visibility设为隐藏。这样就达到了撑开容器的目的啦。</p> <p>但是，在文章中说，Windows IE并不支持这样做。所以要让IE也完美显示，则必须在clearfix这个CSS定义的后面加上一些专门为IE设定的HACK。CSS如下：</p> <p>CSS代码：</p> <ol> <li> <p>.clearfix:after {</p> </li> <li> <p>content: &quot;.&quot;;</p> </li> <li> <p>display: block;</p> </li> <li> <p>height: 0;</p> </li> <li> <p>clear: both;</p> </li> <li> <p>visibility: hidden;</p> </li> <li> <p>}</p> </li> <li> <p><i>/* Hides from IE-mac \*/</i></p> </li> <li> <p>* html .clearfix {height: 1%;}</p> </li> <li> <p><i>/* End hide from IE-mac */</i></p> </li> </ol> <p>因为转义字符&quot;\&quot;，Mac IE浏览器会忽略掉这段Hack，但Windows IE不会，它会应用 * html .clearfix {height: 1%;} 来达到撑开DIV容器的目的（貌似Mac IE没有办法解决这个问题，不过幸好用户数量是在是太少了，Safari支持就可以了:p）。</p> <p>测试一下，果然大功告成。</p> <p><img alt="P_1160709321_0.gif" src="/assets/P_1160709321_0.gif" width="207" height="248" /></p></p> <p class="read-more">Continue reading <a class="heading" href="/web%E5%89%8D%E7%AB%AF/2011/05/25/e5-a6-82-e4-bd-95-e4-bf-ae-e6-ad-a3div-float-e4-b9-8b-e5-90-8e-e5-af-bc-e8-87-b4-e7-9a-84-e5-a4-96-e9-83-a8-e5-ae-b9-e5-99-a8-e4-b8-8d-e8-83-bd-e6-92-91-e5-bc-80-e7-9a-84-e9-97-ae-e9-a2-98.html" data-flip="title">如何修正DIV float之后导致的外部容器不能撑开的问题</a></p> </article> <article id="post-web%E5%89%8D%E7%AB%AF/2011/05/25/css3-jqeury" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web%E5%89%8D%E7%AB%AF/2011/05/25/css3-jqeury.html" data-flip="title"> css3-jqeury </a> </h1> <p class="post-date heading"> <time datetime="2011-05-25T16:16:35+08:00">25 May 2011</time> in <span>Web前端</span> on <span>Css3 jqeury</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>css3可以轻松实现很多譬如图片边框、多重背景、文字阴影等效果，但是目前支持css3的浏览器少之又少，往往了实现圆角效果要去写一堆代码，下面介绍的这些强大的jQuery插件可以轻松帮你实现很多复杂的视觉效果。</p> <p>&#160;&#160; 在这之前我们先来看一下几个CSS3实例代码是怎么实现各种效果的。</p> <p>1.多重背景</p> <blockquote><p>#backgrounds-box { <br />background: url(top-backgroundg.png) top left no-repeat, <br />url(bottom-backgroundg.png) bottombottom left no-repeat, <br />url(middle -backgroundg.png) left repeat-y; <br />padding: 35px; <br />}</p> </blockquote> <p>2.文字阴影</p> <blockquote><p>b { text-shadow:&#160; 5px 5px 5px #666666; }</p> </blockquote> <p>3.圆角</p> <blockquote><p>#rounded-corners-box { <br />-moz-border-radius-topleft: 8px; <br />-moz-border-radius-topright: 8px; <br />-moz-border-radius-bottomright: 8px; <br />-moz-border-radius-bottomleft: 8px; <br />-webkit-border-top-left-radius: 8px; <br />-webkit-border-top-rightright-radius: 8px; <br />-webkit-border-bottom-left-radius: 8px; <br />-webkit-border-bottom-rightright-radius: 8px; <br />}</p> </blockquote> <p> 4.透明效果</p> <blockquote><p>.div-name { background: #333333; opacity:0.8; width: 380px; height:70px; }</p> </blockquote> <p> 下面来看看jQuery插件实现css3效果的插件：</p> <p><b>jQuery Corners 0.3</b></p> <p><b><a href="http://malsup.com/jquery/corner/">http://malsup.com/jquery/corner/</a></b></p> <p>轻松地实现漂亮的圆角，无需额外的标签或图片。支持 iPhone.、Chrome、Firefox、Safari 2+、 Opera 9.0+、Internet Explorer 6+。</p> <p><img alt="jQuery Corners 0.3" src="/assets/1243223421-0.jpg" width="466" height="266" /></p> <p><b>jQuery Canvas Rounded Corners</b></p> <p>通过canvas 实现圆角的jQuery插件，支持IE7、FF。</p> <p><img alt="jQuery Canvas Rounded Corners" src="/assets/1243223547-1.jpg" width="466" height="266" /></p> <p><b>How To&#160; Border Image with CSS3 and jQuery</b></p> <p>CSS3 draft 介绍灰墙强大的图片边框技术。</p> <p><img alt="How To Border Image with CSS3 and jQuery" src="/assets/1243221200-2.jpg" width="466" height="266" /></p> <p><b>How To CSS Multiple Backgrounds / Background Layering with jQuery</b></p> <p>实现多重图片背景的这个插件可以极大地减少xhtml标签，精简你的代码，多重背景的概念类似于PS的图层，一个图层叠在另一个图层上面。</p> <p><img alt="How To CSS Multiple Backgrounds / Background Layering with jQuery" src="/assets/1243226221-3.jpg" width="466" height="266" /></p> <p>How To Drop Shadow with jQuery</p> <p>为页面上的文字和透明图片添加柔和和阴影效果。</p> <p><img alt="drop-shadow" src="/assets/1243224E2-4.jpg" width="466" height="266" /></p> <p><b>How To Text-shadow in Internet Explorer</b> using jQuery</p> <p>这个教程会教你如何在IE中轻松实现文字阴影效果。</p> <p><img alt="How To Text-shadow in Internet Explorer using jQuery" src="/assets/12432252M-5.jpg" width="466" height="266" /></p> <p>How To Element Gradient with jquery</p> <p>允许你自定义元素的填充渐变效果，支持指定渐变的方向。</p> <p><img alt="How To Element Gradient with jquery" src="/assets/1243223616-6.jpg" width="466" height="266" /></p> <p><b>How to Rounded Corners in jQuery</b></p> <p>一个简易的用jQuery实现圆角的教程。</p> <p><img alt="How to Rounded Corners in jQuery" src="/assets/124322M29-7.jpg" width="466" height="266" /></p> <p><b>CSS3 Template Layout realized with jQuery</b></p> <p>实现CSS3布局。</p> <p><img alt="CSS3 Template Layout realized with jQuery" src="/assets/12432261R-8.jpg" width="466" height="266" /></p> <p><b>Creating a polaroid photo viewer with CSS3 and jQuery</b></p> <p>结合CSS3的 <b>Box Shadow</b> 属性<b>Rotate</b> 实现拖动图片过程中的阴影效果。</p> <p><img alt="Creating a polaroid photo viewer with CSS3 and jQuery" src="/assets/12432253T-9.jpg" width="466" height="266" /></p> <p><b>jSlickmenu: A jQuery plugin for slick CSS3 menus</b></p> <p>jSlickmenu通过类似CSS3的rotation 和shadows属性现非常酷的菜单效果。</p> <p><img alt="Super slick jQuery menu with CSS3" src="/assets/124322A26-10.jpg" width="466" height="266" /></p> <p class="read-more">Continue reading <a class="heading" href="/web%E5%89%8D%E7%AB%AF/2011/05/25/css3-jqeury.html" data-flip="title">css3-jqeury</a></p> </article> <article id="post-java/2011/05/25/tapestry-5-building-web-applications-%e8%bf%99%e6%9c%ac%e4%b9%a6%e4%b8%8d%e9%94%99" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/java/2011/05/25/tapestry-5-building-web-applications-e8-bf-99-e6-9c-ac-e4-b9-a6-e4-b8-8d-e9-94-99.html" data-flip="title"> Tapestry 5 Building Web Applications 这本书不错 </a> </h1> <p class="post-date heading"> <time datetime="2011-05-25T16:13:38+08:00">25 May 2011</time> in <span>Java</span> on <span>Tapestry</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <h5><i><b></b></i></h5></p> <p>Tapestry 5 Building Web Applications 这本书不错，比in action要好看些，但是我看到的版本有几点没讲到：</p> <p>javascrip/ajaxt整合</p> <p>客户端验证</p> <p>组件动态创建（可不可行？）</p> <p class="read-more">Continue reading <a class="heading" href="/java/2011/05/25/tapestry-5-building-web-applications-e8-bf-99-e6-9c-ac-e4-b9-a6-e4-b8-8d-e9-94-99.html" data-flip="title">Tapestry 5 Building Web Applications 这本书不错</a></p> </article> <article id="post-web/%E5%AE%89%E5%85%A8/2011/05/25/p3p-%e8%b7%a8%e5%9f%9f" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web/%E5%AE%89%E5%85%A8/2011/05/25/p3p-e8-b7-a8-e5-9f-9f.html" data-flip="title"> p3p 跨域 </a> </h1> <p class="post-date heading"> <time datetime="2011-05-25T16:12:07+08:00">25 May 2011</time> in <span>Web</span> / <span>安全</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <h5>p3p 跨域</h5> <p>最近因为工作需要写了个msn<b>机器</b><b>人</b>，发现<b>xiaoi</b><b>机器</b><b>人</b>的活动页面是使用frame来加载用户页面，于是会导致cookie,session,js,等权限问题。 <br />1、cookie,session的权限问题，解决方案一：可以通过添加P3P header解决，如：Response.AddHeader(&quot;P3P&quot;, &quot;CP=CAO PSA OUR&quot;);，也可在IIS里面直接设置。//很好 <br />2、如有页面中还有frame,就会报禁止访问。 <br />终极方案：添加一个跳转页面，页面只需一个js: <br />&#160; window.top.location = &quot;your url&quot;;//这一条行不通，跨域访问仍然会报错，top则造成在msn外面打开了新窗口，莫名其妙。 <br />这样，就不会存在任何权限问题。 <br />===================================================================================================== <br /><b>sohu实现-单点登录</b>:</p> <h3><a name="TOC-cross-domain-cookie-"></a>跨域(cross-domain)访问 cookie （读取和设置）</h3> <p> 由 qyb 于 星期四, 2006-11-16 21:41 发表 <p>Passport 一方面意味着用一个帐号可以在不同服务里登录，另一方面就是在一个服务里面登录后可以无障碍的漫游到其他服务里面去。坦白说，目前 sohu passport 在这一点实现的很烂（不过俺的工作就是要把它做好啦，hehe）</p> <p>搜狐的 SSO 需求比较麻烦，因为它旗下有好多域名：sohu.com、chinaren.com、sogou.com、focus.cn、17173.com、go2map.com，登录用户漫游的主要障碍也来自于此。</p> <p>以前亿邮的邮件系统在和别的系统整合的时候是提供一个 URL，用户从第三方系统里面点击这个链接就可以生成访问邮件界面所需的 cookie，然后进入邮件。这个方式的确很有效，但问题是： <br />1. 每个外部链接都必须用特殊的 URL 跳转，维护很麻烦 <br />2. 两个系统集成已经很麻烦了，若是集成的系统有好几个，彼此都需要跳转而缺乏一个中心机制就成了噩梦 <br />3. 根本无法处理用户直接在地址栏输入地址进行访问的情况</p> <p>即使是跨域，上述的解决方法相对来说还是容易的。 <br />A. 首先是所有登录必须首先通过一个中央服务器进行认证，然后在它那里给浏览器种下 cookie（下面称之为 sso cookie） <br />B. 当用户访问另外的域名 app 的时候，浏览器是无法直接发送 sso cookie 给服务器认证的。此时应该利用 javascript，动态创建一个隐藏的 iframe，让其访问 sso <br />C. 这个 iframe 的请求是可以把 sso cookie 送给 sso server 的。sso server 验证 cookie 后，返回一个重定向页面到 app 的某个 URL，由该 URL 设置 app cookie <br />D. 此时浏览器上可看见的页面容器实际上也是可以和重定向回来的内容交互的。比如可以用 js 控制发现重定向页面成功返回后，就刷新整个页面，让它看起来和用户登录后访问没有什么区别。</p> <p><b>下面是真正的技巧：怎样才能在 IE 里面跨域去设置 cookie</b> <br />上述技术看起来是不是很好？但它的前提是所有的登录都 post 到 sso server 上，认证成功后再返回 app 页面。可我接受到的需求之一就是要支持页面无刷新登录。</p> <p>哈！就是说本来在 chinaren.com 上提交登录表单的 action 应该是 passport.sohu.com 这个 sso server。可是在 AJAX 大潮下，chinaren 计划采用 XMLHTTPRequest 提交，这个就麻烦了，因为是不能跨域来提交的。</p> <p>那么解决方法就是跨域产生 cookie，即 js 发现口令校验成功后，再在 passport.sohu.com 上种上合法的 cookie.</p> <p>套用上面的跨域读 cookie 的方案似乎很简单去推论：就是创建一个隐含的 iframe，让那个 iframe 去调用 passport.sohu.com 的 URL 来产生 cookie。很遗憾，此方法在 Fx 下工作的很好，但是不能在 IE 上应用。（在 IE 状态栏上显示 cookie 隐私警告，红色圆底白横杠）</p> <p>我试了很多很多方法，包括创建 、 node，包括用 js 设置，但都一次次被 IE 无情的挡在了浏览器外。google 之，也没有任何真正可用的答案，中文网页要么介绍的方法是错的，要么说无解。</p> <p>最后还是在 chinaren 一哥们的帮助下，翻出了他们所使用的，以和 alumni.sohu.com 交互的方法（不知道是哪位牛人发现的），<b>只需要设置 P3P HTTP Header</b>，在隐含 iframe 里面跨域设置 cookie 就可以成功。他们所用的内容是：</p> <p>P3P: CP=&quot;CURa ADMa DEVa PSAo PSDo OUR BUS UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR&quot;</p> <p>最后是我做的一个小小的演示：cookie 怎么在 vmx.cn 和 dup2.net 之间交互</p> <p>1. <a href="http://qiuyingbo.test.vmx.cn/cookie.php">http://qiuyingbo.test.vmx.cn/cookie.php</a></p> <p>2. 随便输入什么，点 reset cookie，就可以看到 vmx.cn 的 cookie 已经被设上了</p> <p>3. 在该页面点连接到 http://www.dup2.net/vmx/cookie.html</p> <p>4. 点&quot;get corss-domain cookie&quot; .. （此时 js 会去创建一个iframe，请求 qiuyingbo.test.vmx.cn ，返回页面把 cookie 值作为 GET 参数重定向回 dup2.net 的另外一个URL。）</p> <p>5. 点 &quot;display corss-domain cookie&quot; .. 就可以看到 vmx.cn 的 cookie 了</p> <p>6. 在该页面的输入框中输入其它的值，然后点 &quot;set cross-domain cookie&quot;，该行为将主动设置 vmx.cn 的 cookie</p> <p>7. 点链接回到 http://qiuyingbo.test.vmx.cn/cookie.php ，就可以看到新的值了</p> <p>==============================================================================================================================</p> <p>作者：老王</p> <p>说使用P3P可以完成跨域COOKIE操作，感觉很COOL，不过没有提供源代码，我胡乱写了一下，大家看看。</p> <p>实际工作中，类似这样的要求很多，比如说，我们有两个域名，我们想实现在一个域名登录后，能自动完成另一个域名的登录，也就是PASSPORT的功能。</p> <p>我只写一个大概，为了测试的方便，先编辑hosts文件，加入测试域名（C:\WINDOWS\system32\drivers\etc\hosts）</p> <p>127.0.0.1&#160;&#160;&#160;&#160;&#160;&#160; www.a.com <br />127.0.0.1&#160;&#160;&#160;&#160;&#160;&#160; www.b.com</p> <p>首先：创建 a_setcookie.php 文件，内容如下：</p> <p><b>&lt;?php&#160; <br /></b><b>//header('P3P: CP=&quot;CURa ADMa DEVa PSAo PSDo OUR BUS UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR&quot;');&#160; <br />setcookie(&quot;test&quot;</b><b>, </b>$_GET['id'], <b>time()+3600, &quot;/&quot;, &quot;.a.com&quot;</b><b>);&#160; <br />?&gt;</b></p> <p>然后：创建 a_getcookie.php 文件，内容如下：</p> <p><b>&lt;?php&#160; <br />var_dump($_COOKIE</b><b>);&#160; <br />?&gt;</b></p> <p>最后：创建 b_setcookie.php 文件，内容如下：</p> <p><b>&lt;script src=&quot;</b><b>http://www.a.com/a_setcookie.php?id=www.b.com&quot;&gt;&lt;/script</b><b>&gt;</b></p> <p>－－－－－－－－－－－－－－－－－－－－－－－－－－－－</p> <p>三个文件创建完毕后，我们通过浏览器依次访问：</p> <p>http://www.b.com/b_setcookie.php <br />http://www.a.com/a_getcookie.php</p> <p>我们会发现，在访问b.com域的时候，我们并没有在a.com域设置上cookie值。</p> <p>然后我们修改一下a_setcookie.php文件，去掉注释符号，a_setcookie.php即为：</p> <p>&lt;?php&#160;&#160; <br />header('P3P: CP=&quot;CURa ADMa DEVa PSAo PSDo OUR BUS UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR&quot;');&#160;&#160; <br />setcookie(&quot;test&quot;, $_GET['id'], time()+3600, &quot;/&quot;, &quot;.a.com&quot;);&#160;&#160; <br />?&gt; </p> <p>再次通过浏览器依次访问：</p> <p>http://www.b.com/b_setcookie.php <br />http://www.a.com/a_getcookie.php</p> <p>这次，你会发现在访问b.com域的时候，我们设置了a.com域的cookie值。</p> <p>末了补充一句，似乎只有IE对跨域访问COOKIE限制比较严格，上述代码在FIREFOX下测试，即使不发送P3P头信息，也能成功。不过IE是老大啊。</p> <p>参考文档：<a href="http://www.w3.org/P3P/">http://www.w3.org/P3P/</a></p> <p>p3p介绍:</p> <p><a href="http://www.yxl.cn/Info/20060302,212041,5095.html">http://www.yxl.cn/Info/20060302,212041,5095.html</a></p> <p><b>这里水很深……</b></p> <p class="read-more">Continue reading <a class="heading" href="/web/%E5%AE%89%E5%85%A8/2011/05/25/p3p-e8-b7-a8-e5-9f-9f.html" data-flip="title">p3p 跨域</a></p> </article> <article id="post-java/2011/05/25/wicket%e4%b8%8ejsfseam%e6%af%94%e8%be%83" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/java/2011/05/25/wicket-e4-b8-8ejsfseam-e6-af-94-e8-be-83.html" data-flip="title"> wicket与jsf/seam比较 </a> </h1> <p class="post-date heading"> <time datetime="2011-05-25T16:09:44+08:00">25 May 2011</time> in <span>Java</span> on <span>Web jsf wicket</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <h5>wicket与jsf/seam比较</h5> <h3><a name="TOC-:"></a>原文:</h3> <h3><a name="TOC-http:-swik.net-Peter-Thomas-Increme"></a><a href="http://swik.net/Peter-Thomas/Incremental+Operations/Seam+%2F+JSF+vs+Wicket:+performance+comparison/cp1je">http://swik.net/Peter-Thomas/Incremental+Operations/Seam+%2F+JSF+vs+Wicket:+performance+comparison/cp1je</a></h3> <h3><a name="TOC-Seam-JSF-vs-Wicket:-performance-com"></a>Seam / JSF vs Wicket: performance comparison </h3> <p>Your tags: or <a href="http://swik.net/Peter-Thomas/Incremental+Operations/Seam+%2F+JSF+vs+Wicket:+performance+comparison/cp1je#cancel">Cancel</a></p> <h3><a name="TOC-Tags-Applied-to-this-Entry"></a>Tags Applied to this Entry</h3> <p>No one has tagged this page.</p> <p><a href="http://swik.net/Peter-Thomas/Incremental+Operations/Seam+%2F+JSF+vs+Wicket:+performance+comparison/cp1je#">Tag this Entry</a> | <a href="http://swik.net/Peter-Thomas/Incremental+Operations/Seam+%2F+JSF+vs+Wicket:+performance+comparison/cp1je">Tagging Details</a></p> <ul> <li><a href="http://history.swik.net/Peter-Thomas">Recent Edits for Peter-Thomas</a></li> <li><a href="http://history.swik.net/Peter-Thomas/Incremental+Operations">Recent Edits for Incremental Operations</a></li> <li><a href="http://history.swik.net/Peter-Thomas/Incremental+Operations/Seam+%2F+JSF+vs+Wicket%3A+performance+comparison">Recent Edits for Seam / JSF vs Wicket: performance comparison</a></li> </ul> <p>created on 20 Jan 2009, by Syndication, <a href="http://ptrthomas.wordpress.com/2009/01/14/seam-jsf-vs-wicket-performance-comparison/">read more…</a></p> <p>A while after <a href="http://in.relation.to/Bloggers/SeamlessWicket">Seam support for Apache Wicket</a> was announced, I downloaded Seam and took a look at the Wicket example. Then an idea struck – how about doing a performance comparison – I mean, here was the very same application implemented in JSF and Wicket – right? So I decided to write a JMeter script for both the JSF and Wicket versions of the Seam “hotel booking” example and compare results. I started right away but very soon got tired of waiting for app-server re-starts on my trusty laptop (Jetty has really spoiled me) – and it kind of bothered me that the Seam examples were not in Maven 2 layout. Anyway, at some point I decided to re-write an “EJB-free” version of the Seam booking example using just Wicket and JPA. And use Maven and Jetty. And… one thing led to another – and what I ended up doing is this:</p> <ul> <li>Adapted the Seam JPA example (the one that does not use EJB) as the baseline application. Converted it into a Maven 2 WAR project which can run on Jetty. </li> <li>Implemented what I hope is the exact equivalent of the above using only Wicket and JPA, also Maven-ized and Jetty-fied. Decided to also experiment with some of the ideas in <a href="http://wicketinaction.com/2008/09/building-a-smart-entitymodel/">this blog post</a>. </li> <li>Wrote a JMeter script for both applications taking care to exercise identical functionality. </li> <li>Used an Ant script to run the JMeter scripts in batch mode (passing number of concurrent users as a parameter) and start / stop Jetty in sync. </li> <li>Automated the entire cycle of running the load test for 1, 5, 10, 15 and 20 concurrent users including some code to parse the JMeter logs and generate a CSV file of tabular results. </li> <li>Also included an Ant target that takes a JVM heap dump at the end of the load test – just before the users are logged out and the HTTP sessions killed.</li> </ul> <p>I was able to re-use the official Seam Wicket example to some extent, mainly the HTML files – but the Java side is almost completely re-written. The Seam booking example covers quite a bit of ground from the framework comparison point of view – for example:</p> <ul> <li><b>Security</b> – some pages are secured and redirect to a login page </li> <li><b>Templating</b> – some pages inherit from a common layout with a header / footer defined </li> <li><b>Ajax</b> – <ul> <li>hotel search results refresh as you type and a “busy” image is shown during the Ajax request </li> <li>form field validations occur as soon as the field loses focus</li> </ul> </li> <li><b>Session scope</b> – some state is stored and retrieved in the session </li> <li><b>Page navigation / state</b> – <ul> <li>user navigation state transparently managed by the framework </li> <li>user should be able to work in multiple concurrent conversations (browser tabs) </li> <li>the browser back button should work as expected</li> </ul> </li> <li><b>JPA</b> – getting access to the entity manager and transaction management </li> <li><b>Forms</b> – binding, validation and displaying error / info feedback to the user </li> <li><b>Hibernate Validator</b> – annotations on the JPA entity classes are re-used for form-validation</li> </ul> <p>Both sides use the exact same entities, persistence.xml and initial HSQLDB import. I’m using the latest Seam 2.1.1-GA and Wicket 1.3.5. Disclaimer: my Wicket code may not be ideal, and I’ve also experimented with a custom RequestCycle for JPA and tried to use inherited models as far as possible. Instructions on how you can download the source and run the scripts on your local machine are at the end of this blog post.</p> <p>I may do some follow up blog posts on how the code compares between the Seam / JSF and Wicket implementations, and also share some tips on writing JMeter scripts and automation using Jetty, Ant etc. I’m also expecting to have to make corrections and changes to the code based on feedback. For now, I’ll summarize my observations on performance and memory usage.</p> <p><b>Performance:</b> <br />In the JMeter script, except for the login and logout (first two rows and last row), the actions are executed in a loop ten times for each concurrent user. So if the number of concurrent users is 20, the login and logout actions happen 20 times and the rest 20 x 10 times. The numbers below are average page response time in milliseconds.</p> <p><img alt="performance2" src="/assets/performance2.png?w=720&amp;h=220" width="720" height="220" /></p> <p>Wicket appears to be faster by a wide margin. For two pages (“ajax post search” and “post confirm booking”) the results are a bit closer. This can possibly be explained by the fact that these particular actions display the results from a relatively expensive database query. My amateur profiling attempts suggest that the database query is taking most of the time here.</p> <p>One thing I have to mention: the “cc number” and “cc name” requests are simulations of the Ajax validations of the credit card number and name fields on the booking form. For these particular requests on the JSF side, the entire form is being POST-ed instead of just the value of the form field being validated when the user tabs out (onblur). So the difference here is quite dramatic. I did try adding <a href="http://www.jboss.org/file-access/default/members/jbossrichfaces/freezone/docs/devguide/en/html/support.html">ajaxSingle=”true”</a> in the JSF view but it did not appear to work (I used <a href="https://addons.mozilla.org/en-US/firefox/addon/6647">HttpFox</a> while building the JMeter scripts). I can re-post the updated results if someone lets me know what changes need to be made to “book.xhtml” to get the Ajax validation to work as expected.</p> <p><b>Memory Usage:</b> <br />The JMeter script can be told to skip the logout page and I wired up one of the Ant targets to take a JVM heap dump / snapshot as soon as the JMeter script completes. So I can compare what the heap looks like just after a load test when all the concurrent HTTP sessions are alive.</p> <p>I’m very much a NetBeans user but I have to say that the <a href="http://www.eclipse.org/mat/">Eclipse Memory Analyzer</a> is far better than what the built-in NetBeans Profiler offers for looking at JVM heap dumps. Here are some side-by-side screenshots of the heap analysis after running the JMeter script for 20 concurrent users.</p> <p>“Top Consumers” report below showing the classes that dominate memory usage:</p> <p><img alt="top-consumers2" src="/assets/top-consumers2.png?w=782&amp;h=461" width="782" height="461" /></p> <p>The “dominator tree” report below is very useful to see which objects hold on to the most memory directly as well as indirectly. The column headings after “Class name” are Shallow Heap, Retained Heap and Percentage. Shallow Heap means the memory consumed by a single object and Retained Heap is the sum of shallow sizes of all objects that will be garbage collected if the given object is garbage collected.</p> <p><img alt="dominator-tree" src="/assets/dominator-tree.png?w=729&amp;h=491" width="729" height="491" /></p> <p>Looking at the above two reports we can infer that on the Seam / JSF side, the 20 sessions each take up about 800 KB adding up to around 16 MB total. On the Wicket side the 20 sessions add up to around 1.5 MB. On the Wicket side it is the DiskPageStore that appears to hold the most memory and we can see what is going on here after drilling down a little:</p> <p><img alt="diskpagestore2" src="/assets/diskpagestore2.png?w=597&amp;h=380" width="597" height="380" /></p> <p>The Wicket DiskPageStore uses <a href="http://www.ibm.com/developerworks/java/library/j-jtp01246.html">SoftReference</a>-s to serialized pages so the memory will be reclaimed by the JVM if needed. And the SerializedPageWithSession holds a <a href="http://www.ibm.com/developerworks/java/library/j-jtp11225/index.html">WeakReference</a> to the actual page instance (MainPage). You can also spot the byte-array which is the result of page serialization. If a serialized page is requested (perhaps the user hit the browser back-button) and the page is no longer in memory because the SoftReference has been GC-ed – it will be restored from the temp file that the DiskPageStore has been saving pages to.</p> <p>I’m totally impressed by the Eclipse Memory Analyzer. Here we can see the break-up of the contents of the largest HTTP session on both sides. I think we can safely blame JSF for the lion’s share of memory usage on the left:</p> <p><img alt="session-dominators" src="/assets/session-dominators.png?w=726&amp;h=491" width="726" height="491" /></p> <p>Finally, a summary of the heap-dump comparison (for 20 users) collated from the various reports:</p> <p><img alt="heap-summary" src="/assets/heap-summary.png?w=318&amp;h=105" width="318" height="105" /></p> <p><b>Instructions:</b></p> <p>Prerequisites:</p> <ul> <li>JDK 1.5 or greater installed </li> <li><a href="http://ant.apache.org/">Apache Ant</a> installed </li> <li><a href="http://jakarta.apache.org/jmeter/">JMeter</a> 2.X available unzipped somewhere (better use latest 2.3.2)</li> </ul> <p>Steps:</p> <ul> <li>Do a Subversion check out of the source from here: <a href="http://perfbench.googlecode.com/svn/trunk/perfbench/">http://perfbench.googlecode.com/svn/trunk/perfbench/</a></li> <li>Create a perfbench/build.properties file that points to your JMeter installation. You can look at the comment in perfbench/build.xml for an example. </li> <li>Open a command prompt, change directory to perfbench/seam-jpa </li> <li>If running for the first time, use the command “ant jmeter-cycle”. The build script would prompt for the number of threads, so enter “1”. It may take time for all the required JAR files to get downloaded. Once you see Jetty start and stop successfully, you should be all set to run the actual benchmark. </li> <li>To start the benchmark run “ant jmeter-cycle-full”. This should take 2 – 3 minutes to run a series of tests for 1, 5, 10, 15 and 20 concurrent users. Results will be dumped into perfbench/target. You can look at the *.csv file at the end for the results. </li> <li>You can also run a load test which saves a snapshot of the heap dump towards the end by running “ant jmeter-cycle-heapdump”. </li> <li>Repeat the previous 3 steps after changing working directory to perfbench/wicket-jpa</li> </ul> <p><i>Update:</i> perfbench/build.xml starts Jetty with JVM options “-Xms64m -Xmx64m” and you may need to change this if you want to experiment with more concurrent users.</p> <p>&#160;</p> <p>我说，这两个都不行啊，别怪我打击你。</p> <p class="read-more">Continue reading <a class="heading" href="/java/2011/05/25/wicket-e4-b8-8ejsfseam-e6-af-94-e8-be-83.html" data-flip="title">wicket与jsf/seam比较</a></p> </article> <article id="post-web%E5%89%8D%E7%AB%AF/2011/05/25/ajax-httpxml-%e8%bf%94%e5%9b%9e%e7%a0%810-%e5%92%8c-1" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web%E5%89%8D%E7%AB%AF/2011/05/25/ajax-httpxml-e8-bf-94-e5-9b-9e-e7-a0-810-e5-92-8c-1.html" data-flip="title"> ajax httpxml 返回码0 和 -1 </a> </h1> <p class="post-date heading"> <time datetime="2011-05-25T16:07:50+08:00">25 May 2011</time> in <span>Web前端</span> on <span>Web ajax</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>当容器(tomcat)停机,返回码是status=0 ,statusText=&quot;communication failure&quot; </p> <p>当拔网线，status=-1,statusText=&quot;transaction abort&quot;</p> <p class="read-more">Continue reading <a class="heading" href="/web%E5%89%8D%E7%AB%AF/2011/05/25/ajax-httpxml-e8-bf-94-e5-9b-9e-e7-a0-810-e5-92-8c-1.html" data-flip="title">ajax httpxml 返回码0 和 -1</a></p> </article> <article id="post-web%E5%89%8D%E7%AB%AF/2011/05/25/%e6%a8%a1%e6%9d%bf%e5%ba%93" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web%E5%89%8D%E7%AB%AF/2011/05/25/e6-a8-a1-e6-9d-bf-e5-ba-93.html" data-flip="title"> 模板库 </a> </h1> <p class="post-date heading"> <time datetime="2011-05-25T16:07:14+08:00">25 May 2011</time> in <span>Web前端</span> on <span>Web</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>国外免费 <br />http://www.freewebsitetemplates.com <br />模板库 </p> <p>http://www.skinpress.com/ <br />韩国模板</p> <p>http://sc.68design.net/</p> <p class="read-more">Continue reading <a class="heading" href="/web%E5%89%8D%E7%AB%AF/2011/05/25/e6-a8-a1-e6-9d-bf-e5-ba-93.html" data-flip="title">模板库</a></p> </article> <article id="post-web%E5%89%8D%E7%AB%AF/2011/05/25/%e5%9c%a8%e7%ba%bf%e9%a2%9c%e8%89%b2%e9%80%89%e6%8b%a9%e5%99%a8-web%e5%b7%a5%e5%85%b7" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web%E5%89%8D%E7%AB%AF/2011/05/25/e5-9c-a8-e7-ba-bf-e9-a2-9c-e8-89-b2-e9-80-89-e6-8b-a9-e5-99-a8-web-e5-b7-a5-e5-85-b7.html" data-flip="title"> 在线颜色选择器-web工具 </a> </h1> <p class="post-date heading"> <time datetime="2011-05-25T16:06:14+08:00">25 May 2011</time> in <span>Web前端</span> on <span>Web 工具</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>http://colorschemedesigner.com/ </p> <p>迷你取色器MiniGP，但是它的C值要反着来[ver=1.2],例如123456应该是563412</p> <p class="read-more">Continue reading <a class="heading" href="/web%E5%89%8D%E7%AB%AF/2011/05/25/e5-9c-a8-e7-ba-bf-e9-a2-9c-e8-89-b2-e9-80-89-e6-8b-a9-e5-99-a8-web-e5-b7-a5-e5-85-b7.html" data-flip="title">在线颜色选择器-web工具</a></p> </article> <article id="post-web/2011/05/25/sso-%e7%bb%bc%e8%bf%b0" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web/2011/05/25/sso-e7-bb-bc-e8-bf-b0.html" data-flip="title"> sso 综述 </a> </h1> <p class="post-date heading"> <time datetime="2011-05-25T16:03:43+08:00">25 May 2011</time> in <span>Web</span> on <span>Sso</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <h5>sso</h5> <p>理论文章 <a title="http://www.ibm.com/developerworks/cn/security/se-sso/index.html" href="http://www.ibm.com/developerworks/cn/security/se-sso/index.html">http://www.ibm.com/developerworks/cn/security/se-sso/index.html</a></p> <p>这里面谈的cas的较多，另外一方面还有openID可以了解一下。</p> <p>1. SSO 原理浅谈 </p> <p>这篇文章写的很好，特别要注意要保证&#160;&#160;&#160;&#160;&#160; 的安全。 <br /><a title="http://kazge.com/archives/491.html" href="http://kazge.com/archives/491.html">http://kazge.com/archives/491.html</a></p> <h4>3. CAS 以外的其他开源 SSO 方案</h4> <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 除了 CAS 之外，还有很多开源的 SSO 方案，采用何种方案跟用户的应用环境有比较大的关系。 SSO 的优劣一般要考虑易用性，安全性，性能，扩展性等因素。<br /> <h5>3.1 JOSSO</h5> <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 经常听到别人讨论 JOSSO ， JOSSO （ www.josso.org ）是我很早就用过的 SSO 开源项目，我后来抛弃了它，因为它存在比较多缺点，下面我们来看看： <p>1，&#160; 没有将后台认证与 SSO 分离，过分强调 JAAS ， Axis 等</p> <p>JOSSO 官方网站发布了 JOSSO 三个基准：</p> <p>Standard Based</p> <ul> <li>JOSSO security infrastructure is based on JAAS (Java Authentication and Authorization Service) </li> <li>JOSSO uses web services implementing Axis as the distributed infrastructure. </li> <li>JOSSO uses Struts and JSP standards </li> </ul> <p>这些标准可以看到 JOSSO 的适应性存在较大的限制，因为 SSO 其实并不关心认证细节，作为一个开源项目，不应该引用过多的技术，如 Axis ，因为这个世界还有很多人用 Xfire 。</p> <p>2，&#160; 没有描述 SSO 协议的 UseCase 图</p> <p>从 JOSSO 的网站，似乎都看不到一个 SSO 的 UseCase ，容易让那些关注安全性的大型项目负责人感到忧虑。</p> <p>3，&#160; 缺乏广泛的 SSO 客户端支持</p> <p>JOSSO 的支持的客户端比较少，这个跟他的 Memember Team 、 Contributor Team 有比较大的关系。</p> <p>4，&#160; 缺乏成功案例</p> <p>读者使用任何 SSO 开源方案之前，有必要先了解次方案的成功案例， CAS 全球有 50 多个大学在使用 ( 大学对 SSO 的要求往往更复杂 ) 成功案例，这方面， JOSSO 跟 CAS 存在很大的差距。</p> <p>5，&#160; 不支持跨域的落后设计</p> <p>当然， JOSSO 不支持跨域是因为它使用了共享 cookie ，下面的话截取于 JOSSO 的官方文档：</p> <p>JOSSO uses a session HTTP cookie to keep track of the SSO session identifier. This cookie lives as long as the browser window is open, being sent only in requests associated with the domain that generated it. This means that all JOSSO partner applications must be accessed using the same domain.</p> <p>这段话给我们一个提示，如果设计 SSO 的时候，使用了 cookie 来在 SSO Server 和 SSO Agent( 相当于 CAS 的 CAS Client) 之间共享用户信息，那么这个协议是无法突破跨域限制的。因为当多个 SSO Agent 如果不使用同一个域名，也就是 Microsoft.com 和 IBM.com 无法共享同一个 cookie ， JOSSO 采用了一种 DNS 技巧，即使用 Microsoft.sso.com 和 ibm.sso.com 来共享 cookie ，但这带来的问题同样很多，尤其是业务系统本身存在一些对域名限制的业务逻辑的时候，需要改动原来业务系统，这不是一件好受的事情。</p> <h5>3.2 CoSign</h5> <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; CoSign 原先是 Michigan 大学的一个 SSO 项目， CoSign 是一个很不错的设计，但是它跟 CAS 比较相似，都是基于 Kerberos 方式的协议，一个最大的不同是 CoSign 的 SSO Server 是基于 CGI(Java Fans 更多会选择 CAS) ，对 C/C++ 的群体应该是一个不错的选择。 CoSign 协议的 UseCase 跟 CAS 很相似， CoSign 的客户端虽然也支持 J2EE/Apache/MSAPI(IIS) ，但它的 Server 端使用 C 来编写，影响了在 Java 群体中的使用。 CoSign 是一个不错的选择，可能是因为本人比较喜欢 Kerberos Model 的原因吧。<br /> <h5>3.3 WebAuth</h5> <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; WebAuth 是一种早期的 SSO 方案，它的 WebServer 是用 perl 来编写的，客户端支持 Apache ， C++ ， Perl 等，当然， WebAuth 推出的时候， Java 并不是很流行，现在，要让 WebAuth 跟众多的 Java 产品结合不是一件容易的事情。 <br />WebAuth 的协议适用了 Share Secret ，即 SSO Server 和 SSO Client 之间存在一个对称密钥 (symmetric key ) 。 SSO Server 和 SSO Client 之间的信任关系通过这个 Key 来保障。 <br />&#160;&#160; 上图中展示了一个 WebAuth 的基本模式， Client 就是浏览器用户， Generic Web Service 是 SSO Client ， WebAuth Service 和 Auth Service 可以看作是 SSO Server 。 <br />当浏览器发起一个对 Web 应用的访问请求时，这个请求未授权，因此被重定向到 WebAuth Service 进行认证，认证的结果是获得一个经过 symmetric key 加密的 token ，而这个 Token 只有 Generic Web Service 能够解密，因此， Web 应用能够知道浏览器用户的身份。使用对称加密来共享用户身份信息存在一定的安全隐患，首先是 WebAuth Service 如何保护这些对称密钥 ( 保护密钥安全本身是一件很困难的事情 ) ，一旦这些对称密钥被泄漏了， Token 就可以被随意篡改。另外，由于 Token 本身是基于 Cookie 方式发送，因此，只要 Hacker 能够复制这个 Token ，他同样可以访问其他应用。 <br />如果不考虑安全性问题， WebAuth 的效率应该比其他 SSO 方案要高，因为它的协议没有 CAS/CoSign 那么复杂， WebAuth 中， SSO Server 不需要跟 SSO Client 通讯以确认用户的身份，用户的身份就放在 Token 中。<br /> <h4>4. SAML</h4> <p> SAML 是 OASIS 制定的一种安全性断言标记语言，它用于在复杂的环境下交换用户的身份识别信息。在 SAML 诞生之前，如果想在 Websphere 、 Weblogic 和 SunONE 等之间实现 SSO ，我们必须分别实现一个适配层，来达成一种相互理解的协议，在该协议上，产品能够共享各自的用户认证 / 授权信息。 SAML 诞生之后，我们免去了这种烦恼。可以预计，将来大部分产品都可以实现基于 SAML 的联邦服务。 <br />&#160;&#160;&#160;&#160;&#160;&#160; 事实伤， SAML 已经在很多商业 / 开源产品中得到实现，包括： <p>l&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; IBM Tivoli Access Manager</p> <p>l&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <a href="http://www.blogjava.net/security/archive/2006/10/02/www.bea.com">BEA</a> Weblogic</p> <p>l&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Oblix NetPoint</p> <p>l&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; SunONE Identity Server</p> <p>l&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Baltimore, SelectAccess</p> <p>l&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Entegrity Solutions AssureAccess</p> <p>l&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Internet2 OpenSAML</p> <p>l&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Yale CAS 3</p> <p>l&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Netegrity SiteMinder</p> <p>l&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Sigaba Secure Messaging Solutions</p> <p>l&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; RSA Security ClearTrust</p> <p>l&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; VeriSign Trust Integration Toolkit</p> <p>l&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Entrust GetAccess 7</p> <p>SAML 背后是强大的商业联盟和开源联盟，尽管 Microsoft 迟迟未能在 SAML 2.0 观点上达成一致，但它也正努力跟进SAML标准化过程，由此可见SAML协议已经是势在必行。</p> <h5>4.1 SAML 的基本概念</h5> <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 理解 SAML 的概念很重要，个人认为 SAML 协议的原理跟 CAS/Kerberos 很类似，理解上不存在困难，但 SAML 引入了一些新的概念名词，因此要先把握清楚这些概念。 <br />&#160;&#160;&#160;&#160;&#160;&#160; 断言，这个在 SAML 的 ”A” ，是整个 SAML 协议中出现的最多的字眼，我们可以将断言看作是一种判断，并且我们相信这种判断，因此，做出断言的一方必须被信赖。校验来自断言方的断言必须通过一些手段，比如数字签名，以确保断言的确实来自断言方。 <br />&#160;&#160;&#160;&#160;&#160;&#160; SAML 目标是让多个应用间实现联邦身份 (Identity Federation) ，提起联邦，大家可以想象一下欧盟，欧盟国家之间的公民都具有一个联邦身份，比如 Peter 是法国公民， John 是比利时公民，这两个公民的身份都能够互相被共享，恰好，张三是一个中国公民，但他能像 Peter 和 Jhhn 那样随意进入欧盟国家，显然不能，因为它不具有欧盟联邦身份。 <br />&#160;&#160;&#160;&#160;&#160;&#160; 理解了联邦的概念，我们就可以回到 SAML 上， SAML 解决了联邦环境中如何识别身份信息共享的标准化问题，比如，法国的 Peter 进入比利时，他如何证明自己的身份呢？ <br />&#160;&#160;&#160;&#160;&#160;&#160; SAML 就是为了解决这个问题。 <br />在联邦环境中，通常有下面的 3 种实体： <p>l&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Subject ( 主题 ) ： Subject 是 SAML 实体中的第一个重要的概念， Subject 包括了 User 、 Entity 、 Workstation 等能够象征一个参与信息交换的实体。</p> <p>l&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Relying Party ( 信任方 ) ： SAML 中的 Service Provider 角色，也就是提供服务的一方。</p> <p>l&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Asserting Party ( 断言方 ) ： SAML 中的 Identity Provider 角色，用于提供对主题的身份信息的正确的断言，类似一个公证机构。</p> <p>我们看看联邦环境的一个场景： <br />假设有一个 Peter(Subject) 的法国公民，他需要访问比利时 (Service Provider) ，他在比利时机场被要求提供身份信息， Peter 提供了欧盟 (Federation) 的通行证件，随即，这个通行证件在比利时机场被审核，或通过计算机送到欧盟身份认证中心 (Identity Provider) ，该中心有一个由所有欧盟国家共同建立的公民数据库，中心审核了 Peter 的身份信息，并断言“ Yes ， He is Peter From France ”，于是， Peter 得到礼貌的回应“欢迎光临比利时”。 <br />&#160;&#160;&#160;&#160;&#160;&#160; 如果你将欧盟看作是一个联邦环境，你会发现上面的场景跟在联邦环境应用 SAML 很相似。 <br />在联邦环境下，任何需要授权访问的服务都需要知道服务请求方的身份主题信息 (Who are you) ，服务提供方 (Service Provider) 不负责审核用户的身份信息，但它依赖于 1 个甚至多个 Identity Provider 来完成此任务，见下图。 <br />1 个 Idnetity Provider 可以被多个 Service Provider 共享，当然，共享的前提是建立信任关系 ( 即 Service Provider 要信任 Idnetity Provider) ，就好比如，如果比利时 (Service Provider) 需要开放对欧盟国家成员访问，它信任欧盟的 Idnetity Provider ，它信任欧盟的 Idnetity Provider 的任何判断，包括 ”He is Peter From France” 。至于是否让 Peter 入境，那是受权限策略的控制 ( 注意 SAML 同样对 Authorization 断言做了标准化，此处，我们仅仅关注 Authentication) 。</p> <h5></h5> <h5>4.2 SAML 的 2 种典型模式</h5> <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 在协议的角度， SAML 原理非常类似 CAS 和 Kerberos ， CAS 协议依赖于 CAS Server ， Kerberos 依赖于 KDC ，而 SAML 则依赖于 Identity Provider 。 <br />&#160;&#160;&#160;&#160;&#160;&#160; 根据 Service Provider( 以下简称 SP) 和 Identity Provider( 以下简称 IDP) 的交互方式， SAML 可以分为以下几种模式：一种是 SP 拉方式，一种是 IDP 推方式。 <br />&#160;&#160;&#160;&#160;&#160;&#160; 在 SAML 中，最重要的环节是 SP 如何获取对 Subject 的断言， SP 拉方式是 SP 主动到 IDP 去了解 Subject 的身份断言，而 IDP 推方式则是 IDP 主动把 Subject 的身份断言通过某种途径告诉 SP 。 <br />2.2.1 SAML 的 POST/Artifact Bindings 方式（即 SP 拉方式） <br />&#160;&#160;&#160;&#160;&#160;&#160; 该方式的主要特点是， SP 获得客户端的凭证 ( 是 IDP 对 Subject 的一种身份认可 ) 之后，主动请求 IDP 对 Subject 的凭证的断言。如下图所示： Subject 是根据凭证去访问 SP 的。凭证代表了 Subject 的身份，它类似于“来自 IDP 证明：我就是 Peter ，法国公民”。 <br />现在，让我们看看 SP 拉方式是如何进行的：&#160;&#160; <br />Subject 访问 SP 的受保护资源， SP 发现 Subject 的请求中没有包含任何的授权信息，于是它重定向用户访问 IDP. <br />&#160;&#160;&#160;&#160;&#160;&#160; 协议执行： <p>1，&#160; Subject 向 IDP 请求凭证 ( 方式是提交用户名 / 密码 )</p> <p>2，&#160; IDP 通过验证 Subject 提供的信息，来确定是否提供凭证给 Subject</p> <p>3，&#160; 假如 Subject 的验证信息正确，他将获取 IDP 的凭证以及将服务请求同时提交给 SP 。</p> <p>4，&#160; SP 接受到 Subject 的凭证，它是提供服务之前必须验证次凭证，于是，它产生了一个 SAML 请求，要求 IDP 对凭证断言</p> <p>5，&#160; 凭证是 IDP 产生的，它当然知道凭证的内容，于是它回应一个 SAML 断言给 SP</p> <p>6，&#160; SP 信任 IDP 的 SAML 断言，它会根据断言结果确定是否为 Subject 提供服务。</p> <p>4.2.1 SAML 的 Redirect/POST Bindings 方式 ( 即 IDP 推方式 ) <br />&#160;&#160;&#160;&#160;&#160;&#160; 该方式的主要特点是， IDP 交给 Subject 的不是凭证，而是断言。 <br />&#160;&#160;&#160;&#160;&#160;&#160; 过程如下图所示： <br />&#160;&#160;&#160;&#160;&#160;&#160; 1 ， Subject 访问 SP 的授权服务， SP 重定向 Subject 到 IDP 获取断言。 <br />&#160;&#160;&#160;&#160;&#160;&#160; 2 ， IDP 会要求 Subject 提供能够证明它自己身份的手段 (Password ， X.509 证书等 ) <br />&#160;&#160;&#160;&#160;&#160;&#160; 3 ， Subject 向 IDP 提供了自己的帐号密码。 <br />&#160;&#160;&#160;&#160;&#160;&#160; 4 ， IDP 验证密码之后，会重订向 Subject 到原来的 SP 。 <br />&#160;&#160;&#160;&#160;&#160;&#160; 5 ， SP 校验 IDP 的断言 ( 注意， IDP 会对自己的断言签名， SP 信任 IDP 的证书，因此，通过校验签名，能够确信从 Subject 过来的断言确实来自 IDP 的断言 ) 。 <br />&#160;&#160;&#160;&#160;&#160;&#160; 6 ，如果签名正确， SP 将向 Subject 提供该服务。</p> <h5>4.3 SAML 的优势所在</h5> <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; SAML 协议仍在不断的发展， SAML1.0, SAML1.1 到现在的 SAML2.0 ，都是 IT 商业巨头协商后，由 OASIS 发布的产物，另外， OASIS SAML 实验室得到拥有美国政府 GSA 的大力资助。 <br />SAML 在 SOA 中扮演了一个关键角色，由于用户要求将企业资源从原有的面向数据 / 接口转变为面向服务，而建立在众多 Vendor 产品下的服务存在这种种鸿沟，最大的鸿沟是如何识别身份，如何能够让网易 163 邮件的 VIP 用户享受免费参加 Dev2dev 广州 UserGroup 的活动？ <br />读者可能已经听闻很多身份管理软件， IBM Tivoli ， SiteMinder ， RSA SecureID 等，虽然身份管理软件都非常强，但成本同时也很高。身份管理并不适合于那种构建是 B2B 之上的商业环境（联邦环境）。 <br />但对用户来说，根本问题是，网易和 Dev2dev 是两个不同的公司 / 组织，它们都严格保护自己的用户身份信息，一般极少可能会共享身份数据，因此，做法是双方都提供一个服务入口，对身份信息做断言，例如只告诉 Dev2dev 该用户确实是网易的 VIP 用户。 <br />SAML 提供了一个安全标记规范，并且给出了一些的 UseCase ，这些 usecase 足以满足我们绝大部分的 SSO 需求。 <br />我喜欢这种规范，很大原因是因为以前用 SSO 实在很累，配置要花去大半天时间， SAML 让这一切变得非常灵活简单，因为厂商一旦在其产品中提供 SAML 支持，我们就可以将其产品作为联邦服务纳入 SSO 环境。 <br />我喜欢 SAML 的另一个原因是因为，它跟 SOAP 一样，不考虑传输协议，事实上， SAML 可以跟 HTTP/SSL/JMS 等任何传输协议捆绑。在 SOA 环境中，这个特性非常重要，因为我们已有的许多服务（来自各个不同 IT Vendors ）都可能有各自的传输协议，即如果在这种复杂的环境下实现 SSO ，传统 Yale CAS 已经无能为力，因为 CAS SSO 实现在 HTTP/SSL 之上，只有 SAML 能够完成这项任务，因为它与传输协议无关。 <br />最后，应该提一下， SAML 是一种 SSO 标准而 CAS 是一种 SSO 的实现，从 CAS 的 Roadmap 可以看出， CAS 很快会提供对其他 SAML 的支持。 <br />=============================================================================================================================================================================== <br />Portal的功能可以分为三个主要方面： <br />1.&#160;&#160;&#160;&#160;&#160;&#160;&#160; Portlet容器：Portlet容器与servlet容器非常类似，所有的 portlet都部署在portlet容器里，portlet容器控制portlet的生命周期并为其提供必要的资源和环境信息。Portlet容器负责初始化和销毁portlets，向portlets传送用户请求并合成响应。 <br />2.&#160;&#160;&#160;&#160;&#160;&#160;&#160; 内容聚集：Portlet规范中规定portal的主要工作之一是聚集由各种portlet应用生成的内容，我们将在“如何创建Portal页面”部分对此做进一步讨论。 <br />3.&#160;&#160;&#160;&#160;&#160;&#160;&#160; 公共服务：portlet服务器的一个强项是它所提供的一套公共服务。这些服务并不是portlet规范所要求的，但portal的商业实现版本提供了丰富的公共服务以有别于它们的竞争者。在大部分实现中都有望找到的几个公共服务有： <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; o 单次登录：只需登录portal服务器一次就可以访问所有其它的应用，这意味着你无需再分别登录每一个应用。例如一旦我登录了我的intranet网站，我就能访问mail应用、IM消息应用和其它的intranet应用，不必再分别登录这些应用。 <br />Portal 服务器会为你分配一个通行证库。你只需要在mail应用里设定一次用户名和密码，这些信息将以加密的方式存储在通行证库中。在你已登录到 intranet网站并要访问mail应用的时候，portal服务器会从通行证库中读取你的通行证替你登录到mail服务器上。你对其它应用的访问也将照此处理。 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; o 个性化：个性化服务的基本实现使用户能从两方面个性化她的页面：第一，用户可以根据她的自身喜好决定标题条的颜色和控制图标。第二，用户可以决定在她的页面上有哪些portlets。例如，如果我是个体育迷，我可能会用一个能提供我钟爱球队最新信息的 portlet来取代股票和新闻portlets。 <br />&#160;&#160;&#160;&#160;&#160;&#160; 一些在个性化服务方面领先的商业实现版本允许你建立为用户显示什么样的应用所依据的标准（如收入和兴趣）。在这种情况下，可以设定一些像“对任何收入为X的用户显示馈赠商品的portlet”和“对任何收入为X的用户显示打折商品的portlet”这样的商业规则。</p> <p>&#160;</p> <p>&#160;</p> <p>============================</p> <p><a href="http://kazge.com/archives/490.html" target="_blank">jasig实战</a></p> <p><a title="http://denger.iteye.com/blog/973068" href="http://denger.iteye.com/blog/973068">&#160;</a></p> <p class="read-more">Continue reading <a class="heading" href="/web/2011/05/25/sso-e7-bb-bc-e8-bf-b0.html" data-flip="title">sso 综述</a></p> </article> <article id="post-python/2011/05/25/%e4%b8%80%e4%b8%aa%e5%b0%86%e7%9b%ae%e5%bd%95%e6%88%96%e6%8c%87%e5%ae%9a%e6%96%87%e4%bb%b6%e4%bd%bf%e7%94%a8img2py%e8%bf%9b%e8%a1%8c%e5%a4%84%e7%90%86%e7%9a%84%e5%b0%8f%e7%a8%8b%e5%ba%8f" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/python/2011/05/25/e4-b8-80-e4-b8-aa-e5-b0-86-e7-9b-ae-e5-bd-95-e6-88-96-e6-8c-87-e5-ae-9a-e6-96-87-e4-bb-b6-e4-bd-bf-e7-94-a8img2py-e8-bf-9b-e8-a1-8c-e5-a4-84-e7-90-86-e7-9a-84-e5-b0-8f-e7-a8-8b-e5-ba-8f.html" data-flip="title"> 一个将目录或指定文件使用img2py进行处理的小程序 </a> </h1> <p class="post-date heading"> <time datetime="2011-05-25T16:00:52+08:00">25 May 2011</time> in <span>Python</span> on <span>Python</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p><a href="http://blog.donews.com/limodou/archive/2005/08/10/503300.aspx">[Python学习]一个将目录或指定文件使用img2py进行处理的小程序</a></p> <p>img2py 可以将图片文件存成文本文件，但它不支持多个文件处理，这特别在我的目录下有许多的文件，如果一个个处理的话，会非常麻烦。于是为了解决目录及支持多个文件的问题，我编写了下面的小程序，希望对你有用。</p> <blockquote><p>import wx.tools.img2py as img2py <br />import getopt <br />import sys <br />import os <br />import os.path</p> <p>def usage(): <br />&#160;&#160;&#160; print &quot;&quot;&quot; <br />%s [-d directory][-h] -o outputfile files <br />&quot;&quot;&quot; % sys.argv[0] <br />def main(): <br />&#160;&#160;&#160; if len(sys.argv) == 1: <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; usage() <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; sys.exit(1) <br />&#160;&#160;&#160; try: <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; opts, fileArgs = getopt.getopt(sys.argv[1:], &quot;d:o:h&quot;) <br />&#160;&#160;&#160; except getopt.GetoptError: <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; usage() <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; sys.exit(1)</p> <p>&#160;&#160;&#160; imagedir = '' <br />&#160;&#160;&#160; outputfile = '' <br />&#160;&#160;&#160; for opt, val in opts: <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; if opt == &quot;-h&quot;: <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; usage() <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sys.exit(1) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; elif opt == &quot;-d&quot;: <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; imagedir = val <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; elif opt == &quot;-o&quot;: <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; outputfile = val</p> <p>&#160;&#160;&#160; convert(outputfile, imagedir, fileArgs)</p> <p>def isImageFile(filename): <br />&#160;&#160;&#160; f, ext = os.path.splitext(filename) <br />&#160;&#160;&#160; if os.path.isfile(filename) and ext.lower() in ('.gif', '.png', '.bmp', '.jpg', '.ico'): <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; return True <br />&#160;&#160;&#160; else: <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; return False <br />def convert(outputfile, dir='', imagefiles=[]): <br />&#160;&#160;&#160; files = [] <br />&#160;&#160;&#160; files.extend(imagefiles) <br />&#160;&#160;&#160; if dir: <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; f = [os.path.join(dir, x) for x in os.listdir(dir) if os.path.isfile(os.path.join(dir, x))] <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; files.extend(f) <br />&#160;&#160;&#160; files = list(set([x for x in files if isImageFile(x)])) <br />&#160;&#160;&#160; for i, x in enumerate(files): <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; name = os.path.splitext(os.path.basename(x))[0].lower() <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; cmd =[] <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; if i != 0: <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cmd.append('-a') <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; cmd.append('-n') <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; cmd.append(name.capitalize()) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; cmd.append(x) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; cmd.append(outputfile) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; os.system(&quot;img2py %s&quot; % &quot; &quot;.join(cmd)) <br />if __name__ == '__main__': <br />&#160;&#160;&#160; main()</p> </blockquote> <p>我们在写gui程序的时候，经常会用到一些图标图片资 源，对此有几种解决办法，有人喜欢用zip模块将其打包，用的时候取出来，因为python读取zip文件也是很方便的，有人则干脆不打包，直接放在一个 子目录中，用的时候直接读取。而我则喜欢将其转换为.py文件，作为模块调用。</p> <p>我在看wxPython程序的例程的时候，[<b>encode_bitmaps.py</b>]发现它的图片是从一个模块(.py文件)中调入的，于是很好奇，顺藤摸瓜，于是发现：</p> <p>wxPython安装好之后，会在 wx\tools 目录下安装一些工具，其中名为img2py.py的工具。 <br />这个工具可以很方便的将我们程序中所用到的图片或者图标资源转换成py文件，这样我们在需要使用这些图片资源的时候，只需要 <br />import 这些扩展名为.py的模块文件即可</p> <p>在命令行下输入img2py.py并回车，可以查看详细的帮助信息。而一般情况下，我们所要做的，只是将图片转换为.py文件</p> <p>例如，我有一个ico文件，想用其作为我程序的托盘图标</p> <p>那么我可以这样做</p> <p>首先，将其转换为 .py 文件</p> <p>img2py.py myicon.ico myicon.py</p> <p>然后，在程序中导入这个模块</p> <p>import myicon</p> <p>最后，当我需要用它的时候，只需要：</p> <p>icon = myicon.geticonIcon()</p> <p>注意，如果你的myicon.py中没有geticonIcon()方法，只需要加入如下一行语句即可：</p> <p>geticonIcon = icon.GetIcon</p> <p>怎么样，是不是很方便？</p> <p>在 wx\tools 目录下还有一些其他的工具，具体用法还有待大家发掘</p> <p>--------------------------------------------------</p> <p>目的： <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; 即为img2py的用处，img2py是将图像转为以py文件存储的程序，简化了程序过程中读文件的处理。 <br />开发环境：eclipse+pydev插件 <br />步骤： <br />1，在 eclipse工程中增加个含有main函数的模块，用来处理图片到py,代码如下： <br />''' <br />Created on 2009-6-16 <br />@author: fengxuanshuo</p> <p>This is a way to save the startup time when running img2py on lots of <br />files...</p> <p>''' <br />import sys <br />from wx.tools import img2py</p> <p>command_lines = [ <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &quot;-a -F -n book&#160;&#160; pictures/right_menu/222.png&#160;&#160; ../main/images.py&quot;, <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &quot;-a -F -n boo&#160;&#160; pictures/right_menu/111.png&#160;&#160; ../main/images.py&quot;, <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &quot;-a -F -n ook_red&#160;&#160; pictures/right_menu/000.png&#160;&#160; ../main/images.py&quot;, <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ]</p> <p>if __name__ == '__main__': <br />&#160;&#160;&#160; for line in command_lines: <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; args = line.split() <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; img2py.main(args) <br />其中command_lines为命令行执行内容，程序需要的图片都可以处理，而且目标文件可以有多个，名字自己取。 <br />2，执行新增加的模块，就会发现 main目录多了个images.py文件。 <br />3，更新eclipse pydev工程：pydev插件并没有常用的那个add file to project选项，不过有pydev-&gt;source format python files. <br />4，然后再原工程里面就可以用图片py文件了（可能有些版本，在生成py文件的时候不会加import相关库的语句，需要手动添加） <br />5，images.py 在wxpython demo 中的用法 <br />定义全局变量 images: images =None <br />在app里面声明全局的images : globel images <br />import imgaes as i <br />images = i <br />其他py文件类似，这么做的好处在demo的注释里面说了，不罗嗦了，over</p> <p class="read-more">Continue reading <a class="heading" href="/python/2011/05/25/e4-b8-80-e4-b8-aa-e5-b0-86-e7-9b-ae-e5-bd-95-e6-88-96-e6-8c-87-e5-ae-9a-e6-96-87-e4-bb-b6-e4-bd-bf-e7-94-a8img2py-e8-bf-9b-e8-a1-8c-e5-a4-84-e7-90-86-e7-9a-84-e5-b0-8f-e7-a8-8b-e5-ba-8f.html" data-flip="title">一个将目录或指定文件使用img2py进行处理的小程序</a></p> </article> <h2 class="sr-only">Pagination</h2> <nav class="pagination heading" role="navigation"> <ul> <li class="pagination-item older" > <a rel="next" href="/page-68/">Older</a> </li> <li class="pagination-item newer" > <a rel="prev" href="/page-66/">Newer</a> </li> </ul> </nav> <footer> <hr/> <p>© 2011 - 2017. All rights reserved.</p> <p> <code>Powered by <a href="https://qwtel.com/hydejack/">Hydejack</a> v<span id="_version">6.6.1</span></code> </p> </footer> </main> </div> <div id="_yDrawer"> <div id="_sidebar" class="sidebar"> <div class="sidebar-bg" style="background-color:#4f86aa;background-image:url()"></div> <header class="sidebar-sticky" role="banner"> <div class="sidebar-about"> <img src="https://avatars0.githubusercontent.com/u/4122902?v=4&s=460" class="me" /> </div> <div class="sidebar-about"> <h1><a id="_title" href="/">Ka's Blog</a></h1> <p>Ka’s blog description…</p> </div> <nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span> <ul> <li> <a class="sidebar-nav-item" href="/categories.html">Categories</a> </li> <li> <a class="sidebar-nav-item" href="/archive.html">Archive</a> </li> <li> <a class="sidebar-nav-item" href="/tags.html">Tags</a> </li> <li> <a class="sidebar-nav-item" href="/about.html">About</a> </li> </ul> </nav> <div class="sidebar-social"> <span class="sr-only">Social:</span> <ul> <li> <a href="https://twitter.com/imhazige" title="Twitter"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a> </li> <li> <a href="https://github.com/imhazige" title="GitHub"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a> </li> <li> <a href="mailto:imhazige@gmail.com" title="Email"> <span class="icon-mail"></span> <span class="sr-only">Email</span> </a> </li> <li> <a href="https://imhazige.github.io/myblog/feed.xml" title="RSS"> <span class="icon-rss2"></span> <span class="sr-only">RSS</span> </a> </li> </ul> </div> </header> </div> </div> </div> <!--[if gt IE 9]><!----> <script>loadJSDeferred('/assets/js/hydejack.js?v=6.6.1');</script> <!--<![endif]--> </body>
</html>
