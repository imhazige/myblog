<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v6.6.1 <https://qwtel.com/hydejack/>
--><head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="format-detection" content="telephone=no"> <meta http-equiv="x-ua-compatible" content="ie=edge"> <title>Ka's Blog &middot; Ka's Blog</title> <meta name="description" content="Ka’s blog description… "> <link rel="canonical" href="http://localhost:4000/page-22/"> <link rel="alternate" type="application/atom+xml" title="Ka's Blog Feed" href="http://localhost:4000/feed.xml"> <link rel="apple-touch-icon" href="/apple-touch-icon.png"> <!-- Place favicon.ico in the root directory --> <link rel="stylesheet" href="/assets/style.css"> <link id="_katexJS" rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.js"> <link id="_katexCSS" rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css"> <!--[if gt IE 8]><!----> <script> WebFontConfig = { google: { families: 'Roboto+Slab:700|Noto+Sans:400,400i,700,700i'.split('|') }, custom: { families: ['icomoon'], urls: ['/assets/icomoon/style.css'] } }; </script> <!--<![endif]--> <script> !function(n,e){function t(n,e){n.onload=function(){this.onerror=this.onload=null,e(null,n)},n.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),n)}}function o(n,e){n.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,e(null,n))}}n._loaded=!1,n.loadJSDeferred=function(a,d){function r(){n._loaded=!0;var r=e.createElement("script");r.src=a,d&&(("onload"in r?t:o)(r,d),r.onload||t(r,d));var l=e.getElementsByTagName("script")[0];l.parentNode.insertBefore(r,l)}n._loaded?r():n.addEventListener?n.addEventListener("load",r,!1):n.attachEvent?n.attachEvent("onload",r):n.onload=r}}(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); window.disablePushState = false; window.disableDrawer = false; </script> <!--[if lt IE 9]> <script src="/assets/bower_components/html5shiv/dist/html5shiv.min.js"></script> <![endif]--> <!--[if gt IE 8]><!----> <style> article, aside, dialog, figcaption, figure, footer, header, hgroup, main, nav, section { display: block; } mark { background: #FF0; color: #000; } * { box-sizing: border-box; } html, body { margin: 0; padding: 0; } html { font-size: 16px; line-height: 1.75; } body { color: #333; background-color: #fff; overflow-y: scroll; } a { text-decoration: none; } .lead { margin-left: -1rem; margin-right: -1rem; } img, .img { display: block; max-width: 100%; margin-bottom: 1rem; border: none; } img.lead, .img.lead { max-width: calc(100% + 2rem); width: calc(100% + 2rem); } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-weight: bold; text-rendering: optimizeLegibility; } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 { margin: 3rem 0 1rem; line-height: 1.6; } h1, .h1 { font-size: 2rem; line-height: 1.25; } h2, .h2 { font-size: 1.5rem; } h3, .h3 { font-size: 1.17em; } p { margin-top: 0; margin-bottom: 1rem; } p.lead { font-size: 1.25rem; font-weight: 300; padding: 0 1rem; } ul, ol, dl { margin-top: 0; margin-bottom: 1rem; } ul, ol { padding-left: 1.25rem; } hr { position: relative; margin: 1.5rem 0; border: 0; border-top: 1px solid #eee; } .hr { padding-bottom: .5rem; border-bottom: 1px solid #eee; margin-bottom: 1.5rem; } h4, h5, h6, .h4, .h5, .h6 { margin-bottom: 0.5rem; font-size: 1rem; } table { margin-bottom: 1rem; width: 100%; width: calc(100% + 2rem); margin-left: -1rem; border: 1px solid #e5e5e5; border-collapse: collapse; border-spacing: 0; } td, th { padding: .25rem .5rem; border: 1px solid #e5e5e5; } td:first-child, th:first-child { padding-left: 1rem; } td:last-child, th:last-child { padding-right: 1rem; } thead + tbody, tbody + tbody, tfoot { border-top: 3px double #e5e5e5; } tbody tr:nth-child(odd) td, tbody tr:nth-child(odd) th { background-color: #f9f9f9; } footer { margin-bottom: 2rem; } .page, .post { margin-bottom: 3em; } .page li + li, .post li + li { margin-top: .25rem; } .page > header, .post > header { margin-bottom: 2rem; } .page-title, .post-title { margin-top: 0; } .post-date { display: block; margin-top: -0.5rem; margin-bottom: 1rem; color: #9a9a9a; } .related-posts { padding-left: 0; list-style: none; } .related-posts > li, .related-posts > li + li { margin-top: 1rem; } .related-posts > li > small, .related-posts > li + li > small { font-size: 75%; color: #9a9a9a; } .message { margin-bottom: 1rem; padding: 1rem; color: #787878; background-color: #f9f9f9; margin-left: -1rem; margin-right: -1rem; } /* * Global resets * * Update the foundational and global aspects of the page. */ body, main { /* Prevent side-scrolling on mobile */ position: relative; overflow-x: hidden; } @media screen { body::before { content: ''; width: .5rem; background: #e5e5e5; position: absolute; left: 0; top: 0; bottom: 0; } } @media screen and (min-width: 40em) { html { font-size: 17px; } } @media screen and (min-width: 54em) { html { font-size: 16px; } } @media screen and (min-width: 72em) { html { font-size: 17px; } } @media screen and (min-width: 125em) { html { font-size: 18px; } } .sr-only { display: none; } .clearfix, .sidebar-social::after, .clearafter::after { content: ""; display: table; clear: both; } a, .a { position: relative; padding-bottom: .15rem; border-bottom: 1px solid; } .img { overflow: hidden; background-color: #f9f9f9; } .img > img { margin: 0; width: 100%; height: 100%; } .sixteen-nine { position: relative; } .sixteen-nine::before { display: block; content: ""; width: 100%; padding-top: 56.25%; } .sixteen-nine > * { position: absolute; top: 0; left: 0; right: 0; bottom: 0; } h1 + hr, h2 + hr, h3 + hr, h4 + hr, h5 + hr, h6 + hr { margin-top: 0; } .fade-in { animation-duration: 500ms; animation-name: fade-in; animation-fill-mode: forwards; } @keyframes fade-in { from { transform: translateY(-2rem); opacity: 0; } 50% { transform: translateY(-2rem); opacity: 0; } to { transform: translateY(0); opacity: 1; } } .mb6 { margin-bottom: 6rem; } .sidebar { color: rgba(255, 255, 255, 0.75); text-align: left; /* Sidebar links */ } .sidebar::before { /* make sidebar slightly darker to increase text readability (when using a background image) */ content: ""; position: absolute; z-index: 2; top: 0; left: 0; bottom: 0; right: 0; background: linear-gradient(to bottom, rgba(32, 32, 32, 0) 0%, rgba(32, 32, 32, 0.5) 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */ } .sidebar a { color: #fff; border-bottom-color: rgba(255, 255, 255, 0.2); } #_yDrawer { position: relative; padding: 1rem 0; } @media screen { #_yDrawer { padding: 2rem 1rem; min-height: 640px; min-height: 100vh; } } @media screen and (min-width: 54em) { #_yDrawer { position: fixed; top: 0; left: 0; bottom: 0; width: 18rem; margin-left: 0; } } @media screen and (min-width: 97.5em) { #_yDrawer { width: calc(50% - 28rem); } } @media screen { #_yDrawer.loaded { min-height: 0; padding: 0; } } .sidebar-bg { position: absolute; top: 0; right: 0; bottom: 0; left: 0; background: #202020 center / cover; } .sidebar-sticky { position: relative; z-index: 3; } @media screen { .sidebar-sticky { position: absolute; right: 2rem; bottom: 1rem; left: auto; max-width: 14rem; } } @media print { .sidebar-sticky { padding: 0 2rem; } } /* About section */ .sidebar-about > h1 { color: #fff; font-size: 2rem; } .sidebar-nav > ul { list-style: none; padding-left: 0; margin-bottom: .5rem; } a.sidebar-nav-item { font-weight: bold; display: block; line-height: 1.75; padding: .25rem 0; border-bottom: 1px solid rgba(255, 255, 255, 0.2); } @media screen { .y-drawer-scrim { z-index: 2; } .y-drawer-content { width: 18rem; left: -17.5rem; z-index: 3; } } @media screen and (min-width: 97.5em) { .y-drawer-content { width: calc(50% - 28rem); } } .sidebar-social { margin-bottom: .5rem; } .sidebar-social > ul { list-style: none; padding-left: 0; margin: 0 -.25rem; } .sidebar-social > ul > li { float: left; margin: 0 .25rem; } .sidebar-social > ul > li > a { display: inline-block; text-align: center; font-size: 1.6rem; line-height: 3rem; width: 3.1249rem; height: 4rem; padding: .5rem 0; } .sidebar-social > ul li + li { margin-top: 0; } .fixed-top { position: fixed; top: 0; left: 0; width: 100%; z-index: 1; } .navbar > .content { padding-top: 0; padding-bottom: 0; min-height: 0; height: 0; } .menu { display: inline-block; padding: 1.75rem 1.5rem; border-bottom: none; margin-left: -1.5rem; color: #9a9a9a !important; } .menu::after { content: "\2630"; } @media screen and (min-width: 54em) { .menu { padding: 1.25rem 1.5rem; position: absolute; left: -9999px; } .menu:focus { position: static; } } .animation-main { pointer-events: none; } .loading { display: none; } @media print { .menu { display: none; } } .animation-main { opacity: 0; will-change: opacity; } .loading { position: absolute; top: 0; right: 0; padding: 5.25rem 4.5rem; transform-origin: top right; transform: scale(0.33); } .content { position: relative; margin-left: auto; margin-right: auto; padding: 5rem 1rem 12rem; } @media screen { .content { max-width: 38rem; padding-left: 1.5rem; min-height: 100vh; } } @media screen and (min-width: 54em) { .content { max-width: 42rem; padding: 4rem 1rem 12rem; margin-left: 22rem; margin-right: 4rem; } } @media screen and (min-width: 72em) { .content { margin-left: 22rem; margin-right: 4rem; } } @media screen and (min-width: 92em) { .content { max-width: 48rem; } } @media screen and (min-width: 97.5em) { .content { margin: auto; } } .me { float: right; width: 6.5rem; height: 6.5rem; margin-left: 1rem; margin-bottom: .5rem; border-radius: 100%; position: relative; } @media screen and (min-width: 40em) { .me { width: 7rem; height: 7rem; } } @media screen and (min-width: 54em) { .me { width: 6.5rem; height: 6.5rem; } } @media screen and (min-width: 60em) { .me { width: 7rem; height: 7rem; } } main > footer { position: absolute; bottom: 0; left: 0; right: 0; padding: 0 1rem; color: #9a9a9a; font-size: smaller; text-align: center; } main > footer > p { margin-bottom: 0; } /* .card, .pagination-item { border-radius: 0!important; } */ /* @media screen { .sidebar-sticky { left: 2rem; max-width: none; } } */ html { font-family: Helvetica, Arial, sans-serif; } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: Helvetica, Arial, sans-serif; } </style> <link id="_stylePreload" rel="preload" as="style" href="/assets/css/hydejack.css?v=6.6.1"> <script>document.getElementById('_stylePreload').onload=function(){this.rel='stylesheet'}</script> <!-- NOTE: These styles interact with JavsScript, so they MUST NOT be changed --> <style id="_pageStyle"> .content a { color: #4f86aa; border-color: rgba(79, 134, 170, 0.2); } .content a:hover { border-color: #4f86aa; } :focus { outline-color: #4f86aa; } ::selection { color: #fff; background: #4f86aa; } ::-moz-selection { color: #fff; background: #4f86aa; } </style> <noscript> <link rel="stylesheet" href="/assets/css/hydejack.css?v=6.6.1"> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700|Noto+Sans:400,400i,700,700i"> <style> html { font-family: 'Noto Sans', Helvetica, Arial, sans-serif } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: 'Roboto Slab', Helvetica, Arial, sans-serif } </style> <link rel="stylesheet" href="/assets/icomoon/style.css"> </noscript> <!--<![endif]--> <!--[if gt IE 8]><!----> <script async src="/assets/bower_components/webfontloader/webfontloader.js"></script> <!--<![endif]--> </head> <body> <div class="navbar fixed-top"> <div class="content"> <span class="sr-only">Jump to:</span> <a id="_menu" class="menu no-hover" href="#_title"> <span class="sr-only">Menu</span> </a> </div> </div> <div id="_yPushState"> <div class="fade-in"> <main id="_main" class="content" role="main" data-color="#4f86aa" data-image=""> <article id="post-java/web/%E5%88%86%E5%B8%83%E5%BC%8F/2012/03/08/memcache-%e8%b0%83%e7%a0%94" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/java/web/%E5%88%86%E5%B8%83%E5%BC%8F/2012/03/08/memcache-e8-b0-83-e7-a0-94.html" data-flip="title"> Memcache 调研 </a> </h1> <p class="post-date heading"> <time datetime="2012-03-08T18:59:44+08:00">08 Mar 2012</time> in <span>Java</span> / <span>Web</span> / <span>分布式</span> on <span>Memcache</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>官网:<a href="http://memcached.org/">http://memcached.org/</a></p> <p>文档:<a href="http://code.google.com/p/memcached/wiki/NewStart?tm=6">http://code.google.com/p/memcached/wiki/NewStart?tm=6</a></p> <p>这位<a href="http://www.cnblogs.com/Jwin/archive/2008/10/05/1304261.html" target="_blank">仁兄</a>收集了些文章:</p> <p><a href="http://kb.cnblogs.com/page/42775/">分布式缓存系统Memcached简介与实践</a></p> <p><a href="http://kazge.com/archives/750.html">Memcached深度分析</a>&#160;<font color="#0000ff">[好文，必读]</font></p> <p><a href="http://kb.cnblogs.com/page/42777/">自己实现memcached客户端库</a></p> <p><a href="http://www.javaeye.com/topic/225692">memcached server LRU 深入分析</a><font color="#0000ff">[这个针对实际问题阐述memcached内存存储的调整，回头再看</font><a href="http://kazge.com/archives/750.html"><font color="#0000ff">Memcached深度分析</font></a><font color="#0000ff"> ]</font></p> <p><a href="http://blog.csdn.net/heiyeshuwu/article/details/3950532"><font color="#0000ff">Memcached 原理和使用详解(PPT/PDF)</font></a>&#160;<font color="#0000ff">[这个写的很好,必读]</font></p> <p><a href="http://kb.cnblogs.com/page/42790/">Memcached使用点滴</a>&#160;<font color="#0000ff">[这个需要对memcache有一定了解之后，打算自己实现client可做借鉴]</font></p> <p><a href="http://tech.idv2.com/2008/08/17/memcached-pdf/">memcached全面剖析–PDF总结篇</a>&#160;<font color="#0000ff">[very good,日本mixi网站工程师写的，国人翻译的]</font></p> <p>&#160;</p> <p>api client 列表 <a href="http://code.google.com/p/memcached/wiki/Clients">http://code.google.com/p/memcached/wiki/Clients</a></p> <p>参见<a title="http://kazge.com/archives/753.html" href="http://kazge.com/archives/753.html">http://kazge.com/archives/753.html</a>&#160;</p> <p>memcached 安装见<a href="http://www.ccvita.com/257.html">http://www.ccvita.com/257.html</a></p> <p>以下是我的安装命令[需要root权限]:</p> <p>------------------------------------------------------------------------------------------------------------</p> <p>#安装libevent</p> <p>cd /tmp</p> <p>wget <a href="http://memcached.googlecode.com/files/memcached-1.4.13.tar.gz">http://memcached.googlecode.com/files/memcached-1.4.13.tar.gz</a></p> <p>wget --no-check-certificate <a href="https://github.com/downloads/libevent/libevent/libevent-2.0.17-stable.tar.gz">https://github.com/downloads/libevent/libevent/libevent-2.0.17-stable.tar.gz</a></p> <p>tar zxvf libevent-2.0.17-stable.tar.gz</p> <p>cd libevent-2.0.17-stable</p> <p>./configure --prefix=/usr</p> <p>make</p> <p>make install</p> <p>#检查是否安装</p> <p>ls -al /usr/lib | grep libevent</p> <p>#安装memcached</p> <p>tar zxvf memcached-1.4.13.tar.gz</p> <p>cd memcached-1.4.13</p> <p>./configure --with-libevent=/usr</p> <p>make</p> <p>make install</p> <p>#测试是否成功安装memcached：</p> <p>ls -al /usr/local/bin/mem*</p> <p>#查看12000端口是否被占用</p> <p>netstat -tl | grep 12000</p> <p>#启动并将进程号存入memcached.pid</p> <p>/usr/local/bin/memcached -d -m 10 -u root -l 192.168.0.200 -p 12000 -c 256 -P memcached.pid</p> <p>#查看配置状态</p> <p>echo &quot;stats settings&quot; | nc localhost 12000</p> <p>#查看内存分块状态</p> <p>echo &quot;stats slabs&quot; | nc localhost 12000</p> <p>#查看健康状况</p> <p>echo &quot;stats&quot; | nc localhost 12000</p> <p>详细参数列表:</p> <div><pre>-p <span style="color: #0000ff">&lt;</span><span style="color: #800000">num</span><span style="color: #0000ff">&gt;</span>      TCP port number to listen on (default: 11211)
-U <span style="color: #0000ff">&lt;</span><span style="color: #800000">num</span><span style="color: #0000ff">&gt;</span>      UDP port number to listen on (default: 11211, 0 is off)
-s <span style="color: #0000ff">&lt;</span><span style="color: #800000">file</span><span style="color: #0000ff">&gt;</span>     UNIX socket path to listen on (disables network support)
-a <span style="color: #0000ff">&lt;</span><span style="color: #800000">mask</span><span style="color: #0000ff">&gt;</span>     access mask for UNIX socket, in octal (default: 0700)
-l <span style="color: #0000ff">&lt;</span><span style="color: #800000">addr</span><span style="color: #0000ff">&gt;</span>     interface to listen on (default: INADDR_ANY, all addresses)
              <span style="color: #0000ff">&lt;</span><span style="color: #800000">addr</span><span style="color: #0000ff">&gt;</span> may be specified as host:port. If you don't specify
              a port number, the value you specified with -p or -U is
              used. You may specify multiple addresses separated by comma
              or by using -l multiple times
-d            run as a daemon
-r            maximize core file limit
-u <span style="color: #0000ff">&lt;</span><span style="color: #800000">username</span><span style="color: #0000ff">&gt;</span> assume identity of <span style="color: #0000ff">&lt;</span><span style="color: #800000">username</span><span style="color: #0000ff">&gt;</span> (only when run as root)
-m <span style="color: #0000ff">&lt;</span><span style="color: #800000">num</span><span style="color: #0000ff">&gt;</span>      max memory to use for items in megabytes (default: 64 MB)
-M            return error on memory exhausted (rather than removing items)
-c <span style="color: #0000ff">&lt;</span><span style="color: #800000">num</span><span style="color: #0000ff">&gt;</span>      max simultaneous connections (default: 1024)
-k            lock down all paged memory.  Note that there is a
              limit on how much memory you may lock.  Trying to
              allocate more than that would fail, so be sure you
              set the limit correctly for the user you started
              the daemon with (not for -u <span style="color: #0000ff">&lt;</span><span style="color: #800000">username</span><span style="color: #0000ff">&gt;</span> user;
              under sh this is done with 'ulimit -S -l NUM_KB').
-v            verbose (print errors/warnings while in event loop)
-vv           very verbose (also print client commands/reponses)
-vvv          extremely verbose (also print internal state transitions)
-h            print this help and exit
-i            print memcached and libevent license
-P <span style="color: #0000ff">&lt;</span><span style="color: #800000">file</span><span style="color: #0000ff">&gt;</span>     save PID in <span style="color: #0000ff">&lt;</span><span style="color: #800000">file</span><span style="color: #0000ff">&gt;</span>, only used with -d option
-f <span style="color: #0000ff">&lt;</span><span style="color: #800000">factor</span><span style="color: #0000ff">&gt;</span>   chunk size growth factor (default: 1.25)
-n <span style="color: #0000ff">&lt;</span><span style="color: #800000">bytes</span><span style="color: #0000ff">&gt;</span>    minimum space allocated for key+value+flags (default: 48)
-L            Try to use large memory pages (if available). Increasing
              the memory page size could reduce the number of TLB misses
              and improve the performance. In order to get large pages
              from the OS, memcached will allocate the total item-cache
              in one large chunk.
-D <span style="color: #0000ff">&lt;</span><span style="color: #800000">char</span><span style="color: #0000ff">&gt;</span>     Use <span style="color: #0000ff">&lt;</span><span style="color: #800000">char</span><span style="color: #0000ff">&gt;</span> as the delimiter between key prefixes and IDs.
              This is used for per-prefix stats reporting. The default is
              &quot;:&quot; (colon). If this option is specified, stats collection
              is turned on automatically; if not, then it may be turned on
              by sending the &quot;stats detail on&quot; command to the server.
-t <span style="color: #0000ff">&lt;</span><span style="color: #800000">num</span><span style="color: #0000ff">&gt;</span>      number of threads to use (default: 4)
-R            Maximum number of requests per event, limits the number of
              requests process for a given connection to prevent 
              starvation (default: 20)
-C            Disable use of CAS
-b            Set the backlog queue limit (default: 1024)
-B            Binding protocol - one of ascii, binary, or auto (default)
-I            Override the size of each slab page. Adjusts max item size
              (default: 1mb, min: 1k, max: 128m)
-o            Comma separated list of extended or experimental options
              - (EXPERIMENTAL) maxconns_fast: immediately close new
                connections if over maxconns limit
              - hashpower: An integer multiplier for how large the hash
                table should be. Can be grown at runtime if not big enough.
                Set this based on &quot;STAT hash_power_level&quot; before a 
                restart.</pre></div> <p>注意<font color="#0000ff">-f</font>&#160; 增量 <font color="#0000ff">-n</font> chunck块初始大小[默认1024b] <font color="#0000ff">-I</font> slab page大小[不能超过slab大小,1k—128M,默认1M]</p> <p></p> <p>------------------------------------------------------------------------------------------------------------</p> <p>以下摘自: <a href="http://blog.csdn.net/heiyeshuwu/article/details/3950532"><font color="#0000ff">Memcached 原理和使用详解(PPT/PDF)</font></a>&#160;</p> <h6>数据存储方式：Slab Allocation</h6> <p><strong>Slab Alloction 构造图:</strong></p> <p><a href="http://kazge.com/wp-content/uploads/2012/03/image.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/assets/image_thumb.png" width="417" height="312" /></a></p> <p>Slab Allocator的基本原理是按照预先规定的大小，将分配的内存分割成特定长度的块，以完全解决内存碎片问题。 </p> <p>Slab Allocation的原理相当简单。 将分配的内存分割成各种尺寸的块（chunk），并把尺寸相同的块分成组（chunk的集合）</p> <p><strong>Slab Classes 分配图</strong></p> <p><a href="http://kazge.com/wp-content/uploads/2012/03/image1.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/assets/image_thumb1.png" width="417" height="312" /></a> </p> <p>Page：分配给Slab的内存空间，默认是1MB。分配给Slab之后根据slab的大小切分成chunk。</p> <p>Chunk：用于缓存记录的内存空间。</p> <p>注意:摘自<a href="http://y.jmeye.com/?aid=185">http://y.jmeye.com/?aid=185</a></p> <p>Slab是一个内存块，它是memcached一次申请内存的最小单位。 在启动memcached的时候一般会使用参数-m指定其可用内存，但是并不是在启动的那一刻所有的内存就全部分配出去了，只有在需要的时候才会去申请， 而且每次申请一定是一个slab。<font color="#0000ff">Slab的大小固定为1M（1048576 Byte</font>），一个slab由若干个大小相等的chunk组成。每个chunk中都保存了一个item结构体、一对key和value。</p> <p>注意:</p> <p><strong></strong></p> <p><font color="#0000ff">chunk中不仅保持了缓存对象的value，而且保存了缓存对象的key，expire time， flag等详细信息</font></p> <p>参见: <a href="http://tank.blogs.tkiicpp.com/category/programming/memcache/">http://tank.blogs.tkiicpp.com/category/programming/memcache/</a></p> <p>Slab Class：特定大小的chunk的组。</p> <p>memcached根据收到的数据的大小，选择最适合数据大小的slab。 </p> <p>memcached中保存着slab内空闲chunk的列表，根据该列表选择chunk，然后将数据缓存于其中。</p> <p><strong>Slab Alloction 缺点</strong></p> <p><a href="http://kazge.com/wp-content/uploads/2012/03/image2.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/assets/image_thumb2.png" width="416" height="180" /></a> </p> <p>这个问题就是，由于分配的是特定长度的内存，因此无法有效利用分配的内存。例如，将100字节的数据缓存到128字节的chunk中，剩余的28字节就浪费了。</p> <p>&#160;</p> <p>以下摘自: <a href="http://kazge.com/archives/750.html">http://kazge.com/archives/750.html</a></p> <div>在1.2中，chunk大小表示为初始大小*f^n，f为factor，在memcached.c中定义，n为classid，同时，201个头不是全部 都要初始化的，因为factor可变，初始化只循环到计算出的大小达到slab大小的一半为止，而且它是从id1开始的，即：id为1的slab，每 chunk大小80字节，id为2的slab，每chunk大小80*f，id为3的slab，每chunk大小80*f^2，初始化大小有一个修正值 CHUNK_ALIGN_BYTES，用来保证n-byte排列 （保证结果是CHUNK_ALIGN_BYTES的整倍数）。这样，在标准情况下，memcached1.2会初始化到id40，这个slab中每个 chunk大小为504692，每个slab中有两个chunk。最后，slab_init函数会在最后补足一个id41，它是整块的，也就是这个 slab中只有一个1MB大的chunk</div> <div>&#160;</div> <p><font color="#000000">以下摘自:</font> </p> <p><a href="http://blog.csdn.net/jarfield/article/details/4322953">http://blog.csdn.net/jarfield/article/details/4322953</a> </p> <p><a href="http://blog.csdn.net/jarfield/article/details/4336035">http://blog.csdn.net/jarfield/article/details/4336035</a> </p> <p><a href="http://blog.csdn.net/jarfield/article/details/4341819">http://blog.csdn.net/jarfield/article/details/4341819</a> </p> <p>所有的被发送到memcached的单个命令是完全原子的。如果您针对同一份数据同时发送了一个set命令和一个get命令，它们不会影响对方。它们将被串行化、先后执行。 </p> <p>通常，基于memcached中item的值来修改item，是一件棘手的事情。除非您很清楚自己在做什么，否则请不要做这样的事情。</p> <div>&#160;</div> <div>以下摘自: <a href="http://www.iteye.com/topic/225692">http://www.iteye.com/topic/225692</a></div> <div><font color="#0000ff">memcached中新的value过来存放的地址是该value的大小决定的，value总是会被选择存放到chunk与其最接近的一个slab中</font>，比如上面的例子，如果我的value是80b，那么我这所有的value总是会被存放到1号slab中，而1号slab中的free_chunks已经是0了，怎么办呢，如果你在启动memcached的时候没有追加-M（禁止LRU，这种情况下内存不够时会out of memory），那么memcached会把这个slab中最近最少被使用的chunk中的数据清掉，然后放上最新的数据。这就解释了为什么我的内存还有40%的时候LRU就执行了，因为我的其他slab中的chunk_size都远大于我的value，所以我的value根本不会放到那几个slab中，而只会放到和我的value最接近的chunk所在的slab中(而这些slab早就满了，郁闷了)。这就导致了我的数据被不停的覆盖，后者覆盖前者。</div> <div>&#160;</div> <div><font color="#0000ff">我总结一下:</font></div> <div><font color="#0000ff">逻辑上的item 存于chunk中，相同大小chunk组成slab(chunk初始值由-n配置), 各个slab大小是一致的(-I配置)，但是slab1和slab2其内部的chunk大小是不同的，slab2内部的chunk大小是slab1内部chunk大小的 f增量子倍(-f配置),另外slab page是将slab划分的内存块,一个slab可划分为多个page,每个page下存储多个chunk</font></div> <div><font color="#0000ff">逻辑元素: slab,item</font></div> <div><font color="#0000ff">内存元素:page,chunk</font></div> <div><font color="#0000ff">这些可通过memcached的状态打印输出看出来</font></div> <p>STAT 1:chunk_size 80<br /> <br />STAT 1:chunks_per_page 13107</p> <p>STAT 1:total_pages 1</p> <p>STAT 1:total_chunks 13107</p> <p>STAT 1:used_chunks 13107</p> <p>STAT 1:free_chunks 0</p> <p>STAT 1:free_chunks_end 13107</p> <div> <br /><font color="#0000ff">•在 Memcached 中可以保存的item数据量是没有限制的，只有内存足够</font></div> <p><font color="#0000ff">• 最大键长为250字节，大于该长度无法存储，常量代码中KEY_MAX_LENGTH 250 控制</font></p> <p><font color="#0000ff">• 单个item最大数据默认是1MB，超过1MB数据不予存储，常量代码POWER_BLOCK 1048576 进行控制，参数-I控制的是slab page大小,因此它不能超过slab大小，slab大小只能通过编译源码来改。</font></p> <p><font color="#0000ff">32位系统下Memcached单进程最大使用内存为2G，要使用更多内存，可以分多个端口开启多个Memcached进程或改为64位系统。</font></p> <p></p> <p>-----------------------------------------------------------------------------</p> <p>它的接口文档见<a href="http://code.google.com/p/memcached/wiki/NewCommands">http://code.google.com/p/memcached/wiki/NewCommands</a></p> <p>其中有些还没被Memcached-Java-Client实现，比如cas,可能是新加的接口。</p> <p><font color="#0000ff">memcached提供的接口目标就是简单，其用起来可以说简单，但是不简单的地方是什么呢，当然他的内部机理比较复杂，最主要的是实际应用场景的相关问题。</font></p> <p><font color="#0000ff">你做数据缓存，那么哪些数据应该缓存？怎么样缓存？过期策略？</font></p> <p><font color="#0000ff">做session集群共享，要不要保证可靠性?</font></p> <p><font color="#0000ff">很多时候不该memcached做的事情也让它来做了，这时可考虑下nosql地盘的东东了。</font></p> <p>可参考转载的这篇文章：<a title="http://kazge.com/archives/757.html" href="http://kazge.com/archives/757.html">http://kazge.com/archives/757.html</a></p> <p class="read-more">Continue reading <a class="heading" href="/java/web/%E5%88%86%E5%B8%83%E5%BC%8F/2012/03/08/memcache-e8-b0-83-e7-a0-94.html" data-flip="title">Memcache 调研</a></p> </article> <article id="post-web%E5%89%8D%E7%AB%AF/2012/03/07/%e3%80%90%e9%93%be%e3%80%9140%e4%b8%aa%e6%9c%89%e5%88%9b%e6%84%8f%e7%9a%84jquery%e5%9b%be%e7%89%87%e5%92%8c%e5%86%85%e5%ae%b9%e6%bb%91%e5%8a%a8%e5%8f%8a%e5%bc%b9%e5%87%ba%e6%8f%92%e4%bb%b6%e6%94%b6" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web%E5%89%8D%E7%AB%AF/2012/03/07/e3-80-90-e9-93-be-e3-80-9140-e4-b8-aa-e6-9c-89-e5-88-9b-e6-84-8f-e7-9a-84jquery-e5-9b-be-e7-89-87-e5-92-8c-e5-86-85-e5-ae-b9-e6-bb-91-e5-8a-a8-e5-8f-8a-e5-bc-b9-e5-87-ba-e6-8f-92-e4-bb-b6-e6-94-b6.html" data-flip="title"> 【链】40个有创意的jQuery图片和内容滑动及弹出插件收藏集之一 </a> </h1> <p class="post-date heading"> <time datetime="2012-03-07T05:26:37+08:00">07 Mar 2012</time> in <span>Web前端</span> on <span>Jquery</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p><a href="http://www.techolics.com/jquery/20111229_152.html">http://www.techolics.com/jquery/20111229_152.html</a></p> <p>&#160;</p> <p>PS:</p> <p>网上看到<a href="http://www.pixedelic.com/plugins/diapo/">http://www.pixedelic.com/plugins/diapo/</a> 这个效果以为是html5实现的，细看原来是div计算出来的，确实强，所以查出上面的文章，原来这样的插件还不少呢！</p> <p class="read-more">Continue reading <a class="heading" href="/web%E5%89%8D%E7%AB%AF/2012/03/07/e3-80-90-e9-93-be-e3-80-9140-e4-b8-aa-e6-9c-89-e5-88-9b-e6-84-8f-e7-9a-84jquery-e5-9b-be-e7-89-87-e5-92-8c-e5-86-85-e5-ae-b9-e6-bb-91-e5-8a-a8-e5-8f-8a-e5-bc-b9-e5-87-ba-e6-8f-92-e4-bb-b6-e6-94-b6.html" data-flip="title">【链】40个有创意的jQuery图片和内容滑动及弹出插件收藏集之一</a></p> </article> <article id="post-java/2012/03/06/threadlocal-%e4%bd%bf%e7%94%a8%e6%90%9e%e6%98%8e%e7%99%bd" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/java/2012/03/06/threadlocal-e4-bd-bf-e7-94-a8-e6-90-9e-e6-98-8e-e7-99-bd.html" data-flip="title"> ThreadLocal 使用搞明白 </a> </h1> <p class="post-date heading"> <time datetime="2012-03-06T16:17:46+08:00">06 Mar 2012</time> in <span>Java</span> on <span>Threadlocal</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>我最初使用ThreadLocal是copy Myfaces中的源码，为了保存Httprequest对象，现在想一想，总是听说ThreadLocal是解决并发安全性的好方法，这其中有个道理还是没想清楚：</p> <p>ThreadLocal只是维护资源副本，因此对本线程资源的改变是不会对其他线程起作用的。</p> <p>那么我们为什么用它呢，最常用的情况是维护Singleton对象，即一个线程内所有对此对象的访问都可以做到是一个对象，这与类静态变量维护的Sington对象是不同的。</p> <p>可参考：Hibernate的SessionFactory,IBatis的SqlClient</p> <p>参见文章:</p> <p>ThreadLocal如何解决并发安全性 <a href="http://www.java3z.com/cwbwebhome/article/article8/81086.html">http://www.java3z.com/cwbwebhome/article/article8/81086.html</a></p> <p>&#160;&#160;&#160; 前面我们介绍了Java当中多个线程抢占一个共享资源的问题。但不论是同步还是重入锁，都不能实实在在的解决资源紧缺的情况，这些方案只是靠制定规则来约束线程的行为，让它们不再拼命的争抢，而不是真正从实质上解决他们对资源的需求。 <br />在JDK 1.2当中，引入了java.lang.ThreadLocal。它为我们提供了一种全新的思路来解决线程并发的问题。但是他的名字难免让我们望文生义：本地线程？ <br />什么是本地线程？ <br />本地线程开玩笑的说：不要迷恋哥，哥只是个传说。 <br />&#160;&#160; 其实ThreadLocal并非Thread at Local，而是LocalVariable in a Thread。 <br />根据WikiPedia上的介绍，ThreadLocal其实是源于一项多线程技术，叫做Thread Local Storage，即线程本地存储技术。不仅仅是Java，在C++、C#、.NET、Python、Ruby、Perl等开发平台上，该技术都已经得以实现。</p> <p><ins><ins></ins></ins></p> <p>&#160;&#160; 当使用ThreadLocal维护变量时，它会为每个使用该变量的线程提供独立的变量副本。也就是说，他从根本上解决的是资源数量的问题，从而使得每个线程持有相对独立的资源。这样，当多个线程进行工作的时候，它们不需要纠结于同步的问题，于是性能便大大提升。但资源的扩张带来的是更多的空间消耗，ThreadLocal就是这样一种利用空间来换取时间的解决方案。 <br />说了这么多，来看看如何正确使用ThreadLocal。 <br />通过研究JDK文档，我们知道，ThreadLocal中有几个重要的方法：get()、set()、remove()、initailValue()，对应的含义分别是： <br />返回此线程局部变量的当前线程副本中的值、将此线程局部变量的当前线程副本中的值设置为指定值、移除此线程局部变量当前线程的值、返回此线程局部变量的当前线程的“初始值”。 <br />转载注明出处：http://x- spirit.javaeye.com/、http: //www.blogjava.net/zhangwei217245/ <br />还记得我们在第三篇的上半节引出的那个例子么？几个线程修改同一个Student对象中的age属性。为了保证这几个线程能够工作正常，我们需要对Student的对象进行同步。 <br />下面我们对这个程序进行一点小小的改造，我们通过继承Thread来实现多线程：</p> <p>/** <br /> * <br /> * @author x-spirit <br />*/ <br />public class ThreadDemo3 extends Thread{ <br />private ThreadLocal&lt;Student&gt; stuLocal = new ThreadLocal&lt;Student&gt;(); <br />public ThreadDemo3(Student stu){ <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; stuLocal.set(stu); <br />&#160;&#160;&#160; } <br />public static void main(String[] args) { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Student stu = new Student(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ThreadDemo3 td31 = new ThreadDemo3(stu); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ThreadDemo3 td32 = new ThreadDemo3(stu); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ThreadDemo3 td33 = new ThreadDemo3(stu); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; td31.start(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; td32.start(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; td33.start(); <br />&#160;&#160;&#160; } <br />&#160;&#160;&#160; @Override <br />public void run() { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; accessStudent(); <br />&#160;&#160;&#160; } <br />public void accessStudent() { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; String currentThreadName = Thread.currentThread().getName(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(currentThreadName + &quot; is running!&quot;); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Random random = new Random(); <br />int age = random.nextInt(100); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(&quot;thread &quot; + currentThreadName + &quot; set age to:&quot; + age); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Student student = stuLocal.get(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; student.setAge(age); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(&quot;thread &quot; + currentThreadName + &quot; first&#160; read age is:&quot; + student.getAge()); <br />try { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Thread.sleep(5000); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; } catch (InterruptedException ex) { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ex.printStackTrace(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; } <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(&quot;thread &quot; + currentThreadName + &quot; second read age is:&quot; + student.getAge()); <br />&#160;&#160;&#160; } <br />}</p> <p>转载注明出处：http://x- spirit.javaeye.com/、http: //www.blogjava.net/zhangwei217245/ <br />貌似这个程序没什么问题。但是运行结果却显示：这个程序中的3个线程会抛出3个空指针异常。读者一定感到很困惑。我明明在构造器当中把Student对象set进了ThreadLocal里面阿，为什么run起来之后居然在调用stuLocal.get()方法的时候得到的是NULL呢？ <br />转载注明出处：http://x- spirit.javaeye.com/、http: //www.blogjava.net/zhangwei217245/ <br />带着这个疑问，让我们深入到JDK的代码当中，去一看究竟。 <br />转载注明出处：http://x- spirit.javaeye.com/、http: //www.blogjava.net/zhangwei217245/ <br />原来，在ThreadLocal中，有一个内部类叫做ThreadLocalMap。这个ThreadLocalMap并非java.util.Map的一个实现，而是利用java.lang.ref.WeakReference实现的一个键-值对应的数据结构其中，key是ThreadLocal类型，而value是Object类型，我们可以简单的视为HashMap&lt;ThreadLocal,Object&gt;。 <br />而在每一个Thread对象中，都有一个ThreadLocalMap的引用，即Thread.threadLocals。而ThreadLocal的set方法就是首先尝试从当前线程中取得ThreadLocalMap（以下简称Map）对象。如果取到的不为null，则以ThreadLocal对象自身为key，来取Map中的value。如果取不到Map对象，则首先为当前线程创建一个ThreadLocalMap，然后以ThreadLocal对象自身为key，将传入的value放入该Map中。</p> <p>&#160;&#160;&#160; ThreadLocalMap getMap(Thread t) { <br />return t.threadLocals; <br />&#160;&#160;&#160; }&#160;&#160;&#160; <br />public void set(T value) { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Thread t = Thread.currentThread(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ThreadLocalMap map = getMap(t); <br />if (map != null) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; map.set(this, value); <br />else <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; createMap(t, value); <br />&#160;&#160;&#160; }</p> <p>而get方法则是首先得到当前线程的ThreadLocalMap对象，然后，根据ThreadLocal对象自身，取出相应的value。当然，如果在当前线程中取不到ThreadLocalMap对象，则尝试为当前线程创建ThreadLocalMap对象，并以ThreadLocal对象自身为key，把initialValue()方法产生的对象作为value放入新创建的ThreadLocalMap中。</p> <p>public T get() { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Thread t = Thread.currentThread(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ThreadLocalMap map = getMap(t); <br />if (map != null) { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ThreadLocalMap.Entry e = map.getEntry(this); <br />if (e != null) <br />return (T)e.value; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; } <br />return setInitialValue(); <br />&#160;&#160;&#160; } <br />private T setInitialValue() { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; T value = initialValue(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Thread t = Thread.currentThread(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ThreadLocalMap map = getMap(t); <br />if (map != null) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; map.set(this, value); <br />else <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; createMap(t, value); <br />return value; <br />&#160;&#160;&#160; } <br />protected T initialValue() { <br />return null; <br />&#160;&#160;&#160; }</p> <p>这样，我们就明白上面的问题出在哪里：我们在main方法执行期间，试图在调用ThreadDemo3的构造器时向ThreadLocal置入Student对象，而此时，以ThreadLocal对象为key，Student对象为value的Map是被放入当前的活动线程内的。也就是Main线程。而当我们的3个ThreadDemo3线程运行起来以后，调用get()方法，都是试图从当前的活动线程中取得ThreadLocalMap对象，但当前的活动线程显然已经不是Main线程了，于是，程序最终执行了ThreadLocal原生的initialValue()方法，返回了null。 <br />转载注明出处：http://x- spirit.javaeye.com/、http: //www.blogjava.net/zhangwei217245/ <br />讲到这里，我想不少朋友一定已经看出来了：ThreadLocal的initialValue()方法是需要被覆盖的。 <br />转载注明出处：http://x- spirit.javaeye.com/、http: //www.blogjava.net/zhangwei217245/ <br />于是，ThreadLocal的正确使用方法是：将ThreadLocal以内部类的形式进行继承，并覆盖原来的initialValue()方法，在这里产生可供线程拥有的本地变量值。 <br />这样，我们就有了下面的正确例程：</p> <p>/** <br /> * <br /> * @author x-spirit <br />*/ <br />public class ThreadDemo3 extends Thread{ <br />private ThreadLocal&lt;Student&gt; stuLocal = new ThreadLocal&lt;Student&gt;(){ <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; @Override <br />protected Student initialValue() { <br />return new Student(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; } <br />&#160;&#160;&#160; }; <br />public ThreadDemo3(){ <br />&#160;&#160;&#160; } <br />public static void main(String[] args) { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ThreadDemo3 td31 = new ThreadDemo3(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ThreadDemo3 td32 = new ThreadDemo3(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ThreadDemo3 td33 = new ThreadDemo3(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; td31.start(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; td32.start(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; td33.start(); <br />&#160;&#160;&#160; } <br />&#160;&#160;&#160; @Override <br />public void run() { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; accessStudent(); <br />&#160;&#160;&#160; } <br />public void accessStudent() { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; String currentThreadName = Thread.currentThread().getName(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(currentThreadName + &quot; is running!&quot;); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Random random = new Random(); <br />int age = random.nextInt(100); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(&quot;thread &quot; + currentThreadName + &quot; set age to:&quot; + age); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Student student = stuLocal.get(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; student.setAge(age); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(&quot;thread &quot; + currentThreadName + &quot; first&#160; read age is:&quot; + student.getAge()); <br />try { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Thread.sleep(5000); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; } catch (InterruptedException ex) { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ex.printStackTrace(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; } <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(&quot;thread &quot; + currentThreadName + &quot; second read age is:&quot; + student.getAge()); <br />&#160;&#160;&#160; } <br />}</p> <p>可见，要正确使用ThreadLocal，必须注意以下几点： <br />转载注明出处：http://x- spirit.javaeye.com/、http: //www.blogjava.net/zhangwei217245/ <br />1. 总是对ThreadLocal中的initialValue()方法进行覆盖。 <br />转载注明出处：http://x- spirit.javaeye.com/、http: //www.blogjava.net/zhangwei217245/ <br />2. 当使用set()或get()方法时牢记这两个方法是对当前活动线程中的ThreadLocalMap进行操作，一定要认清哪个是当前活动线程！ <br />转载注明出处：http://x- spirit.javaeye.com/、http: //www.blogjava.net/zhangwei217245/ <br />3. 适当的使用泛型，可以减少不必要的类型转换以及可能由此产生的问题。 <br />转载注明出处：http://x- spirit.javaeye.com/、http: //www.blogjava.net/zhangwei217245/ <br />运行该程序，我们发现：程序的执行过程只需要5秒，而如果采用同步的方法，程序的执行结果相同，但执行时间需要15秒。以前是多个线程为了争取一个资源，不得不在同步规则的制约下互相谦让，浪费了一些时间。 <br />转载注明出处：http://x- spirit.javaeye.com/、http: //www.blogjava.net/zhangwei217245/ <br />现在，采用ThreadLocal机制以后，可用的资源多了，你有我有全都有，所以，每个线程都可以毫无顾忌的工作，自然就提高了并发性，线程安全也得以保证。 <br />当今很多流行的开源框架也采用ThreadLocal机制来解决线程的并发问题。比如大名鼎鼎的 Struts 2.x 和 Spring 等。 <br />把ThreadLocal这样的话题放在我们的同步机制探讨中似乎显得不是很合适。但是ThreadLocal的确为我们解决多线程的并发问题带来了全新的思路。它为每个线程创建一个独立的资源副本，从而将多个线程中的数据隔离开来，避免了同步所产生的性能问题，是一种“以空间换时间”的解决方案。 <br />但这并不是说ThreadLocal就是包治百病的万能药了。如果实际的情况不允许我们为每个线程分配一个本地资源副本的话，同步还是非常有意义的。</p> <p class="read-more">Continue reading <a class="heading" href="/java/2012/03/06/threadlocal-e4-bd-bf-e7-94-a8-e6-90-9e-e6-98-8e-e7-99-bd.html" data-flip="title">ThreadLocal 使用搞明白</a></p> </article> <article id="post-%E7%94%9F%E6%B4%BB/2012/03/05/%e4%bb%80%e4%b9%88%e6%97%b6%e5%80%99%e9%94%bb%e7%82%bc%e5%a5%bd" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/%E7%94%9F%E6%B4%BB/2012/03/05/e4-bb-80-e4-b9-88-e6-97-b6-e5-80-99-e9-94-bb-e7-82-bc-e5-a5-bd.html" data-flip="title"> 什么时候锻炼好? </a> </h1> <p class="post-date heading"> <time datetime="2012-03-05T17:23:45+08:00">05 Mar 2012</time> in <span>生活</span> on <span>锻炼</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>最近国内流行锻炼的说法：下午4点到7点最好。</p> <p>这不不是和我们一贯以来早上锻炼的习惯相反吗？</p> <p>处于对国内砖家叫兽的了解，我特地查了一下国外的资料，有如下结论：</p> <p>科学研究表明，下午4点到7点确实是人体较活跃的时间段，但是并不是说这个时间段锻炼就是最适合你的，实际上，你觉得什么时候锻炼适合你，那就是你锻炼的最好时间,贵在坚持!</p> <p>国外研究表明，经常早上锻炼得人早上肌肉有较好的状态，晚上锻炼得人，晚上肌肉有较好的状态。</p> <p>锻炼一个小时以内，可吃可不吃，但是一定要喝点水。</p> <p>一个小时以上者，则一定要吃点食物，喝些水。</p> <p>&#160;</p> <p>以下是我个人观点：</p> <p>从我对中医的领悟来讲，冬天还是太阳出来一小时以后，太阳落山半小时之前这段时间锻炼较好，冬天主藏，不要将自己的身体暴露在肃杀寒气之中。也对应古人“日出而作日入而息”的生活规律。</p> <p>参见:</p> <p><a href="http://www.naturallyintense.net/blog/personal-trainer-nyc-articles/when-is-the-best-time-to-exercise/">http://www.naturallyintense.net/blog/personal-trainer-nyc-articles/when-is-the-best-time-to-exercise/</a></p> <p><a href="http://goaskalice.columbia.edu/best-time-day-exercise">http://goaskalice.columbia.edu/best-time-day-exercise</a></p> <p class="read-more">Continue reading <a class="heading" href="/%E7%94%9F%E6%B4%BB/2012/03/05/e4-bb-80-e4-b9-88-e6-97-b6-e5-80-99-e9-94-bb-e7-82-bc-e5-a5-bd.html" data-flip="title">什么时候锻炼好?</a></p> </article> <article id="post-web/2012/02/28/%e3%80%90%e8%bd%ac%e3%80%91apache-rewrite-%e8%a7%84%e5%88%99%e8%af%a6%e8%a7%a3%e5%be%88%e4%b8%8d%e9%94%99" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web/2012/02/28/e3-80-90-e8-bd-ac-e3-80-91apache-rewrite-e8-a7-84-e5-88-99-e8-af-a6-e8-a7-a3-e5-be-88-e4-b8-8d-e9-94-99.html" data-flip="title"> 【转】Apache Rewrite 规则详解(很不错) </a> </h1> <p class="post-date heading"> <time datetime="2012-02-28T19:20:51+08:00">28 Feb 2012</time> in <span>Web</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>转自:<a href="http://www.iocblog.net/blog/site/apache-rewrite-all.html">http://www.iocblog.net/blog/site/apache-rewrite-all.html</a></p> <p><strong>1、Rewrite规则简介：</strong></p> <p>Rewirte主要的功能就是实现URL的跳转，它的正则表达式是基于Perl语言。可基于服务器级的(httpd.conf)和目录级的 (.htaccess)两种方式。如果要想用到rewrite模块，必须先安装或加载rewrite模块。方法有两种一种是编译apache的时候就直接安装rewrite模块，别一种是编译apache时以DSO模式安装apache,然后再利用源码和apxs来安装rewrite模块。</p> <p>基于服务器级的(httpd.conf)有两种方法，一种是在httpd.conf的全局下直接利用RewriteEngine on来打开rewrite功能;另一种是在局部里利用RewriteEngine on来打开rewrite功能,下面将会举例说明，需要注意的是,必须在每个virtualhost里用RewriteEngine on来打开rewrite功能。否则virtualhost里没有RewriteEngine on它里面的规则也不会生效。</p> <p>基于目录级的(.htaccess),要注意一点那就是必须打开此目录的FollowSymLinks属性且在.htaccess里要声明RewriteEngine on。</p> <p><strong>细讲每一条规则:</strong></p> <p>RewriteRule</p> <p>Syntax: RewriteRule Pattern Substitution [flags]</p> <p>&#160; 一条RewriteRule指令，定义一条重写规则，规则间的顺序非常重要。对Apache1.2及以后的版本，模板(pattern)是一个POSIX正则式，用以匹配当前的URL。当前的URL不一定是用记最初提交的URL，因为可能用一些规则在此规则前已经对URL进行了处理。</p> <p>&#160; 对mod_rewrite来说，！是个合法的模板前缀，表示“非”的意思，这对描述“不满足某种匹配条件”的情况非常方便，或用作最后一条默认规则。当使用！时，不能在模板中有分组的通配符，也不能做后向引用。</p> <p>&#160; 当匹配成功后，Substitution会被用来替换相应的匹配，它除了可以是普通的字符串以外，还可以包括：</p> <p>$N,引用RewriteRule模板中匹配的相关字串，N表示序号,N=0..9</p> <p>%N,引用最后一个RewriteCond模板中匹配的数据，N表示序号</p> <p>%{VARNAME},服务器变量</p> <p>${mapname:key|default},映射函数调用</p> <p>这些特殊内容的扩展，按上述顺序进行。</p> <p>&#160; 一个URL的全部相关部分都会被Substitution替换，而且这个替换过程会一直持续到所有的规则都被执行完，除非明确地用L标志中断处理过程。</p> <p>&#160; 当susbstitution有”-”前缀时，表示不进行替换，只做匹配检查。</p> <p>&#160; 利用RewriteRule，可定义含有请求串(Query String)的URL，此时只需在Sustitution中加入一个？，表示此后的内容放入QUERY_STRING变量中。如果要清空一个QUERY_STRING变量，只需要以？结束Substitution串即可。</p> <p>&#160; 如果给一个Substitution增加一个<a href="http://thishost/">http://thishost</a>[:port]的前缀，则mod_rewrite会自动将此前缀去掉。因此，利用<a href="http://thisthost/">http://thisthost</a>做一个无条件的重定向到自己，将难以奏效。要实现这种效果，必须使用R标志。</p> <p>&#160; Flags是可选参数，当有多个标志同时出现时，彼此间以逗号分隔。</p> <p>'redirect|R [=code]' (强制重定向)</p> <p>&#160; 给当前的URI增加前缀<a href="http://thishost/">http://thishost</a>[:thisport]/， 从而生成一个新的URL，强制生成一个外部重定向(external redirection，指生的URL发送到客户端，由客户端再次以新的URL发出请求，虽然新URL仍指向当前的服务器). 如果没有指定的code值，则HTTP应答以状态值302 (MOVED TEMPORARILY)，如果想使用300-400（不含400）间的其它值可以通过在code的位置以相应的数字指定，也可以用标志名指定： temp (默认值), permanent, seeother.</p> <p>&#160; 注意，当使用这个标志时，要确实substitution是个合法的URL，这个标志只是在URL前增加<a href="http://thishost/">http://thishost</a>[:thisport]/前缀而已，重写操作会继续进行。如果要立即将新URL重定向，用L标志来中重写流程。</p> <p>'forbidden|F' (强制禁止访问URL所指的资源)</p> <p>&#160; 立即返回状态值403 (FORBIDDEN)的应答包。将这个标志与合适的RewriteConds 联合使用，可以阻断访问某些URL。</p> <p>'gone|G' (强制返回URL所指资源为不存在(gone))</p> <p>&#160; 立即返回状态值410 (GONE)的应答包。用这个标志来标记URL所指的资源永久消失了.</p> <p># 'proxy|P' (强制将当前URL送往代理模块（proxy module）)</p> <p>&#160; 这个标志，强制将substitution当作一个发向代理模块的请求，并立即将共送往代理模块。因此，必须确保substitution串是一个合法的URI (如, 典型的情况是以<a href="http://hostname/">http://hostname</a>开头)，否则会从代理模块得到一个错误. 这个标志，是ProxyPass指令的一个更强劲的实现，将远程请求(remote stuff)映射到本地服务器的名字空间(namespace)中来。</p> <p>&#160; 注意，使用这个功能必须确保代理模块已经编译到Apache 服务器程序中了. 可以用“httpd -l ”命令，来检查输出中是否含有mod_proxy.c来确认一下。如果没有，而又需要使用这个功能，则需要重新编译``httpd''程序并使用mod_proxy有效。</p> <p>'last|L' (最后一条规则)</p> <p>&#160; 中止重写流程，不再对当前URL施加更多的重写规则。这相当于perl的last命令或C的break命令。</p> <p>'next|N' (下一轮)</p> <p>&#160; 重新从第一条重写规则开始执行重写过程，新开的过程中的URL不应当与最初的URL相同。 这相当于Perl的next命令或C的continue命令. 千万小心不要产生死循环。</p> <p># 'chain|C' (将当前的规则与其后续规则捆绑(chained))</p> <p>&#160; 当规则匹配时，处理过程与没有捆绑一样；如果规则不匹配，则捆绑在一起的后续规则也不在检查和执行。</p> <p>'type|T=MIME-type' (强制MIME类型)</p> <p>&#160; 强制将目标文件的MIME-type为某MIME类型。例如，这可用来模仿mod_alias模块对某目录的ScriptAlias指定，通过强制将该目录下的所有文件的类型改为 “application/x-httpd-cgi”.</p> <p>'nosubreq|NS' (used only if no internal sub-request )</p> <p>&#160; 这个标志强制重写引擎跳过为内部sub-request的重写规则.例如，当mod_include试图找到某一目录下的默认文件时 (index.xxx)，sub-requests 会在Apache内部发生. Sub-requests并非总是有用的，在某些情况下如果整个规则集施加到它上面，会产生错误。利用这个标志可排除执行一些规则。</p> <p>'nocase|NC' (模板不区分大小写)</p> <p>&#160; 这个标志会使得模板匹配当前URL时忽略大小写的差别。</p> <p>'qsappend|QSA' (追加请求串(query string))</p> <p>&#160; 这个标志，强制重写引擎为Substitution的请求串追加一部分串，则不是替换掉原来的。借助这个标志，可以使用一个重写规则给请求串增加更多的数据。</p> <p>'noescape|NE' (不对输出结果中的特殊字符进行转义处理)</p> <p>&#160; 通常情况下，mod_write的输出结果中，特殊字符（如'%', '$', ';', 等)会转义为它们的16进制形式(如分别为'%25', '%24', and '%3B'）。这个标志会禁止mod_rewrite对输出结果进行此类操作。 这个标志只能在 Apache 1.3.20及以后的版本中使用。</p> <p>'passthrough|PT' (通过下一个处理器)</p> <p>&#160; 这个标志强制重写引擎用filename字段的值来替换内部request_rec数据结构中uri字段的值。. 使用这个标志，可以使后续的其它URI－to-filename转换器的Alias、ScriptAlias、Redirect等指令，也能正常处理RewriteRule指令的输出结果。用一个小例子来说明它的语义：如果要用mod_rewrite的重写引擎将/abc转换为/def,然后用mod_alas将/def重写为ghi，则要：</p> <p>RewriteRule ^/abc(.*) /def$1 [PT]</p> <p>Alias /def /ghi</p> <p>如果PT标志被忽略，则mod_rewrite也能很好完成工作,如果., 将 uri=/abc/... 转换为filename=/def/... ，完全符合一个URI-to-filename转换器的动作。接下来 mod_alias 试图做 URI-to-filename 转换时就会出问题。</p> <p>注意:如果要混合都含有URL－to-filename转换器的不同的模块的指令，必须用这个标志。最典型的例子是mod_alias和mod_rewrite的使用。</p> <p>'skip|S=num' (跳过后面的num个规则)</p> <p>&#160; 当前规则匹配时，强制重写引擎跳过后续的num个规则。用这个可以来模仿if-then-else结构：then子句的最后一条rule的标志是skip=N，而N是else子句的规则条数。</p> <p>'env|E=VAR:VAL' (设置环境变量)</p> <p>&#160; 设置名为VAR的环境变量的值为VAL,其中VAL中可以含有正则式的后向引用($N或%N)。这个标志可以使用多次，以设置多个环境变量。这儿设置的变量，可以在多种情况下被引用，如在XSSI或CGI中。另外，也可以在RewriteCond模板中以%{ENV:VAR}的形式被引用。</p> <p>注意：一定不要忘记，在服务器范围内的配置文件中，模板(pattern)用以匹配整个URL;而在目录范围内的配置文件中，目录前缀总是被自动去掉后再进行模板匹配的，且在替换完成后自动再加上这个前缀。这个功能对很多种类的重写是非常重要的，因为如果没有去前缀，则要进行父目录的匹配，而父目录的信息并不是总能得到的。一个例外是，当substitution中有<a href="http://chenling1018.blog.163.com/rss/">http://</a>打头时，则不再自动增加前缀了，如果P标志出现，则会强制转向代理。</p> <p>注意：如果要在某个目录范围内启动重写引擎，则需要在相应的目录配置文件中设置“RewriteEngine on”，且目录的“Options FollowSymLinks”必须设置。如果管理员由于安全原因没有打开FollowSymLinks，则不能使用重写引擎。</p> <p><strong>2、举例说明：</strong></p> <p>下面是在一个虚拟主机里定义的规则。功能是把client请求的主机前缀不是www.colorme.com和203.81.23.202都跳转到主机前缀为http://www.colorme.com.cn，避免当用户在地址栏写入http://colorme.com.cn时不能以会员方式登录网站。</p> <p>NameVirtualHost 192.168.100.8:80</p> <p>ServerAdmin webmaster@colorme.com.cn <br />DocumentRoot &quot;/web/webapp&quot; <br />ServerName www.colorme.com.cn <br />ServerName colorme.com.cn <br />RewriteEngine on #打开rewirte功能 <br />RewriteCond %{HTTP_HOST} !^www.colorme.com.cn [NC] #声明Client请求的主机中前缀不是www.colorme.com.cn,[NC]的意思是忽略大小写 <br />RewriteCond %{HTTP_HOST} !^203.81.23.202 [NC] #声明Client请求的主机中前缀不是203.81.23.202,[NC]的意思是忽略大小写 <br />RewriteCond %{HTTP_HOST} !^$ #声明Client请求的主机中前缀不为空,[NC]的意思是忽略大小写 <br />RewriteRule ^/(.*) http://www.colorme.com.cn/ [L] <br />#含义是如果Client请求的主机中的前缀符合上述条件，则直接进行跳转到http://www.colorme.com.cn/,[L]意味着立即停止重写操作，并不再应用其他重写规则。这里的.*是指匹配所有URL中不包含换行字符，()括号的功能是把所有的字符做一个标记，以便于后面的应用.就是引用前面里的(.*)字符。</p> <p>例二.将输入 folio.test.com 的域名时跳转到profile.test.com</p> <p>listen 8080 <br />NameVirtualHost 10.122.89.106:8080 <br />ServerAdmin webmaster@colorme.com.cn <br />DocumentRoot &quot;/usr/local/www/apache22/data1/&quot; <br />ServerName profile.test.com <br />RewriteEngine on <br />RewriteCond %{HTTP_HOST} ^folio.test.com [NC] <br />RewriteRule ^/(.*) http://profile.test.com/ [L]</p> <p><strong>3.Apache mod_rewrite规则重写的标志一览</strong></p> <p>1) R[=code](force redirect) 强制外部重定向 <br />强制在替代字符串加上http://thishost[:thisport]/前缀重定向到外部的URL.如果code不指定，将用缺省的302 HTTP状态码。 <br />2) F(force URL to be forbidden)禁用URL,返回403HTTP状态码。 <br />3) G(force URL to be gone) 强制URL为GONE，返回410HTTP状态码。 <br />4) P(force proxy) 强制使用代理转发。 <br />5) L(last rule) 表明当前规则是最后一条规则，停止分析以后规则的重写。 <br />6) N(next round) 重新从第一条规则开始运行重写过程。 <br />7) C(chained with next rule) 与下一条规则关联</p> <p>如果规则匹配则正常处理，该标志无效，如果不匹配，那么下面所有关联的规则都跳过。</p> <p>8) T=MIME-type(force MIME type) 强制MIME类型 <br />9) NS (used only if no internal sub-request) 只用于不是内部子请求 <br />10) NC(no case) 不区分大小写 <br />11) QSA(query string append) 追加请求字符串 <br />12) NE(no URI escaping of output) 不在输出转义特殊字符 <br />例如：RewriteRule /foo/(.*) /bar?arg=P1\%3d$1 [R,NE] 将能正确的将/foo/zoo转换成/bar?arg=P1=zed <br />13) PT(pass through to next handler) 传递给下一个处理 <br />例如： <br />&#160;&#160; RewriteRule ^/abc(.*) /def$1 [PT] # 将会交给/def规则处理 <br />&#160;&#160; Alias /def /ghi <br />14) S=num(skip next rule(s)) 跳过num条规则 <br />15) E=VAR:VAL(set environment variable) 设置环境变量</p> <p><strong>4.Apache rewrite例子集合</strong></p> <p>&#160;&#160; 在 httpd 中将一个域名转发到另一个域名虚拟主机世界近期更换了域名，新域名为 www.wbhw.com, 更加简短好记。这时需要将原来的域名webhosting-world.com, 以及论坛所在地址 webhosting-world.com/forums/定向到新的域名，以便用户可以找到，并且使原来的论坛 URL 继续有效而不出现 404 未找到，比如原来的http://www.webhosting-world.com/forums/-f60.html, 让它在新的域名下继续有效，点击后转发到http://bbs.wbhw.com/-f60.html, 这就需要用 apache 的 Mod_rewrite 功能来实现。</p> <p>在中添加下面的重定向规则：</p> <p>RewriteEngine On <br /># Redirect webhosting-world.com/forums to bbs.wbhw.com <br />RewriteCond %{REQUEST_URI} ^/forums/ <br />RewriteRule /forums/(.*) http://bbs.wbhw.com/$1 [R=permanent,L] <br /># Redirect webhosting-world.com to wbhw.com <br />RewriteCond %{REQUEST_URI} !^/forums/ <br />RewriteRule /(.*) http://www.wbhw.com/$1 [R=permanent,L]</p> <p>添加了上面的规则以后， 里的全部内容如下：</p> <p>ServerAlias webhosting-world.com <br />ServerAdmin admin@webhosting-world.com <br />DocumentRoot /path/to/webhosting-world/root <br />ServerName www.webhosting-world.com <br />RewriteEngine On <br /># Redirect webhosting-world.com/forums to bbs.wbhw.com <br />RewriteCond %{REQUEST_URI} ^/forums/ <br />RewriteRule /forums/(.*) http://bbs.wbhw.com/$1 [R=permanent,L] <br /># Redirect webhosting-world.com to wbhw.com <br />RewriteCond %{REQUEST_URI} !^/forums/ <br />RewriteRule /(.*) http://www.wbhw.com/$1 [R=permanent,L]</p> <p><strong>URL重定向</strong></p> <p>例子一:</p> <p>1.http://www.zzz.com/xxx.php-&gt; http://www.zzz.com/xxx/ <br />2.http://yyy.zzz.com-&gt; http://www.zzz.com/user.php?username=yyy 的功能 <br />RewriteEngine On <br />RewriteCond %{HTTP_HOST} ^www.zzz.com <br />RewriteCond %{REQUEST_URI} !^user\.php$ <br />RewriteCond %{REQUEST_URI} \.php$ <br />RewriteRule (.*)\.php$ http://www.zzz.com/$1/ [R] <br />RewriteCond %{HTTP_HOST} !^www.zzz.com <br />RewriteRule ^(.+) %{HTTP_HOST} [C] <br />RewriteRule ^([^\.]+)\.zzz\.com http://www.zzz.com/user.php?username=$1</p> <p>例子二：</p> <p>/type.php?typeid=*&#160;&#160; --&gt; /type*.html <br />/type.php?typeid=*&amp;page=*&#160;&#160; --&gt; /type*page*.html <br />RewriteRule ^/type([0-9]+).html$ /type.php?typeid=$1 [PT] <br />RewriteRule ^/type([0-9]+)page([0-9]+).html$ /type.php?typeid=$1&amp;page=$2 [PT]</p> <p><strong>5.使用Apache的URL Rewrite配置多用户虚拟服务器</strong></p> <p>&#160;&#160; 要实现这个功能，首先要在DNS服务器上打开域名的泛域名解析（自己做或者找域名服务商做）。比如，我就把 *.semcase.com和 *.semcase.cn全部解析到了我的这台Linux Server上。</p> <p>然后，看一下我的Apache中关于*.semcase.com的虚拟主机的设定。</p> <p>#*.com,*.osall.net</p> <p>ServerAdmin webmaster@semcase.com <br />DocumentRoot /home/www/www.semcase.com <br />ServerName dns.semcase.com <br />ServerAlias dns.semcase.com semcase.com semcase.net *.semcase.com *.semcase.net <br />CustomLog /var/log/httpd/osa/access_log.log&quot; common <br />&#160;&#160;&#160; ErrorLog /var/log/httpd/osa/error_log.log&quot; <br />AllowOverride None <br />Order deny,allow <br />#AddDefaultCharset GB2312&#160;&#160;&#160; <br />RewriteEngine on&#160;&#160;&#160;&#160;&#160;&#160; <br />RewriteCond %{HTTP_HOST}&#160;&#160;&#160;&#160;&#160;&#160;&#160; ^[^.]+\.osall\.(com|net)$&#160;&#160;&#160;&#160;&#160;&#160; <br />RewriteRule ^(.+)&#160;&#160;&#160;&#160; %{HTTP_HOST}$1&#160;&#160; [C]&#160;&#160;&#160;&#160;&#160;&#160; <br />RewriteRule ^([^.]+)\.osall\.(com|net)(.*)$ <br />/home/www/www.semcase.com/sylvan$3?un=$1&amp;%{QUERY_STRING} [L]</p> <p>在这段设定中，我把*.semcase.net和*.semcase.com 的Document Root都设定到了 /home/www/www.semcase.com</p> <p>但是，继续看下去，看到...配置了吗？在这里我就配置了URL Rewrite规则。 <br />RewriteEngine on #打开URL Rewrite功能 <br />RewriteCond %{HTTP_HOST} ^[^.]+.osall.(com|net)$ #匹配条件，如果用户输入的URL中主机名是类似 xxxx.semcase.com 或者 xxxx.semcase.cn 就执行下面一句 <br />RewriteRule ^(.+) %{HTTP_HOST}$1 [C] #把用户输入完整的地址（GET方式的参数除外）作为参数传给下一个规则，[C]是Chain串联下一个规则的意思 <br />RewriteRule ^([^.]+).osall.(com|net)(.*)$ /home/www/dev.semcase.com/sylvan$3?un=$1&amp;%{QUERY_STRING} [L] <br /># 最关键的是这一句，使用证则表达式解析用户输入的URL地址，把主机名中的用户名信息作为名为un的参数传给/home/www /dev.semcase.com目录下的脚本，并在后面跟上用户输入的GET方式的传入参数。并指明这是最后一条规则（[L]规则）。注意，在这一句中指明的重写后的地址用的是服务器上的绝对路径，这是内部跳转。如果使用http://xxxx这样的URL格式，则被称为外部跳转。使用外部跳转的话，浏览着的浏览器中的URL地址会改变成新的地址，而使用内部跳转则浏览器中的地址不发生改变，看上去更像实际的二级域名虚拟服务器。</p> <p>这样设置后，重启Apache服务器，测试一下，就大功告成了！</p> <p class="read-more">Continue reading <a class="heading" href="/web/2012/02/28/e3-80-90-e8-bd-ac-e3-80-91apache-rewrite-e8-a7-84-e5-88-99-e8-af-a6-e8-a7-a3-e5-be-88-e4-b8-8d-e9-94-99.html" data-flip="title">【转】Apache Rewrite 规则详解(很不错)</a></p> </article> <article id="post-php/web/%E5%AE%89%E5%85%A8/2012/02/28/apache-%e6%80%8e%e6%a0%b7%e7%a6%81%e6%ad%a2%e5%af%b9%e6%9f%90%e7%b1%bb%e5%9e%8b%e6%96%87%e4%bb%b6%e7%9a%84web%e8%ae%bf%e9%97%ae" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/php/web/%E5%AE%89%E5%85%A8/2012/02/28/apache-e6-80-8e-e6-a0-b7-e7-a6-81-e6-ad-a2-e5-af-b9-e6-9f-90-e7-b1-bb-e5-9e-8b-e6-96-87-e4-bb-b6-e7-9a-84web-e8-ae-bf-e9-97-ae.html" data-flip="title"> apache 怎样禁止对某类型文件的web访问 </a> </h1> <p class="post-date heading"> <time datetime="2012-02-28T19:18:47+08:00">28 Feb 2012</time> in <span>Php</span> / <span>Web</span> / <span>安全</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>遇到这个问题，可使用subphp来写规则，但是一般这个模块是没有的，另外一种思路是使用mod_rewrite来将此类型跳转到别的页面就可以了。</p> <p>参见:<a href="http://kazge.com/archives/744.html">http://kazge.com/archives/744.html</a></p> <p class="read-more">Continue reading <a class="heading" href="/php/web/%E5%AE%89%E5%85%A8/2012/02/28/apache-e6-80-8e-e6-a0-b7-e7-a6-81-e6-ad-a2-e5-af-b9-e6-9f-90-e7-b1-bb-e5-9e-8b-e6-96-87-e4-bb-b6-e7-9a-84web-e8-ae-bf-e9-97-ae.html" data-flip="title">apache 怎样禁止对某类型文件的web访问</a></p> </article> <article id="post-linux/web/2012/02/24/linux%e8%bf%9c%e7%a8%8b%e7%ae%a1%e7%90%86%e5%b7%a5%e5%85%b7" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/linux/web/2012/02/24/linux-e8-bf-9c-e7-a8-8b-e7-ae-a1-e7-90-86-e5-b7-a5-e5-85-b7.html" data-flip="title"> linux远程管理工具 </a> </h1> <p class="post-date heading"> <time datetime="2012-02-24T22:24:22+08:00">24 Feb 2012</time> in <span>Linux</span> / <span>Web</span> on <span>Linux</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>shh管理，免费的有putty:</p> <p>如何使用Putty远程(SSH)管理Linux VPS</p> <p><a href="http://www.u-ce.com/topics/lorem-ipsum-dolor-sit-amet-consectetur-adipiscing-elit.html">http://www.u-ce.com/topics/lorem-ipsum-dolor-sit-amet-consectetur-adipiscing-elit.html</a></p> <p>sftp可用filezilla</p> <p>还有我常用的xshell和xftp.</p> <p class="read-more">Continue reading <a class="heading" href="/linux/web/2012/02/24/linux-e8-bf-9c-e7-a8-8b-e7-ae-a1-e7-90-86-e5-b7-a5-e5-85-b7.html" data-flip="title">linux远程管理工具</a></p> </article> <article id="post-html5/2012/02/22/html5-%e5%8f%af%e4%bb%a5%e5%bd%95%e9%9f%b3%e5%bd%95%e5%83%8f%e5%90%97" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/html5/2012/02/22/html5-e5-8f-af-e4-bb-a5-e5-bd-95-e9-9f-b3-e5-bd-95-e5-83-8f-e5-90-97.html" data-flip="title"> html5 可以录音录像吗 </a> </h1> <p class="post-date heading"> <time datetime="2012-02-22T00:27:16+08:00">22 Feb 2012</time> in <span>Html5</span> on <span>录音</span>, <span>摄像</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>html5计划上是可以录音和摄像的,见<a href="http://www.w3.org/TR/html-media-capture/">http://www.w3.org/TR/html-media-capture/</a></p> <p>但这只是规划，还没有那个浏览器支持这个功能，而且api也可能会有很大改动。</p> <p>另外google开源了webRTC,这个似乎比上面的api要实在些，起码chrome,firefox和opera是表明要支持的。</p> <p><a href="http://www.w3.org/TR/webrtc/">http://www.w3.org/TR/webrtc/</a></p> <p class="read-more">Continue reading <a class="heading" href="/html5/2012/02/22/html5-e5-8f-af-e4-bb-a5-e5-bd-95-e9-9f-b3-e5-bd-95-e5-83-8f-e5-90-97.html" data-flip="title">html5 可以录音录像吗</a></p> </article> <article id="post-web/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%AE%89%E5%85%A8/2012/02/21/%e3%80%90%e8%bd%ac%e3%80%91tumblr%ef%bc%9a150%e4%ba%bf%e6%9c%88%e6%b5%8f%e8%a7%88%e9%87%8f%e8%83%8c%e5%90%8e%e7%9a%84%e6%9e%b6%e6%9e%84%e6%8c%91%e6%88%98" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%AE%89%E5%85%A8/2012/02/21/e3-80-90-e8-bd-ac-e3-80-91tumblr-ef-bc-9a150-e4-ba-bf-e6-9c-88-e6-b5-8f-e8-a7-88-e9-87-8f-e8-83-8c-e5-90-8e-e7-9a-84-e6-9e-b6-e6-9e-84-e6-8c-91-e6-88-98.html" data-flip="title"> 【转】Tumblr：150亿月浏览量背后的架构挑战 </a> </h1> <p class="post-date heading"> <time datetime="2012-02-21T23:38:28+08:00">21 Feb 2012</time> in <span>Web</span> / <span>分布式</span> / <span>安全</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>转自:<a href="http://cloud.csdn.net/a/20120214/311806.html">http://cloud.csdn.net/a/20120214/311806.html</a></p> <p> <p><cite><a href="http://cloud.csdn.net/"></a></cite></p> <p> <strong>导读：和许多新兴的网站一样，著名的轻博客服务Tumblr在急速发展中面临了系统架构的瓶颈。每天5亿次浏览量，峰值每秒4万次请求，每天3TB新的数据存储，超过1000台服务器，这样的情况下如何保证老系统平稳运行，平稳过渡到新的系统，Tumblr正面临巨大的挑战。近日，HighScalability网站的Todd Hoff采访了该公司的分布式系统工程师Blake Matheny，<a href="http://highscalability.com/blog/2012/2/13/tumblr-architecture-15-billion-page-views-a-month-and-harder.html">撰文系统介绍了网站的架构</a>，内容很有价值。我们也非常希望国内的公司和团队多做类似分享，贡献于社区的同时，更能提升自身的江湖地位，对招聘、业务发展都好处多多。欢迎通过<a href="http://weibo.com/csdncloud">@CSDN云计算的微博</a>向我们投稿。</strong></p> <p><strong>以下为译文的第一部分</strong>。<strong>第二部分点<a href="http://cloud.csdn.net/a/20120215/311867.html">这里</a></strong>。（括号内小号字为CSDN编辑所注）<strong>：</strong></p> <p>Tumblr每月页面浏览量超过150亿次，已经成为火爆的博客社区。用户也许喜欢它的简约、美丽，对用户体验的强烈关注，或是友好而忙碌的沟通方式，总之，它深得人们的喜爱。</p> <p>每月超过30%的增长当然不可能没有挑战，其中可靠性问题尤为艰巨。每天5亿次浏览量，峰值每秒4万次请求，每天3TB新的数据存储，并运行于超过1000台服务器上，所有这些帮助Tumblr实现巨大的经营规模。<img border="0" alt="" src="/assets/132_120214191209_1.jpg" width="426" height="101" /></p> <p>创业公司迈向成功，都要迈过危险的迅速发展期这道门槛。寻找人才，不断改造基础架构，维护旧的架构，同时要面对逐月大增的流量，而且曾经只有4位工程师。这意味着必须艰难地选择应该做什么，不该做什么。这就是Tumblr的状况。好在现在已经有20位工程师了，可以有精力解决问题，并开发一些有意思的解决方案。</p> <p>Tumblr最开始是非常典型的LAMP应用。目前正在向分布式服务模型演进，该模型基于<a href="http://www.scala-lang.org/">Scala</a>、<a href="http://hbase.apache.org/">HBase</a>、<a href="http://redis.io/">Redis</a>（著名开源K-V存储方案）、<a href="http://incubator.apache.org/kafka/index.html">Kafka</a>（Apache项目，出自LinkedIn的分布式发布-订阅消息系统）、<a href="http://twitter.github.com/finagle/">Finagle</a>（由Twitter开源的容错、协议中立的RPC系统），此外还有一个有趣的基于Cell的架构，用来支持Dashboard（CSDN注：Tumblr富有特色的用户界面，类似于微博的时间轴）。</p> <p>Tumblr目前的最大问题是如何改造为一个大规模网站。系统架构正在从LAMP演进为最先进的技术组合，同时团队也要从小的创业型发展为全副武装、随时待命的正规开发团队，不断创造出新的功能和基础设施。下面就是Blake Matheny对Tumblr系统架构情况的介绍。</p> <h5><strong>网站地址</strong></h5> <p><a href="http://www.tumblr.com/">http://www.tumblr.com/</a></p> <h5><strong>主要数据</strong></h5> <ul> <li>&#160;&#160;&#160; 每天5亿次PV（页面访问量） </li> <li>&#160;&#160;&#160; 每月超过150亿PV </li> <li>&#160;&#160;&#160; 约20名工程师 </li> <li>&#160;&#160;&#160; 峰值请求每秒近4万次 </li> <li>&#160;&#160;&#160; 每天超过1TB数据进入Hadoop集群 </li> <li>&#160;&#160;&#160; MySQL/HBase/Redis/memcache每天生成若干TB数据 </li> <li>&#160;&#160;&#160; 每月增长30% </li> <li>&#160;&#160;&#160; 近1000硬件节点用于生产环境 </li> <li>&#160;&#160;&#160; 平均每位工程师每月负责数以亿计的页面访问 </li> <li>&#160;&#160;&#160; 每天上传大约50GB的文章，每天跟帖更新数据大约2.7TB（CSDN注：这两个数据的比例看上去不太合理，据<a href="https://twitter.com/#!/adamlaiacano/status/169140791732740096">Tumblr数据科学家Adam Laiacano在Twitter上解释</a>，前一个数据应该指的是文章的文本内容和元数据，不包括存储在S3上的多媒体内容）</li> </ul> <h5><strong>软件环境</strong></h5> <ul> <li>&#160;&#160;&#160; 开发使用OS X，生产环境使用Linux（CentOS/Scientific） </li> <li>&#160;&#160;&#160; Apache </li> <li>&#160;&#160;&#160; PHP, Scala, Ruby </li> <li>&#160;&#160;&#160; Redis, HBase, MySQL </li> <li><a href="https://www.varnish-cache.org/">Varnish</a>, <a href="http://haproxy.1wt.eu/">HAProxy</a>, nginx </li> <li>&#160;&#160;&#160; memcache, <a href="http://gearman.org/">Gearman</a>（支持多语言的任务分发应用框架）, Kafka, <a href="https://github.com/robey/kestrel">Kestrel</a>（Twitter开源的分布式消息队列系统）, Finagle </li> <li>&#160;&#160;&#160; Thrift, HTTP </li> <li><a href="http://func.et.redhat.com/">Func</a>——一个安全、支持脚本的远程控制框架和API </li> <li>&#160;&#160;&#160; Git, Capistrano（多服务器脚本部署工具）, Puppet, Jenkins</li> </ul> <h5><strong>硬件环境</strong></h5> <ul> <li>&#160;&#160;&#160; 500台Web服务器 </li> <li>&#160;&#160;&#160; 200台数据库服务器（47 pool，20 shard） </li> <li>&#160;&#160;&#160; 30台memcache服务器 </li> <li>&#160;&#160;&#160; 22台Redis服务器 </li> <li>&#160;&#160;&#160; 15台Varnish服务器 </li> <li>&#160;&#160;&#160; 25台HAproxy节点 </li> <li>&#160;&#160;&#160; 8台nginx服务器 </li> <li>&#160;&#160;&#160; 14台工作队列服务器（Kestrel + Gearman）</li> </ul> <h5><strong>架构</strong></h5> <p>&#160;&#160;&#160; 1. 相对其他社交网站而言，Tumblr有其独特的使用模式：</p> <ul> <li>&#160;&#160;&#160; 每天有超过5千万篇文章更新，平均每篇文章的跟帖又数以百计。用户一般只有数百个粉丝。这与其他社会化网站里少数用户有几百万粉丝非常不同，使得Tumblr的扩展性极具挑战性。 </li> <li>&#160;&#160;&#160; 按用户使用时间衡量，Tumblr已经是排名第二的社会化网站。内容的吸引力很强，有很多图片和视频，文章往往不短，一般也不会太长，但允许写得很长。文章内容往往比较深入，用户会花费更长的时间来阅读。 </li> <li>&#160;&#160;&#160; 用户与其他用户建立联系后，可能会在Dashboard上往回翻几百页逐篇阅读，这与其他网站基本上只是部分信息流不同。 </li> <li>&#160;&#160;&#160; 用户的数量庞大，用户的平均到达范围更广，用户较频繁的发帖，这些都意味着有巨量的更新需要处理。</li> </ul> <p>&#160;&#160;&#160; 2. Tumblr目前运行在一个托管数据中心中，已在考虑地域上的分布性。</p> <p>&#160;&#160;&#160; 3. Tumblr作为一个平台，由两个组件构成：公共Tumblelogs和Dashboard</p> <ul> <li>&#160;&#160;&#160; 公共Tumblelogs与博客类似（此句请Tumblr用户校正），并非动态，易于缓存 </li> <li>&#160;&#160;&#160; Dashboard是类似于Twitter的时间轴,用户由此可以看到自己关注的所有用户的实时更新。与博客的扩展性不同，缓存作用不大，因为每次请求都不同，尤其是活跃的关注者。而且需要实时而且一致，文章每天仅更新50GB，跟帖每天更新2.7TB，所有的多媒体数据都存储在S3上面。 </li> <li>&#160;&#160;&#160; 大多数用户以Tumblr作为内容浏览工具，每天浏览超过5亿个页面，70%的浏览来自Dashboard。 </li> <li>&#160;&#160;&#160; Dashboard的可用性已经不错，但Tumblelog一直不够好，因为基础设施是老的，而且很难迁移。由于人手不足，一时半会儿还顾不上。</li> </ul> <h6>老的架构</h6> <p>Tumblr最开始是托管在Rackspace上的，每个自定义域名的博客都有一个A记录。当2007年Rackspace无法满足其发展速度不得不迁移时，大量的用户都需要同时迁移。所以他们不得不将自定义域名保留在Rackspace，然后再使用HAProxy和Varnish路由到新的数据中心。类似这样的遗留问题很多。</p> <p>开始的架构演进是典型的LAMP路线：</p> <ul> <li>最初用PHP开发，几乎所有程序员都用PHP </li> <li>最初是三台服务器：一台Web，一台数据库，一台PHP </li> <li>为了扩展，开始使用memcache，然后引入前端cache，然后在cache前再加HAProxy，然后是MySQL sharding（非常奏效） </li> <li>采用“在单台服务器上榨出一切”的方式。过去一年已经用C开发了两个后端服务：<a href="http://engineering.tumblr.com/post/10996371189/blake-matheny-id-generation-at-scale">ID生成程序</a>和<a href="http://engineering.tumblr.com/post/7819252942/staircar-redis-powered-notifications">Staircar</a>（用Redis支持Dashboard通知）</li> </ul> <p>Dashboard采用了“扩散-收集”方式。当用户访问Dashboard时将显示事件，来自所关注的用户的事件是通过拉然后显示的。这样支撑了6个月。由于数据是按时间排序的，因此sharding模式不太管用。 </p> <h6>新的架构</h6> <p>由于招人和开发速度等原因，改为<strong>以JVM为中心</strong>。目标是将一切从PHP应用改为服务，使应用变成请求鉴别、呈现等诸多服务之上的薄层。</p> <p>这其中，非常重要的是<strong>选用了Scala和Finagle</strong>。</p> <ul> <li>在团队内部有很多人具备Ruby和PHP经验，所以Scala很有吸引力。 </li> <li>Finagle是选择Scala的重要因素之一。这个来自Twitter的库可以解决大多数分布式问题，比如分布式跟踪、服务发现、服务注册等。 </li> <li>转到JVM上之后，Finagle提供了团队所需的所有基本功能（Thrift, ZooKeeper等），无需再开发许多网络代码，另外，团队成员认识该项目的一些开发者。 </li> <li>Foursquare和Twitter都在用Finagle，Meetup也在用Scala。 </li> <li>应用接口与Thrift类似，性能极佳。 </li> <li>团队本来很喜欢<a href="http://netty.io/">Netty</a>（Java异步网络应用框架，2月4日刚刚发布3.3.1最终版），但不想用Java，Scala是不错的选择。 </li> <li>选择Finagle是因为它很酷，还认识几个开发者。</li> </ul> <p>之所以<strong>没有选择Node.js</strong>，是因为以JVM为基础更容易扩展。Node的发展为时尚短，缺乏标准、最佳实践以及大量久经测试的代码。而用Scala的话，可以使用所有Java代码。虽然其中并没有多少可扩展的东西，也无法解决5毫秒响应时间、49秒HA、4万每秒请求甚至有时每秒40万次请求的问题。但是，Java的生态链要大得多，有很多资源可以利用。</p> <p>内部服务从C/libevent为基础正在转向Scala/Finagle为基础。</p> <p>开始采用新的<strong>NoSQL存储方案</strong>如HBase和Redis。但大量数据仍然存储在大量分区的MySQL架构中，并没有用HBase代替MySQL。HBase主要支持短地址生产程序（数以十亿计）还有历史数据和分析，非常结实。此外，HBase也用于高写入需求场景，比如Dashboard刷新时一秒上百万的写入。之所以还没有替换HBase，是因为不能冒业务上风险，目前还是依靠人来负责更保险，先在一些小的、不那么关键的项目中应用，以获得经验。MySQL和时间序列数据sharding（分片）的问题在于，总有一个分片太热。另外，由于要在slave上插入并发，也会遇到读复制延迟问题。</p> <p>此外，还开发了一个<strong>公用服务框架</strong>：</p> <ul> <li>花了很多时间解决分布式系统管理这个运维问题。 </li> <li>为服务开发了一种Rails scaffolding，内部用模板来启动服务。 </li> <li>所有服务从运维的角度来看都是一样的，所有服务检查统计数据、监控、启动和停止的方式都一样。 </li> <li>工具方面，构建过程围绕<a href="https://github.com/harrah/xsbt/wiki">SBT</a>（一个Scala构建工具），使用插件和辅助程序管理常见操作，包括在Git里打标签，发布到代码库等等。大多数程序员都不用再操心构建系统的细节了。</li> </ul> <p>200台<strong>数据库服务器</strong>中，很多是为了提高可用性而设，使用的是常规硬件，但MTBF（平均故障间隔时间）极低。故障时，备用充足。</p> <p>为了支持PHP应用有6个<strong>后端服务</strong>，并有一个小组专门开发后端服务。新服务的发布需要两到三周，包括Dashboard通知、Dashboard二级索引、短地址生成、处理透明分片的memcache代理。其中在MySQL分片上耗时很多。虽然在纽约本地非常热，但并没有使用MongoDB，他们认为MySQL的可扩展性足够了。</p> <p><strong>Gearman</strong>用于会长期运行无需人工干预的工作。</p> <p>可用性是以达到范围（reach）衡量的。用户能够访问自定义域或者Dashboard吗？也会用错误率。</p> <p>历史上总是解决那些最高优先级的问题，而现在会对故障模式系统地分析和解决，目的是从用户和应用的角度来定成功指标。（后一句原文似乎不全）</p> <p>最开始Finagle是用于Actor模型的，但是后来放弃了。对于运行后无需人工干预的工作，使用任务队列。而且Twitter的<a href="http://twitter.github.com/util/">util工具库</a>中有Future实现，服务都是用Future（Scala中的无参数函数，在与函数关联的并行操作没有完成时，会阻塞调用方）实现的。当需要线程池的时候，就将Future传入Future池。一切都提交到Future池进行异步执行。</p> <p>Scala提倡无共享状态。由于已经在Twitter生产环境中经过测试，Finagle这方面应该是没有问题的。使用Scala和Finagle中的结构需要避免可变状态，不使用长期运行的状态机。状态从数据库中拉出、使用再写回数据库。这样做的好处是，开发人员不需要操心线程和锁。</p> <p>22台<strong>Redis</strong>服务器，每台的都有8-32个实例，因此线上同时使用了100多个Redis实例。</p> <ul> <li>Redis主要用于Dashboard通知的后端存储。 </li> <li>所谓通知就是指某个用户like了某篇文章这样的事件。通知会在用户的Dashboard中显示，告诉他其他用户对其内容做了哪些操作。 </li> <li>高写入率使MySQL无法应对。 </li> <li>通知转瞬即逝，所以即使遗漏也不会有严重问题，因此Redis是这一场景的合适选择。 </li> <li>这也给了开发团队了解Redis的机会。 </li> <li>使用中完全没有发现Redis有任何问题，社区也非常棒。 </li> <li>开发了一个基于Scala Futures的Redis接口，该功能现在已经并入了Cell架构。 </li> <li>短地址生成程序使用Redis作为一级Cache，HBase作为永久存储。 </li> <li>Dashboard的二级索引是以Redis为基础开发的。 </li> <li>Redis还用作Gearman的持久存储层，使用Finagle开发的memcache代理。 </li> <li>正在缓慢地从memcache转向Redis。希望最终只用一个cache服务。性能上Redis与memcache相当。</li> </ul> <p>（先到这里吧，敬请期待下篇，包括如何用Kafaka、Scribe、Thrift实现内部活动流，Dashboard的Cell架构，开发流程和经验教训等精彩内容。）</p> <p>翻译：包研，张志平，刘江；审校：刘江</p> <p>&#160;</p> <p>---</p> <p><strong>内部的firehose</strong><strong>(通信管道)</strong></p> <ul> <li>内部的应用需要活跃的信息流通道。这些信息包括用户创建/删除的信息，liking/unliking的提示，等等。挑战在于这些数据要实时的分布式处理。我们希望能够检测内部运行状况，应用的生态系统能够可靠的生长，同时还需要建设分布式系统的控制中心。 </li> <li>以前，这些信息是基于Scribe(Facebook开源的分布式日志系统。)/Hadoop的分布式系统。服务会先记录在Scribe中，并持续的长尾形式写入，然后将数据输送给应用。这种模式可以立即停止伸缩，尤其在峰值时每秒要创建数以千计的信息。不要指望人们会细水长流式的发布文件和grep。 </li> <li>内部的firehose就像装载着信息的大巴，各种服务和应用通过<a href="http://thrift.apache.org/">Thrift</a>与消防管线沟通。(一个可伸缩的跨语言的服务开发框架。) </li> <li>LinkedIn的Kafka用于存储信息。内部人员通过HTTP链接firehose。经常面对巨大的数据冲击，采用MySQL显然不是一个好主意，分区实施越来越普遍。 </li> <li>firehose的模型是非常灵活的，而不像Twitter的firehose那样数据被假定是丢失的。 </li> <li>&#160;&#160;&#160; firehose的信息流可以及时的回放。他保留一周内的数据，可以调出这期间任何时间点的数据。 </li> <li>&#160;&#160;&#160; 支持多个客户端连接，而且不会看到重复的数据。每个客户端有一个ID。Kafka支持客户群，每个群中的客户都用同一个ID，他们不会读取重复的数据。可以创建多个客户端使用同一个ID，而且不会看到重复的数据。这将保证数据的独立性和并行处理。Kafka使用ZooKeeper(Apache推出的开源分布式应用程序协调服务。)定期检查用户阅读了多少。</li> </ul> <p><strong>为Dashboard收件箱设计的Cell架构</strong></p> <ul> <li>现在支持Dashboard的功能的分散-集中架构非常受限，这种状况不会持续很久。 </li> <li>&#160;&#160;&#160; 解决方法是采用基于Cell架构的收件箱模型，与<a href="http://cloud.csdn.net/a/20120215/www.facebook.com/note.php?note_id=454991608919">Facebook Messages</a>非常相似。 </li> <li>&#160;&#160;&#160; 收件箱与分散-集中架构是对立的。每一位用户的dashboard都是由其追随者的发言和行动组成的，并按照时间顺序存储。 </li> <li>&#160;&#160;&#160; 就因为是收件箱就解决了分散-集中的问题。你可以会问到底在收件箱中放了些什么，让其如此廉价。这种方式将运行很长时间。</li> </ul> <ul> <li>重写Dashboard非常困难。数据已经分布，但是用户局部升级产生的数据交换的质量还没有完全搞定。 </li> <li>&#160;&#160;&#160; 数据量是非常惊人的。平均每条消息转发给上百个不同的用户，这比Facebook面对的困难还要大。大数据+高分布率+多个数据中心。 </li> <li>&#160;&#160;&#160; 每秒钟上百万次写入，5万次读取。没有重复和压缩的数据增长为2.7TB，每秒百万次写入操作来自24字节行键。 </li> <li>&#160;&#160;&#160; 已经流行的应用按此方法运行。</li> </ul> <ul> <li>cell </li> <li>&#160;&#160;&#160; 每个cell是独立的，并保存着一定数量用户的全部数据。在用户的Dashboard中显示的所有数据也在这个cell中。 </li> <li>&#160;&#160;&#160; 用户映射到cell。一个数据中心有很多cell。 </li> <li>&#160;&#160;&#160; 每个cell都有一个HBase的集群，服务集群，Redis的缓存集群。 </li> <li>&#160;&#160;&#160; 用户归属到cell，所有cell的共同为用户发言提供支持。 </li> <li>&#160;&#160;&#160; 每个cell都基于<a href="https://github.com/twitter/finagle">Finagle</a>（Twitter推出的异步的远程过程调用库），建设在HBase上，Thrift用于开发与firehose和各种请求与数据库的链接。(<strong>请纠错</strong>) </li> <li>&#160;&#160;&#160; 一个用户进入Dashboard，其追随者归属到特定的cell，这个服务节点通过HBase读取他们的dashboard并返回数据。 </li> <li>&#160;&#160;&#160; 后台将追随者的dashboard归入当前用户的table，并处理请求。 </li> <li>&#160;&#160;&#160; Redis的缓存层用于cell内部处理用户发言。</li> </ul> <ul> <li>请求流：用户发布消息，消息将被写入firehose，所有的cell处理这条消息并把发言文本写入数据库，cell查找是否所有发布消息追随者都在本cell内，如果是的话，所有追随者的收件箱将更新用户的ID。（<strong>请纠错</strong>）</li> </ul> <ul> <li>cell设计的优点： </li> <li>&#160;&#160;&#160; 大规模的请求被并行处理，组件相互隔离不会产生干扰。 cell是一个并行的单位，因此可以任意调整规格以适应用户群的增长。 </li> <li>&#160;&#160;&#160; cell的故障是独立的。一个Cell的故障不会影响其他cell。 </li> <li>&#160;&#160;&#160; cell的表现非常好，能够进行各种升级测试，实施滚动升级，并测试不同版本的软件。</li> </ul> <ul> <li>关键的思想是容易遗漏的：所有的发言都是可以复制到所有的cell。 </li> <li>&#160;&#160;&#160; 每个cell中存储的所有发言的单一副本。 每个cell可以完全满足Dashboard呈现请求。应用不用请求所有发言者的ID，只需要请求那些用户的ID。(<strong>“那些用户”所指不清，请指正。</strong>)他可以在dashboard返回内容。每一个cell都可以满足Dashboard的所有需求，而不需要与其他cell进行通信。 </li> <li>&#160;&#160;&#160; 用到两个HBase table ：一个table用于存储每个发言的副本，这个table相对较小。在cell内，这些数据将与存储每一个发言者ID。第二个table告诉我们用户的dashboard不需要显示所有的追随者。当用户通过不同的终端访问一个发言，并不代表阅读了两次。收件箱模型可以保证你阅读到。 </li> <li>&#160;&#160;&#160; 发言并不会直接进入到收件箱，因为那实在太大了。所以，发言者的ID将被发送到收件箱，同时发言内容将进入cell。这个模式有效的减少了存储需求，只需要返回用户在收件箱中浏览发言的时间。而缺点是每一个cell保存所有的发言副本。令人惊奇的是，所有发言比收件箱中的镜像要小。(<strong>请纠错</strong>)每天每个cell的发言增长50GB，收件箱每天增长2.7TB。用户消耗的资源远远超过他们制造的。 </li> <li>&#160;&#160;&#160; 用户的dashboard不包含发言的内容，只显示发言者的ID，主要的增长来自ID。(<strong>请Tumblr用户纠错</strong>) </li> <li>&#160;&#160;&#160; 当追随者改变时，这种设计方案也是安全的。因为所有的发言都保存在cell中了。如果只有追随者的发言保存在cell中，那么当追随者改变了，将需要一些回填工作。 </li> <li>&#160;&#160;&#160; 另外一种设计方案是采用独立的发言存储集群。这种设计的缺点是，如果群集出现故障，它会影响整个网站。因此，使用cell的设计以及后复制到所有cell的方式，创建了一个非常强大的架构。</li> </ul> <ul> <li>一个用户拥有上百万的追随者，这带来非常大的困难，有选择的处理用户的追随者以及他们的存取模式（见<a href="http://highscalability.com/blog/2012/1/17/paper-feeding-frenzy-selectively-materializing-users-event-f.html">Feeding Frenzy</a>） </li> <li>&#160;&#160;&#160; 不同的用户采用不同并且恰当的存取模式和分布模型，两个不同的分布模式包括：一个适合受欢迎的用户，一个使用大众。 </li> <li>&#160;&#160;&#160; 依据用户的类型采用不同的数据处理方式，活跃用户的发言并不会被真正发布，发言将被有选择的体现。(果真如此？<strong>请Tumblr用户纠错</strong>) </li> <li>&#160;&#160;&#160; 追随了上百万用户的用户，将像拥有上百万追随者的用户那样对待。</li> </ul> <ul> <li>cell的大小非常难于决定。cell的大小直接影响网站的成败。每个cell归于的用户数量是影响力之一。需要权衡接受怎样的用户体验，以及为之付出多少投资。</li> </ul> <ul> <li>从firehose中读取数据将是对网络最大的考验。在cell内部网络流量是可管理的。</li> </ul> <ul> <li>当更多cell被增添到网络中来，他们可以进入到cell组中，并从firehose中读取数据。一个分层的数据复制计划。这可以帮助迁移到多个数据中心。</li> </ul> <p><strong>在纽约启动运作</strong></p> <ul> <li>纽约具有独特的环境，资金和广告充足。招聘极具挑战性，因为缺乏创业经验。 </li> <li>在过去的几年里，纽约一直致力于推动创业。纽约大学和哥伦比亚大学有一些项目，鼓励学生到初创企业实习，而不仅仅去华尔街。市长建立了一所学院，侧重于技术。</li> </ul> <p><strong>团队架构</strong></p> <ul> <li>团队：基础架构，平台，SRE，产品，web ops，服务； </li> <li>基础架构：5层以下，IP地址和DNS，硬件配置； </li> <li>平台：核心应用开发，SQL分片，服务，Web运营； </li> <li>SRE：在平台和产品之间，侧重于解决可靠性和扩展性的燃眉之急； </li> <li>服务团队：相对而言更具战略性， </li> <li>Web ops：负责问题检测、响应和优化。</li> </ul> <p><strong>软件部署</strong></p> <ul> <li>开发了一套rsync脚本，可以随处部署PHP应用程序。一旦机器的数量超过200台，系统便开始出现问题，部署花费了很长时间才完成，机器处于部署进程中的各种状态。 </li> <li>接下来，使用Capistrano（一个开源工具，可以在多台服务器上运行脚本）在服务堆栈中构建部署进程（开发、分期、生产）。在几十台机器上部署可以正常工作，但当通过SSH部署到数百台服务器时，再次失败。 </li> <li>现在，所有的机器上运行一个协调软件。基于Redhat Func（一个安全的、脚本化的远程控制框架和接口）功能，一个轻量级的API用于向主机发送命令，以构建扩展性。 </li> <li>建立部署是在Func的基础上向主机发送命令，避免了使用SSH。比如，想在组A上部署软件，控制主机就可以找出隶属于组A的节点，并运行部署命令。 </li> <li>部署命令通过Capistrano实施。 <p>&#160;&#160;&#160; Func API可用于返回状态报告，报告哪些机器上有这些软件版本。</p> </li> <li>安全重启任何服务，因为它们会关闭连接，然后重启。 </li> <li>在激活前的黑暗模式下运行所有功能。</li> </ul> <p><strong>展望</strong></p> <ul> <li>从哲学上将，任何人都可以使用自己想要的任意工具。但随着团队的发展壮大，这些工具出现了问题。新员工想要更好地融入团队，快速地解决问题，必须以他们为中心，建立操作的标准化。 </li> <li>过程类似于Scrum（一种敏捷管理框架），非常敏捷。 </li> <li>每个开发人员都有一台预配置的开发机器，并按照控制更新。 </li> <li>开发机会出现变化，测试，分期，乃至用于生产。 </li> <li>开发者使用VIM和TextMate。 </li> <li>测试是对PHP程序进行代码审核。 </li> <li>在服务方面，他们已经实现了一个与提交相挂钩的测试基础架构，接下来将继承并内建通知机制。</li> </ul> <p><strong>招聘流程</strong></p> <ul> <li>面试通常避免数学、猜谜、脑筋急转弯等问题，而着重关注应聘者在工作中实际要做什么。 </li> <li>着重编程技能。 </li> <li>面试不是比较，只是要找对的人。 </li> <li>挑战在于找到具有可用性、扩展性经验的人才，以应对Tumblr面临的网络拥塞。 </li> <li>在Tumblr工程博客（Tumblr Engineering Blog），他们对已过世的Dennis Ritchie和John McCarthy予以纪念。</li> </ul> <p><strong>经验及教训</strong></p> <ul> <li>自动化无处不在 </li> <li>MySQL（增加分片）规模，应用程序暂时还不行 </li> <li>Redis总能带给人惊喜 </li> <li>基于Scala语言的应用执行效率是出色的 </li> <li>废弃项目——当你不确定将如何工作时 </li> <li>不顾用在他们发展经历中没经历过技术挑战的人，聘用有技术实力的人是因为他们能适合你的团队以 及工作。 </li> <li>选择正确的软件集合将会帮助你找到你需要的人 </li> <li>建立团队的技能 </li> <li>阅读文档和博客文章。 </li> <li>多与同行交流，可以接触一些领域中经验丰富的人，例如与在Facebook、Twitter、LinkedIn的工程师 多交流，从他们身上可以学到很多 </li> <li>对技术要循序渐进，在正式投入使用之前他们煞费苦心的学习HBase和Redis。同时在试点项目中使用 或将其控制在有限损害范围之内。</li> </ul> <p>翻译：包研，张志平</p> <p class="read-more">Continue reading <a class="heading" href="/web/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%AE%89%E5%85%A8/2012/02/21/e3-80-90-e8-bd-ac-e3-80-91tumblr-ef-bc-9a150-e4-ba-bf-e6-9c-88-e6-b5-8f-e8-a7-88-e9-87-8f-e8-83-8c-e5-90-8e-e7-9a-84-e6-9e-b6-e6-9e-84-e6-8c-91-e6-88-98.html" data-flip="title">【转】Tumblr：150亿月浏览量背后的架构挑战</a></p> </article> <article id="post-web/web%E5%89%8D%E7%AB%AF/2012/02/20/%e3%80%90%e8%bd%ac%e3%80%91%e8%b0%83%e7%94%a8sina%e8%82%a1%e7%a5%a8%e6%95%b0%e6%8d%ae" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web/web%E5%89%8D%E7%AB%AF/2012/02/20/e3-80-90-e8-bd-ac-e3-80-91-e8-b0-83-e7-94-a8sina-e8-82-a1-e7-a5-a8-e6-95-b0-e6-8d-ae.html" data-flip="title"> 【转】调用Sina股票数据 </a> </h1> <p class="post-date heading"> <time datetime="2012-02-20T21:41:20+08:00">20 Feb 2012</time> in <span>Web</span> / <span>Web前端</span> on <span>Sinajs</span>, <span>Stock</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <h5>转自 <a href="http://yuanliyin.iteye.com/blog/848988">调用Sina股票数据</a><em></em></h5> <p><a href="http://www.iteye.com/blogs/tag/JavaScript"></a></p> <p>sina股票数据接口 <br />以大秦铁路（股票代码：601006）为例，如果要获取它的最新行情，只需访问新浪的股票数据 <br />接口：http://hq.sinajs.cn/list=sh601006这个url会返回一串文本，例如： <br />var hq_str_sh601006=&quot;大秦铁路, 27.55, 27.25, 26.91, 27.55, 26.20, 26.91, 26.92, <br />22114263, 589824680, 4695, 26.91, 57590, 26.90, 14700, 26.89, 14300, <br />26.88, 15100, 26.87, 3100, 26.92, 8900, 26.93, 14230, 26.94, 25150, 26.95, <br />15220, 26.96, 2008-01-11, 15:05:32&quot;; <br />这个字符串由许多数据拼接在一起，不同含义的数据用逗号隔开了，按照程序员的思路，顺序号从0开始。 <br />0：”大秦铁路”，股票名字； <br />1：”27.55″，今日开盘价； <br />2：”27.25″，昨日收盘价； <br />3：”26.91″，当前价格； <br />4：”27.55″，今日最高价； <br />5：”26.20″，今日最低价； <br />6：”26.91″，竞买价，即“买一”报价； <br />7：”26.92″，竞卖价，即“卖一”报价； <br />8：”22114263″，成交的股票数，由于股票交易以一百股为基本单位，所以在使用时，通常把该值除以一百； <br />9：”589824680″，成交金额，单位为“元”，为了一目了然，通常以“万元”为成交金额的单位，所以通常把该值除以一万； <br />10：”4695″，“买一”申请4695股，即47手； <br />11：”26.91″，“买一”报价； <br />12：”57590″，“买二” <br />13：”26.90″，“买二” <br />14：”14700″，“买三” <br />15：”26.89″，“买三” <br />16：”14300″，“买四” <br />17：”26.88″，“买四” <br />18：”15100″，“买五” <br />19：”26.87″，“买五” <br />20：”3100″，“卖一”申报3100股，即31手； <br />21：”26.92″，“卖一”报价 <br />(22, 23), (24, 25), (26,27), (28, 29)分别为“卖二”至“卖四的情况” <br />30：”2008-01-11″，日期； <br />31：”15:05:32″，时间； <br />这个接口对于JavaScript程序非常方便，通常的使用方式为，静态或动态地在页面中插入： <br />&lt;script src=&quot;http://hq.sinajs.cn/list=sh601006&quot; type=&quot;text/javascript&quot;&gt;&lt;!--mce:0--&gt;&lt;/script&gt; <br />&lt;script type=&quot;text/javascript&quot;&gt;&lt;!--mce:1--&gt;&lt;/script&gt; <br />这段代码输出大秦铁路（股票代码：601006）的当前股价 <br />current price:14.20 <br />如果你要同时查询多个股票，那么在URL最后加上一个逗号，再加上股票代码就可以了；比如你要一次查询大秦铁路（601006）和大同煤业（601001）的行情，就这样使用URL： <br />http://hq.sinajs.cn/list=sh601003,sh601001 <br />但如果你要查询大盘指数，情况会有不同，比如查询上证综合指数（000001），使用如下URL： <br />http://hq.sinajs.cn/list=s_sh000001 服务器返回的数据为： <br />var hq_str_s_sh000001=”上证指数,3094.668,-128.073,-3.97,436653,5458126″; <br />数据含义分别为：指数名称，当前点数，当前价格，涨跌率，成交量（手），成交额（万元）； <br />查询深圳成指的URL为： <br />http://hq.sinajs.cn/list=s_sz399001 <br />对于股票的K线图，日线图等的获取可以通过请求http://image.sinajs.cn/…./…/*.gif此URL获取，其中*代表股票代码，详见如下： <br />查看日K线图： <br />http://image.sinajs.cn/newchart/daily/n/sh601006.gif <br />分时线的查询： <br />http://image.sinajs.cn/newchart/min/n/sh000001.gif <br />日K线查询： <br />http://image.sinajs.cn/newchart/daily/n/sh000001.gif <br />周K线查询： <br />http://image.sinajs.cn/newchart/weekly/n/sh000001.gif <br />月K线查询： <br />http://image.sinajs.cn/newchart/monthly/n/sh000001.gif</p> <p><font color="#0000ff">深成指：&lt;script type=&quot;text/javascript&quot; src=&quot;http://hq.sinajs.cn/list=sz399001&quot; charset=&quot;gb2312&quot;&gt;&lt;/script&gt; <br />上证指：&lt;script type=&quot;text/javascript&quot; src=&quot;http://hq.sinajs.cn/list=sh000001&quot; charset=&quot;gb2312&quot;&gt;&lt;/script&gt; <br />道琼斯：&lt;script type=&quot;text/javascript&quot; src=&quot;http://hq.sinajs.cn/list=int_dji&quot; charset=&quot;gb2312&quot;&gt;&lt;/script&gt; <br />纳斯达克：&lt;script type=&quot;text/javascript&quot; src=&quot;http://hq.sinajs.cn/list=int_nasdaq&quot; charset=&quot;gb2312&quot;&gt;&lt;/script&gt; <br />恒生指：&lt;script type=&quot;text/javascript&quot; src=&quot;http://hq.sinajs.cn/list=int_hangseng&quot; charset=&quot;gb2312&quot;&gt;&lt;/script&gt; <br />日经指数：&lt;script type=&quot;text/javascript&quot; src=&quot;http://hq.sinajs.cn/list=int_nikkei&quot; charset=&quot;gb2312&quot;&gt;&lt;/script&gt; <br />台湾加权：&lt;script type=&quot;text/javascript&quot; src=&quot;http://hq.sinajs.cn/list=b_TWSE&quot; charset=&quot;gb2312&quot;&gt;&lt;/script&gt; <br />新加坡：&lt;script type=&quot;text/javascript&quot; src=&quot;http://hq.sinajs.cn/list=b_FSSTI&quot; charset=&quot;gb2312&quot;&gt;&lt;/script&gt; <br /></font>转自：http://nerrsoft.com/259.html</p> <p class="read-more">Continue reading <a class="heading" href="/web/web%E5%89%8D%E7%AB%AF/2012/02/20/e3-80-90-e8-bd-ac-e3-80-91-e8-b0-83-e7-94-a8sina-e8-82-a1-e7-a5-a8-e6-95-b0-e6-8d-ae.html" data-flip="title">【转】调用Sina股票数据</a></p> </article> <h2 class="sr-only">Pagination</h2> <nav class="pagination heading" role="navigation"> <ul> <li class="pagination-item older" > <a rel="next" href="/page-23/">Older</a> </li> <li class="pagination-item newer" > <a rel="prev" href="/page-21/">Newer</a> </li> </ul> </nav> <footer> <hr/> <p>© 2011 - 2017. All rights reserved.</p> <p> <code>Powered by <a href="https://qwtel.com/hydejack/">Hydejack</a> v<span id="_version">6.6.1</span></code> </p> </footer> </main> </div> <div id="_yDrawer"> <div id="_sidebar" class="sidebar"> <div class="sidebar-bg" style="background-color:#4f86aa;background-image:url()"></div> <header class="sidebar-sticky" role="banner"> <div class="sidebar-about"> <img src="https://avatars0.githubusercontent.com/u/4122902?v=4&s=460" class="me" /> </div> <div class="sidebar-about"> <h1><a id="_title" href="/">Ka's Blog</a></h1> <p>Ka’s blog description…</p> </div> <nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span> <ul> <li> <a class="sidebar-nav-item" href="/categories.html">Categories</a> </li> <li> <a class="sidebar-nav-item" href="/archive.html">Archive</a> </li> <li> <a class="sidebar-nav-item" href="/tags.html">Tags</a> </li> <li> <a class="sidebar-nav-item" href="/about.html">About</a> </li> </ul> </nav> <div class="sidebar-social"> <span class="sr-only">Social:</span> <ul> <li> <a href="https://twitter.com/imhazige" title="Twitter"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a> </li> <li> <a href="https://github.com/imhazige" title="GitHub"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a> </li> <li> <a href="mailto:imhazige@gmail.com" title="Email"> <span class="icon-mail"></span> <span class="sr-only">Email</span> </a> </li> <li> <a href="https://imhazige.github.io/myblog/feed.xml" title="RSS"> <span class="icon-rss2"></span> <span class="sr-only">RSS</span> </a> </li> </ul> </div> </header> </div> </div> </div> <!--[if gt IE 9]><!----> <script>loadJSDeferred('/assets/js/hydejack.js?v=6.6.1');</script> <!--<![endif]--> </body>
</html>
