<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v6.6.1 <https://qwtel.com/hydejack/>
--><head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="format-detection" content="telephone=no"> <meta http-equiv="x-ua-compatible" content="ie=edge"> <title>Ka's Blog &middot; Ka's Blog</title> <meta name="description" content="Ka’s blog description… "> <link rel="canonical" href="http://localhost:4000/page-69/"> <link rel="alternate" type="application/atom+xml" title="Ka's Blog Feed" href="http://localhost:4000/feed.xml"> <link rel="apple-touch-icon" href="/apple-touch-icon.png"> <!-- Place favicon.ico in the root directory --> <link rel="stylesheet" href="/assets/style.css"> <link id="_katexJS" rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.js"> <link id="_katexCSS" rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css"> <!--[if gt IE 8]><!----> <script> WebFontConfig = { google: { families: 'Roboto+Slab:700|Noto+Sans:400,400i,700,700i'.split('|') }, custom: { families: ['icomoon'], urls: ['/assets/icomoon/style.css'] } }; </script> <!--<![endif]--> <script> !function(n,e){function t(n,e){n.onload=function(){this.onerror=this.onload=null,e(null,n)},n.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),n)}}function o(n,e){n.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,e(null,n))}}n._loaded=!1,n.loadJSDeferred=function(a,d){function r(){n._loaded=!0;var r=e.createElement("script");r.src=a,d&&(("onload"in r?t:o)(r,d),r.onload||t(r,d));var l=e.getElementsByTagName("script")[0];l.parentNode.insertBefore(r,l)}n._loaded?r():n.addEventListener?n.addEventListener("load",r,!1):n.attachEvent?n.attachEvent("onload",r):n.onload=r}}(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); window.disablePushState = false; window.disableDrawer = false; </script> <!--[if lt IE 9]> <script src="/assets/bower_components/html5shiv/dist/html5shiv.min.js"></script> <![endif]--> <!--[if gt IE 8]><!----> <style> article, aside, dialog, figcaption, figure, footer, header, hgroup, main, nav, section { display: block; } mark { background: #FF0; color: #000; } * { box-sizing: border-box; } html, body { margin: 0; padding: 0; } html { font-size: 16px; line-height: 1.75; } body { color: #333; background-color: #fff; overflow-y: scroll; } a { text-decoration: none; } .lead { margin-left: -1rem; margin-right: -1rem; } img, .img { display: block; max-width: 100%; margin-bottom: 1rem; border: none; } img.lead, .img.lead { max-width: calc(100% + 2rem); width: calc(100% + 2rem); } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-weight: bold; text-rendering: optimizeLegibility; } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 { margin: 3rem 0 1rem; line-height: 1.6; } h1, .h1 { font-size: 2rem; line-height: 1.25; } h2, .h2 { font-size: 1.5rem; } h3, .h3 { font-size: 1.17em; } p { margin-top: 0; margin-bottom: 1rem; } p.lead { font-size: 1.25rem; font-weight: 300; padding: 0 1rem; } ul, ol, dl { margin-top: 0; margin-bottom: 1rem; } ul, ol { padding-left: 1.25rem; } hr { position: relative; margin: 1.5rem 0; border: 0; border-top: 1px solid #eee; } .hr { padding-bottom: .5rem; border-bottom: 1px solid #eee; margin-bottom: 1.5rem; } h4, h5, h6, .h4, .h5, .h6 { margin-bottom: 0.5rem; font-size: 1rem; } table { margin-bottom: 1rem; width: 100%; width: calc(100% + 2rem); margin-left: -1rem; border: 1px solid #e5e5e5; border-collapse: collapse; border-spacing: 0; } td, th { padding: .25rem .5rem; border: 1px solid #e5e5e5; } td:first-child, th:first-child { padding-left: 1rem; } td:last-child, th:last-child { padding-right: 1rem; } thead + tbody, tbody + tbody, tfoot { border-top: 3px double #e5e5e5; } tbody tr:nth-child(odd) td, tbody tr:nth-child(odd) th { background-color: #f9f9f9; } footer { margin-bottom: 2rem; } .page, .post { margin-bottom: 3em; } .page li + li, .post li + li { margin-top: .25rem; } .page > header, .post > header { margin-bottom: 2rem; } .page-title, .post-title { margin-top: 0; } .post-date { display: block; margin-top: -0.5rem; margin-bottom: 1rem; color: #9a9a9a; } .related-posts { padding-left: 0; list-style: none; } .related-posts > li, .related-posts > li + li { margin-top: 1rem; } .related-posts > li > small, .related-posts > li + li > small { font-size: 75%; color: #9a9a9a; } .message { margin-bottom: 1rem; padding: 1rem; color: #787878; background-color: #f9f9f9; margin-left: -1rem; margin-right: -1rem; } /* * Global resets * * Update the foundational and global aspects of the page. */ body, main { /* Prevent side-scrolling on mobile */ position: relative; overflow-x: hidden; } @media screen { body::before { content: ''; width: .5rem; background: #e5e5e5; position: absolute; left: 0; top: 0; bottom: 0; } } @media screen and (min-width: 40em) { html { font-size: 17px; } } @media screen and (min-width: 54em) { html { font-size: 16px; } } @media screen and (min-width: 72em) { html { font-size: 17px; } } @media screen and (min-width: 125em) { html { font-size: 18px; } } .sr-only { display: none; } .clearfix, .sidebar-social::after, .clearafter::after { content: ""; display: table; clear: both; } a, .a { position: relative; padding-bottom: .15rem; border-bottom: 1px solid; } .img { overflow: hidden; background-color: #f9f9f9; } .img > img { margin: 0; width: 100%; height: 100%; } .sixteen-nine { position: relative; } .sixteen-nine::before { display: block; content: ""; width: 100%; padding-top: 56.25%; } .sixteen-nine > * { position: absolute; top: 0; left: 0; right: 0; bottom: 0; } h1 + hr, h2 + hr, h3 + hr, h4 + hr, h5 + hr, h6 + hr { margin-top: 0; } .fade-in { animation-duration: 500ms; animation-name: fade-in; animation-fill-mode: forwards; } @keyframes fade-in { from { transform: translateY(-2rem); opacity: 0; } 50% { transform: translateY(-2rem); opacity: 0; } to { transform: translateY(0); opacity: 1; } } .mb6 { margin-bottom: 6rem; } .sidebar { color: rgba(255, 255, 255, 0.75); text-align: left; /* Sidebar links */ } .sidebar::before { /* make sidebar slightly darker to increase text readability (when using a background image) */ content: ""; position: absolute; z-index: 2; top: 0; left: 0; bottom: 0; right: 0; background: linear-gradient(to bottom, rgba(32, 32, 32, 0) 0%, rgba(32, 32, 32, 0.5) 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */ } .sidebar a { color: #fff; border-bottom-color: rgba(255, 255, 255, 0.2); } #_yDrawer { position: relative; padding: 1rem 0; } @media screen { #_yDrawer { padding: 2rem 1rem; min-height: 640px; min-height: 100vh; } } @media screen and (min-width: 54em) { #_yDrawer { position: fixed; top: 0; left: 0; bottom: 0; width: 18rem; margin-left: 0; } } @media screen and (min-width: 97.5em) { #_yDrawer { width: calc(50% - 28rem); } } @media screen { #_yDrawer.loaded { min-height: 0; padding: 0; } } .sidebar-bg { position: absolute; top: 0; right: 0; bottom: 0; left: 0; background: #202020 center / cover; } .sidebar-sticky { position: relative; z-index: 3; } @media screen { .sidebar-sticky { position: absolute; right: 2rem; bottom: 1rem; left: auto; max-width: 14rem; } } @media print { .sidebar-sticky { padding: 0 2rem; } } /* About section */ .sidebar-about > h1 { color: #fff; font-size: 2rem; } .sidebar-nav > ul { list-style: none; padding-left: 0; margin-bottom: .5rem; } a.sidebar-nav-item { font-weight: bold; display: block; line-height: 1.75; padding: .25rem 0; border-bottom: 1px solid rgba(255, 255, 255, 0.2); } @media screen { .y-drawer-scrim { z-index: 2; } .y-drawer-content { width: 18rem; left: -17.5rem; z-index: 3; } } @media screen and (min-width: 97.5em) { .y-drawer-content { width: calc(50% - 28rem); } } .sidebar-social { margin-bottom: .5rem; } .sidebar-social > ul { list-style: none; padding-left: 0; margin: 0 -.25rem; } .sidebar-social > ul > li { float: left; margin: 0 .25rem; } .sidebar-social > ul > li > a { display: inline-block; text-align: center; font-size: 1.6rem; line-height: 3rem; width: 3.1249rem; height: 4rem; padding: .5rem 0; } .sidebar-social > ul li + li { margin-top: 0; } .fixed-top { position: fixed; top: 0; left: 0; width: 100%; z-index: 1; } .navbar > .content { padding-top: 0; padding-bottom: 0; min-height: 0; height: 0; } .menu { display: inline-block; padding: 1.75rem 1.5rem; border-bottom: none; margin-left: -1.5rem; color: #9a9a9a !important; } .menu::after { content: "\2630"; } @media screen and (min-width: 54em) { .menu { padding: 1.25rem 1.5rem; position: absolute; left: -9999px; } .menu:focus { position: static; } } .animation-main { pointer-events: none; } .loading { display: none; } @media print { .menu { display: none; } } .animation-main { opacity: 0; will-change: opacity; } .loading { position: absolute; top: 0; right: 0; padding: 5.25rem 4.5rem; transform-origin: top right; transform: scale(0.33); } .content { position: relative; margin-left: auto; margin-right: auto; padding: 5rem 1rem 12rem; } @media screen { .content { max-width: 38rem; padding-left: 1.5rem; min-height: 100vh; } } @media screen and (min-width: 54em) { .content { max-width: 42rem; padding: 4rem 1rem 12rem; margin-left: 22rem; margin-right: 4rem; } } @media screen and (min-width: 72em) { .content { margin-left: 22rem; margin-right: 4rem; } } @media screen and (min-width: 92em) { .content { max-width: 48rem; } } @media screen and (min-width: 97.5em) { .content { margin: auto; } } .me { float: right; width: 6.5rem; height: 6.5rem; margin-left: 1rem; margin-bottom: .5rem; border-radius: 100%; position: relative; } @media screen and (min-width: 40em) { .me { width: 7rem; height: 7rem; } } @media screen and (min-width: 54em) { .me { width: 6.5rem; height: 6.5rem; } } @media screen and (min-width: 60em) { .me { width: 7rem; height: 7rem; } } main > footer { position: absolute; bottom: 0; left: 0; right: 0; padding: 0 1rem; color: #9a9a9a; font-size: smaller; text-align: center; } main > footer > p { margin-bottom: 0; } /* .card, .pagination-item { border-radius: 0!important; } */ /* @media screen { .sidebar-sticky { left: 2rem; max-width: none; } } */ html { font-family: Helvetica, Arial, sans-serif; } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: Helvetica, Arial, sans-serif; } </style> <link id="_stylePreload" rel="preload" as="style" href="/assets/css/hydejack.css?v=6.6.1"> <script>document.getElementById('_stylePreload').onload=function(){this.rel='stylesheet'}</script> <!-- NOTE: These styles interact with JavsScript, so they MUST NOT be changed --> <style id="_pageStyle"> .content a { color: #4f86aa; border-color: rgba(79, 134, 170, 0.2); } .content a:hover { border-color: #4f86aa; } :focus { outline-color: #4f86aa; } ::selection { color: #fff; background: #4f86aa; } ::-moz-selection { color: #fff; background: #4f86aa; } </style> <noscript> <link rel="stylesheet" href="/assets/css/hydejack.css?v=6.6.1"> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700|Noto+Sans:400,400i,700,700i"> <style> html { font-family: 'Noto Sans', Helvetica, Arial, sans-serif } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: 'Roboto Slab', Helvetica, Arial, sans-serif } </style> <link rel="stylesheet" href="/assets/icomoon/style.css"> </noscript> <!--<![endif]--> <!--[if gt IE 8]><!----> <script async src="/assets/bower_components/webfontloader/webfontloader.js"></script> <!--<![endif]--> </head> <body> <div class="navbar fixed-top"> <div class="content"> <span class="sr-only">Jump to:</span> <a id="_menu" class="menu no-hover" href="#_title"> <span class="sr-only">Menu</span> </a> </div> </div> <div id="_yPushState"> <div class="fade-in"> <main id="_main" class="content" role="main" data-color="#4f86aa" data-image=""> <article id="post-java/2011/05/25/swt%e7%bb%93%e5%90%88httpclient%e5%ae%9e%e7%8e%b0%e8%87%aa%e5%8a%a8%e6%9b%b4%e6%96%b0-autoupdate-in-swt-with-httpclient" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/java/2011/05/25/swt-e7-bb-93-e5-90-88httpclient-e5-ae-9e-e7-8e-b0-e8-87-aa-e5-8a-a8-e6-9b-b4-e6-96-b0-autoupdate-in-swt-with-httpclient.html" data-flip="title"> swt结合httpclient实现自动更新 [autoupdate in swt with httpclient] </a> </h1> <p class="post-date heading"> <time datetime="2011-05-25T15:32:00+08:00">25 May 2011</time> in <span>Java</span> on <span>Swt java</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>/** <br /> * 本地程序应当自知版本号已与更新站点相比较, <br /> * plugin的版本号是在plugin.xml里面设置的,导出的jar包会依据此版本号命名， <br /> * 而eclipse会自动依据此版本信息选择加载最新版本 <br /> * 此程序的测试：不能直接在eclipse里面运行，应将此rcp打包，然后将version改大，又打个plugin包,将plugin包放在站点上 <br /> * 启动原来的rcp程序则会出现下载重启动作 <br />&#160; * @date Nov 4, 2008 <br /> * @see <br /> */ <br />public class AutoUpdate <br />{ <br />&#160;&#160;&#160; private Display display; <br />&#160;&#160;&#160; private Shell shell; <br />&#160;&#160;&#160; private boolean needReload; <br />&#160;&#160;&#160; private String version = &quot;1.0.0&quot;; <br />&#160;&#160;&#160; public AutoUpdate() <br />&#160;&#160;&#160; { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; display = new Display(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; shell = new Shell(display);&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; shell.setText(version); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; shell.setSize(500, 200); <br />&#160;&#160;&#160; } <br />&#160;&#160;&#160; private byte[] httpGetRequest(String url) <br />&#160;&#160;&#160; { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; HttpClient httpClient = new HttpClient(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; GetMethod getMethod = new GetMethod(url); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; try <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; int statusCode = httpClient.executeMethod(getMethod); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (statusCode != HttpStatus.SC_OK) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.err.println(&quot;Method failed: &quot; + getMethod.getStatusLine()); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return null; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; } <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; byte[] responseBody = getMethod.getResponseBody(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return responseBody;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; } <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; catch (HttpException e) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; e.printStackTrace(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return null; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; } <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; catch (IOException e) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; e.printStackTrace(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return null; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; finally <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; getMethod.releaseConnection(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; } <br />&#160;&#160;&#160; } <br />&#160;&#160;&#160; public void checkAndDown() <br />&#160;&#160;&#160; {&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; try <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; byte[] responseBody = httpGetRequest(&quot;http://localhost:10010/SmileScriptWeb/autoupdate_config.xml&quot;); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (null == responseBody) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.err.println(&quot;can't get config.&quot;); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; } <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; String strXml = new String(responseBody); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(strXml); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Document doc = DocumentHelper.parseText(strXml); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Element el = doc.getRootElement().element(&quot;update&quot;); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; String sversion = el.attributeValue(&quot;version&quot;); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; String fileName = el.attributeValue(&quot;filename&quot;); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; String url = el.attributeValue(&quot;url&quot;); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; int curversion = Integer.valueOf(version.replaceAll(&quot;\\.&quot;, &quot;&quot;)).intValue(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; int serverversion = Integer.valueOf(sversion.replaceAll(&quot;\\.&quot;, &quot;&quot;)).intValue(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (curversion &lt; serverversion) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(&quot;need download new version.&quot;); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }else{ <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; } <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(&quot;got config successfully: version=&quot; + sversion); <br />//&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; download&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; url = &quot;http://localhost:10010/SmileScriptWeb/&quot; + url; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; responseBody = httpGetRequest(url); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (null == responseBody) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.err.println(&quot;can't download update.&quot;); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; } <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; fileName = getAppRootPath() + &quot;plugins/&quot; + fileName; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(&quot;the download file full name=&quot; + fileName); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; File storeFile = new File(fileName);&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; FileOutputStream output = new FileOutputStream(storeFile); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; output.write(responseBody); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; output.close(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(&quot;download successfully.&quot;); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; needReload = true; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; } <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; catch (DocumentException e) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; e.printStackTrace(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; } <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; catch (IOException e) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; e.printStackTrace(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; } <br />&#160;&#160;&#160; } <br />&#160;&#160;&#160; private static String installPath; <br />&#160;&#160;&#160; public static String getAppRootPath() { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (null == installPath) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Location installLoc = Platform.getInstallLocation();&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; URL installURL = installLoc.getURL(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; installPath = installURL.getPath();&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; return installPath; <br />&#160;&#160;&#160; } <br />&#160;&#160;&#160; public Object run() <br />&#160;&#160;&#160; { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; final int totalColumn = 1 ; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; GridLayout layout = new GridLayout(totalColumn,false); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; shell.setLayout(layout); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; checkAndDown(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (needReload) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return IPlatformRunnable.EXIT_RESTART;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; } <br />//&#160;&#160;&#160;&#160;&#160;&#160;&#160; shell.pack(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; shell.open(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; while (!shell.isDisposed()) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; { <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (!display.readAndDispatch()) <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; display.sleep(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; } <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; display.dispose(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; return IPlatformRunnable.EXIT_OK;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160; } <br />} <br />------------------------------------------------------------------------autoupdate_config.xml------------------------------- <br />&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; <br />&lt;config&gt; <br />&#160;&#160;&#160; &lt;update version=&quot;1.0.1&quot; filename=&quot;rcp_swt_1.0.1.jar&quot; url=&quot;rcp_swt_1.0.1.jar&quot; /&gt; <br />&lt;/config&gt;</p> <p class="read-more">Continue reading <a class="heading" href="/java/2011/05/25/swt-e7-bb-93-e5-90-88httpclient-e5-ae-9e-e7-8e-b0-e8-87-aa-e5-8a-a8-e6-9b-b4-e6-96-b0-autoupdate-in-swt-with-httpclient.html" data-flip="title">swt结合httpclient实现自动更新 [autoupdate in swt with httpclient]</a></p> </article> <article id="post-web%E5%89%8D%E7%AB%AF/2011/05/25/%e5%85%b3%e4%ba%8ejavascript%e5%92%8ccss%e7%9a%84%e5%ae%bf%e4%b8%bb%e7%8e%af%e5%a2%83%e4%bb%a5%e5%8f%8a%e8%b5%84%e6%ba%90%e5%bc%95%e7%94%a8%e7%9b%b8%e5%af%b9%e8%b7%af%e5%be%84%e7%ad%89%e9%97%ae" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web%E5%89%8D%E7%AB%AF/2011/05/25/e5-85-b3-e4-ba-8ejavascript-e5-92-8ccss-e7-9a-84-e5-ae-bf-e4-b8-bb-e7-8e-af-e5-a2-83-e4-bb-a5-e5-8f-8a-e8-b5-84-e6-ba-90-e5-bc-95-e7-94-a8-e7-9b-b8-e5-af-b9-e8-b7-af-e5-be-84-e7-ad-89-e9-97-ae.html" data-flip="title"> 关于javascript和css的宿主环境以及资源引用相对路径等问题实践总结! </a> </h1> <p class="post-date heading"> <time datetime="2011-05-25T15:30:39+08:00">25 May 2011</time> in <span>Web前端</span> on <span>Web css javascript</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>1.javascript引用资源(比如图片)相对路径是以宿主环境(所被引用的网页比如user.html)所处位置为基准</p> <p>2.css引用资源(比如图片)相对路径是以.css文件所处位置为基准!</p> <p>已经实践证明过!</p> <p>--2009aicheaizi <br />------images <br />---------index_02.jpg <br />------test.htm</p> <p>--css <br />------css <br />----------test.css</p> <p>--js <br />------js <br />----------test.js</p> <p>引用代码如下: <br />test.css </p> <div><pre><span style="color: #800000">#imgtest</span> 
{ 
<span style="color: #ff0000">background-image</span>:<span style="color: #0000ff">url(。。/。。/2009aicheaizi/images/index_02.jpg)</span>;//<span style="color: #ff0000">把</span>.<span style="color: #0000ff">换成。以防cnblogs转换 
width:500px</span>; 
<span style="color: #ff0000">height</span>:<span style="color: #0000ff">50px</span>; 
<span style="color: #ff0000">border</span>:<span style="color: #0000ff">solid 1px red</span>; 
}</pre></div> <p>test.js</p> <div><pre><span style="color: #0000ff">function</span> writeimg() 
{ 
  <span style="color: #0000ff">document</span>.write(&quot;<span style="color: #8b0000">&lt;img src='images/index_02.jpg' /&gt;</span>&quot;); 
}</pre></div> <p></p> <p>test.html</p> <div><pre><span style="color: #0000ff">&lt;</span>!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;<span style="color: #0000ff">&gt;</span> 
<span style="color: #0000ff">&lt;</span><span style="color: #800000">html</span> <span style="color: #ff0000">xmlns</span>=<span style="color: #0000ff">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span style="color: #0000ff">&gt;</span> 
<span style="color: #0000ff">&lt;</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span> 
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>无标题页<span style="color: #0000ff">&lt;/</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span> 
<span style="color: #0000ff">&lt;</span><span style="color: #800000">script</span> <span style="color: #ff0000">type</span>=<span style="color: #0000ff">&quot;text/javascript&quot;</span> <span style="color: #ff0000">src</span>=<span style="color: #0000ff">&quot;../js/js/test.js&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #0000ff">&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span> 
  <span style="color: #0000ff">&lt;</span><span style="color: #800000">link</span> <span style="color: #ff0000">href</span>=<span style="color: #0000ff">&quot;../css/css/test.css&quot;</span> <span style="color: #ff0000">rel</span>=<span style="color: #0000ff">&quot;stylesheet&quot;</span> <span style="color: #ff0000">type</span>=<span style="color: #0000ff">&quot;text/css&quot;</span> <span style="color: #0000ff">/&gt;</span> 
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span> 
<span style="color: #0000ff">&lt;</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span> 
<span style="color: #0000ff">&lt;</span><span style="color: #800000">script</span> <span style="color: #ff0000">type</span>=<span style="color: #0000ff">&quot;text/javascript&quot;</span><span style="color: #0000ff">&gt;</span> 
writeimg(); 
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span> 
<span style="color: #0000ff">&lt;</span><span style="color: #800000">div</span> <span style="color: #ff0000">id</span>=<span style="color: #0000ff">&quot;imgtest&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #0000ff">&lt;/</span><span style="color: #800000">div</span><span style="color: #0000ff">&gt;</span> 
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span> 
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">html</span><span style="color: #0000ff">&gt;</span></pre></div> <p></p> <p>实践是检验真理的唯一途径.</p> <p>&#160;</p> <p>另外//d1.abc.com/test.js 这种用法没试过吧，这也是绝对路径，但是没有写前面的http协议头，这样写有什么好处呢，对于需要引用外部脚本的站点来说，如果是https请求，那么上面的地址会请求<a href="https://d1.abc.com/test.js">https://d1.abc.com/test.js</a>&#160; 如果是http请求,上面地址则会请求<a href="http://d1.abc.com/test.js">http://d1.abc.com/test.js</a> 这样就避免了跨域安全问题，参见:<a href="http://kazge.com/archives/402.html">http://kazge.com/archives/402.html</a></p> <p class="read-more">Continue reading <a class="heading" href="/web%E5%89%8D%E7%AB%AF/2011/05/25/e5-85-b3-e4-ba-8ejavascript-e5-92-8ccss-e7-9a-84-e5-ae-bf-e4-b8-bb-e7-8e-af-e5-a2-83-e4-bb-a5-e5-8f-8a-e8-b5-84-e6-ba-90-e5-bc-95-e7-94-a8-e7-9b-b8-e5-af-b9-e8-b7-af-e5-be-84-e7-ad-89-e9-97-ae.html" data-flip="title">关于javascript和css的宿主环境以及资源引用相对路径等问题实践总结!</a></p> </article> <article id="post-web%E5%89%8D%E7%AB%AF/2011/05/25/flex%e7%bc%ba%e7%82%b9%e4%b8%8e%e6%af%94%e8%be%83" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web%E5%89%8D%E7%AB%AF/2011/05/25/flex-e7-bc-ba-e7-82-b9-e4-b8-8e-e6-af-94-e8-be-83.html" data-flip="title"> flex缺点与比较 </a> </h1> <p class="post-date heading"> <time datetime="2011-05-25T15:28:41+08:00">25 May 2011</time> in <span>Web前端</span> on <span>Flex</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <h5>flex漫谈</h5> <p>若干年前，我还在CitiBank工作的时候，全球包括国内IT界就有很多WEB开发者热论Rich Internet思想，众多IT媒体纷纷把RIA当作一个时髦的词汇挂在嘴边，时不时地品评一番。而各网络技术供应商也在暗地里思考着是不是新的机会到来了。当时正是全球java企业级技术开发高速发展的时期，OpenSource运动也在如火如荼的进行着。有一天，头召集我们说Macromedia（当时还没有被Adobe兼并）已经实现了一个实验版本的解决方案，名字叫Flex，让我们关注一下云云，因为下一个项目要用到它。于是从那时起便开始了 Flex之旅了。我想我们是Macromedia Flex最早的客户。Flex1.5精彩的UI组件给我留下了深深的印象. 一直到现在都密切的关注着它的发展，用它实现过很多让很多人激动人心的功能，同时也经历着由于Flex先天的不足所带来的困惑，以及每个困惑后面的解决方案。从第一个Beta版本的脆弱到现在2.0的进步，我能明显地感觉到它在成长和发展。我个人也在成长和发展。想以一个过来人的视角告诉国内这些被 Flex地魅力所打动地人们一些经验和教训。以及怎么发挥Flex最强悍的地方，巧妙地避开它相对不稳定和脆弱的地方。只要注意足够的细节，我的实践和经验告诉我，Flex总能让人激动人心！</p> <p>现在，我想首先随便举例介绍一些Flex的短处。从最早的版本1.5开始。</p> <p>1 不支持鼠标双击事件（解决方案是用两次时间间隔100毫秒的单击事件来模拟），2.0有所改观。</p> <p>2 Flex的FlashSession和IE的标准HttpSession在Tomcat,WebLogic上部署时没有问题，但是在Unix的JRUN上时，Post请求参数不同步（解决方案是在Remote Object实现中手动同步必要的参数，比如如果你把Spring中的Facade Object作为Remote Object）2.0有同样的问题。在WebService作为Server端的通信方式时没有类似问题。</p> <p>3&#160; 前期绑定和官方声称的不一致。组件绑定在Flex中分为前期绑定和后期绑定。当Client端装载编译过的mxml或as码流时首先出发的事件是 Initialize然后是CreationComplete，当我们分别写两个handler相应这两个事件，如果后期绑定可能用到前期绑定时装载的数据，你就会发现数据有可能会没有转载。原因有若干，在下一篇文章中详细介绍。</p> <p>4 FlashPlayer 9以前的实现，类层次结构太深，实现很机械死板，存在很多重构的可能，比如一个应用中包括若干容器和组件，每个组件的初始化都要调flash类根结点相同的构造器。你配置好Flex自带的Profiler，就可以在Console中看到整个应用在底层的对象创建初始化的所有过程。只要在flex- config.xml中打开开关然后再做些额外的配置就可以了。（解决方案是写一个底层flash类Singleton的类工厂cache所有底层 flash类，此方案非常见效，flex并不是想象中的那么慢！）</p> <p>5 本身没有好的pattern可以直接利用，容易造成mxml和as混在一起，可以选择cairngorm，这个不错。我将单独写一篇关于CAIRNGORM架构的文章。不过2.0时已经被集成进来。</p> <p>6 CellRender存在数据类型DataType不匹配的Bug等等。</p> <p>以上说了这些，有些朋友可能有些失望，其实大可不必。我们要保持一种客观的态度，等我把Flex的优点列出来以后，你又会充满信心了，其实，任何产品都有优势和劣势。另外，以上我所列的东西都是我在实际的开发中碰到的，到后来你会发现，等你做完项目必须的优化动作后，反而是数据传输所消耗的时间比 Flex组件初始化的时间要长一些，那时可以采用在Server端做个Cache以及Client端Lazy Load的策略。想一下Flex都可以做全球各大股票市场行情实时显示和分析，还有什么它不可以做的呢！ <br />==============================================================================================================</p> <p>支持的： <br />在Action Script的历代版本中, 没有任何一个UI是支持HTML所有的标签的, 它们只支持HTML一部分的标签. <br />TextArea这个UI也是一样的, 只支持HTML里少数标签, 比如加粗(&lt;B&gt;内容&lt;/B&gt;), 或者斜体等等这些基本标签. <br />表格标签&lt;table&gt;是不被支持的, 要用表格的话, 我建议你用DataGrid组件, Flex 2里的DG比Flash 8的漂亮很多, bug很少. <br />不是。java is a programing language! <br />Flex技术是Micromedia推出的，此公司相续推出了两个版本Flex1.0和Flex1.5，但是由于他们所设计的IDE和生成的flash文件太过于臃肿，所以一直声誉不隆。 <br />2005年，Micromedia被Adobe公司收购，Flex2.0和Flex3.0相继推出，Adobe改良了FlexBuilder和SDk，使得开发Flex变得简单，而且生成的.swf文件变的更小。于是这门技术才开始在国外盛行起来。 <br />总的来说，flex是大势所趋，flex+java的J2EE开发在此后一段时间将是主角 <br />oracle是主流数据库, ajax,既然有了flex,ajax可以不用学了 <br />flex资料确实少,但flex3的中文书还是有几本的,况且现在flex4快要出了,赶紧学习吧。 <br />另外，于Flex竞争的还有微软的SilverLight.最新消息，Sun公司也推出了javaFX,其实都是RIA。 <br />不过由于Flex率先占领了市场，所以支援Flex的开源的东西也相对多很多，所以此后一段时间当主推Flex。</p> <p>票数: 0 </p> <p><a href="http://wenda.tianya.cn/wenda/user?userid=18095424257645709014">sdihei</a> <img src="/assets/level_1.png" /> 2009-3-13 下午12:52:24 218.93.127.* 举报 </p> <p>取这个标题,难免会惹来幼稚和可笑之闲,打心底压根儿没有拿这两者来比过,因为这两者是否具有可比性本身是个疑问.可是最近一些朋友的公司却一直在UI的技术选型上犯愁.一些朋友这么问我,所以我想把自己的想法罗列在此,仅供参考. <br />先申明,我不是什么牛人,也不是FLEX和EXT方面的高手,甚至对EXT并没有在项目中亲自实践过,写此文之前我问自己,凭什么在此发言? 最后我找到一个说服自己的欠充分的理由.既然有人发问,就应该个答案,既然我不能更清楚地说出答案,何不以此做为源头,让更多的人来揭开这层面纱,此文难免落入俗套,请大家海涵. <br />不啰嗦了,进入主题吧. <br />FLEX和EXT该选谁? <br />一:从项目的风险上来考虑: <br /> 项目能否成功, 一定程度上并不关技术鸟事儿.因为不同的技术可能达到同样的效果.而我们往往只选取最有把握的一种技术,这就是让项目归避了风险,那么这两者中哪一种技术你更有把握呢? 大家自己更清楚,我可以大概地分析下两者目前使用现状来做个推测或猜测.不排除有例外. <br />FLEX在国内已明显比国外慢了半拍,从 FLEX的相关学习资料可以得出这一结论,记得从FLEX2开始我重新开始了对FLEX(以前玩过FLASH)的关注,那时我还在神龙汽车公司里做实施项目用的是SSH架构.项目中有很多有关经销商的数据需要统计和比较,客户非常希望能够直接在系统中看到各经销商特定数据项比较的结果,当时苦于没能说服经理采用FLEX的CHART来实现这一功能,而采用了BO报表这个庞大的系统来”高射炮打蚊子”,当时提出FLEX技术项目组的同志们闻所未闻,我简单地说是FLASH的一种技术,大家听罢都敬而远之.说FLASH依赖于FP.后来学习FLEX变成了我的业余爱好.当然现在在国内大概不会再出现类似的情况了,FLEX以及微软的SL大有山雨欲来风满楼的架势.CSDN的孟岩说”RIA是趋势”,我想倒底是不是趋势大家能感受得到.在这里我想表明一点,是 EXT已经被众多企业以及用户所接受,但FLEX还在考验和推广的路途之中.回到风险的考虑上来讲,你的团队中真正懂FLEX的人不多,或者根本就没有. 因为大家都没有FLEX方面的经验积累,你贸然采用FLEX,一旦在你的项目中遇到FLEX本身或者你的团队不能解决的难题,而又很难在寻求外界的技术支援时,你的项目势必为摇摇欲坠.这种惊心动魄我想大家都不想感受.而EXT听起来虽然是个新名词,但如XX人所说,AJAX只是一个新瓶装老酒的DD,我们几乎不需要额外的学习就可以完美的实现”拿来主义”,我们还可以根据自己的需求来修改内部的代码.所以就目前来讲,EXT的技术风险远低于FLEX. <br />二:学习和培训的成本: <br />要上一个项目,你的团队没有FLEX的经验也没有EXT的经验积累.别无它法,一:让团队成员自学交流,二:给团队成员培训一下.而不管是学习还是培训,EXT会更快地让大家所接受,所以EXT的学习培训成本或者说成是使用成本更低.(当然这只是就当前的项目而言,从公司长远的考虑,学习FLEX这个投入可能会得到更高的回报, 这是后话). <br />三:企业运营的成本: <br />BS结构的 DD,SERVER是运营时的重头戏,带宽的大小,服务器的负载能力….因素,在项目开发之前技术选型时都要经过深入考究,本着”问题都要在项目开始之先暴露的原则”,我们不能视FLEX项目的更高的带宽要求而不见;FLEX在第一次将整个项目SWF下载到客户端缓存,所以项目大载入会非常慢,鉴于国内的带宽状况似乎还很不乐观,这一点是几乎是FLEX技术选择时最为头疼的问题,这里或许有人会反驳说,有办法解决:我想很严肃地回驳,没办法解决,运用 RSL以及MODULE只能缓解这种尴尬; <br />针对这一尴尬.ADOBE官方有这么一说,FLEX是为企业级用户准备的,当然你做的是企业级方案,那这一尴尬确实可以不再让其蒙羞;所以FLEX在外网的解决方案的使用上似乎要更加慎重考虑 <br />再回到话题上来,FLEX与EXT相比所需的带宽要求要高得多,最终用户的网络带宽不理想,你用FLEX做再华丽的,再炫,再牛的用户体验,他也体会不到. 当系统的并发数急剧增加时,企业的服务器要相应地提高对用户的响应速度,也需要加大带宽,运用木桶原理,可能需要增加的带宽不小(本人没有数据来说明,因为没有做过测试),支付的费用也会成若干倍增加. <br />四:开发效率和维护成本 <br />看到上面,好像我更倾向于采用EXT,似乎我把FLEX说得一无是处,不然,FLEX也是时代的英雄,只是他的演出才刚拉开帷幕,从开发效率上来讲EXT根本没法跟FLEX相提并论,</p> <p class="read-more">Continue reading <a class="heading" href="/web%E5%89%8D%E7%AB%AF/2011/05/25/flex-e7-bc-ba-e7-82-b9-e4-b8-8e-e6-af-94-e8-be-83.html" data-flip="title">flex缺点与比较</a></p> </article> <article id="post-java/web%E5%89%8D%E7%AB%AF/2011/05/25/blaze-data-services%e8%bf%98%e6%98%aflivecycle-data-services%ef%bc%9f" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/java/web%E5%89%8D%E7%AB%AF/2011/05/25/blaze-data-services-e8-bf-98-e6-98-aflivecycle-data-services-ef-bc-9f.html" data-flip="title"> Blaze Data Services还是LiveCycle Data Services？ </a> </h1> <p class="post-date heading"> <time datetime="2011-05-25T15:14:00+08:00">25 May 2011</time> in <span>Java</span> / <span>Web前端</span> on <span>Flex</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <h5><a href="http://www.infoq.com/cn/articles/Blaze-LiveCycle">http://www.infoq.com/cn/articles/Blaze-LiveCycle</a></h5> <h3><a name="TOC-Blaze-Data-Services-LiveCycle-Data-"></a>Blaze Data Services还是LiveCycle Data Services？</h3> <p>作者 <b><a href="http://www.infoq.com/cn/bycategory.action?authorName=Ryan-Knight">Ryan Knight</a> </b>译者<b><a href="http://www.infoq.com/cn/bycategory.action?authorName=%E5%BC%A0%E9%BE%99"> 张龙</a> </b>发布于 2009年5月5日 下午10时11分 </p> <p>社区 <a href="http://www.infoq.com/cn/java" name="java">Java</a> 主题 <a href="http://www.infoq.com/cn/opensource" name="opensource">开放源代码</a>, <a href="http://www.infoq.com/cn/web2_0" name="web2_0">Web 2.0</a>, <a href="http://www.infoq.com/cn/dataaccess" name="dataaccess">数据访问</a>, <a href="http://www.infoq.com/cn/ria" name="ria">RIA</a>, <a href="http://www.infoq.com/cn/rich-client-desktop" name="rich-client-desktop">富客户端/桌面</a> 标签 <a href="http://www.infoq.com/cn/adobe" name="adobe">Adobe</a>, <a href="http://www.infoq.com/cn/flex" name="flex">Flex</a>, <a href="http://www.infoq.com/cn/air" name="air">Adobe集成运行时/AIR</a>, <a href="http://www.infoq.com/cn/Flash" name="Flash">Flash</a></p> <h6><a name="TOC-1"></a>摘要</h6> <p>现在已经有不少文章在谈论各种版本的Data Services，然而却没人能说清楚该如何从这些Data Services中进行选择，同时也没人对端点（end point）和管道（channel）是如何影响着应用性能这个议题进行过详细论述。</p> <p>尽管Adobe提到4个不同版本的Data Services，但实际上只有2个主要版本。一个是开源的Blaze Data Services，另一个是名为LiveCycle Data Services（LCDS）的私有版本。这两个产品都提供了一个重要特性：借助于Message Broker Servlet连接Flex和Java。他们都可以通过二进制协议，ActionScript消息格式（AMF）使用远程过程调用和消息与服务器端进行通信。此外，Adobe还在这两个核心产品之上提供了支持版本和更具扩展性的产品套件。</p> <p>从我在Gorilla Logic的工作经历来看，我认为这两个产品之间的主要差异在于支持项与数据管理，而性能和可伸缩性之间的差异则颇具争议。LCDS为客户端通信提供了额外的端点和管道。Adobe宣称这么做的主要好处在于提升了可伸缩性，然而基本的通信方式依然是通过HTTP上的AMF，这样不管服务器端或客户端的配置如何，其性能没什么差别。</p> <p>LCDS提供的另一个特性是数据管理，它通过实时的冲突调节（conflict resolution）实现Flex客户端和Java服务器端之间的数据同步，同时还提供了数据装配器和适配器以通过JDBC、Hibernate或其他客户化的适配器连接Data Services和持久化存储。</p> <p>那么这4个不同版本都是什么呢？</p> <ol> <li><b>Blaze Data Services</b>——免费、开源的版本 </li> <li><b>LiveCycle Data Services社区版</b>——Blaze DS的一个支持版 </li> <li><b>LiveCycle Data Service单CPU协议版</b>——商业版的一个免费版本，具有一些额外特性，但只能用在单个CPU上 </li> <li><b>LiveCycle Data Services</b>——带有支持的商业版的付费版本</li> </ol> <p>同时还有一个Adobe称之为<b>LiveCycle Data Services Enterprise Suite的</b>产品套件。它向核心的Data Services中添加了额外的产品以通过PDF Generation、Forms及Digital Signatures等工具提供内容服务和文档输出功能。</p> <p>理论上来说，我们可以根据以下三点来选择产品。</p> <ol> <li>需要支持么？这取决于应用是否需要支持，比如任务关键的应用。 </li> <li>需要数据管理服务么？这取决于应用对数据同步和管理服务的需求。 </li> <li>需要额外的LCDS端点和管道么？根据Adobe所述，如果同时有几百个并发连接，那么就需要了，然而这么说还是颇具争议的。服务器能处理的并发连接数取决于多种因素，比如线程和I/O吞吐量等，同时我们还可以通过多个服务器的负载平衡来处理大量的并发连接，就像Java应用服务器那样。</li> </ol> <p>在本文的最后有一张比较图表概览了这4个不同版本。</p> <h6><a name="TOC-Servlet-NIO"></a>概览不同的端点——Servlet和NIO</h6> <p>在Data Services中，端点就是服务器监听来自客户端连接的方式。对于Blaze DS和LCDS来说，标准的端点基于Servlet，运行在应用服务器上。端点通过Message Broker Servlet（配置在web.xml中）加入到标准的Servlet过滤器链中，这样我们就可以将Blaze DS和LCDS部署到现有的Java应用中。与Java Servlet端点类似，每个客户端连接都需要服务器上一个单独的线程。</p> <p>与上面相比，NIO端点的工作方式就完全不同了。NIO表示Java新的输入/输出。NIO端点会创建一个独立的基于NIO的Socket Server。其优势在于单个线程能管理多个I/O流，这样就无需很多线程，同时能处理更多的客户端。</p> <p>要想使用NIO，我们面临着如下几个挑战：</p> <ul> <li>客户端无法通过客户端代理访问NIO端点。 </li> <li>连接无法通过标准的Servlet链，因为这会打断依赖于Servlet的任何一部分系统。比如我们在项目中使用Servlet处理文件上传。 </li> <li>要想使用NIO，我们必须利用客户化的认证，因为Socket Server运行在与Servlet容器不同的进程中。</li> </ul> <p>尽管我们可以通过配置的方式让NIO服务器监听80端口，但通常它却驻留在其它端口上。这样就给网络配置带来了挑战，我们必须将网络配置成可以接收新端口上的连接。根据服务器内部网络和各种客户端的不同，这可能会产生问题。不过这个问题还是有可能解决的：使用带有sticky sessions的负载平衡器。</p> <p>然而Java NIO的这些优势却是颇具争议的。开发Java NIO的目的在于让单个线程处理多个连接，这是通过令单个线程遍历连接池以检查是否需要读取或写入新的数据来实现的。但由于NIO是在2002年引入的，那时的JDK版本还是1.4，而现在JVM和Linux中的线程已经得到了极大的改进，因此Java和Linux处理大量线程的能力也已经得到了巨大的提升。</p> <p>举个例子吧，Linux Kernel 2.6引入了一个新的线程库，也就是本地的POSIX Linux线程库（NPTL）。测试表明，借助于NPTL在IA-32上只需2秒钟<sup>1</sup>就能启动100,000个线程，而如果不使用NPTL的话，Linux Kernel需要花费15分钟才能启动这么多线程。</p> <p>更有意思的是Paul Tyma等人发布了一篇博文说到Java NIO实际上是个劣势<sup>2</sup>, <sup>3</sup>, <sup>4</sup>。凭借一系列基准，Paul得出了如下一些结论：</p> <ul> <li>Java NIO丧失了大约20%到30%的吞吐量 </li> <li>线程上下文切换的代价并<b>不大</b></li> <li>同步的代价并<b>不大</b></li> </ul> <p>Paul 根据这些测试得出如下结论：一个连接对应一个线程完全没问题。在使用JDK 1.6的情况下，JVM可以处理15K到30K的线程数。这意味着Servlet端点已经不再局限于几百个线程了，相反，线程数可以更多，甚至15K个连接以上。当然了，实际的限制取决于硬件配置，比如内存、CPU等等。</p> <h6><a name="TOC-2"></a><b>概览不同类型的管道</b></h6> <p>我们可以在基本的网络连接之上使用多种不同类型的管道进行客户端与服务器端的通信。基本远程过程调用使用的是标准AMF管道。</p> <p>另一种通信形式就是消息，这样应用就可以推送来自于服务器端的消息并进行近乎实时的通信。代表性应用就是聊天服务器、拍卖客户端及协作服务。</p> <p>Data services处理消息的主要方式就是轮询（polling）。由于HTTP上的标准通信并不会一直打开通信管道，这样一个轮询管道就会让客户端请求一直等待服务器端，直到数据可用为止，其等待时间从几毫秒到几分钟不等。这么做就模拟了从服务器端推送数据的过程。</p> <p>有两种基本的轮询管道：短轮询与长轮询。其主要区别在于服务器端等到客户端数据变得可用时所需时间的多少。</p> <p>一种更高级的管道是流式AMF（streaming AMF）。它会打开到服务器端的HTTP连接并让服务器以流的方式在该管道上传输消息（消息的数量没有限制）。这么做就无需客户端轮询了，同时还能使用标准的网络配置。该方式最接近于实时流。流式AMF的挑战在于它使用了HTTP 1.1的持续连接，而不同的浏览器对其的实现方式却不同。</p> <p>最后一种管道就是RTMP（实时消息协议）管道了，目前只有LiveCycle DS对其提供了支持。Adobe最近宣布将要发布RTMP规范，由此我猜想它最终将会得到其他产品的支持。</p> <p>设计RTMP的目的是在双向管道上以流的方式处理大量多媒体和数据。RTMP的一个主要好处是可以一直打开与客户端的连接，这样就可以推送服务器端的数据了。凭借这一点，RTMP可用于Comet风格的通信和实时的数据推送。</p> <p>RTMP有三种形式。一种是基于TCP并使用1935端口，其底层实现要求在客户端浏览器上初始化连接。由于使用了非标准的端口，这样客户端防火墙经常会阻止其运行。</p> <p>RTMP的另两种形式在HTTP请求内封装了RTMP消息，这样协议就可以穿越防火墙并使用标准的端口。这两种形式分别是RTMPT（用在标准的HTTP上）及RTMPTS（用在安全的HTTPS上）。</p> <p>在 Flex中，所有对服务器的调用都是异步执行的，因此这些管道都不会对客户端性能造成任何影响。然而他们却对服务器端性能有一定的影响，尤其是在同时打开多个客户端连接的情况下更是如此。例如，流式AMF会导致服务器端打开大量并发的客户端连接，这也就意味着会产生多个线程。但如前所述，多个线程的影响微乎其微。</p> <p>所有的客户端连接都可以配置默认管道和备选管道，如果默认管道失败则可以切换到备选管道上。根据服务器端处理的不同通信类型，我们可以指定不同的管道链。例如，可以指定RTMP管道，但如果该连接失败，就回到长轮询管道。</p> <h6><a name="TOC-3"></a><b>结论</b></h6> <p>相对于Blaze DS来说，LiveCycle DS的真正优势在于其支持与数据管理，而额外的端点和管道所带来的优势却是颇具争议的。根据我们在Gorilla Logic所完成的项目来看，根本无需使用NIO端点或是RTMP。但从技术角度来看，没什么是确定的。我倒是想多点项目经历。</p> <p><b>特性比较表</b></p> <p><img border="0" alt="table" src="/assets/table.png" width="600" height="585" /></p> <p><b>关于作者</b></p> <p>Ryan Knight是<a href="http://gorillalogic.com/">Gorilla Logic</a>的高级软件架构师，他主要从事Flex和Java咨询方面的工作，同时还是Anvil Flex的主要贡献者，这是一个开源的项目，用来帮助企业上手Flex开发。他有着12年的Java开发经验，期间经历了从开发到咨询的各种角色变迁。</p> <p><b>资源</b></p> <p><sup>1</sup> <u><a href="http://www.linuxjournal.com/article/6530">http://www.linuxjournal.com/article/6530</a></u></p> <p><sup>2 </sup><u><a href="http://paultyma.blogspot.com/2008/03/writing-java-multithreaded-servers.html">http://paultyma.blogspot.com/2008/03/writing-java-multithreaded-servers.html</a></u></p> <p><sup>3 </sup><u><a href="http://www.theserverside.com/discussions/thread.tss?thread_id=26700">http://www.theserverside.com/discussions/thread.tss?thread_id=26700</a></u></p> <p><sup>4 </sup><u><a href="http://cometdaily.com/2008/11/21/are-raining-comets-and-threads/">http://cometdaily.com/2008/11/21/are-raining-comets-and-threads/</a></u></p> <p><b>来自Adobe的链接</b></p> <p><u><a href="http://www.adobe.com/products/livecycle/">LiveCycle Homepage</a></u></p> <p><u><a href="http://www.adobe.com/products/livecycle/">LiveCycle Data Services ES FAQ</a></u></p> <p><u><a href="http://www.adobe.com/products/livecycle/dataservices/compare.html">Comparison of the different LiveCycle Data Services solutions</a></u></p> <p><b>其他资源</b></p> <p><u><a href="http://gregsramblings.com/2008/03/27/livecycle-ds-vs-livecycle-es-clearing-up-the-confusion/">LiveCycle ES vs LiveCycle DS vs BlazeDS - clearing up the confusion</a></u></p> <p><u><a href="http://quetwo.wordpress.com/2008/03/15/why-are-you-not-using-livecycle-ds/">Why are you NOT using LiveCycle DS?</a></u></p> <p><b>查看英文原文:</b> <a href="http://www.infoq.com/articles/Blaze-LiveCycle">Blaze Data Services or LiveCycle Data Services?</a></p> <p class="read-more">Continue reading <a class="heading" href="/java/web%E5%89%8D%E7%AB%AF/2011/05/25/blaze-data-services-e8-bf-98-e6-98-aflivecycle-data-services-ef-bc-9f.html" data-flip="title">Blaze Data Services还是LiveCycle Data Services？</a></p> </article> <article id="post-delphi/2011/05/25/delphi-7%e7%bc%96%e8%af%91%e7%9a%84%e7%a8%8b%e5%ba%8f%e4%bb%bb%e4%bd%95%e7%b3%bb%e7%bb%9f%e9%83%bd%e6%ad%a3%e5%b8%b8%e6%98%be%e7%a4%ba" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/delphi/2011/05/25/delphi-7-e7-bc-96-e8-af-91-e7-9a-84-e7-a8-8b-e5-ba-8f-e4-bb-bb-e4-bd-95-e7-b3-bb-e7-bb-9f-e9-83-bd-e6-ad-a3-e5-b8-b8-e6-98-be-e7-a4-ba.html" data-flip="title"> Delphi 7编译的程序任何系统都正常显示 </a> </h1> <p class="post-date heading"> <time datetime="2011-05-25T15:07:38+08:00">25 May 2011</time> in <span>Delphi</span> on <span>Delphi</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <h6><font face="宋体">Delphi 7编译的程序任何系统都正常显示<font color="#0000a0">[这个没提供解决方案，可当基础知识]</font></font></h6> <p> <font face="宋体">字符编码的问题。 <br />字符编码在Delphi7中已经得到了很大提高。 <br />Delphi7自己的IDE虽然不能读取Unicode编码的源代码文件，但编译器已经支持 <br />AnsiString和WideString的转换。也就是说，只要定义的时候定义 <div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">Technorati 标签: <a href="http://technorati.com/tags/delphi" rel="tag">delphi</a></div> <p> WideString， <br />那么在后面直接给他赋值时，AnsiString自动转换为WideString，反之亦然。 <br />这样有好处也有坏处，好处是在快速开发中，不需要考虑更多的字符转换问题， <br />能够比较平顺地从Win98向NT字符集转换，坏处是混淆了字符界限，深入看下 <br />去，有时候搞不清我的内存里究竟是Ansi还是Wide，特别是希望仅仅使用宽字 <br />符的情况下，更要留意字符格式的定义。 <br />WideString保存为文本文件时，常用的有UTF-8、Unicode、Ansi、Unicode Big Endian， <br />其中 UTF-8 的格式，从文件读取的时候，需要利用 Delphi7 提供的 Utf8ToUnicode <br />转换一下全部编码，其他几种编码本身都不需要转换（BigEndian编码是摩托罗拉规范，是 <br />intel 规范的 Unicode (即我们现在说的 WideString)编码的字符按字节反转，这符合摩 <br />托罗拉生产的计算机芯片的构造特点，所以读取后要按 WORD 反转），但保存为相应格式的 <br />文本文件时，必须按要求在文件头部写入一个编码识别记号，他们分别为： <br />Ansi：不需要 <br />Unicode：$FEFF （十六进制编辑器看到的是高位在前显示$FFFE，以下同） <br />BigEndian：$FFFE （正好是上面 Unicode 的反转） <br />UTF-8：$BBEF $BF （三字节，十六进制编辑器里显示 $EFBB BF） <br />这样，其他编辑器读取时就可以识别出保存者把文本翻译成了什么编码。 <br />Unicode（即WideString）只要写好文件头，后面的就按照保存Ansi文本一样把 <br />文本写入文件，保存为Big Endian，则按WORD逐字节反转写入，保存为UTF-8 <br />要利用UnicodeToUtf8转换后写入。 <br />在XML解析中，如果带有非ASCII编码的文字，MS默认使用UTF-16编码，如果 <br />原始文本是Ansi编码，这时将获得乱码的字符。这个编码不是Delphi造成的，是 <br />MS的XML库所致，所以在使用非ASCII字符前，建议转换成UTF-8编码，上面例 <br />子中我没有使用WideString，所以没有实现编码转换。 <br />编码转换有很多现成的开源代码可以利用，其中影响最深远的就是JEDI的Unicoee.pas， <br />但这个文件很庞大，大约有250K大小，它还带有一个转换表的资源文件，如果 <br />处理一些小型的字符转换就显得杀鸡用牛刀了。当然我们可以直接利用Delphi7 <br />提供给我们的函数，比如： <br />function PUCS4Chars(const S: UCS4String): PUCS4Char; <br />function WideStringToUCS4String(const S: WideString): UCS4String; <br />function UCS4StringToWidestring(const S: UCS4String): WideString; <br />function UnicodeToUtf8(Dest: PChar; Source: PWideChar; MaxBytes: Integer): Integer; <br />function UnicodeToUtf8(Dest: PChar; MaxDestBytes: Cardinal; Source: PWideChar; SourceChars: Cardinal): Cardinal; <br />function Utf8ToUnicode(Dest: PWideChar; Source: PChar; MaxChars: Integer): Integer; <br />function Utf8ToUnicode(Dest: PWideChar; MaxDestChars: Cardinal; Source: PChar; SourceBytes: Cardinal): Cardinal; <br />function Utf8Encode(const WS: WideString): UTF8String; <br />function Utf8Decode(const S: UTF8String): WideString; <br />function AnsiToUtf8(const S: string): UTF8string; <br />function Utf8ToAnsi(const S: UTF8string): string; <br />等等。这些已经足够使用了。轻量级的代码是OmniXML中的TGpTextStream， <br />不过这个代码有不少BUG，并且不支持BigEndian的写入（读取部分也因忘了使 <br />用临时变量而错误）。这些都可以利用。 <br />在Delphi7中，Edit等控件不支持WideString，但有一组TnTWare的开源控件可 <br />以直接支持WideString。 <br />所以，了解了这些内容后，就可以明确这么多编码在读入内存后变成了什么。 <br />读入内存中的字符其实已经只剩下二种格式了： <br />要么是 AnsiString， <br />要么是WideString。 <br />因此，对于认识字符编码的关键就是理解读取和理解保存，只有这二个地方需 <br />要对编码有了解才能正确地完成工作。 <br />哦，对了，还要补充一下Delphi中比较特殊的一个事情：本来我们全程使用了 <br />WideString后，在NT系统下应该可以不考虑处于哪种语言环境的，但是Delphi <br />的全部控件都是基于Ansi的，因此，除非使用了象Tnt控件一样的显示控件， <br />否则都要注意字符集的定义。象Edit，如果要显示WideString，Edit的Line.Text <br />会自动转换为AnsiString，这个转换的依据是活动文档的键盘定义或者活动文档 <br />的字符集定义（字符集定义优先），因此一定不要忘记把Edit字符集设置为与 <br />文本相适应的标志，比如中文，就设置为GB2313_CHARSET，这样，转换时会 <br />使用936的中文字符集。这个设置与具体使用的字体无关，只要强制把这个属 <br />性设置好了，字体是否支持这个集合由系统自动转换。 <br />因为 WideString 中最需要转换的编码就是 UTF-8，所以演示了 UTF-8 就可以应用到所有 <br />WideString 编码。 <br />下面的演示代码是把 UTF-8 格式的文本装入只能显示 AnsiString 的 Delphi 自带的 Memo <br />中，并且可以再将这个 Memo 中的 AnsiString 取出来保存为 UTF-8 格式文本，并且支持 <br />在任何语种的 Windows NT 操作系统上显示中文。 <br />unit frmUnit; <br />interface <br />uses <br />Windows, Messages, SysUtils, Variants, Classes, Graphics, <br />Controls, Forms, Dialogs, ComCtrls, Menus, StdCtrls; <br />type <br />TEncodeFlags = (efUnknown, efAnsi, efUnicode, efUncodeBigEn, efUTF8); <br />TUniEditFrm = class(TForm) <br />&#160;&#160; MainMenu1: TMainMenu; <br />&#160;&#160; mnuFileItem: TMenuItem; <br />&#160;&#160; mnuOpen: TMenuItem; <br />&#160;&#160; mnuSpace1: TMenuItem; <br />&#160;&#160; mnuSaveAs: TMenuItem; <br />&#160;&#160; mnuSpace2: TMenuItem; <br />&#160;&#160; mnuExit: TMenuItem; <br />&#160;&#160; StatusBar: TStatusBar; <br />&#160;&#160; procedure FormCreate(Sender: TObject); <br />&#160;&#160; procedure FormDestroy(Sender: TObject); <br />private <br />&#160;&#160; { Private declarations } <br />&#160;&#160; FStream: TStream; <br />&#160;&#160; OpenDlg: TOpenDialog; <br />&#160;&#160; SaveDlg: TSaveDialog; <br />&#160;&#160; UnicoMemo: TMemo; <br />&#160;&#160; procedure SetMemoCharset; <br />&#160;&#160; procedure LoadFromFile(fName: string); <br />&#160;&#160; procedure SaveToFile(fName: string); <br />&#160;&#160; procedure SetStatusMessage(Msg: string); <br />&#160;&#160; procedure MenuItemOnClick(Sender: TObject); <br />&#160;&#160; function ChWideToAnsi(const StrW: WideString): AnsiString; <br />&#160;&#160; function ChAnsiToWide(const StrA: AnsiString): WideString; <br />&#160;&#160; function UTF8ToWideString(const Stream: TStream): WideString; <br />&#160;&#160; procedure TextToUTF8Stream(const Text: string; var Stream: TStream); <br />&#160;&#160; function GetEncodeFromStream(const Stream: TStream): TEncodeFlags; <br />public <br />&#160;&#160; { Public declarations } <br />end; <br />var <br />UniEditFrm: TUniEditFrm; <br />implementation <br />{$R *.dfm} <br />type <br />TUTF8Falg = packed record <br />&#160;&#160; EF, BB, BF: Byte; <br />end; <br />const <br />Encode: TUTF8Falg = (EF: $EF; BB: $BB; BF: $BF); <br />MenuActSpace = 0; <br />MenuActOpen = 1; <br />MenuActSaveAs = 2; <br />MenuActExit = 3; <br />{ TUniEditFrm } <br />procedure TUniEditFrm.FormCreate(Sender: TObject); <br />var <br />n: integer; <br />begin <br />mnuOpen.Tag := MenuActOpen; <br />mnuSaveAs.Tag := MenuActSaveAs; <br />mnuExit.Tag := MenuActExit; <br />for n := 0 to mnuFileItem.Count - 1 do <br />&#160;&#160; if mnuFileItem.Items[n].Caption &lt;&gt; '-' then <br />&#160;&#160;&#160;&#160; mnuFileItem.Items[n].OnClick := MenuItemOnClick; <br />OpenDlg := TOpenDialog.Create(Self); <br />OpenDlg.Filter := 'UTF8 Text File|*.txt'; <br />SaveDlg := TSaveDialog.Create(Self); <br />SaveDlg.Filter := 'UTF8 Text File|*.txt'; <br />SaveDlg.DefaultExt := '.txt'; <br />UnicoMemo := TMemo.Create(Self); <br />UnicoMemo.Parent := Self; <br />UnicoMemo.Align := alClient; <br />UnicoMemo.ScrollBars := ssVertical; <br />SetMemoCharset; <br />end; <br />procedure TUniEditFrm.FormDestroy(Sender: TObject); <br />begin <br />OpenDlg.Free; SaveDlg.Free; UnicoMemo.Free; <br />if Assigned(FStream) then FStream.Free; <br />end; <br />procedure TUniEditFrm.MenuItemOnClick(Sender: TObject); <br />begin <br />case TComponent(Sender).tag of <br />&#160;&#160; MenuActOpen: if OpenDlg.Execute then LoadFromFile(OpenDlg.FileName); <br />&#160;&#160; MenuActSaveAs: if SaveDlg.Execute then SaveToFile(SaveDlg.FileName); <br />&#160;&#160; MenuActExit: Close; <br />end; <br />end; <br />procedure TUniEditFrm.SetMemoCharset; <br />begin <br />UnicoMemo.Font.Charset := GB2312_CHARSET; <br />UnicoMemo.Font.Size := 12; <br />end; <br />procedure TUniEditFrm.SetStatusMessage(Msg: string); <br />begin <br />SendMessage(StatusBar.Handle, WM_USER + 1, 0, DWord(PChar(Msg))); <br />end; <br />procedure TUniEditFrm.LoadFromFile(fName: string); <br />begin <br />if not Assigned(FStream) then FStream := TMemoryStream.Create; <br />TMemoryStream(FStream).LoadFromFile(fName); <br />if GetEncodeFromStream(FStream) = efUTF8 then <br />begin <br />&#160;&#160; SetStatusMessage(Format('File: %s ,Size:%d Byte', [fName, FStream.Size])); <br />&#160;&#160; UnicoMemo.Lines.BeginUpdate; <br />&#160;&#160; UnicoMemo.Clear; <br />&#160;&#160; try <br />&#160;&#160;&#160;&#160; UnicoMemo.Lines.Add(ChWideToAnsi(UTF8ToWideString(FStream))); <br />&#160;&#160; finally <br />&#160;&#160;&#160;&#160; UnicoMemo.Lines.EndUpdate; <br />&#160;&#160; end; <br />end <br />else SetStatusMessage(Format('File: %s ,Unknown Encode', [fName])); <br />FStream.Size := 0; <br />end; <br />procedure TUniEditFrm.SaveToFile(fName: string); <br />begin <br />try <br />&#160;&#160; if not Assigned(FStream) then FStream := TMemoryStream.Create; <br />&#160;&#160; TextToUTF8Stream(UnicoMemo.Lines.Text, FStream); <br />&#160;&#160; TMemoryStream(FStream).SaveToFile(fName); <br />&#160;&#160; SetStatusMessage(Format('Save File: %s ,Size:%d Byte', [fName, FStream.Size])); <br />finally <br />&#160;&#160; FStream.Size := 0; <br />end; <br />end; <br />function TUniEditFrm.ChWideToAnsi(const StrW: WideString): AnsiString; <br />var <br />nLen: integer; <br />begin <br />Result := StrW; <br />if Result &lt;&gt; '' then <br />begin <br />&#160;&#160; nLen := WideCharToMultiByte(936, 624, @StrW[1], -1, nil, 0, nil, nil); <br />&#160;&#160; SetLength(Result, nLen - 1); <br />&#160;&#160; if nLen &gt; 1 then <br />&#160;&#160;&#160;&#160; WideCharToMultiByte(936, 624, @StrW[1], -1, @Result[1], nLen - 1, nil, nil); <br />end; <br />end; <br />function TUniEditFrm.ChAnsiToWide(const StrA: AnsiString): WideString; <br />var <br />nLen: integer; <br />begin <br />Result := StrA; <br />if Result &lt;&gt; '' then <br />begin <br />&#160;&#160; nLen := MultiByteToWideChar(936, 1, PChar(@StrA[1]), -1, nil, 0); <br />&#160;&#160; SetLength(Result, nLen - 1); <br />&#160;&#160; if nLen &gt; 1 then <br />&#160;&#160;&#160;&#160; MultiByteToWideChar(936, 1, PChar(@StrA[1]), -1, PWideChar(@Result[1]), nLen - 1); <br />end; <br />end; <br />function TUniEditFrm.UTF8ToWideString(const Stream: TStream): WideString; <br />var <br />nLen: Cardinal; <br />begin <br />try <br />&#160;&#160; SetLength(Result, Stream.Size div SizeOf(WideChar) * 3); <br />&#160;&#160; nLen := Utf8ToUnicode(@Result[1], Length(Result), <br />&#160;&#160;&#160;&#160; Pointer(DWord(TMemoryStream(Stream).Memory) + Stream.Position), <br />&#160;&#160;&#160;&#160; Stream.Size - Stream.Position); <br />&#160;&#160; SetLength(Result, nLen); <br />except <br />&#160;&#160; SetLength(Result, 0); <br />end; <br />end; <br />procedure TUniEditFrm.TextToUTF8Stream(const Text: string; var Stream: TStream); <br />var <br />StringW, StrW: WideString; <br />nLen: Cardinal; <br />begin <br />try <br />&#160;&#160; if Text &lt;&gt; '' then <br />&#160;&#160; begin <br />&#160;&#160;&#160;&#160; StrW := ChAnsiToWide(Text); <br />&#160;&#160;&#160;&#160; nLen := Length(StrW) * 3; <br />&#160;&#160;&#160;&#160; SetLength(StringW, nLen); <br />&#160;&#160;&#160;&#160; nLen := UnicodeToUtf8(@StringW[1], nLen, @StrW[1], Length(StrW)); <br />&#160;&#160;&#160;&#160; SetLength(StringW, nLen); <br />&#160;&#160;&#160;&#160; Stream.Write(Encode, SizeOf(Encode)); <br />&#160;&#160;&#160;&#160; Stream.Write(StringW[1], Length(StringW)); <br />&#160;&#160; end <br />&#160;&#160; else <br />&#160;&#160;&#160;&#160; Stream.Write(Encode, SizeOf(Encode)); <br />except <br />&#160;&#160; SetLength(StrW, 0); <br />&#160;&#160; SetLength(StringW, 0); <br />end; <br />end; <br />function TUniEditFrm.GetEncodeFromStream(const Stream: TStream): TEncodeFlags; <br />var <br />FEncode: TUTF8Falg; <br />begin <br />Result := efUnknown; <br />Stream.Read(FEncode, SizeOf(FEncode)); <br />if (FEncode.EF = Encode.EF) and (FEncode.BB = Encode.BB) <br />&#160;&#160; and (FEncode.BF = Encode.BF) then Result := efUTF8; <br />end; <br />end. <br />代码中有几个控件是动态创建的，其中有对话框和 Memo。这是为了随时改变使用不同控件 <br />库进行测试观察的需要，如果你使用支持宽字符的控件，不用改界面，直接把创建实例改一 <br />改就可以测试观察了。这种写法不是最好的，如果使用接口来描述就会更随意些。 <br />------------------------------------------------------------------------------------- <br />干净搞定delphi多语言-兼论设计模式&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160; 随着全球化程度加深，软件越来越像蒲公英，到处飘散、扎根。这其中要解决的是不同语言的显示问题。我们当然希望一套程序，可以不修改代码就可以支持不同的语言，不要去维护很多的版本。 <br />&#160;&#160;&#160;&#160;&#160;&#160; 首先要谈到的一个问题是乱码问题，因为delphi win32到11.x版还是不支持unicode，所以一般使用Ansi码，有这样几种情况会显示乱码：</font> <ol> <li><font face="宋体">使用的语言文字与系统当前设定的语言不一样；比如简体版QQ在繁体操作系统（或简体操作系统的区域设置中“非Unicode程序的语言”设定为 繁体）就是乱码。即使改变Font.Charset，某些元件仍然会出现乱码，如StatusBar。因此，在越南文版的windows显示越南文，在伊 朗文版的windows显示伊朗文，不要在越南文版windows显示伊朗文，在伊朗文版windows显示越南文，这样就能确保没有乱码问题。好在一般 这样的错位用法也不多见。</font> </li> <li><font face="宋体">系统没有安装你要显示的语言的语言包；</font> </li> </ol> <p><font face="宋体">&#160;&#160;&#160;&#160;&#160;&#160; 如果你要保证完全无乱码，必须考虑使用unicode码，使用成套的支持unicode的元件，如tnt，但它在UI变现上比较单一，你不可能不使用别的元件。 <br />&#160;&#160;&#160;&#160;&#160;&#160; 言归正传，首先，看看哪些地方的字串需要实现多语言，并来看看各种实现方法的优劣。 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1、界面上的元件，如TButton的Caption； <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 2、主动弹出的消息，如ShowMessage('Are you sure?')，Raise Exception.Create('Error!')； <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 3、例外错误举发的报告信息，如f/0引起的exception； <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 4、第3方元件包内部的上述字串； <br />&#160;&#160;&#160;&#160;&#160;&#160; 实现多语言的方法很多，列举一二： <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1、delphi自带的Resource生成工具 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 此工具把专案的dfm文件里的所有字串以及pas中定义为ResourceString的字串列举出来，按不同的语言编译成不同的Resource，专案编译前先选语言，每种语言编译成一个exe。 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 这个工具使用很不方便，不是一个完整的解决方案，跟Borland的Midas的demo一样（TClientDataSet通过 ProviderName连接到RemoteDatamodule的TDataSetProvider，实际开发Erp系统时，谁会放100个 TDataSetProvider连接到100个TDataSet？），只是一个原理尚通的示范。 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 首先，由于dfm本身也是资源文件的一部分，因此每次修改都要“Update Resource DLLs...”，如修改Button1为Button2，如果你忘了，运行时就会报“找不到资源Button1的错误”；提供的字典编辑画面中，出了字 串，还有Left/Top等资料；字典不能重用，在一个模组翻译了，在第2个模组还要再翻译相同的词。 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 其次，每种语言一个exe/bpl，如果你的系统是Package切割，bpl也是每种语言一个，还要小心别把不同语言的bpl组合在了一起，到时候一个画面显示中文，一个显示德文（有一个可能是乱码）就惨了。 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 再次，在作bpl组装的系统时，第3方元件如果没有提供多语言的方案，你就需要修改第3方元件，但一般我们不这样干，因为第3方元件会随时更新，难道每次人家更新你也再更新人家。 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 因此，一般都没有人使用Delphi本身提供的这个方案（除了作demo）。 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 2、Resource dll方式 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 用单独的ResourceDll，用LoadResString等函数获得翻译字串，但你要到处写这个函数来一一替换，特别是Form上的字串，噢，会累死人。字典可以重用。 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 3、网上讨论很多的ini文件方式 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 此方法是写个替换的引擎，在运行时从ini文件读取语言字串来替换画面元件的显示文字。这个方法比第一种进步很多，不需要每种语言编译一个exe了，只要 提供不同的ini文件就好；画面修改时如果ini没有同步更新也不会出现致命错误，最多就是某个文字没有转换；引擎也提供了字串转换函数，因此也可以处理 主动弹出的消息。这个方法在文件格式上有三种不同的实现： <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (1)、[编号]=[字串] <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 每个字串从1开始编号，1，2，3，4......，很麻烦，代码要修改，当然运行时切换语言没问题。 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (2)、[元件.属性]=[字串] <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 这种实现把元件instance一一对应，用RTTI来判断属性，替换很精确，也可以运行时切换语言。不足之处是，略显呆板，多个元件相同的字串会多次列 出；没有扩展性，表现TListView的Columns等复杂元件时比较吃力。 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (3)、[旧字串]=[新字串] <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 不管元件的instance，ini是纯粹的语言对照表，或者叫字典，扩展性、运行时切换语言可能在引擎里。不足之处是不能处理一词多义。 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 总的说来，这种方式有很大进步，但为了用ini文件，大家还要费力的破解64k的限制，更专业的方式是使用自定义的文件格式。 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 在简单性方面，无疑是这种自定义的转换引擎，[旧字串]=[新字串]的文件格式来得方便，借助字典管理工具，字典文件可以重复使用，也可以提供给专业翻译 公司翻译。那么剩下的问题在引擎上，如何方便，最好用户不写一行代码；如何扩展性强，支持任意的第三方元件；如何有弹性，同一个画面有多种语言的文字，同 一个词可以转换成不同的意思...... <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 4、给每个元件类继承一个子类，在子类的Loaded方法里转换文字。由于要处理的都是叶级元件（虽然TLabel、TPanel都是从 TCustomControl来，但不能只处理TCustomControl），工作量比较大；对旧有程序除了换元件无能为力。 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 5、为每个元件类注册一个转换函数，引擎遍历Container，为每个元件找到血源最近的转换函数，调用这个函数转换这个元件的文字。这样可以不必处理 叶结点，只需在恰当的元件层上注册函数；不必改动旧有程序。設計時Form上只需要放一個轉換元件，這個元件在Loaded后開始掃描Form上的元件， 從for I:=0 to ComponentCount-1或從for i:=0 to ControlCount-1遞歸，找到一個元件就去查找其血緣最近的註冊函數，然後調用這個函數替換其文字。因爲註冊函數是額外加上去的，所以不會動到 舊的代碼，對任意第方元件都可以擴展支持，且也不用去修改人家第3方元件的代碼。 <br />我认为第5种方法很优雅，看起来比较干净。用GOF的设计模式来套，这属 于Mediator pattern(中介者模式)。多年前，我们使用一个叫TXPMenu的元件来获得XP风格的界面，也是感觉到它很干净，一个元件就搞定一切，不用 TLabel换成TFlatLabel,TButton换成TFlatButton......我记得《程序员》上还有文章专门称赞这个元件。但那个元件 没有使用中介者模式，不能很好的扩展对第3方元件的支持。 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; 最后，我们畅想一下，如果我是Borland，如何在Delphi里完整支援多语言。Delphi提供了一个区块定义的关键字 “ResourceString”，在这个区块定义的字串常量，编译器会把它编译在exe文件的资源区，运行时用LoadStringA这个 Windows API来读取，因此有些外部转换工具可以直接从exe文件读取这些资源字串，再写入转换后的字串；内嵌的转换引擎也可以拦截这个API函数来转换文字。但 是如果exe里的字串资源化不彻底，就无能为力，这个不彻底恰恰来自Delphi的DFM文件，Delphi把DFM文件整个作为一项资源放在exe里， 其上的字串就没法决定是否要don`t resource（Delphi源码里很多常量字串都有这个提示）了。 <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; 如果除了string,widestring,ansistring等等这些数据类型，delphi增加一种数据类型multistring，然后修改 vcl元件定义（拜托Borland连同Unicode一起解决了吧），像TLabel.Caption定义成MultiString，对 MultiString类型，有一种专门的处理方法，如类似ResourceString用LoadString API来处理，每次读取就转换一次，但应该比这个内容更多，比如要传出instance，然后提供一个全局的ApplicationMulti元件，类似 ApplicationEvent，让外面能捕捉到。至于字典，只能外部用户提供（当然可以制定一个标准格式让delphi人都可以共享交换）。 <br />&#160;&#160;&#160;&#160;&#160; 此法看起来可行，但还有个效率问题要考虑，（1）每次读取都转换，对频繁 draw的东西效率低；（2）比如一个ToolBar有好多的ToolButton，批次更新时一般都会用 BeginUpdate/EndUpdate，vcl如何告知后代来提高这种效率。（补记：效率看起来不是问题，对多次字串更改导致频繁draw，其实元 件自己已经会用beginupdate/endupdate处理，外部不会涉及）</font></p> <p class="read-more">Continue reading <a class="heading" href="/delphi/2011/05/25/delphi-7-e7-bc-96-e8-af-91-e7-9a-84-e7-a8-8b-e5-ba-8f-e4-bb-bb-e4-bd-95-e7-b3-bb-e7-bb-9f-e9-83-bd-e6-ad-a3-e5-b8-b8-e6-98-be-e7-a4-ba.html" data-flip="title">Delphi 7编译的程序任何系统都正常显示</a></p> </article> <article id="post-delphi/2011/05/25/delphi%e5%85%a5%e9%97%a8%e7%ac%94%e8%ae%b0" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/delphi/2011/05/25/delphi-e5-85-a5-e9-97-a8-e7-ac-94-e8-ae-b0.html" data-flip="title"> delphi入门笔记 </a> </h1> <p class="post-date heading"> <time datetime="2011-05-25T14:54:01+08:00">25 May 2011</time> in <span>Delphi</span> on <span>Delphi</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <div>源码资源 : <a href="http://subsimple.com/delphi.asp"><span>http://subsimple.com/delphi.asp</span></a></div> <div>《从入门到精通》 文档中有备份</div> <div>《从入门到精通》</div> <div>一般应该重写free方法而不是destroy方法， D不提供垃圾回收机制，需要自己回收内存。</div> <div>接口方法用静态方法绑定实现生成代码比虚方法实现要小。</div> <div>except和finally不能同时使用。</div> <div>子类隐藏父类虚方法不会起到滞后联编的效果，但是覆盖接口的方法却是可以并且是提倡的。</div> <div>program pt;</div> <div>{$APPTYPE CONSOLE}</div> <div>uses</div> <div>SysUtils;</div> <div>type</div> <div>IT = interface</div> <div>['{A2E180BC-7372-4894-9FB9-9AD286B700CF}']</div> <div>procedure M1;</div> <div>end;</div> <div>type</div> <div>TA = class(TInterfacedObject,IT)</div> <div>public</div> <div>procedure M1();</div> <div>end;</div> <div>procedure TA.M1();</div> <div>begin</div> <div>Writeln('Am');</div> <div>end;</div> <div>type</div> <div>TB = class(TA,IT) //重新声明继承IT接口，如果不这样，不会起到滞后联编的效果</div> <div>public</div> <div>procedure M1();</div> <div>end ;</div> <div>procedure TB.M1() ;</div> <div>begin</div> <div>Writeln('Bm');</div> <div>end;</div> <div>var t:IT;</div> <div>begin</div> <div>t := TB.Create;</div> <div>t.M1;</div> <div>Readln;</div> <div>end.</div> <div> <p>使用delphi7 lite集成了cnpack,但是代码提示快捷键无法修改(ctrl+space),其他快捷键可在</p> </div> <div><a href="http://174.120.8.254/~sopoboke/wp/wp-content/uploads/2011/05/image001.jpg"><img class="alignnone size-full wp-image-54" src="/assets/image001.jpg" alt="" width="491" height="646" /></a></div> <div><a href="http://174.120.8.254/~sopoboke/wp/wp-content/uploads/2011/05/image002.jpg"><img class="alignnone size-full wp-image-55" src="/assets/image002.jpg" alt="" width="862" height="560" /></a></div> <div>快捷键:</div> <div>格式化:ctrl+shift+F</div> <div>----------------------------------------------------------------------------------------构造函数</div> <div>每个应用程序将分配给其运行的内存分为四个区域：&nbsp;</p> <p>代码区(Code area)<br /> 全局数据区(data area)<br /> 堆区(heap area)<br /> 栈区(stack area)</p> </div> <div>图2 程序内存空间<br /> 代码区：存储程序中程序代码，包括所有的函数代码<br /> 全局数据区：存储全局数据。<br /> 堆区：又叫“自由存储区”,存储动态数据（在Delphi中包括对象和字符串）。作用域为整个应用程序的整个生命周期直到调用了析构方法。<br /> 栈区：又叫“自动存储区”存储程序中的局部数据，在C 中，局部变量实际上是auto类型的变量。作用域为函数内部，函数调用完系统就立即回收栈空间。<br /> 在C 中，对象既可创建在堆(heap)上，也可以创建在栈(stack)中，还可以在全局数据中创建对象，故C 有全局对象、局部对象、静态对象和堆对象四种对象之说。而在Delphi中，所有的对象都是建立堆（heap）存储区上，所以<span style="color: blue">Delphi构造函数不能自 动被调用，而必须由程序员自己调用(在设计器拖动组件，此时对象由Delphi创建)</span>。下面的程序说明Delphi和C 中创建对象的区别：<br /> 在Delphi中：<br /> Procedure CreateObject(var FooObjRef:TFooObject);<br /> begin<br /> FooObjRef:=TfooObject.create;<br /> //由程序员调用,过程调用完之后,对象依然存在.不需要进行拷贝<br /> FooObject.caption=’I am created in stack of CreateObject()’;<br /> End;</div> <div>在做popupmanager时</div> <div>EnumWindows(@popwatcher.ProcessFun, LPARAM(self));//一定要这样写@popwatcher.ProcessFun,网上的都没搞清楚，而且这个函数不能是类的函数（静态和对象都不行），否则虽然会调用但是会抛内存访问错误。</div> <div>另外LPARAM(self)和LPARAM(@self)都能work,偶不懂。尝试自己转指针，没有成功，直接在参数定义上与传入参数一致就可以了：function ProcessFun(hwnd: HWND; <span style="color: blue">pw:TPopWatcher</span>): boolean; stdcall;&nbsp;</p> <p>&nbsp;</p> </div> <div>Vista提供的UAC机制，是Vista的新增功能之一。它的主要目的是防止对于操作系统本身的恶意修改。如果想对于Vista的系统设置进行改动，必须通过UAC的验证才能够进行。通过这样的手段，大大提供了系统的安全性。&nbsp;</p> <p>关于UAC的利弊，网络上的说法褒贬不一，在这里就不具体讨论了。</p> <p>对于Delphi程序的影响，UAC主要在于以下几点：</p> <p>1、由于UAC机制，Delphi对于系统的操作可能无声的失败，而同样的程序，在2000/X下面可能运行正常。譬如注册表的改动。。。</p> <p>2、为了避免这样的情况，Delphi程序必须支持Vista UAC标注，也就是说，在UAC程序的图标下面显示盾牌标志。这样可以在需要系统更高权限的时候，提醒用户。</p> <p>为了让程序显示UAC标志，现在看来Vista是通过读取程序的资源（Resource）里面的MANIFEST资源，来决定是否显示“UAC盾牌”。</p> <p>为了支持Vista，Delphi程序必须在资源里面嵌入MANIFEST信息。</p> <p>1、首先编辑一个文件，内容如下：</p> <p>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;<br /> &lt;assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0"&gt;<br /> &lt;trustInfo xmlns="urn:schemas-microsoft-com:asm.v3"&gt;<br /> &lt;security&gt;<br /> &lt;requestedPrivileges&gt;<br /> &lt;requestedExecutionLevel level="requireAdministrator"/&gt;<br /> &lt;/requestedPrivileges&gt;<br /> &lt;/security&gt;<br /> &lt;/trustInfo&gt;<br /> &lt;/assembly&gt;</p> <p>保持为UAC.manifest，这里文件是随意的。特别注意红色的“requireAdministrator”，这个表示程序需要管理员（Administrator）才能正常运行。</p> <p>2、然后编辑一个RC文件，名为uac.rc</p> <p>1 24 UAC.manifest</p> <p>其中：</p> <p>1-代表资源编号</p> <p>24-资源类型为RTMAINIFEST</p> <p>UAC.manifest-前面的文件名称</p> <p>3、用brcc32编译这个rc文件为res文件</p> <p>brcc32 uac.rc -fouac.res</p> <p>4、在程序里面加入</p> <p><span style="color: blue">{$R uac.res}  //注意这一步，必须添加。不要以为{$R *.res}中的*是包含所有，它是指对应的意思，对你程序中包含的文件会包含其对应的.res，例如abc.pas会包含abc.res(如果有)</span></p> <p>让Delphi编译的时候，把uac.res编译进exe文件</p> <p>5、把文件放到vista里面运行，就会看程序图标下面显示UAC盾牌标志了。</p> <p>&nbsp;</p> </div> <p class="read-more">Continue reading <a class="heading" href="/delphi/2011/05/25/delphi-e5-85-a5-e9-97-a8-e7-ac-94-e8-ae-b0.html" data-flip="title">delphi入门笔记</a></p> </article> <article id="post-%E6%95%B0%E6%8D%AE%E5%BA%93/2011/05/25/nosql%e7%ac%94%e8%ae%b0" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/%E6%95%B0%E6%8D%AE%E5%BA%93/2011/05/25/nosql-e7-ac-94-e8-ae-b0.html" data-flip="title"> nosql笔记 </a> </h1> <p class="post-date heading"> <time datetime="2011-05-25T14:17:32+08:00">25 May 2011</time> in <span>数据库</span> on <span>Nosql</span>, <span>数据库</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">NoSQL 是非关系型数据存储的广义定义。它打破了长久以来关系型数据库与</span><a href="http://en.wikipedia.org/wiki/ACID"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">ACID</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> 理论大一统的局面。NoSQL 数据存储不需要固定的表结构，通常也不存在</span><a href="http://en.wikipedia.org/wiki/Join_%28SQL%29"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">连接</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">操作。在大数据存取上具备关系型数据库无法比拟的性能优势。该术语在 2009 年初得到了广泛认同。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">当今的应用体系结构需要数据存储在</span><a href="http://en.wikipedia.org/wiki/Scalability"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">横向伸缩性</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">上能够满足需求。而 NoSQL 存储就是为了实现这个需求。Google 的</span><a href="http://en.wikipedia.org/wiki/BigTable"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">BigTable</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">与</span><a href="http://en.wikipedia.org/wiki/Amazon"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">Amazon</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> 的</span><a href="http://en.wikipedia.org/wiki/Dynamo_%28storage_system%29"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">Dynamo</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">是非常成功的商业 NoSQL 实现。一些开源的 NoSQL 体系，如Facebook 的</span><a href="http://en.wikipedia.org/wiki/Cassandra_%28database%29"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">Cassandra</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">， Apache 的</span><a href="http://en.wikipedia.org/wiki/HBase"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline"> HBase</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">，也得到了广泛认同。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">如果您刚接触 NoSQL，那有必要学习一些背景知识。下列资料是Kas Thomas，一位国外的</span><a href="http://asserttrue.blogspot.com/"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">技术分析师</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">认为非常有价值的 NoSQL 相关必读资料：</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">先看看这个吧 <a href="http://sebug.net/paper/databases/nosql/Nosql.html">http://sebug.net/paper/databases/nosql/Nosql.html</a></span></p> <p><a href="http://s3.amazonaws.com/AllThingsDistributed/sosp/amazon-dynamo-sosp2007.pdf"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">Amazon Dynamo 论文</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">。几乎所有懂 NoSQL 的人都阅读过它。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Google 的</span><a href="http://labs.google.com/papers/bigtable.html"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">Bigtable 论文</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">。 也许您已经耳熟能详。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Werner Vogels 的</span><a href="http://www.allthingsdistributed.com/2008/12/eventually_consistent.html"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">Eventually Consistent</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> （发布于</span><a href="http://delivery.acm.org/10.1145/1470000/1466448/p14-vogels.pdf?key1=1466448key2=8241830621coll=GUIDEdl=GUIDECFID=65986758CFTOKEN=76261788"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">ACM Queue</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">）。如果您对最终一致性不是非常清晰，请阅读这篇文章。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Brewer 的 CAP 理论（可伸缩性的基础）在</span><a href="http://www.julianbrowne.com/article/viewer/brewers-cap-theorem"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">这里</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">可以找到非常好的诠释。也可以看看 2000 7 月 PODC 上 Brewer的</span><a href="http://www.cs.berkeley.edu/%7Ebrewer/cs262b-2004/PODC-keynote.pdf"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">原始幻灯片</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">。</span></p> <p><a href="http://blog.oskarsson.nu/2009/06/nosql-debrief.html"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">在 2009 年 6 月在 SFO 的 NoSQL 见面会的幻灯片</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">。这些资料可以用经典的、关键的、将影响巨大的、值得纪念的来形容。</span></p> <p><a href="http://adam.blog.heroku.com/past/2009/7/6/sql_databases_dont_scale/"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">SQL Databases Don’t Scale</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> 是一篇简短、基础、直切问题的文章。除非您是一位在伸缩性问题上身经百战的数据库管理员，否则，这篇文章讲述的内容对于您可能是非常关键的。</span></p> <p><a href="http://twitter.com/spyced"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">Jonathan Ellis</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> 的文章</span><a href="http://www.rackspacecloud.com/blog/2009/11/09/nosql-ecosystem/"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">NoSQL Ecosystem</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> 以表格的方式对当今主流的分布式数据库做了比较。类似的比较还有</span><a href="http://themindstorms.blogspot.com/2009/05/quick-reference-to-alternative-data.html"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">Quick Reference to Alternative data storages</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">。Ellis 的文章除了表格对比外对于想了解 NoSQL 生态的人来说是非常值得一读的，该文章内涵丰富，短小精悍；而</span><a href="http://themindstorms.blogspot.com/2009/05/quick-reference-to-alternative-data.html"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">Quick Reference to Alternative data storages</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> 主要是表格，这些表格对比的内容又比 Ellis 的完整。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: bold; text-decoration: none">【相关国外资源】</span></p> <p><a href="http://nosql-databases.org/"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">http://nosql-databases.org/</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> 该站点的标语是：非关系型世界的终结向导！，该站点非常确信自己是：在互联网上拥有 NoSQL 相关链接最多的网站。总之，该网站值得关注。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">另外，作为 NoSQL 极客（geeks），请 follow</span><a href="http://twitter.com/nosqlupdate"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">@nosqlupdate</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">。另外，请 follow</span><a href="http://twitter.com/al3xandru"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">@al3xandru</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> （</span><a href="http://nosql.mypopescu.com/"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">MyNoSQL blog</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> 与</span><a href="http://nosql.mypopescu.com/post/272903545/nosql-week-review-part-1"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">NoSQL Week in Review</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> 的创建者）。</span><a href="http://nosql.mypopescu.com/post/272903545/nosql-week-review-part-1"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">NoSQL Week in Review</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> 比较新，希望能保持正常更新，因为它确实很棒！</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">当然，您还可以看看 Ricky Ho 最近的博文，他总结了一些分布式数据存储技术关键点。他的博文中有两篇非常值得一看的文章：</span><a href="http://horicky.blogspot.com/2009/11/query-processing-for-nosql-db.html"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">Query Processing for NoSQL Databases</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">，还有</span><a href="http://horicky.blogspot.com/2009/11/nosql-patterns.html"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">NoSQL Design Patterns</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">（《程序员》杂志有译文）。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">--------------------------------------------------------------------------------------------------------------------------</span></p> <p><a href="http://adam.heroku.com/past/2009/7/6/sql_databases_dont_scale/"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000099; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">http://adam.heroku.com/past/2009/7/6/sql_databases_dont_scale/</span></a></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #0000ff; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">此文章非常有用,它对之前主流的分布式数据库的概念进行了批判。</span></p> <h1><a href="http://adam.heroku.com/"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000099; font-size: 24pt; vertical-align: baseline; font-weight: bold; text-decoration: underline">a tornado of razorblades</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span></h1> <h1><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">by Adam Wiggins</span></h1> <h1><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 18pt; vertical-align: baseline; font-weight: bold; text-decoration: none">SQL Databases Don't Scale</span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span></h1> <h2><a href="http://adam.heroku.com/past/tags/databases"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000099; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">databases</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span></h2> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Mon Jul 06 12:51:22 -0700 2009 </span></h2> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">A question I’m often asked about Heroku is: “How do you scale the SQL database?” There’s a lot of things I can say about using caching, sharding, and other techniques to take load off the database. But the actual answer is: we don’t. SQL databases are fundamentally non-scalable, and there is no magical pixie dust that we, or anyone, can sprinkle on them to suddenly make them scale.</span></h2> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 18pt; vertical-align: baseline; font-weight: bold; text-decoration: none">What Is Scaling?</span></h2> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">To qualify as true scaling, I believe a technique must fit the following criteria:</span></h2> <ol> <li><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Horizontal scale: more servers creates more capacity. 水平扩展性(也称Scale out)</span> </li> <li><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Transparent to the application: the business logic of the app should be separated from concerns of scaling server resources. 透明性</span> </li> <li><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">No single point of failure: there should be no one server which, if lost, causes downtime of the application. 没有单点故障</span> </li> </ol> <p>&#160;</p> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">As an example from the hardware world, a RAID5 disk array offers true scaling:</span></h2> <ol> <li><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Horizontal scale: you can run a RAID5 with 4 disks, or 12, or 20; more disks gives you more drive space and (generally) better performance.</span> </li> <li><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Transparent to the application: applications using the RAID as a single device. My text editor doesn’t care that the file it is saving or loading is split across many disks.</span> </li> <li><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">No single point of failure: you can pop out a drive and the array will continue to function (albeit with a performance hit, known as “degraded mode”). Replace the drive and it will rebuild itself. All of this happens without the applications using the RAID being aware any interruption of the functioning of the disk storage.</span> </li> </ol> <p>&#160;</p> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">So let’s take a look at some of the techniques used to “scale” SQL databases, and why they all fail to achieve the criteria above.</span></h2> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 18pt; vertical-align: baseline; font-weight: bold; text-decoration: none">Vertical Scaling 垂直扩展性</span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">[关系数据库的扩展方式的问题，相对于水平扩展性，纵向扩展性（也称Scale up）]</span></h2> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">One way to scale a SQL database is to buy a bigger box. This is usually called “vertical scaling.” I sometimes call it: Moore’s law scaling. What are the problems with this?</span></h2> <ul> <li><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">It’s a complicated transaction that usually requires manual labor from ops people and substantial downtime.</span> </li> <li><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">The old machine is useless afterward. This wastes resources and encourages you to overprovision, buying a big server before you know you’re really going to need it.</span> </li> <li><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">There’s a cap on how big you can go.</span> </li> </ul> <p>&#160;</p> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">I know plenty of folks who have bumped their head on the last point (usually somewhere around a 256-core Sun server) and now they are painted into a corner. They find themselves crossing their fingers and hoping that they’ll stop growing - not cool at all.</span></h2> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">So yes, you can put a SQL database on a bigger box to buy yourself more headroom. But this fails point #1 on my checklist for true scaling.</span></h2> <h2>之前的分布式也是主要使用水平扩展的，这里是说nosql更好的支持水平扩展。</h2> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 18pt; vertical-align: baseline; font-weight: bold; text-decoration: none">Partitioning, aka Sharding </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">分区/分片破坏RDBS数据关系</span></h2> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Sharding divides your data along some kind of application-specific boundary. For example, you might store users whose names start with A-M on one database, and N-Z on another. Or use a modulo of the user id by the number of databases.</span></h2> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">This requires deep integration into the application and careful planning of the partitioning scheme relative to the database schema and the kinds of queries you want to do. Summary: big pain in the ass.</span></h2> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">So while sharding is a form of horizontal scaling, it fails point #2: it is not transparent to the business logic of the application.</span></h2> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">The deeper problem with sharding is that SQL databases are relational databases, and most of the value in a relational database is that it stores </span><span style="background-color: transparent; font-style: italic; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">relationships</span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">. Once you split records across multiple servers, you’re servering many of those relations; they now have to be reconstructed on the client side. Sharding kills most of the value of a relational database.</span></h2> <p>&#160;</p> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 18pt; vertical-align: baseline; font-weight: bold; text-decoration: none">Read Slaves </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">主从模式的局限性</span></h2> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">MySQL’s killer feature is easy configuration of master-slave replication, where you have a read-only slave database that replicates everything coming to the master database in realtime. You can then create a routing proxy between the clients and your database (or build smart routing into the client library) which sends any reads (SELECT) to one of the read slaves, while only sending writes (INSERT, UPDATE, DELETE) to the master.</span></h2> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Postgres has replication via</span><a href="http://www.slony.info/"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000099; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">Slony</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">, though it’s much more cumbersome to set up than MySQL’s replication. Years ago I even did basic master-slave replication with a 50-line Perl script that read from the query log and mirrored all write queries over to the slave. So replication is possible just about anywhere, with differing degrees of setup and maintenance headaches.</span></h2> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">The read slave technique is the best option for scaling SQL databases. It qualifies as horizontal scaling on the read side, and is transparent to the application. This is the technique that many of the largest MySQL installs use.</span></h2> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">And yet, this is still ultimately a limited technique. </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #0000ff; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">The master server is a bottleneck</span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">, particularly on write-heavy applications. And it fails point #3 on the true scaling definition: </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #0000ff; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">there is a single point of failure</span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">. This is a problem not only when the database fails, but when you want to perform maintenance on the server. Promoting one of the read slaves to master allows you to recover relatively quickly, but this switcharoo requires hands-on attention from the sysadmins.</span></h2> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #0000ff; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">主数据库存在瓶颈，因此存在单点故障</span></p> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">And while it qualifies as horizontal scaling for read performance, it does not qualify for writes and capacity. Horizontal scaling should spread out both the load of executing queries and the data storage itself. This is how you can grow the total storage space of a RAID: add enough disks, and you can get a RAID which has a much greater capacity than any single hard drive on the market. </span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #0000ff; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Read slaves require complete copies of the database, so you still have a ceiling on how much data you can store.</span></h2> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #0000ff; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">读-从数据库需要数据的完整复制，因此任然存在存储天花板--硬盘能存多少东西？</span></p> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 18pt; vertical-align: baseline; font-weight: bold; text-decoration: none">A Long-Term Solution</span></h2> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">So where do we go from here? Some might reply “keep trying to make SQL databases scale.” I disagree with that notion. When hundreds of companies and thousands of the brightest programmers and sysadmins have been trying to solve a problem for twenty years and still haven’t managed to come up with an obvious solution that everyone adopts, that says to me the problem is unsolvable. Like Kirk facing the Kobayashi Maru, we can only solve this problem by redefining the question.</span></h2> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">---------------------------------------------------------------------------------------------------------------------------</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">文章 </span><a href="http://horicky.blogspot.com/2009/11/query-processing-for-nosql-db.html"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #888888; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">Query Processing for NoSQL Databases</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none"> ：</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #0000ff; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">大体意思是nosql有两个局限：</span></p> <ol> <li><span style="background-color: transparent; font-style: normal; font-family: arial; color: #0000ff; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">It calls for a more relaxed data consistency model</span> </li> </ol> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #0000ff; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">它是个简单关系的模型</span></p> <ol> <li><span style="background-color: transparent; font-style: normal; font-family: arial; color: #0000ff; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">It provides primitive querying and searching capability</span> </li> </ol> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #0000ff; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">他只提供原始的查询能力，例如键值对的键查询</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">----------------------------------------------------------------------------------------------------------------------------</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #0000ff; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">孙立文章&#160; 不错</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">在 过去，我们只需要学习和使用一种数据库技术，就能做几乎所有的数据库应用开发。因为成熟稳定的关系数据库产品并不是很多，而供你选择的免费版本就更加少 了，所以互联网领域基本上都选择了免费的MySQL数据库。在高速发展的WEB2.0时代，我们发现关系数据库在性能、扩展性、数据的快速备份和恢复、满 足需求的易用性上并不总是能很好的满足我们的需要，我们越来越趋向于根据业务场景选择合适的数据库，以及进行多种数据库的融合运用。几年前的一篇文章《</span><a href="http://www.google.com.hk/search?q=One+Size+Fits+All+-+An+Idea+Whose+Time+Has+Come+and+Gone"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000099; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">One Size Fits All - An Idea Whose Time Has Come and Gone</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">》就已经阐述了这个观点。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">当我们在讨论是否要使用NoSQL的时候，你还需要理解NoSQL也是分很多种类的，在NoSQL百花齐放的今天，NoSQL的正确选择比选择关系数据库还具有挑战性。虽然NoSQL的使用很简单，但是选择却是个麻烦事，这也正是很多人在观望的一个原因。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">NoSQL的分类</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">NoSQL仅仅是一个概念，NoSQL数据库根据数据的存储模型和特点分为很多种类。</span></p> <table style="border-bottom-style: none; border-right-style: none; border-collapse: collapse; border-top-style: none; border-left-style: none"> <colgroup> <col width="48" /></colgroup> <colgroup> <col width="187" /></colgroup> <colgroup> <col width="379" /></colgroup> <tbody> <tr style="height: 0px"> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">类型</span></td> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">部分代表</span></td> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">特点</span></td> </tr> <tr style="height: 0px"> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">列存储</span></td> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Hbase,Cassandra,</span> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Hypertable</span></p> </td> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">顾名思义，是按列存储数据的。最大的特点是方便存储结构化和半结构化数据，方便做数据压缩，对针对某一列或者某几列的查询有非常大的IO优势。</span></td> </tr> <tr style="height: 0px"> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">文档存储</span></td> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">MongoDB,CouchDB</span></td> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">文档存储一般用类似json的格式存储，存储的内容是文档型的。这样也就有有机会对某些字段建立索引，实现关系数据库的某些功能。</span></td> </tr> <tr style="height: 0px"> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">key-value存储</span></td> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Tokyo Cabinet / TyrantBerkeley DBMemcacheDBRedis</span></td> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">可以通过key快速查询到其value。一般来说，存储不管value的格式，照单全收。（Redis包含了其他功能）</span></td> </tr> <tr style="height: 0px"> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">图存储</span></td> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Neo4J,FlockDB</span></td> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">图形关系的最佳存储。使用传统关系数据库来解决的话性能低下，而且设计使用不方便。</span></td> </tr> <tr style="height: 0px"> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">对象存储</span></td> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">db4o,Versant</span></td> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">通过类似面向对象语言的语法操作数据库，通过对象的方式存取数据。</span></td> </tr> <tr style="height: 0px"> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">xml数据库</span></td> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Berkeley DB XMLBaseX</span></td> <td style="border-bottom: #aaa 1px dotted; border-left: #aaa 1px dotted; padding-bottom: 7px; padding-left: 7px; padding-right: 7px; vertical-align: top; border-top: #aaa 1px dotted; border-right: #aaa 1px dotted; padding-top: 7px"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">高效的存储XML数据，并支持XML的内部查询语法，比如XQuery,Xpath。</span></td> </tr> </tbody> </table> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">以上NoSQL数据库类型的划分并不是绝对，只是从存储模型上来进行的大体划分。它们之间没有绝对的分界，也有交差的情况，比如Tokyo Cabinet / Tyrant的Table类型存储，就可以理解为是文档型存储，Berkeley DB XML数据库是基于Berkeley DB之上开发的。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">NoSQL还是关系数据库</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">虽然09年出现了比较激进的文章《</span><a href="http://www.google.com.hk/search?q=%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B7%B2%E6%AD%BB"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000099; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">关系数据库已死</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">》，但是我们心里都清楚，关系数据库其实还活得好好的，你还不能不用关系数据库。但是也说明了一个事实，关系数据库在处理WEB2.0数据的时候，的确已经出现了瓶颈。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">那么我们到底是用NoSQL还是关系数据库呢？我想我们没有必要来进行一个绝对的回答。我们需要根据我们的应用场景来决定我们到底用什么。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">如 果关系数据库在你的应用场景中，完全能够很好的工作，而你又是非常善于使用和维护关系数据库的，那么我觉得你完全没有必要迁移到NoSQL上面，除非你是 个喜欢折腾的人。如果你是在金融，电信等以数据为王的关键领域，目前使用的是Oracle数据库来提供高可靠性的，除非遇到特别大的瓶颈，不然也别贸然尝 试NoSQL。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">然而，在WEB2.0的网站中，关系数据库大部分都出现了瓶颈。在磁盘IO、数据库可扩展上都花费了开发人员相当多的精力来优化，比如做分 表分库 （database sharding）、主从复制、异构复制等等，然而，这些工作需要的技术能力越来越高，也越来越具有挑战性。如果你正在经历这些场合，那么我觉得你应该尝 试一下NoSQL了。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">选择合适的NoSQL</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">如此多类型的NoSQL，而每种类型的NoSQL又有很多，到底选择什么类型的NoSQL来作为我们的存储呢？这并不是一个很好回答的问题，影 响我们选择 的因素有很多，而选择也可能有多种，随着业务场景，需求的变更可能选择又会变化。我们常常需要根据如下情况考虑：</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">数据结构特点。包括结构化、半结构化、字段是否可能变更、是否有大文本字段、数据字段是否可能变化。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">写入特点。包括insert比例、update比例、是否经常更新数据的某一个小字段、原子更新需求。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">查询特点。包括查询的条件、查询热点的范围。比如用户信息的查询，可能就是随机的，而新闻的查询就是按照时间，越新的越频繁。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">NoSQL和关系数据库结合</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">其实NoSQL数据库仅仅是关系数据库在某些方面（性能，扩展）的一个弥补，单从功能上讲，NoSQL的几乎所有的功能，在关系数据库上都能够满足，所以选择NoSQL的原因并不在功能上。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">所以，</span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #0000ff; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">我们一般会把NoSQL和关系数据库进行结合使用，各取所长，需要使用关系特性的时候我们使用关系数据库，需要使用NoSQL特性的时候我们使用NoSQL数据库，各得其所。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">举 个简单的例子吧，比如用户评论的存储，评论大概有主键id、评论的对象aid、评论内容content、用户uid等字段。我们能确定的是评论内容 content肯定不会在数据库中用where content=’’查询，评论内容也是一个大文本字段。那么我们可以把 主键id、评论对象aid、用户id存储在数据库，评论内容存储在NoSQL，这样数据库就节省了存储content占用的磁盘空间，从而节省大量IO， 对content也更容易做Cache。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">//从MySQL中查询出评论主键id列表</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">commentIds=DB.query(&quot;SELECT id FROM comments where aid=’评论对象id’ LIMIT 0,20&quot;);</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">//根据主键id列表，从NoSQL取回评论实体数据</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">CommentsList=NoSQL.get(commentIds);</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">NoSQL代替MySQL</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">在某些应用场合，比如一些配置的关系键值映射存储、用户名和密码的存储、Session会话存储等等，用NoSQL完全可以替代MySQL存储。不但具有更高的性能，而且开发也更加方便。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #0000ff; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">NoSQL作为缓存服务器</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">MySQL+Memcached的架构中，我们处处都要精心设计我们的缓存，包括过期时间的设计、缓存的实时性设计、缓存内存大小评估、缓存命中率等等。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">NoSQL数据库一般都具有非常高的性能，在大多数场景下面，你不必再考虑在代码层为NoSQL构建一层Memcached缓存。NoSQL数据本身在Cache上已经做了相当多的优化工作。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Memcached这类内存缓存服务器缓存的数据大小受限于内存大小，如果用NoSQL来代替Memcached来缓存数据库的话，就可以不再受限于内存大小。虽然可能有少量的磁盘IO读写，可能比Memcached慢一点，但是完全可以用来缓存数据库的查询操作。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">规避风险</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">由于NoSQL是一个比较新的东西，特别是我们选择的NoSQL数据库还不是非常成熟的产品，所以我们可能会遇到未知的风险。为了得到NoSQL的好处，又要考虑规避风险，鱼与熊掌如何兼得？</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">现 在业内很多公司的做法就是数据的备份。在往NoSQL里面存储数据的时候还会往MySQL里面存储一份。NoSQL数据库本身也需要进行备份（冷备和热 备）。或者可以考虑使用两种NoSQL数据库，出现问题后可以进行切换（</span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #0000ff; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">避免出现digg使用Cassandra的悲剧[全盘使用nosql出现问题]</span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">）。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">总结</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">本文只是简单的从MySQL和NoSQL的角度分析如何选择，以及进行融合使用。其实在选择NoSQL的时候，你可能还会碰到关于CAP原则，最终一致性，BASE思想的考虑。因为使用MySQL架构的时候，你也会碰到上面的问题，所以这里没有阐述。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">----------------------------------------------------------------------------------------------------------------------------</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">nosql 介绍[孙立]-</span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #7f6000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">-</span><span style="background-color: transparent; font-style: normal; font-family: arial; color: #0000ff; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">文章泛泛而谈,nosql--mysql比较</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">非 常荣幸能受邀在InfoQ开辟这样一个关于NoSQL的专栏，InfoQ是我非常尊重的一家技术媒体，同时我也希望借助InfoQ，在国内推动 NoSQL的发展，希望跟我一样有兴趣的朋友加入进来。这次的NoSQL专栏系列将先整体介绍NoSQL，然后介绍如何把NoSQL运用到自己的项目中合 适的场景中，还会适当地分析一些成功案例，希望有成功使用NoSQL经验的朋友给我提供一些线索和信息。</span></p> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 18pt; vertical-align: baseline; font-weight: bold; text-decoration: none">NoSQL概念</span></h2> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">随着web2.0的快速发展，非关系型、分布式数据存储得到了快速的发展，它们不保证关系数据的ACID特性。</span><a href="http://nosql-database.org/"><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000099; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: underline">NoSQL</span></a><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">概念在2009年被提了出来。NoSQL最常见的解释是“non-relational”，“Not Only SQL”也被很多人接受。（“NoSQL”一词最早于1998年被用于一个轻量级的关系数据库的名字。）</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">NoSQL被我们用得最多的当数key-value存储，当然还有其他的文档型的、列存储、图型数据库、xml数据库等。在NoSQL概念提出之前，这些数据库就被用于各种系统当中，但是却很少用于web互联网应用。比如cdb、qdbm、bdb数据库。</span></p> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 18pt; vertical-align: baseline; font-weight: bold; text-decoration: none">传统关系数据库的瓶颈</span></h2> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">传统的关系数据库具有不错的性能，高稳定型，久经历史考验，而且使用简单，功能强大，同时也积累了大量的成功案例。在互联网领域，MySQL成为了绝对靠前的王者，毫不夸张的说，MySQL为互联网的发展做出了卓越的贡献。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">在90年代，一个网站的访问量一般都不大，用单个数据库完全可以轻松应付。在那个时候，更多的都是静态网页，动态交互类型的网站不多。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">到了最近10年，网站开始快速发展。火爆的论坛、博客、sns、微博逐渐引领web领域的潮流。在初期，论坛的流量其实也不大，如果你接触网络比较早，你可能还记得那个时候还有文本型存储的论坛程序，可以想象一般的论坛的流量有多大。</span></p> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 18pt; vertical-align: baseline; font-weight: bold; text-decoration: none">Memcached+MySQL</span></h2> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">后 来，随着访问量的上升，几乎大部分使用MySQL架构的网站在数据库上都开始出现了性能问题，web程序不再仅仅专注在功能上，同时也在追求性 能。程序员们开始大量的使用缓存技术来缓解数据库的压力，优化数据库的结构和索引。开始比较流行的是通过文件缓存来缓解数据库压力，但是当访问量继续增大 的时候，多台web机器通过文件缓存不能共享，大量的小文件缓存也带了了比较高的IO压力。在这个时候，Memcached就自然的成为一个非常时尚的技 术产品。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">Memcached 作为一个独立的分布式的缓存服务器，为多个web服务器提供了一个共享的高性能缓存服务，在Memcached服务器上，又发展 了根据hash算法来进行多台Memcached缓存服务的扩展，然后又出现了一致性hash来解决增加或减少缓存服务器导致重新hash带来的大量缓存 失效的弊端。当时，如果你去面试，你说你有Memcached经验，肯定会加分的。</span></p> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 18pt; vertical-align: baseline; font-weight: bold; text-decoration: none">Mysql主从读写分离</span></h2> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">由于数据库的写入压力增加，Memcached只能缓解数据库的读取压力。读写集中在一个数据库上让数据库不堪重负，大部分网站开始使用主从复制技术来达到读写分离，以提高读写性能和读库的可扩展性。Mysql的master-slave模式成为这个时候的网站标配了。</span></p> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 18pt; vertical-align: baseline; font-weight: bold; text-decoration: none">分表分库</span></h2> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">随 着web2.0的继续高速发展，在Memcached的高速缓存，MySQL的主从复制，读写分离的基础之上，这时MySQL主库的写压力开始出 现瓶颈，而数据量的持续猛增，由于MyISAM使用表锁，在高并发下会出现严重的锁问题，大量的高并发MySQL应用开始使用InnoDB引擎代替 MyISAM。同时，开始流行使用分表分库来缓解写压力和数据增长的扩展问题。这个时候，分表分库成了一个热门技术，是面试的热门问题也是业界讨论的热门 技术问题。也就在这个时候，MySQL推出了还不太稳定的表分区，这也给技术实力一般的公司带来了希望。虽然MySQL推出了MySQL Cluster集群，但是由于在互联网几乎没有成功案例，性能也不能满足互联网的要求，只是在高可靠性上提供了非常大的保证。</span></p> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 18pt; vertical-align: baseline; font-weight: bold; text-decoration: none">MySQL的扩展性瓶颈</span></h2> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">在 互联网，大部分的MySQL都应该是IO密集型的，事实上，如果你的MySQL是个CPU密集型的话，那么很可能你的MySQL设计得有性能问 题，需要优化了。大数据量高并发环境下的MySQL应用开发越来越复杂，也越来越具有技术挑战性。分表分库的规则把握都是需要经验的。虽然有像淘宝这样技 术实力强大的公司开发了透明的中间件层来屏蔽开发者的复杂性，但是避免不了整个架构的复杂性。分库分表的子库到一定阶段又面临扩展问题。还有就是需求的变 更，可能又需要一种新的分库方式。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">MySQL数据库也经常存储一些大文本字段，导致数据库表非常的大，在做数据库恢复的时候就导致非常的慢，不容易快速恢复数据库。比如1000万4KB大小的文本就接近40GB的大小，如果能把这些数据从MySQL省去，MySQL将变得非常的小。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">关系数据库很强大，但是它并不能很好的应付所有的应用场景。MySQL的扩展性差（需要复杂的技术来实现），大数据下IO压力大，表结构更改困难，正是当前使用MySQL的开发人员面临的问题。</span></p> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 18pt; vertical-align: baseline; font-weight: bold; text-decoration: none">NOSQL的优势[<font color="#0000ff">总结的好</font>]</span></h2> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: bold; text-decoration: none">易扩展</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">NoSQL数据库种类繁多，但是一个共同的特点都是去掉关系数据库的关系型特性。<font color="#0000ff">数据之间无关系，这样就非常容易扩展。也无形之间，在架构的层面上带来了可扩展的能力。</font></span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: bold; text-decoration: none">大数据量，高性能</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">NoSQL 数据库都具有非常高的读写性能，尤其在大数据量下，同样表现优秀。<font color="#0000ff">这得益于它的无关系性，数据库的结构简单</font>。一般MySQL使用 Query Cache，每次表的更新Cache就失效，是一种大粒度的Cache，在针对web2.0的交互频繁的应用，Cache性能不高。而NoSQL的 Cache是记录级的，是一种细粒度的Cache，所以NoSQL在这个层面上来说就要性能高很多了。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: bold; text-decoration: none">灵活的数据模型</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">NoSQL无需事先为要存储的数据建立字段，随时可以存储自定义的数据格式。而在关系数据库里，增删字段是一件非常麻烦的事情。如果是非常大数据量的表，增加字段简直就是一个噩梦。这点在大数据量的web2.0时代尤其明显。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: bold; text-decoration: none">高可用</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">NoSQL在不太影响性能的情况，就可以方便的实现高可用的架构。比如Cassandra，HBase模型，通过复制模型也能实现高可用。</span></p> <h2><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 18pt; vertical-align: baseline; font-weight: bold; text-decoration: none">总结</span></h2> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">NoSQL数据库的出现，弥补了关系数据（比如MySQL）在某些方面的不足，在某些方面能极大的节省开发成本和维护成本。</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">MySQL和NoSQL都有各自的特点和使用的应用场景，两者的紧密结合将会给web2.0的数据库发展带来新的思路。让关系数据库关注在关系上，NoSQL关注在存储上</span></p> <p><span style="background-color: transparent; font-style: normal; font-family: arial; color: #000000; font-size: 11pt; vertical-align: baseline; font-weight: normal; text-decoration: none">-----------------------------------------------------------------------------------------------------------------------</span></p> <p class="read-more">Continue reading <a class="heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/2011/05/25/nosql-e7-ac-94-e8-ae-b0.html" data-flip="title">nosql笔记</a></p> </article> <h2 class="sr-only">Pagination</h2> <nav class="pagination heading" role="navigation"> <ul> <li class="pagination-item older" > <span>Older</span> </li> <li class="pagination-item newer" > <a rel="prev" href="/page-68/">Newer</a> </li> </ul> </nav> <footer> <hr/> <p>© 2011 - 2017. All rights reserved.</p> <p> <code>Powered by <a href="https://qwtel.com/hydejack/">Hydejack</a> v<span id="_version">6.6.1</span></code> </p> </footer> </main> </div> <div id="_yDrawer"> <div id="_sidebar" class="sidebar"> <div class="sidebar-bg" style="background-color:#4f86aa;background-image:url()"></div> <header class="sidebar-sticky" role="banner"> <div class="sidebar-about"> <img src="https://avatars0.githubusercontent.com/u/4122902?v=4&s=460" class="me" /> </div> <div class="sidebar-about"> <h1><a id="_title" href="/">Ka's Blog</a></h1> <p>Ka’s blog description…</p> </div> <nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span> <ul> <li> <a class="sidebar-nav-item" href="/categories.html">Categories</a> </li> <li> <a class="sidebar-nav-item" href="/archive.html">Archive</a> </li> <li> <a class="sidebar-nav-item" href="/tags.html">Tags</a> </li> <li> <a class="sidebar-nav-item" href="/about.html">About</a> </li> </ul> </nav> <div class="sidebar-social"> <span class="sr-only">Social:</span> <ul> <li> <a href="https://twitter.com/imhazige" title="Twitter"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a> </li> <li> <a href="https://github.com/imhazige" title="GitHub"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a> </li> <li> <a href="mailto:imhazige@gmail.com" title="Email"> <span class="icon-mail"></span> <span class="sr-only">Email</span> </a> </li> <li> <a href="https://imhazige.github.io/myblog/feed.xml" title="RSS"> <span class="icon-rss2"></span> <span class="sr-only">RSS</span> </a> </li> </ul> </div> </header> </div> </div> </div> <!--[if gt IE 9]><!----> <script>loadJSDeferred('/assets/js/hydejack.js?v=6.6.1');</script> <!--<![endif]--> </body>
</html>
