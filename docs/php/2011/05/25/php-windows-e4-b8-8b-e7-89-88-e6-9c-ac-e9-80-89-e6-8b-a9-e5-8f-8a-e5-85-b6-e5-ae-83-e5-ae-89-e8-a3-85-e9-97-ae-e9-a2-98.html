<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v6.6.1 <https://qwtel.com/hydejack/>
--><head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="format-detection" content="telephone=no"> <meta http-equiv="x-ua-compatible" content="ie=edge"> <title>PHP windows下版本选择及其它安装问题 &middot; Ka's Blog</title> <meta name="description" content="这个问题只会是你在windows开发时存在，linux下没这么个情况。 看了半天，大概了解了： apache的mod_php+php的Thread Safe v6版本。 apache的mod_fcgid+php的None Thread Safe v6版本。[我认为这个比较接近linux环境,推荐这个,使用进程就不存在线程问题] 另外php Debug Pack是为调试php本身用的与php使用者调试器zonedebuger,xdebuger不同 php apache2安装指南 http://docs.php.net/manual/zh/install.windows.apache2.php Windows下PHP的线程安全（Thread Safe）版本和非线程安全（None Thread Safe）版本的选择？ 八月 6th, 2010 Posted by zsj4cn 今天又在本机装了一下apache+php，在下载php的时候发现windows版本已经不在php.net主站下面了，有了一个独立的子域名：windows.php.net。 还有，我以前没有发现php for windows还有Thread Safe版本和None Thread Safe本版，一时还不该盲目下载来用。 查阅了一下资料，总结一下： windows+apache2.2+php5.3 在都默认安装的情况下，apache2.2用了mpm_winnt_module本身是多线 程，apache的mod_php方式相当于上面家属的ISAPI方式被调用，php本身是线程安全的，但是php下的第三方扩展就不一定了。在这种情况 下，php应该选Thread Safe的安装程序。 如果调整一下配置，我建议用apache的mod_fcgid+php的None Thread Safe版本。 扩展阅读： http://www.juyo.org/juyo/original/php-Thread-Safe/ …先从字面意思上理解，None-Thread Safe就是非线程安全，在执行时不进行线程（thread）安全检查；Thread Safe就是线程安全，执行时会进行线程（thread）安全检查，以防止有新要求就启动新线程的 CGI 执行方式耗尽系统资源。 再来看PHP的两种执行方式：ISAPI和FastCGI。FastCGI执行方式是以单一线程来执行操作，所以不需要进行线程的安全检查，除去线程安全 检查的防护反而可以提高执行效率，所以，如果是以..."> <link rel="canonical" href="http://localhost:4000/php/2011/05/25/php-windows-e4-b8-8b-e7-89-88-e6-9c-ac-e9-80-89-e6-8b-a9-e5-8f-8a-e5-85-b6-e5-ae-83-e5-ae-89-e8-a3-85-e9-97-ae-e9-a2-98.html"> <link rel="alternate" type="application/atom+xml" title="Ka's Blog Feed" href="http://localhost:4000/feed.xml"> <link rel="prev" href="http://localhost:4000/php/2011/05/25/e8-bd-acphp-e7-9a-84require-e5-92-8cinclude-e8-b7-af-e5-be-84-e9-97-ae-e9-a2-98-e7-bb-8f-e9-aa-8c-e6-80-bb-e7-bb-93-e8-a2-ab-e5-8c-85-e5-90-ab-e8-b7-af-e5-be-84-e5-bc-84-e6-99-95-e4-ba-86-e7-9a-84.html"> <link rel="next" href="http://localhost:4000/php/2011/05/25/e8-bd-acwindows-e4-b8-adphp4-php5-e5-85-b1-e5-ad-98-e4-b9-8b-e9-81-93-e5-8a-a0-e5-85-a5-e4-b8-aa-e4-ba-ba-e9-81-87-e5-88-b0-e7-9a-84-e9-97-ae-e9-a2-98.html"> <link rel="apple-touch-icon" href="/apple-touch-icon.png"> <!-- Place favicon.ico in the root directory --> <link rel="stylesheet" href="/assets/style.css"> <link id="_katexJS" rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.js"> <link id="_katexCSS" rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css"> <!--[if gt IE 8]><!----> <script> WebFontConfig = { google: { families: 'Roboto+Slab:700|Noto+Sans:400,400i,700,700i'.split('|') }, custom: { families: ['icomoon'], urls: ['/assets/icomoon/style.css'] } }; </script> <!--<![endif]--> <script> !function(n,e){function t(n,e){n.onload=function(){this.onerror=this.onload=null,e(null,n)},n.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),n)}}function o(n,e){n.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,e(null,n))}}n._loaded=!1,n.loadJSDeferred=function(a,d){function r(){n._loaded=!0;var r=e.createElement("script");r.src=a,d&&(("onload"in r?t:o)(r,d),r.onload||t(r,d));var l=e.getElementsByTagName("script")[0];l.parentNode.insertBefore(r,l)}n._loaded?r():n.addEventListener?n.addEventListener("load",r,!1):n.attachEvent?n.attachEvent("onload",r):n.onload=r}}(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); window.disablePushState = false; window.disableDrawer = false; </script> <!--[if lt IE 9]> <script src="/assets/bower_components/html5shiv/dist/html5shiv.min.js"></script> <![endif]--> <!--[if gt IE 8]><!----> <style> article, aside, dialog, figcaption, figure, footer, header, hgroup, main, nav, section { display: block; } mark { background: #FF0; color: #000; } * { box-sizing: border-box; } html, body { margin: 0; padding: 0; } html { font-size: 16px; line-height: 1.75; } body { color: #333; background-color: #fff; overflow-y: scroll; } a { text-decoration: none; } .lead { margin-left: -1rem; margin-right: -1rem; } img, .img { display: block; max-width: 100%; margin-bottom: 1rem; border: none; } img.lead, .img.lead { max-width: calc(100% + 2rem); width: calc(100% + 2rem); } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-weight: bold; text-rendering: optimizeLegibility; } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 { margin: 3rem 0 1rem; line-height: 1.6; } h1, .h1 { font-size: 2rem; line-height: 1.25; } h2, .h2 { font-size: 1.5rem; } h3, .h3 { font-size: 1.17em; } p { margin-top: 0; margin-bottom: 1rem; } p.lead { font-size: 1.25rem; font-weight: 300; padding: 0 1rem; } ul, ol, dl { margin-top: 0; margin-bottom: 1rem; } ul, ol { padding-left: 1.25rem; } hr { position: relative; margin: 1.5rem 0; border: 0; border-top: 1px solid #eee; } .hr { padding-bottom: .5rem; border-bottom: 1px solid #eee; margin-bottom: 1.5rem; } h4, h5, h6, .h4, .h5, .h6 { margin-bottom: 0.5rem; font-size: 1rem; } table { margin-bottom: 1rem; width: 100%; width: calc(100% + 2rem); margin-left: -1rem; border: 1px solid #e5e5e5; border-collapse: collapse; border-spacing: 0; } td, th { padding: .25rem .5rem; border: 1px solid #e5e5e5; } td:first-child, th:first-child { padding-left: 1rem; } td:last-child, th:last-child { padding-right: 1rem; } thead + tbody, tbody + tbody, tfoot { border-top: 3px double #e5e5e5; } tbody tr:nth-child(odd) td, tbody tr:nth-child(odd) th { background-color: #f9f9f9; } footer { margin-bottom: 2rem; } .page, .post { margin-bottom: 3em; } .page li + li, .post li + li { margin-top: .25rem; } .page > header, .post > header { margin-bottom: 2rem; } .page-title, .post-title { margin-top: 0; } .post-date { display: block; margin-top: -0.5rem; margin-bottom: 1rem; color: #9a9a9a; } .related-posts { padding-left: 0; list-style: none; } .related-posts > li, .related-posts > li + li { margin-top: 1rem; } .related-posts > li > small, .related-posts > li + li > small { font-size: 75%; color: #9a9a9a; } .message { margin-bottom: 1rem; padding: 1rem; color: #787878; background-color: #f9f9f9; margin-left: -1rem; margin-right: -1rem; } /* * Global resets * * Update the foundational and global aspects of the page. */ body, main { /* Prevent side-scrolling on mobile */ position: relative; overflow-x: hidden; } @media screen { body::before { content: ''; width: .5rem; background: #e5e5e5; position: absolute; left: 0; top: 0; bottom: 0; } } @media screen and (min-width: 40em) { html { font-size: 17px; } } @media screen and (min-width: 54em) { html { font-size: 16px; } } @media screen and (min-width: 72em) { html { font-size: 17px; } } @media screen and (min-width: 125em) { html { font-size: 18px; } } .sr-only { display: none; } .clearfix, .sidebar-social::after, .clearafter::after { content: ""; display: table; clear: both; } a, .a { position: relative; padding-bottom: .15rem; border-bottom: 1px solid; } .img { overflow: hidden; background-color: #f9f9f9; } .img > img { margin: 0; width: 100%; height: 100%; } .sixteen-nine { position: relative; } .sixteen-nine::before { display: block; content: ""; width: 100%; padding-top: 56.25%; } .sixteen-nine > * { position: absolute; top: 0; left: 0; right: 0; bottom: 0; } h1 + hr, h2 + hr, h3 + hr, h4 + hr, h5 + hr, h6 + hr { margin-top: 0; } .fade-in { animation-duration: 500ms; animation-name: fade-in; animation-fill-mode: forwards; } @keyframes fade-in { from { transform: translateY(-2rem); opacity: 0; } 50% { transform: translateY(-2rem); opacity: 0; } to { transform: translateY(0); opacity: 1; } } .mb6 { margin-bottom: 6rem; } .sidebar { color: rgba(255, 255, 255, 0.75); text-align: left; /* Sidebar links */ } .sidebar::before { /* make sidebar slightly darker to increase text readability (when using a background image) */ content: ""; position: absolute; z-index: 2; top: 0; left: 0; bottom: 0; right: 0; background: linear-gradient(to bottom, rgba(32, 32, 32, 0) 0%, rgba(32, 32, 32, 0.5) 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */ } .sidebar a { color: #fff; border-bottom-color: rgba(255, 255, 255, 0.2); } #_yDrawer { position: relative; padding: 1rem 0; } @media screen { #_yDrawer { padding: 2rem 1rem; min-height: 640px; min-height: 100vh; } } @media screen and (min-width: 54em) { #_yDrawer { position: fixed; top: 0; left: 0; bottom: 0; width: 18rem; margin-left: 0; } } @media screen and (min-width: 97.5em) { #_yDrawer { width: calc(50% - 28rem); } } @media screen { #_yDrawer.loaded { min-height: 0; padding: 0; } } .sidebar-bg { position: absolute; top: 0; right: 0; bottom: 0; left: 0; background: #202020 center / cover; } .sidebar-sticky { position: relative; z-index: 3; } @media screen { .sidebar-sticky { position: absolute; right: 2rem; bottom: 1rem; left: auto; max-width: 14rem; } } @media print { .sidebar-sticky { padding: 0 2rem; } } /* About section */ .sidebar-about > h1 { color: #fff; font-size: 2rem; } .sidebar-nav > ul { list-style: none; padding-left: 0; margin-bottom: .5rem; } a.sidebar-nav-item { font-weight: bold; display: block; line-height: 1.75; padding: .25rem 0; border-bottom: 1px solid rgba(255, 255, 255, 0.2); } @media screen { .y-drawer-scrim { z-index: 2; } .y-drawer-content { width: 18rem; left: -17.5rem; z-index: 3; } } @media screen and (min-width: 97.5em) { .y-drawer-content { width: calc(50% - 28rem); } } .sidebar-social { margin-bottom: .5rem; } .sidebar-social > ul { list-style: none; padding-left: 0; margin: 0 -.25rem; } .sidebar-social > ul > li { float: left; margin: 0 .25rem; } .sidebar-social > ul > li > a { display: inline-block; text-align: center; font-size: 1.6rem; line-height: 3rem; width: 3.1249rem; height: 4rem; padding: .5rem 0; } .sidebar-social > ul li + li { margin-top: 0; } .fixed-top { position: fixed; top: 0; left: 0; width: 100%; z-index: 1; } .navbar > .content { padding-top: 0; padding-bottom: 0; min-height: 0; height: 0; } .menu { display: inline-block; padding: 1.75rem 1.5rem; border-bottom: none; margin-left: -1.5rem; color: #9a9a9a !important; } .menu::after { content: "\2630"; } @media screen and (min-width: 54em) { .menu { padding: 1.25rem 1.5rem; position: absolute; left: -9999px; } .menu:focus { position: static; } } .animation-main { pointer-events: none; } .loading { display: none; } @media print { .menu { display: none; } } .animation-main { opacity: 0; will-change: opacity; } .loading { position: absolute; top: 0; right: 0; padding: 5.25rem 4.5rem; transform-origin: top right; transform: scale(0.33); } .content { position: relative; margin-left: auto; margin-right: auto; padding: 5rem 1rem 12rem; } @media screen { .content { max-width: 38rem; padding-left: 1.5rem; min-height: 100vh; } } @media screen and (min-width: 54em) { .content { max-width: 42rem; padding: 4rem 1rem 12rem; margin-left: 22rem; margin-right: 4rem; } } @media screen and (min-width: 72em) { .content { margin-left: 22rem; margin-right: 4rem; } } @media screen and (min-width: 92em) { .content { max-width: 48rem; } } @media screen and (min-width: 97.5em) { .content { margin: auto; } } .me { float: right; width: 6.5rem; height: 6.5rem; margin-left: 1rem; margin-bottom: .5rem; border-radius: 100%; position: relative; } @media screen and (min-width: 40em) { .me { width: 7rem; height: 7rem; } } @media screen and (min-width: 54em) { .me { width: 6.5rem; height: 6.5rem; } } @media screen and (min-width: 60em) { .me { width: 7rem; height: 7rem; } } main > footer { position: absolute; bottom: 0; left: 0; right: 0; padding: 0 1rem; color: #9a9a9a; font-size: smaller; text-align: center; } main > footer > p { margin-bottom: 0; } /* .card, .pagination-item { border-radius: 0!important; } */ /* @media screen { .sidebar-sticky { left: 2rem; max-width: none; } } */ html { font-family: Helvetica, Arial, sans-serif; } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: Helvetica, Arial, sans-serif; } </style> <link id="_stylePreload" rel="preload" as="style" href="/assets/css/hydejack.css?v=6.6.1"> <script>document.getElementById('_stylePreload').onload=function(){this.rel='stylesheet'}</script> <!-- NOTE: These styles interact with JavsScript, so they MUST NOT be changed --> <style id="_pageStyle"> .content a { color: #4f86aa; border-color: rgba(79, 134, 170, 0.2); } .content a:hover { border-color: #4f86aa; } :focus { outline-color: #4f86aa; } ::selection { color: #fff; background: #4f86aa; } ::-moz-selection { color: #fff; background: #4f86aa; } </style> <noscript> <link rel="stylesheet" href="/assets/css/hydejack.css?v=6.6.1"> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700|Noto+Sans:400,400i,700,700i"> <style> html { font-family: 'Noto Sans', Helvetica, Arial, sans-serif } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: 'Roboto Slab', Helvetica, Arial, sans-serif } </style> <link rel="stylesheet" href="/assets/icomoon/style.css"> </noscript> <!--<![endif]--> <!--[if gt IE 8]><!----> <script async src="/assets/bower_components/webfontloader/webfontloader.js"></script> <!--<![endif]--> </head> <body> <div class="navbar fixed-top"> <div class="content"> <span class="sr-only">Jump to:</span> <a id="_menu" class="menu no-hover" href="#_title"> <span class="sr-only">Menu</span> </a> </div> </div> <div id="_yPushState"> <div class="fade-in"> <main id="_main" class="content" role="main" data-color="#4f86aa" data-image=""> <article id="post-php/2011/05/25/php-windows%e4%b8%8b%e7%89%88%e6%9c%ac%e9%80%89%e6%8b%a9%e5%8f%8a%e5%85%b6%e5%ae%83%e5%ae%89%e8%a3%85%e9%97%ae%e9%a2%98" class="post" role="article"> <header> <h1 class="post-title"> PHP windows下版本选择及其它安装问题 </h1> <p class="post-date heading"> <time datetime="2011-05-25T15:55:19+08:00">25 May 2011</time> in <span>Php</span> on <span>Php</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>这个问题只会是你在windows开发时存在，linux下没这么个情况。 <br />看了半天，大概了解了： <br />apache的mod_php+php的Thread Safe v6版本。 <br />apache的mod_fcgid+php的None Thread Safe v6版本。[我认为这个比较接近linux环境,推荐这个,使用进程就不存在线程问题] <br />另外php Debug Pack是为调试php本身用的与php使用者调试器zonedebuger,xdebuger不同 <br />php apache2安装指南 <br /><a href="http://docs.php.net/manual/zh/install.windows.apache2.php">http://docs.php.net/manual/zh/install.windows.apache2.php</a> <br />Windows下PHP的线程安全（Thread Safe）版本和非线程安全（None Thread Safe）版本的选择？ <br />八月 6th, 2010 Posted by zsj4cn <br />今天又在本机装了一下apache+php，在下载php的时候发现windows版本已经不在php.net主站下面了，有了一个独立的子域名：windows.php.net。 <br />还有，我以前没有发现php for windows还有Thread Safe版本和None Thread Safe本版，一时还不该盲目下载来用。 <br />查阅了一下资料，总结一下： <br />windows+apache2.2+php5.3 在都默认安装的情况下，apache2.2用了mpm_winnt_module本身是多线 程，apache的mod_php方式相当于上面家属的ISAPI方式被调用，php本身是线程安全的，但是php下的第三方扩展就不一定了。在这种情况 下，php应该选Thread Safe的安装程序。 <br />如果调整一下配置，我建议用apache的mod_fcgid+php的None Thread Safe版本。 <br />扩展阅读： <br /><a href="http://www.juyo.org/juyo/original/php-Thread-Safe/">http://www.juyo.org/juyo/original/php-Thread-Safe/</a> <br />…先从字面意思上理解，None-Thread Safe就是非线程安全，在执行时不进行线程（thread）安全检查；Thread Safe就是线程安全，执行时会进行线程（thread）安全检查，以防止有新要求就启动新线程的 CGI 执行方式耗尽系统资源。 <br />再来看PHP的两种执行方式：ISAPI和FastCGI。FastCGI执行方式是以单一线程来执行操作，所以不需要进行线程的安全检查，除去线程安全 检查的防护反而可以提高执行效率，所以，如果是以 FastCGI（无论搭配 IIS 6 或 IIS 7）执行 PHP ，都建议下载、执行 non-thread safe 的 PHP …。而线程安全检查正是为ISAPI方式的PHP准备的，因为有许多php模块都不是线程安全的，所以需要使用Thread Safe的PHP。 <br />说到这里，大家应该知道应该如何选择哪个版本的PHP了。None-Thread Safe or Thread Safe，您会选择哪个？ <br /><a href="http://blog.bluesky.cn/archives/472/php-thread-safe-and-non-thread-safe-version-of-the-distinction-between.html">http://blog.bluesky.cn/archives/472/php-thread-safe-and-non-thread-safe-version-of-the-distinction-between.html</a> <br />… 从2000年10月20日发布的第一个Windows版的PHP3.0.17开始的都是线程安全的版本，这是由于与Linux/Unix系统是采用多进 程的工作方式不同的是Windows系统是采用多线程的工作方式。如果在IIS下以CGI方式运行PHP会非常慢，这是由于CGI模式是建立在多进程的基 础之上的，而非多线程。一般我们会把PHP配置成以ISAPI的方式来运行，ISAPI是多线程的方式，这样就快多了。但存在一个问题，很多常用的PHP 扩展是以Linux/Unix的多进程思想来开发的，这些扩展在ISAPI的方式运行时就会出错搞垮IIS。因此在IIS下CGI模式才是PHP运行的最 安全方式，但CGI模式对于每个HTTP请求都需要重新加载和卸载整个PHP环境，其消耗是巨大的。 <br />为了兼顾IIS下PHP的效率和安全，微软给出了FastCGI的解决方案。FastCGI可以让PHP的进程重复利用而不是每一个新的请求就重开一个进 程。同时FastCGI也可以允许几个进程同时执行。这样既解决了CGI进程模式消耗太大的问题，又利用上了CGI进程模式不存在线程安全问题的优势。 <br />因此，如果是使用ISAPI的方式来运行PHP就必须用Thread Safe(线程安全)的版本；而用FastCGI模式运行PHP的话就没有必要用线程安全检查了，用None Thread Safe(NTS，非线程安全)的版本能够更好的提高效率。 <br />-------------------------------------------------------------------------------------------------------------------------</p> <h3>php非线程安全和线程安全版本有什么区别</h3> <ul> <li>5月 7th, 2010</li> <li>Posted in<a href="http://www.edushiba.cn/?cat=7"> E都市吧PHP学习</a></li> <li><a href="http://www.edushiba.cn/?p=664#comments">Write comment</a></li> </ul> <p>php5.3 版本有线程安全和非线程安全两种二进制for windows，我不明白这两种有什么区别，从网上没找到合适的答案，我用apache2.2+php5.2，一开始用非线程安全的apache启动不起 来，后换成线程安全的就可以了，不明白其中的原因？下面是一些相关解释可以看看。 <br />看到zend debuger有非线程安全的版本，才知道PHP推出了非线程安全的版本。而此前我对非线程安全一无所知： <br />另一篇文章好像说这个跟 FASTCGI有点关系。 <br />这是一段文字，不过我没看明白： <br />php本身是线程安全的。一个服务进程可以安全地提供多请求线程的支持 <br />一些扩展并不遵守 <br />例如：线程安全的扩展中，全局变量的定义不是像普通C程序那样直接定义在函数之外，而是定义在宏 ZEND_BEGIN_MODULE_GLOBALS和 ZEND_END_MODULE_GLOBALS之间。需要ZTS（Zend Thread Safe）支持的扩展需要包含TSRM.h头文件，并定义TSRMG宏值 <br />在不支持线程安全的扩展中，仅是简单地认为一个服务进程同时只有一个请求在激活状态，不会出现冲突，那么全局变量可以简单地在RINIT函数中初始化（RINIT表示请求开始）并在RSHUTDOWN中注销： <br />CODE:[Copy to clipboard]PHP_RINIT_FUNCTION(ext) <br />{ <br />counter = 0; <br />} <br />PHP_FUNCTION(ext) <br />{ <br />RETURN_LONG(counter++); <br />} <br />…这就是一个很简单的计数器。只要请求没有结束，每次调用ext，都会触发 counter自增。 <br />当在多线程环境中时，这个程序会发生严重的混乱，counter会变得飘忽不定，因为没有办法预测线程的触发和结束顺序及时间。这说明这个扩展并非线程级安全。 <br />多线程，Apache 1.3 和 Apache 2.0 <br />如 果您已经使用了 Apache 和 PHP 一段时间了，那么您很可能见到过安装文档中的一个警告信息，它说“不要在生产环境中使用 Apache 2.0.x 和 PHP，在 Unix 和 Windows 上都不行”。在 Windows 系统上的 PHP 5.0.2 包中，这个警告信息可以在 install.txt 文件中的第 745 行找到。我们需要理解此处的这个问题是什么，这样就可以决定是否要使用 Apache 2.0 或 IBM HTTP Server 2.0。 <br />Apache 2.0 可以配置为以两种方法运行：采用线程的和不采用线程的。当作为一个采用线程的服务器运行时，服务器中可以同时有多个线程都处于活动状态在执行，一次可以为 多个用户生成响应信息。通常，这样可以提高服务器的响应能力，使其更好地利用具有多个处理器的大型硬件。但是它同时也引入了一种风险。服务器调用的各个软 件层次必须在同时为多个用户调用时都能保证是安全的。尽管 Web 服务器本身、PHP 解释器以及 PHP 扩展以这样调用都是安全的，但是有些 PHP 扩展会使用其他语言（例如 C 语言）编写的库，这些库并不全都是线程安全的。 <br />在 Apache Web 页面上您可以找到一个有关这个问题的讨论，其中给出了一些建议，以及一种用来发现您的 PHP 扩展可能正在使用哪些 C 库以及哪些是线程安全的方法，请参阅参考资料部分。 <br />在 实践中，很多人都会选择回避这个问题，而是采用下面的两种方法：要么以单线程模式使用 Apache 2.0，要么使用 Apache 1.3，它总是以单线程模式运行。虽然 Apache 1.3 和 2.0 也有其他一些区别，例如 Apache 2.0 可以支持 IPv6，但是到目前为止，二者之间最大的区别就是线程的问题，因此保留使用 Apache 1.3 服务器并不像听起来一样是一种退化。 <br />这 个问题在 IBM HTTP Server 中是怎样的呢？IBM 采用线程模式从 Apache 2.0 中编译出了 IBM HTTP Server：这样速度更快，但却可能在使用非线程安全的扩展时是不安全的。由于 IBM 并没有同时发行源代码，而且选择采用线程和不采用线程的模式都是在编译时进行选择的，因此作为一个终端用户来说，您无法选择采用不使用线程的模式重新编译 IBM HTTP Server 2.0。不过在编写本文时，IBM 正在同时发行基于 2.0 和 1.3 版本的 IBM HTTP Server，这样您就可以选择使用单线程的基于 1.3 版本的服务器了。 <br />---------------------------------------------------------------------------------------------------------------------------- <br /> 关于Apache的MPM【转自apache模块开发指南】 <br />2010年03月16日 星期二 14:23<br /> <h5>2.3.1 为什么需要MPM</h5> <p>老版本的NCSA server和Apache 1是在UNIX系统中成长起来的。当时Apache是一个多进程服务器，一个服务进程处理一个用户请求，如果当前并发客户访问数量大于服务进程 数，Apache便会增加新的服务进程来处理当前请求。在正常情况下，Apache会维护一定数量的服务进程来处理用户的请求。</p> <p>尽管这种多进程服务机 制在Unix类系统中能够很好地工作，但是在其他的平台上效率却很低，如在Windows中产生一个进程是非常费时的。因此，让Apache真正实现跨平 台还需要其他的方法。Apache 2采用的方法是把核心任务处理作为一个可插拔的模块，即MPM，使其能针对不同的环境进行优化。MPM架构允许不同的Apache模块在一个操作系统平台 下共存，能够为用户根据不同应用做出选择。</p> <p>在实际应用中，只 有UNIX类操作系统有其他的选择，而其他系统平台（Windows、Netware、OS/2、BeOS）则只有唯一的根据操作系统优化的MPM。在 UNIX平台上，Apache 2.2目前已经有两种高质量的、作为标准的MPM（Prefork和Worker），第三种（Eevent方式）在不使用SSL的情况下也是稳定可靠的。 另外还有一些MPM可以实验应用，暂时不适合产品应用。其他第三方的MPM模块也是可用的。</p> <h5>2.3.2 UNIX类的MPM模块</h5> <p> Prefork MPM基于非线程模型，和Apache 1.x版本中的MPM很相似。Prefork MPM在所有情况下都很安全，对运行非线程安全（non-thread-safe）模式的软件如PHP，它是唯一的安全选择。对于某些应用程序，包括在 Apache 1.3上非常流行的程序（如简单静态页面、CGI脚本等），Prefork MPM是最好的选择。 <br />Worker MPM基于线程模式，具有内存消耗低（对繁忙的服务很重要）、扩展性在某些特定应用情况下比Prefork更好等优点。在稍后介绍SQL数据库支持和mod_dbd模块时我们会讨论其中一些内容。 <br />以上两种稳定的MPM方式在非常繁忙的服务器应用下都有些不足。尽管 HTTP的Keepalive方式能减少TCP连接数量和网络负载，但是Keepalive需要和服务进程或者线程绑定，这就导致一个繁忙的服务器会耗光 所有的线程。Event MPM是解决这个问题的一种新模型，它把服务进程从连接中分离出来。在服务器处理速度很快，同时具有非常高的点击率时，可用的线程数量就是关键的资源限 制，此时Event MPM方式是最有效的。一个以Worker MPM方式工作的繁忙服务器能够承受每秒好几万次的访问量（例如在大型新闻服务站点的高峰时），而Event MPM可以用来处理更高负载。值得注意的是，Event MPM不能在安全HTTP（HTTPS）访问下工作。 <br />还有一些针对UNIX系统的、处于实验中的MPM，在本书编写过程 中，它们在继续开发，有的可能已经实现了。Perchild MPM具有一个非常好的特性：以不用的用户ID为不同的虚拟主机运行Apache服务器。其他的一些MPM也提供类似的功能，包括第三方的Metux和 Peruser，以及mod_ruid（只支持Linux）。为了运行外部程序，还可选择fastcgi/mod_fcgid和suexec（CGI）。 作者对第三方的解决方案没有相应的了解，因此不能作出相应的评价。<br /> <h5>2.3.3 MPM模块和操作系统</h5> <p>一言以蔽之：对应用程序来说，MPM方式很少见，应该忽略!</p> <p>既然MPM内部机制不是应用程序接口的一部 分，Apache的应用开发者不需要知道MPM的细节。这里就简单带过。一些为应用开发者提供的最佳实践的基本规则（命名机制、编写安全线程、交叉进程安 全、代码重入）将会在第4章中简单介绍。这里主要介绍开发平台无关代码。事实上，有时应用程序的开发平台更要考虑MPM而不是操作系统。</p> <p>有时一个应用程序更加适应于某个MPM。例如，数据库驱动或者 负载均衡应用程序得益于thread MPM方式的连接池（在本书稍后讨论）。反之，产生子进程（原始的CGI实现或者mod_ext_filter）在一个基于线程的程序中会产生巨大开销， 因此在Prefork MPM方式下工作得更好。然而，除非某些特殊限制，应用程序应该考虑如何适应在非首选的MPM下工作。</p> <p>如果你想让Apache运行在现在还不支持Apache的操作系统上，那么首要的任务是在APR库中增加对目标平台的支持。APR库用来提供操作系统层的支持。一个定制的MPM不是必需的，但是它很可能比已有的MPM提供更好的性能。从Apache的角度出发，这</p> <p>是一个系统编程的任务，因此它已经超出一本应用程序开发书籍的介绍范围。</p> </article> <hr class="dingbat" /> <!-- <aside class="author" role="complementary"> <div class="author"> <img src="https://avatars0.githubusercontent.com/u/4122902?v=4&s=460" class="me" alt="Ka" /> <h2 class="page-title hr"> About </h2> <p>About Me…</p> <div class="sidebar-social"> <span class="sr-only">Social:</span> <ul> <li> <a href="https://twitter.com/imhazige" title="Twitter"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a> </li> <li> <a href="https://github.com/imhazige" title="GitHub"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a> </li> <li> <a href="mailto:imhazige@gmail.com" title="Email"> <span class="icon-mail"></span> <span class="sr-only">Email</span> </a> </li> <li> <a href="https://imhazige.github.io/myblog/feed.xml" title="RSS"> <span class="icon-rss2"></span> <span class="sr-only">RSS</span> </a> </li> </ul> </div> </div> </aside> --> <div style="text-align: center; " class="kazge-after-content" id="kazge-677219085"> <p><a href="https://itunes.apple.com/us/app/volitant-egg-ads-version/id1247264387?mt=8" target="_blank"><br> <img src="/assets/volitantegg-show.gif" alt=""><br> </a></p> </div> <aside class="related" role="complementary"> <h2 class="hr">Related Posts</h2> <ul class="related-posts"> <li class="h4"> <a href="/php/2013/02/01/php-e9-9d-a2-e5-90-91-e5-af-b9-e8-b1-a1-e7-9b-b8-e5-85-b3.html" data-flip="title"> <span>php 面向对象相关</span> </a> <small><time datetime="2013-02-01T19:34:52+08:00"> 01 Feb 2013 </time></small> </li> <li class="h4"> <a href="/php/2013/01/11/php-e6-89-93-e5-8d-b0error-trace.html" data-flip="title"> <span>php 打印error trace</span> </a> <small><time datetime="2013-01-11T19:01:48+08:00"> 11 Jan 2013 </time></small> </li> <li class="h4"> <a href="/php/2013/01/11/smarty-e8-ad-a6-e5-91-8a-e6-8a-a5-e9-94-99-e9-97-ae-e9-a2-98.html" data-flip="title"> <span>Smarty 警告报错问题</span> </a> <small><time datetime="2013-01-11T18:50:53+08:00"> 11 Jan 2013 </time></small> </li> </ul> </aside> <footer> <hr/> <p>© 2011 - 2017. All rights reserved.</p> <p> <code>Powered by <a href="https://qwtel.com/hydejack/">Hydejack</a> v<span id="_version">6.6.1</span></code> </p> </footer> </main> </div> <div id="_yDrawer"> <div id="_sidebar" class="sidebar"> <div class="sidebar-bg" style="background-color:#4f86aa;background-image:url()"></div> <header class="sidebar-sticky" role="banner"> <div class="sidebar-about"> <img src="https://avatars0.githubusercontent.com/u/4122902?v=4&s=460" class="me" /> </div> <div class="sidebar-about"> <h1><a id="_title" href="/">Ka's Blog</a></h1> <p>Ka’s blog description…</p> </div> <nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span> <ul> <li> <a class="sidebar-nav-item" href="/categories.html">Categories</a> </li> <li> <a class="sidebar-nav-item" href="/archive.html">Archive</a> </li> <li> <a class="sidebar-nav-item" href="/tags.html">Tags</a> </li> <li> <a class="sidebar-nav-item" href="/about.html">About</a> </li> </ul> </nav> <div class="sidebar-social"> <span class="sr-only">Social:</span> <ul> <li> <a href="https://twitter.com/imhazige" title="Twitter"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a> </li> <li> <a href="https://github.com/imhazige" title="GitHub"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a> </li> <li> <a href="mailto:imhazige@gmail.com" title="Email"> <span class="icon-mail"></span> <span class="sr-only">Email</span> </a> </li> <li> <a href="https://imhazige.github.io/myblog/feed.xml" title="RSS"> <span class="icon-rss2"></span> <span class="sr-only">RSS</span> </a> </li> </ul> </div> </header> </div> </div> </div> <!--[if gt IE 9]><!----> <script>loadJSDeferred('/assets/js/hydejack.js?v=6.6.1');</script> <!--<![endif]--> </body>
</html>
