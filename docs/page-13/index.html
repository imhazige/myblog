<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v6.6.1 <https://qwtel.com/hydejack/>
--><head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="format-detection" content="telephone=no"> <meta http-equiv="x-ua-compatible" content="ie=edge"> <title>Ka's Blog &middot; Ka's Blog</title> <meta name="description" content="Ka’s blog description… "> <link rel="canonical" href="http://localhost:4000/page-13/"> <link rel="alternate" type="application/atom+xml" title="Ka's Blog Feed" href="http://localhost:4000/feed.xml"> <link rel="apple-touch-icon" href="/apple-touch-icon.png"> <!-- Place favicon.ico in the root directory --> <link rel="stylesheet" href="/assets/style.css"> <link id="_katexJS" rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.js"> <link id="_katexCSS" rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css"> <!--[if gt IE 8]><!----> <script> WebFontConfig = { google: { families: 'Roboto+Slab:700|Noto+Sans:400,400i,700,700i'.split('|') }, custom: { families: ['icomoon'], urls: ['/assets/icomoon/style.css'] } }; </script> <!--<![endif]--> <script> !function(n,e){function t(n,e){n.onload=function(){this.onerror=this.onload=null,e(null,n)},n.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),n)}}function o(n,e){n.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,e(null,n))}}n._loaded=!1,n.loadJSDeferred=function(a,d){function r(){n._loaded=!0;var r=e.createElement("script");r.src=a,d&&(("onload"in r?t:o)(r,d),r.onload||t(r,d));var l=e.getElementsByTagName("script")[0];l.parentNode.insertBefore(r,l)}n._loaded?r():n.addEventListener?n.addEventListener("load",r,!1):n.attachEvent?n.attachEvent("onload",r):n.onload=r}}(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); window.disablePushState = false; window.disableDrawer = false; </script> <!--[if lt IE 9]> <script src="/assets/bower_components/html5shiv/dist/html5shiv.min.js"></script> <![endif]--> <!--[if gt IE 8]><!----> <style> article, aside, dialog, figcaption, figure, footer, header, hgroup, main, nav, section { display: block; } mark { background: #FF0; color: #000; } * { box-sizing: border-box; } html, body { margin: 0; padding: 0; } html { font-size: 16px; line-height: 1.75; } body { color: #333; background-color: #fff; overflow-y: scroll; } a { text-decoration: none; } .lead { margin-left: -1rem; margin-right: -1rem; } img, .img { display: block; max-width: 100%; margin-bottom: 1rem; border: none; } img.lead, .img.lead { max-width: calc(100% + 2rem); width: calc(100% + 2rem); } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-weight: bold; text-rendering: optimizeLegibility; } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 { margin: 3rem 0 1rem; line-height: 1.6; } h1, .h1 { font-size: 2rem; line-height: 1.25; } h2, .h2 { font-size: 1.5rem; } h3, .h3 { font-size: 1.17em; } p { margin-top: 0; margin-bottom: 1rem; } p.lead { font-size: 1.25rem; font-weight: 300; padding: 0 1rem; } ul, ol, dl { margin-top: 0; margin-bottom: 1rem; } ul, ol { padding-left: 1.25rem; } hr { position: relative; margin: 1.5rem 0; border: 0; border-top: 1px solid #eee; } .hr { padding-bottom: .5rem; border-bottom: 1px solid #eee; margin-bottom: 1.5rem; } h4, h5, h6, .h4, .h5, .h6 { margin-bottom: 0.5rem; font-size: 1rem; } table { margin-bottom: 1rem; width: 100%; width: calc(100% + 2rem); margin-left: -1rem; border: 1px solid #e5e5e5; border-collapse: collapse; border-spacing: 0; } td, th { padding: .25rem .5rem; border: 1px solid #e5e5e5; } td:first-child, th:first-child { padding-left: 1rem; } td:last-child, th:last-child { padding-right: 1rem; } thead + tbody, tbody + tbody, tfoot { border-top: 3px double #e5e5e5; } tbody tr:nth-child(odd) td, tbody tr:nth-child(odd) th { background-color: #f9f9f9; } footer { margin-bottom: 2rem; } .page, .post { margin-bottom: 3em; } .page li + li, .post li + li { margin-top: .25rem; } .page > header, .post > header { margin-bottom: 2rem; } .page-title, .post-title { margin-top: 0; } .post-date { display: block; margin-top: -0.5rem; margin-bottom: 1rem; color: #9a9a9a; } .related-posts { padding-left: 0; list-style: none; } .related-posts > li, .related-posts > li + li { margin-top: 1rem; } .related-posts > li > small, .related-posts > li + li > small { font-size: 75%; color: #9a9a9a; } .message { margin-bottom: 1rem; padding: 1rem; color: #787878; background-color: #f9f9f9; margin-left: -1rem; margin-right: -1rem; } /* * Global resets * * Update the foundational and global aspects of the page. */ body, main { /* Prevent side-scrolling on mobile */ position: relative; overflow-x: hidden; } @media screen { body::before { content: ''; width: .5rem; background: #e5e5e5; position: absolute; left: 0; top: 0; bottom: 0; } } @media screen and (min-width: 40em) { html { font-size: 17px; } } @media screen and (min-width: 54em) { html { font-size: 16px; } } @media screen and (min-width: 72em) { html { font-size: 17px; } } @media screen and (min-width: 125em) { html { font-size: 18px; } } .sr-only { display: none; } .clearfix, .sidebar-social::after, .clearafter::after { content: ""; display: table; clear: both; } a, .a { position: relative; padding-bottom: .15rem; border-bottom: 1px solid; } .img { overflow: hidden; background-color: #f9f9f9; } .img > img { margin: 0; width: 100%; height: 100%; } .sixteen-nine { position: relative; } .sixteen-nine::before { display: block; content: ""; width: 100%; padding-top: 56.25%; } .sixteen-nine > * { position: absolute; top: 0; left: 0; right: 0; bottom: 0; } h1 + hr, h2 + hr, h3 + hr, h4 + hr, h5 + hr, h6 + hr { margin-top: 0; } .fade-in { animation-duration: 500ms; animation-name: fade-in; animation-fill-mode: forwards; } @keyframes fade-in { from { transform: translateY(-2rem); opacity: 0; } 50% { transform: translateY(-2rem); opacity: 0; } to { transform: translateY(0); opacity: 1; } } .mb6 { margin-bottom: 6rem; } .sidebar { color: rgba(255, 255, 255, 0.75); text-align: left; /* Sidebar links */ } .sidebar::before { /* make sidebar slightly darker to increase text readability (when using a background image) */ content: ""; position: absolute; z-index: 2; top: 0; left: 0; bottom: 0; right: 0; background: linear-gradient(to bottom, rgba(32, 32, 32, 0) 0%, rgba(32, 32, 32, 0.5) 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */ } .sidebar a { color: #fff; border-bottom-color: rgba(255, 255, 255, 0.2); } #_yDrawer { position: relative; padding: 1rem 0; } @media screen { #_yDrawer { padding: 2rem 1rem; min-height: 640px; min-height: 100vh; } } @media screen and (min-width: 54em) { #_yDrawer { position: fixed; top: 0; left: 0; bottom: 0; width: 18rem; margin-left: 0; } } @media screen and (min-width: 97.5em) { #_yDrawer { width: calc(50% - 28rem); } } @media screen { #_yDrawer.loaded { min-height: 0; padding: 0; } } .sidebar-bg { position: absolute; top: 0; right: 0; bottom: 0; left: 0; background: #202020 center / cover; } .sidebar-sticky { position: relative; z-index: 3; } @media screen { .sidebar-sticky { position: absolute; right: 2rem; bottom: 1rem; left: auto; max-width: 14rem; } } @media print { .sidebar-sticky { padding: 0 2rem; } } /* About section */ .sidebar-about > h1 { color: #fff; font-size: 2rem; } .sidebar-nav > ul { list-style: none; padding-left: 0; margin-bottom: .5rem; } a.sidebar-nav-item { font-weight: bold; display: block; line-height: 1.75; padding: .25rem 0; border-bottom: 1px solid rgba(255, 255, 255, 0.2); } @media screen { .y-drawer-scrim { z-index: 2; } .y-drawer-content { width: 18rem; left: -17.5rem; z-index: 3; } } @media screen and (min-width: 97.5em) { .y-drawer-content { width: calc(50% - 28rem); } } .sidebar-social { margin-bottom: .5rem; } .sidebar-social > ul { list-style: none; padding-left: 0; margin: 0 -.25rem; } .sidebar-social > ul > li { float: left; margin: 0 .25rem; } .sidebar-social > ul > li > a { display: inline-block; text-align: center; font-size: 1.6rem; line-height: 3rem; width: 3.1249rem; height: 4rem; padding: .5rem 0; } .sidebar-social > ul li + li { margin-top: 0; } .fixed-top { position: fixed; top: 0; left: 0; width: 100%; z-index: 1; } .navbar > .content { padding-top: 0; padding-bottom: 0; min-height: 0; height: 0; } .menu { display: inline-block; padding: 1.75rem 1.5rem; border-bottom: none; margin-left: -1.5rem; color: #9a9a9a !important; } .menu::after { content: "\2630"; } @media screen and (min-width: 54em) { .menu { padding: 1.25rem 1.5rem; position: absolute; left: -9999px; } .menu:focus { position: static; } } .animation-main { pointer-events: none; } .loading { display: none; } @media print { .menu { display: none; } } .animation-main { opacity: 0; will-change: opacity; } .loading { position: absolute; top: 0; right: 0; padding: 5.25rem 4.5rem; transform-origin: top right; transform: scale(0.33); } .content { position: relative; margin-left: auto; margin-right: auto; padding: 5rem 1rem 12rem; } @media screen { .content { max-width: 38rem; padding-left: 1.5rem; min-height: 100vh; } } @media screen and (min-width: 54em) { .content { max-width: 42rem; padding: 4rem 1rem 12rem; margin-left: 22rem; margin-right: 4rem; } } @media screen and (min-width: 72em) { .content { margin-left: 22rem; margin-right: 4rem; } } @media screen and (min-width: 92em) { .content { max-width: 48rem; } } @media screen and (min-width: 97.5em) { .content { margin: auto; } } .me { float: right; width: 6.5rem; height: 6.5rem; margin-left: 1rem; margin-bottom: .5rem; border-radius: 100%; position: relative; } @media screen and (min-width: 40em) { .me { width: 7rem; height: 7rem; } } @media screen and (min-width: 54em) { .me { width: 6.5rem; height: 6.5rem; } } @media screen and (min-width: 60em) { .me { width: 7rem; height: 7rem; } } main > footer { position: absolute; bottom: 0; left: 0; right: 0; padding: 0 1rem; color: #9a9a9a; font-size: smaller; text-align: center; } main > footer > p { margin-bottom: 0; } /* .card, .pagination-item { border-radius: 0!important; } */ /* @media screen { .sidebar-sticky { left: 2rem; max-width: none; } } */ html { font-family: Helvetica, Arial, sans-serif; } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: Helvetica, Arial, sans-serif; } </style> <link id="_stylePreload" rel="preload" as="style" href="/assets/css/hydejack.css?v=6.6.1"> <script>document.getElementById('_stylePreload').onload=function(){this.rel='stylesheet'}</script> <!-- NOTE: These styles interact with JavsScript, so they MUST NOT be changed --> <style id="_pageStyle"> .content a { color: #4f86aa; border-color: rgba(79, 134, 170, 0.2); } .content a:hover { border-color: #4f86aa; } :focus { outline-color: #4f86aa; } ::selection { color: #fff; background: #4f86aa; } ::-moz-selection { color: #fff; background: #4f86aa; } </style> <noscript> <link rel="stylesheet" href="/assets/css/hydejack.css?v=6.6.1"> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700|Noto+Sans:400,400i,700,700i"> <style> html { font-family: 'Noto Sans', Helvetica, Arial, sans-serif } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: 'Roboto Slab', Helvetica, Arial, sans-serif } </style> <link rel="stylesheet" href="/assets/icomoon/style.css"> </noscript> <!--<![endif]--> <!--[if gt IE 8]><!----> <script async src="/assets/bower_components/webfontloader/webfontloader.js"></script> <!--<![endif]--> </head> <body> <div class="navbar fixed-top"> <div class="content"> <span class="sr-only">Jump to:</span> <a id="_menu" class="menu no-hover" href="#_title"> <span class="sr-only">Menu</span> </a> </div> </div> <div id="_yPushState"> <div class="fade-in"> <main id="_main" class="content" role="main" data-color="#4f86aa" data-image=""> <article id="post-web%E5%89%8D%E7%AB%AF/2012/08/30/extjs-%e4%b8%80%e5%8f%a5%e8%af%9d%e5%af%bc%e8%87%b4%e6%80%a7%e8%83%bd%e9%99%8d%e4%bd%8e" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web%E5%89%8D%E7%AB%AF/2012/08/30/extjs-e4-b8-80-e5-8f-a5-e8-af-9d-e5-af-bc-e8-87-b4-e6-80-a7-e8-83-bd-e9-99-8d-e4-bd-8e.html" data-flip="title"> Extjs 性能降低的可能原因 </a> </h1> <p class="post-date heading"> <time datetime="2012-08-30T00:26:07+08:00">30 Aug 2012</time> in <span>Web前端</span> on <span>Extjs</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>见天终于找出一个问题，我们的应用要打开一个Ext.Window窗口,然后可以关闭它再打开。问题是，第一次打开很好，速度不错，再以后打开就非常慢，有时甚至达到5秒以上的延迟。由于系统比较复杂，开始一直找的是网络问题，服务端调用问题，后来发现不是这些原因，而是Extjs绘制很慢。</p> <p>逐个排除，发现是多了这么一句话 renderTo: document.body,</p> <p>这样导致在调用show之前就绘制了一次，然后show又绘制了一次。后来发信这个问题别人也遇到过了。</p> <p><a href="http://blog.csdn.net/tianxiaode/article/details/6525486">http://blog.csdn.net/tianxiaode/article/details/6525486</a></p> <p>另外一个问题是，有个Ext.window里面有个很大的dom元素，我们发现使用hide(),show()方法显示比较卡，有时甚至几秒钟。我们的解决方法是，要隐藏时将这个window位置设置到用户看不到的地方，要显示时再把它移回来。这样明显速度快多了。发现Extjs本身就是使用这种方式来显示隐藏对话框的。看来这确实是个问题。</p> <p>现在看来，Extjs使用还真得小心，你说C容易内存泄露，Extjs也会。如果不注意尾巴的话，你打开dom树，就会发现一堆垃圾在那没回收，到后来就是越来越慢。</p> <p>&#160;</p> <p>--如果给我一个美工，我将丢弃Extjs。</p> <p class="read-more">Continue reading <a class="heading" href="/web%E5%89%8D%E7%AB%AF/2012/08/30/extjs-e4-b8-80-e5-8f-a5-e8-af-9d-e5-af-bc-e8-87-b4-e6-80-a7-e8-83-bd-e9-99-8d-e4-bd-8e.html" data-flip="title">Extjs 性能降低的可能原因</a></p> </article> <article id="post-web%E5%89%8D%E7%AB%AF/2012/08/29/background-attachmentfixed-%e9%97%ae%e9%a2%98" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web%E5%89%8D%E7%AB%AF/2012/08/29/background-attachmentfixed-e9-97-ae-e9-a2-98.html" data-flip="title"> background-attachment:fixed 问题 </a> </h1> <p class="post-date heading"> <time datetime="2012-08-29T01:08:51+08:00">29 Aug 2012</time> in <span>Web前端</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>今天发现background-attachment:fixed原来不是这么简单：</p> <p>见:<a href="http://reference.sitepoint.com/css/background-attachment">http://reference.sitepoint.com/css/background-attachment</a></p> <p>The value fixed stops the background-image from scrolling with its containing block. <font color="#0000ff">Note that although the fixed background-image may be applied to elements throughout the document, its background-position is always placed in relation to the viewport</font>. This means the background-image is only visible when its background-position coincides with the content, padding, or border area of the element to which it is applied. Thus, a fixed background-image doesn’t move with elements that have a scrollbar—see overflow—because it’s placed in relation to the viewport.</p> <p>我真是晕，fixed的情况下，不管background-attachment:fixed设置到哪个元素，其background-position是依据body来定位的。</p> <p>使用background-attachment:scroll则是相对本元素定位。</p> <p>测试FF,IE8,Chrome都是这样。</p> <p>&#160;</p> <p>可依据这个例子来看:</p> <div>><span style="color: #0000ff">&lt;</span><span style="color: #800000">html</span><span style="color: #0000ff">&gt;</span> <span style="color: #0000ff">&lt;</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span> <span style="color: #0000ff">&lt;</span><span style="color: #800000">style</span> <span style="color: #ff0000">type</span>=<span style="color: #0000ff">&quot;text/css&quot;</span><span style="color: #0000ff">&gt;</span> .hi { height:200px; width:200px; border:1px solid blue; background-image:url('eg_bg_03.gif'); background-repeat:no-repeat; background-attachment:fixed; background-position:left top; padding: 0px; } <p class="read-more">Continue reading <a class="heading" href="/web%E5%89%8D%E7%AB%AF/2012/08/29/background-attachmentfixed-e9-97-ae-e9-a2-98.html" data-flip="title">background-attachment:fixed 问题</a></p> </article> <article id="post-web%E5%89%8D%E7%AB%AF/2012/08/28/photoshop%e8%bd%acico%e6%8f%92%e4%bb%b6" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web%E5%89%8D%E7%AB%AF/2012/08/28/photoshop-e8-bd-acico-e6-8f-92-e4-bb-b6.html" data-flip="title"> Photoshop转ico插件 </a> </h1> <p class="post-date heading"> <time datetime="2012-08-28T18:40:05+08:00">28 Aug 2012</time> in <span>Web前端</span> on <span>Photoshop</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>这段时间补了一下PS的课，稍微熟悉了点，但还是很多地方不熟，用七拼八凑的知识做了个本站的logo：</p> <p><a href="http://kazge.com/wp-content/uploads/2012/08/logok.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="logok" border="0" alt="logok" src="/assets/logok_thumb.png" width="204" height="204" /></a> </p> <p>还凑合吧。</p> <p>这里说一下PS转ico的插件，PS不知为什么不支持存储为ico,所以还得下个插件来保存：</p> <p><a href="http://www.telegraphics.com.au/svn/icoformat/trunk/dist/README.html">http://www.telegraphics.com.au/svn/icoformat/trunk/dist/README.html</a></p> <p>安装方法上面有，不过这里没找到下载地址，还是到</p> <p><a title="http://www.hiliuyun.cn/wp-content/uploads/2010/01/PhotoShop-ico-lpugin.zip" href="http://www.hiliuyun.cn/wp-content/uploads/2010/01/PhotoShop-ico-lpugin.zip">http://www.hiliuyun.cn/wp-content/uploads/2010/01/PhotoShop-ico-lpugin.zip</a></p> <p>这里下载的。</p> <p>&#160;</p> <p>参见:</p> <p><a href="http://www.hiliuyun.cn/2010/01/photoshop-png%E6%A0%BC%E5%BC%8F%E8%BD%ACico%E6%8F%92%E4%BB%B6.html">http://www.hiliuyun.cn/2010/01/photoshop-png%E6%A0%BC%E5%BC%8F%E8%BD%ACico%E6%8F%92%E4%BB%B6.html</a></p> <p class="read-more">Continue reading <a class="heading" href="/web%E5%89%8D%E7%AB%AF/2012/08/28/photoshop-e8-bd-acico-e6-8f-92-e4-bb-b6.html" data-flip="title">Photoshop转ico插件</a></p> </article> <article id="post-java/2012/08/27/xpath-namespace%e7%9a%84%e6%83%85%e5%86%b5" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/java/2012/08/27/xpath-namespace-e7-9a-84-e6-83-85-e5-86-b5.html" data-flip="title"> XPath namespace的情况 </a> </h1> <p class="post-date heading"> <time datetime="2012-08-27T23:01:16+08:00">27 Aug 2012</time> in <span>Java</span> on <span>Namespace</span>, <span>Xml</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>今天使用Dom4j取节点，试了半天都没取到，真是很纳闷，用了这么久的函数今天突然不行了？仔细一看，原来xml节点带名空间。</p> <p>下面引用自: <a href="http://www.cnblogs.com/PunkChen/archive/2008/04/02/1134304.html">http://www.cnblogs.com/PunkChen/archive/2008/04/02/1134304.html</a></p> <p>xml代码example: <br /> &lt;report&#160; xmlns=&quot;<a href="http://www.eclipse.org/birt/2005/design&quot;">http://www.eclipse.org/birt/2005/design&quot;</a> version=&quot;3.2.15&quot; id=&quot;1&quot;&gt; <br />&#160;&#160;&#160; &lt;list-property name=&quot;cssStyleSheets&quot;&gt; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;structure&gt; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;property name=&quot;fileName&quot;&gt;D: eport.css&lt;/property&gt; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/structure&gt; <br />&#160;&#160;&#160; &lt;/list-property&gt; <br />&lt;/report&gt; <br />第一个方案.设置你的xpath的命名空间setNamespaceURIs </p> <p>public class TransferXML { <br />&#160;&#160;&#160; public static void main(String[] args) throws Exception{ <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Map map = new HashMap(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; map.put(&quot;design&quot;,&quot;<a href="http://www.eclipse.org/birt/2005/design&quot;);">http://www.eclipse.org/birt/2005/design&quot;);</a> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; SAXReader saxReader = new SAXReader(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; File file = new File(&quot;D:\test.xml&quot;); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Document document = saxReader.read(file); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; XPath x = document.createXPath(&quot;//design:list-property&quot;); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; x.setNamespaceURIs(map); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; List nodelist = x.selectNodes(document); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(nodelist.size()); <br />&#160;&#160;&#160; } <br />} <br />第二个解决方案:设置你的DocumentFactory()的命名空间 setXPathNamespaceURIs <br />public class TransferXML { <br />&#160;&#160;&#160; public static void main(String[] args) throws Exception{ <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Map map = new HashMap(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; map.put(&quot;design&quot;,&quot;<a href="http://www.eclipse.org/birt/2005/design&quot;);">http://www.eclipse.org/birt/2005/design&quot;);</a> <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; SAXReader saxReader = new SAXReader(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; File file = new File(&quot;D:\test.xml&quot;); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; saxReader.getDocumentFactory().setXPathNamespaceURIs(map); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Document document = saxReader.read(file); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; List tmp = document.selectNodes(&quot;//design:list-property&quot;); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(tmp.size()); <br />&#160;&#160;&#160; } <br />} <br />第三种方法：本人用的，最笨也是最通用的方法，就是不使用开发环境给你提供的一系列对象，而是用XPath语法中自带的local-name() 和 namespace-uri() 指定你要使用的节点名和命名空间。 <br />当你遇到使用xslt来样式化xml时，就知道这个笨方法的好处了： <br />public class TransferXML { <br />&#160;&#160;&#160; public static void main(String[] args) throws Exception <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; SAXReader saxReader = new SAXReader(); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; File file = new File(&quot;D:\test.xml&quot;); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Document document = saxReader.read(file); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; List tmp = document.selectNodes(&quot;//*[local-name()='report' and namespace-uri()='<a href="http://www.eclipse.org/birt/2005/design']/*">http://www.eclipse.org/birt/2005/design']/*</a> [local-name()='list-property']&quot;); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(tmp.size()); <br />&#160;&#160;&#160; } <br />}</p> <p>我觉得第三种最方便，虽然有点繁琐，往往那个名空间是多余的东西，我们处理的数据不需要关心它，所以使用低三种方法时，可以将and namespace-uri()='<a href="http://www.eclipse.org/birt/2005/design']/*">http://www.eclipse.org/birt/2005/design</a> 这个条件不要，那么不管它是什么名空间，只要是要选取得节点名就被包含了。</p> <p>&#160;</p> <p>不得不吐槽：为什么不用json呢?</p> <p>&#160;</p> <p>参见:</p> <p><a href="http://www.cnblogs.com/PunkChen/archive/2008/04/02/1134304.html">http://www.cnblogs.com/PunkChen/archive/2008/04/02/1134304.html</a></p> <p class="read-more">Continue reading <a class="heading" href="/java/2012/08/27/xpath-namespace-e7-9a-84-e6-83-85-e5-86-b5.html" data-flip="title">XPath namespace的情况</a></p> </article> <article id="post-web/2012/08/26/%e5%86%8d%e8%b0%88p3p%e4%b8%8e%e7%ac%ac%e4%b8%89%e6%96%b9cookie" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web/2012/08/26/e5-86-8d-e8-b0-88p3p-e4-b8-8e-e7-ac-ac-e4-b8-89-e6-96-b9cookie.html" data-flip="title"> 再谈p3p与第三方cookie </a> </h1> <p class="post-date heading"> <time datetime="2012-08-26T23:47:21+08:00">26 Aug 2012</time> in <span>Web</span> on <span>Cookie</span>, <span>P3p</span>, <span>跨域</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>之前的文章 <a href="http://kazge.com/archives/91.html">http://kazge.com/archives/91.html</a> 初略了解了一下p3p,这次重温一下。</p> <p>P3P是w3c 开发的协议 <b>Platform for Privacy Preferences Project</b> (<b>P3P</b>)。</p> <p>主要用途是：</p> <p>允许第三方cookie使用，这样的场景例如：</p> <p>一个站点A.com包含了一个iframe,这个iframe指向了另外一个域的站点B.com。</p> <p>那么B想要设置cookie并有时需要获得它，这就是第三方cookie。</p> <p><font color="#0000ff">注意，这里B能设置的cookie的domain 值还是b.com,但是相对于整个页面来说访问的是A.com所以叫做第三方cookie,B.com仍然是不能操作A.com的cookie的，否则就乱套了。</font><font color="#0000ff"> 这个其实也不存在什么跨域的意思。</font></p> <p>要让B.com能操作它的第三方cookie,B.com的页面需要使用P3P header来让浏览器来允许它这样做。</p> <p>什么情况会发生这种应用场景：</p> <p>1：第三方访问统计分析网站。</p> <p>2：A 站点集成其他站点应用。</p> <p>&#160;</p> <p>参见：</p> <p><a href="http://kazge.com/archives/91.html">http://kazge.com/archives/91.html</a></p> <p class="read-more">Continue reading <a class="heading" href="/web/2012/08/26/e5-86-8d-e8-b0-88p3p-e4-b8-8e-e7-ac-ac-e4-b8-89-e6-96-b9cookie.html" data-flip="title">再谈p3p与第三方cookie</a></p> </article> <article id="post-web%E5%89%8D%E7%AB%AF/2012/08/23/ie-%e5%9b%9e%e8%bd%a6-%e6%8f%90%e4%ba%a4%e8%a1%a8%e5%8d%95%e9%97%ae%e9%a2%98" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/web%E5%89%8D%E7%AB%AF/2012/08/23/ie-e5-9b-9e-e8-bd-a6-e6-8f-90-e4-ba-a4-e8-a1-a8-e5-8d-95-e9-97-ae-e9-a2-98.html" data-flip="title"> IE 回车 提交表单问题 </a> </h1> <p class="post-date heading"> <time datetime="2012-08-23T03:19:25+08:00">23 Aug 2012</time> in <span>Web前端</span> on <span>Ie</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>现在当我写一个form时，总是提心吊胆的，因为最近我几次遇到回车导致表单提交的情况，当然，这任然是在“神奇的IE”里面出现的奇迹。</p> <p>这里所说的问题都是说在文本框里回车导致的，你在别的地方回车当然没这个问题。</p> <p>网上有人总结了：</p> <p><a href="http://www.cnblogs.com/cxd4321/archive/2012/05/07/2486926.html">http://www.cnblogs.com/cxd4321/archive/2012/05/07/2486926.html</a></p> <blockquote><p>&#160;</p> <p>我们有时候希望回车键敲在文本框（input element）里来提交表单（form），但有时候又不希望如此。比如搜索行为，希望输入完关键词之后直接按回车键立即提交表单，而有些复杂表单，可能要避免回车键误操作在未完成表单填写的时候就触发了表单提交。</p> <p>要控制这些行为，不需要借助JS，浏览器已经帮我们做了这些处理，这里总结几条规则：</p> <p>1、如果表单里有一个type=”submit”的按钮，回车键生效。</p> <p>2、如果表单里只有一个type=”text”的input，不管按钮是什么type，回车键生效。</p> <p>3、如果按钮不是用input，而是用button，并且没有加type，IE下默认为type=button，FX默认为type=submit。</p> <p>4、其他表单元素如textarea、select不影响，radio checkbox不影响触发规则，但本身在FX下会响应回车键，在IE下不响应。</p> <p>5、type=”image”的input，效果等同于type=”submit”，不知道为什么会设计这样一种type，不推荐使用，应该用CSS添加背景图合适些。</p> <p>实际应用的时候，要让表单响应回车键很容易，保证表单里有个type=”submit”的按钮就行。而当只有一个文本框又不希望响应回车键怎么办呢？我的方法有点别扭，就是再写一个无意义的文本框，隐藏起来。根据第3条规则，我们在用button的时候，尽量显式声明type以使浏览器表现一致。</p> </blockquote> <p>我再补充type=”image”的BT情况，当用户会车时，竟然会触发这种标签的onclick事件---这就是奇迹，它就在那里！</p> <p>&#160;</p> <p>然后再联系一下IE form提交的另外的问题<a href="http://kazge.com/archives/356.html">http://kazge.com/archives/356.html</a> ， 这就是我为什么提心吊胆的原因了。</p> <p class="read-more">Continue reading <a class="heading" href="/web%E5%89%8D%E7%AB%AF/2012/08/23/ie-e5-9b-9e-e8-bd-a6-e6-8f-90-e4-ba-a4-e8-a1-a8-e5-8d-95-e9-97-ae-e9-a2-98.html" data-flip="title">IE 回车 提交表单问题</a></p> </article> <article id="post-%E6%95%B0%E6%8D%AE%E5%BA%93/2012/08/22/oracle11g-xe-%e4%bd%bf%e7%94%a8%e7%bb%8f%e5%8e%86" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/%E6%95%B0%E6%8D%AE%E5%BA%93/2012/08/22/oracle11g-xe-e4-bd-bf-e7-94-a8-e7-bb-8f-e5-8e-86.html" data-flip="title"> oracle11g XE 使用经历 </a> </h1> <p class="post-date heading"> <time datetime="2012-08-22T16:24:45+08:00">22 Aug 2012</time> in <span>数据库</span> on <span>Oracle</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>我这次使用oracle 11g XE(express edition)算是浅尝辄止，我的机器几年前装过8,9i都不是很卡，几年过去，都到11g了，安装到很顺利，但是一开服务，我的机子就做不了事了，开个网页都卡的不行。</p> <p>还试用了sql developer 3,不需要oracle客户端（TNS连接方式）， sql编辑按空格有提示。</p> <p>导入客户的sql脚本，结果n多表空间要建，真是麻烦。</p> <p>用惯了mysql现在不习惯oracle这个笨家伙了，我的mysql服务一直开机启动，根本没什么影响。</p> <p>&#160;</p> <p>另外在oracle官网上下载都需要注册oracle用户，且速度奇慢。</p> <p class="read-more">Continue reading <a class="heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/2012/08/22/oracle11g-xe-e4-bd-bf-e7-94-a8-e7-bb-8f-e5-8e-86.html" data-flip="title">oracle11g XE 使用经历</a></p> </article> <article id="post-voip/2012/08/16/askterisk%e7%ac%94%e8%ae%b0%e3%80%90%e4%ba%8c%e3%80%91" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/voip/2012/08/16/askterisk-e7-ac-94-e8-ae-b0-e3-80-90-e4-ba-8c-e3-80-91.html" data-flip="title"> askterisk笔记【二】 </a> </h1> <p class="post-date heading"> <time datetime="2012-08-16T16:54:51+08:00">16 Aug 2012</time> in <span>Voip</span> on <span>Asterisk</span>, <span>Asterisk笔记</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <h6>第二十章 AMI</h6> <p>Asterisk Manager Interface主要提供AST系统监控以及管理功能，它可以要求AST做一些事情，例如发起一个新呼叫。</p> <p>需要的配置:</p> <p>manager.conf</p> <blockquote><p>; <br />; 打开AMI并本地访问 <br />[general] <br />enabled = yes <br />webenabled = yes <br />bindaddr = 127.0.0.1 <br />; <br />; 创建用户hello,密码world <br />; <br />[hello] <br />secret=world</p> </blockquote> <p>上面的配置打开了http访问，这个需要配置http.conf(注意这个不是apache的http<font color="#0000ff"><strong>d</strong></font>.conf)但是我安装的ASteriskNow并没有这个http.conf配置文件，也没打开http访问，常见的还是使用tcp访问，默认端口是5038。</p> <p>如果没发现这个文件http.conf,可以自己加一个：</p> <blockquote><p>[general] <br />enabled=yes <br />bindaddr=0.0.0.0 <br />bindport=8088 <br />prefix=gui&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ;这个前缀用于http请求的url前缀 <br />enablestatic=yes</p> </blockquote> <p>这样的话请求AMI应该是:</p> <p><a href="http://localhost:8088/gui/rawman?action=login&amp;username=hello&amp;secret=world">http://localhost:8088/<font color="#0000ff">gui</font>/rawman?action=login&amp;username=hello&amp;secret=world</a></p> <p>然后重新加载:CLI&gt;core reload</p> <p>如果登陆不成功，还要看manager.conf中deny设置是否禁止了你的ip访问。</p> <p><strong>协议：</strong></p> <p>主要有两种协议：</p> <p>Manager events 只从AST到AMI客户端的单项事件 </p> <p>Manager actions AMI客户端请求AMI会得到返回Action Response。</p> <p>对于http连接，事件需要通过poll来获取。</p> <p>下面是开源AMI客户端库。</p> <p>Adhearsion Ruby <a href="http://adhearsion.com/">http://adhearsion.com/</a> <br />StarPy Python <a href="http://starpy.sourceforge.net/">http://starpy.sourceforge.net/</a> <br />Asterisk-Java Java <a href="http://asterisk-java.org/">http://asterisk-java.org/</a></p> <p>介绍几个有用的AMI应用:</p> <p>Asterisk GUI这个包含在AsteriskNow中 ,参见<a href="http://www.asterisk.org/asterisknow/developers/gui-guide">http://www.asterisk.org/asterisknow/developers/gui-guide</a></p> <p>&#160;</p> <h6>第二十一章 AGI</h6> <p>内置的dialplan写法可能有很多不便之处（如果你熟知一门编程语言的话），使用AGI则可以使用其他编程语言来控制呼叫流程，但是这么做还是离不开native dialplan的参与。</p> <p>例如</p> <blockquote><p>exten =&gt; 500,1,AGI(hello-world.sh)</p> </blockquote> <p>这里就调用了shell脚本的AGI</p> <p><strong>打开AGI调试:</strong></p> <blockquote><p>*CLI&gt; agi set debug on</p> </blockquote> <p><strong>AGI变种</strong></p> <p><strong>Process-Based AGI:</strong></p> <p>最简单的AGI，调用方式AGI(command[,arg1[,arg2[,...]]]) command可以使绝对路径，相对路径,arg1…是AGI需要传入的参数。</p> <p>执行AGI时，与AST交互的方式是通过stdin 和 stdout来进行的。</p> <p>有点：简单</p> <p>缺点：太简单，高并发时建议使用FastAGI</p> <p><strong>EAGI (Enhanced AGI)</strong></p> <p>相对于AGI,除了stdin和stdout外还可以获得单向只读语音流（app_jack提供获得AST之外音频流的功能）。</p> <blockquote><p>*CLI&gt; core show application EAGI</p> </blockquote> <p>优点：简单</p> <p>缺点：性能消耗比Process-Based AGI高</p> <p><strong>DeadAGI</strong></p> <p>这个已被废弃，不要使用。</p> <p><strong>FastAGI—AGI over TCP</strong></p> <p>使用tcp连接，不再是每个call一个进程，提高效率。</p> <blockquote><p>exten =&gt; 1234,1,AGI(<font color="#0000ff">agi</font>://192.168.1.199:4573,arg1,arg2,arg3)</p> </blockquote> <p>FASTAGI支持srvrecord</p> <blockquote><p>exten =&gt; 1234,1,AGI(<font color="#0000ff">hagi</font>://shifteight.org)</p> </blockquote> <p>优点：效率较好</p> <p>缺点：实现FASTAGI Server比较复杂</p> <p><strong>Async AGI—AMI-Controlled AGI</strong></p> <p>异步AGI,可以使AMI调用AGI。</p> <blockquote><p>exten =&gt; 1234,1,AGI(async:agi)</p> </blockquote> <p>这种方式的流程是，当执行上面一句时，会等待，然后，在AMI客户端中向·这个通道发命令，以这样的方式来执行。</p> <p>对于要执行AGI的影虎需要在manager.conf中指明权限</p> <blockquote><p>[hello] <br />secret = world <br />read = agi&#160;&#160;&#160; ；有读权限 <br />write = agi&#160; ；有写权限</p> </blockquote> <p>优点：AMI可使用AGI</p> <p>缺点：最复杂的一种用法</p> <p><strong>会话过程</strong></p> <p>调用AGI或EAGI后，会话建立，自定义参数（如agi_arg_0）和固有参数(如agi_request)会传入：</p> <p>对于Async AGI，开始时AMI会发送事件Manage Events,例如：</p> <blockquote><p>Event: AsyncAGI <br />Privilege: agi,all <br />SubEvent: Start <br />Channel: SIP/0000FFFF0001-00000000 <br />Env: agi_request%3A%20async%0Aagi_channel%3A%20SIP%2F0000FFFF0001-00000000%0A \ <br />agi_language%3A%20en%0Aagi_type%3A%20SIP%0Aagi_uniqueid%3A%201285219743.0%0A \ <br />agi_version%3A%201.8.0-beta5%0Aagi_callerid%3A%2012565551111%0A \ <br />agi_calleridname%3A%20Julie%20Bryant%0Aagi_callingpres%3A%200%0A \ <br />agi_callingani2%3A%200%0Aagi_callington%3A%200%0Aagi_callingtns%3A%200%0A \ <br />agi_dnid%3A%20111%0Aagi_rdnis%3A%20unknown%0Aagi_context%3A%20LocalSets%0A \ <br />agi_extension%3A%20111%0Aagi_priority%3A%201%0Aagi_enhanced%3A%200.0%0A \ <br />agi_accountcode%3A%20%0Aagi_threadid%3A%20-1339524208%0A%0A</p> </blockquote> <p>一旦会话开始，AGI就可以发送命令和获得回应，命令的执行是序列化的，一个执行完毕才会执行下一个。</p> <p><strong>AGI会话的终止</strong></p> <p>各种AGI的行为不一样：</p> <p>Process-based AGI/FastAGI：</p> <p>会话挂断会通知AGI程序来做后续处理。（1.4之前是直接中断，不会通知）</p> <p>Process-based AGI 会发SIGHUP 信号</p> <p>FASTAGI会发HANGUP信号。</p> <p>可以通过这样来禁止发送SIGHUP /HANGUP信号:</p> <blockquote><p>; <br />; Don't send SIGHUP to an AGI process <br />; or the &quot;HANGUP&quot; string to a FastAGI server. <br />; <br />exten =&gt; 500,1,Set(<font color="#0000ff">AGISIGHUP</font>=no) <br />same =&gt; n,AGI(my-agi-application)</p> </blockquote> <p>如果禁用，则相当于DeadAGI模式，会话其实结束了，但仍可以执行。不过只能执行不需要交互的命令，具体看每个命令的文档说明。</p> <p>对于Async AGI，如果会话中断，会发中断提示，如果想要主动中断会话，AMI客户端需要发送ASYNCAGI BREAK命令。</p> <p>AGI各种开发语言库:</p> <p>Adhearsion Ruby <a href="http://adhearsion.com/">http://adhearsion.com/</a> <br />StarPy Python <a href="http://starpy.sourceforge.net/">http://starpy.sourceforge.net/</a> <br />Asterisk-Java Java <a href="http://asterisk-java.org/">http://asterisk-java.org/</a> <br />Asterisk-perl Perl <a href="http://asterisk.gnuinter.net/">http://asterisk.gnuinter.net/</a> <br />PHPAGI PHP&#160; <a href="http://phpagi.sourceforge.net/">http://phpagi.sourceforge.net/</a></p> <h6>第二十五章 web 接口</h6> <p>这一章介绍了有名的相关项目：</p> <p>坐席管理</p> <p><a href="http://www.asternic.org/">http://www.asternic.org/</a> Flash Operator Panel 免费</p> <p><a href="http://www.fop2.com/">http://www.fop2.com/</a>&#160; Flash Operator Panel2 15个以上收费</p> <p><a href="http://www.cdr-stats.org/">http://www.cdr-stats.org/</a> Call Detail Records 分析统计工具</p> <p><a href="http://www.asterisk2billing.org/">http://www.asterisk2billing.org/</a> 计费系统 A2Billi ng</p> <p>&#160;</p> <p><strong>第十八章 外部服务</strong></p> <p><strong> 使用XMPP</strong></p> <p>需要res_jabber模块，默认是没有安装的，如果要支持gtalk的话，需要chan_gtalk,chan_jingle(这两个依赖res_jabber)</p> <p>centos上需要iksemel：</p> <p>yum install iksemel-devel openssl-devel</p> <p>现在假设res_jabber安装好了,需要配置 jabber.conf</p> <blockquote><p>[general] <br />debug=no <br />autoprune=no <br />autoregister=yes <br />auth_policy=accept <br />[asterisk] <br />type=client <br />serverhost=talk.google.com&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ;这里连到了gtalk <br /><a href="mailto:username=asterisk@shifteight.org">username=asterisk@shifteight.org</a>&#160;&#160;&#160; ;xmpp用户名 <br />secret=&lt;super_secret_password&gt;&#160;&#160;&#160;&#160; ;xmpp密码 <br />port=5222 <br />usetls=yes <br />usesasl=yes <br />status=available <br />statusmessage=&quot;Ohai from Asterisk&quot;</p> <p>&#160;</p> </blockquote> <p>dialplan:</p> <blockquote><p>exten =&gt; 106,1,Verbose(2,Example using the Local channel) ;一开始就呼叫dialplan <br />same =&gt; n,Dial(Local/jabber@${CONTEXT}/n&amp;Local/dial@${CONTEXT}/n) <br />exten =&gt; jabber,1,Verbose(2,Send an XMPP message and expect a response) ;接到呼叫发送xmpp消息 <br />; *** This line should not have any line breaks <br />same =&gt; n,<font color="#0000ff">JabberSend</font>(asterisk,leif.madsen@gmail.com,Incoming call from <br />${CALLERID(all)}. Press 2 to send to voicemail.) ；消息不能换行 <br />same =&gt; n,Set(JabberResponse=${<font color="#0000ff">JABBER_RECEIVE</font>(asterisk,leif@shifteight.org,6)}) <br />same =&gt; n,GotoIf($[&quot;${JabberResponse}&quot; = &quot;2&quot;]?voicemail,1) <br />same =&gt; n,Hangup() <br />exten =&gt; dial,1,Verbose(2,Calling our desk) <br />same =&gt; n,Dial(SIP/0000FFFF0002,15) <br />same =&gt; n,Goto(voicemail,1) <br />exten =&gt; voicemail,1,Verbose(2,VoiceMail) <br />same =&gt; n,Answer() <br />; *** This line should not have any line breaks <br />same =&gt; n,Set(VoiceMailStatus=${IF($[${ISNULL(${DIALSTATUS})} <br />| &quot;${DIALSTATUS}&quot; = &quot;BUSY&quot;]?b:u)}) <br />same =&gt; n,Playback(silence/1) <br />same =&gt; n,VoiceMail(100@lmentinc,${VoiceMailStatus}) <br />same =&gt; n,Hangup()</p> </blockquote> <p>这个例子是通过发送xmpp消息来让xmpp用户来选择。</p> <p><strong>与skype整合</strong></p> <p>可以通过skype发、接消息,呼叫好友</p> <p><strong>LDAP整合</strong></p> <p>&#160;</p> <p><strong>TextToSpeech</strong></p> <p>Festival 和 Cepstral 引擎</p> <p>&#160;</p> <p>暂看到这里……</p> <p class="read-more">Continue reading <a class="heading" href="/voip/2012/08/16/askterisk-e7-ac-94-e8-ae-b0-e3-80-90-e4-ba-8c-e3-80-91.html" data-flip="title">askterisk笔记【二】</a></p> </article> <article id="post-voip/2012/08/13/askterisk%e7%ac%94%e8%ae%b0" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/voip/2012/08/13/askterisk-e7-ac-94-e8-ae-b0.html" data-flip="title"> askterisk笔记【一】 </a> </h1> <p class="post-date heading"> <time datetime="2012-08-13T17:56:00+08:00">13 Aug 2012</time> in <span>Voip</span> on <span>Asterisk</span>, <span>Asterisk笔记</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <h5><font style="font-weight: normal">先看看这些：</font></h5> <h5><a href="http://www.asteriskcn.com/index.php?q=content/asterisk%E3%80%81freeswitch-%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E4%B9%A6%E7%B1%8D%E5%9C%A8%E7%BA%BF%E9%98%85%E8%AF%BB">相关技术书籍</a></h5> <h5><a href="http://www.asteriskcn.com/index.php?q=forum/14">http://www.asteriskcn.com/index.php?q=forum/14</a></h5> <p>Asterisk，电话未来之路 这本书翻译得有些生硬，有时看得莫名其妙。</p> <p>建议先看其第7,8章。 理解电话技术和voip协议。</p> <p><strong>第七章 理解电话技术</strong></p> <p>引起振铃音的<strong>交流电压</strong>和给电话机供电的<strong>直流电压</strong>.</p> <p>PS:</p><pre style="width: 855px; height: 85px">电话线里的电压是变化的，既有直流也有交流。
电话在待机的时候，电话线里的电压是负48伏直流，摘机后的电压是正12伏直流，负载一路5伏交流音频信号，合17伏峰值。
振铃时的电压是负48伏直流负载<font color="#0000ff">一路75伏交流振铃脉冲</font>，合110伏峰值。</pre><p>电话响铃时还是有点危险的（人体的安全电压是36伏）。</p> <p><strong>数字电话</strong>，目前我GUO 从家庭到中心局似乎还是模拟技术。</p> <p><strong>奈奎斯特定理表述为：</strong></p> <p>“在对信号采样时，采样频率必须高于输入信号带宽的两倍以上才能根据采样信息很好的重构原始信号。”</p> <p><strong>压扩</strong>是一种提高采样动态范围而不丢失重要精度的方法。它工作的原理是量化比较高的振幅时用更大的粒度，量化比较低振幅用比较小的粒度。换句话说，如果你对着电话喊叫，对你声音的采样不像正常讲话那样清晰。喊叫对你的血压不利，所以最好避免。</p> <p> <br />通常使用两种压扩方法：<font color="#0000ff">在北美用μ律，世界的其他地方用A 律</font>。这两种方法的工作原理相同，但是<font color="#0000ff">相互不兼容。</font></p> <p>在数字音频系统中（正如现代PSTN），如果送到模拟－数字转换器的频率超过采样频率的二分之一就会发生<strong>混叠现象</strong>（Aliasing）</p> <p>PSTN 中，有许多不同容量的电路来满足网络的各种需求。<em>局端和用户之间，通常有一条或多条模拟线路，或者通过数字电路传输的几十个通道。在PSTN 的交换局之间（或者大客户），通常使用光纤。</em></p> <p>电话呼叫数字化的标准方法是以8 比特每秒采样8000 次，所以我们知道PCM(脉冲编码调制) 编码的电话电路需要的带宽是64,000 bps。这种64-kbps 的通道被称为。DS-0是数字化电信电路的基本模块。</p> <p>一个T-1 由复用在一起，形成一个1.544-Mbps 的比特流[*]。这个比特流的正式定义是DS-1。</p><pre style="width: 863px; height: 106px"><p>欧洲是E1,一条E1作为32个64K来用，但是时隙0和时隙15是传输控制信令用，所以一条E1可以传30路话音。</p><p>这似乎是说，欧洲一条普通电话线可以接30个分机 ？</p><p>我朝似乎也是E1?</p></pre><p>Asterisk开发:<a href="http://blog.csdn.net/lin_bei/article/details/2536569">http://blog.csdn.net/lin_bei/article/details/2536569</a></p> <p>目前看似乎Asterisk和freepbx都可以用php开发。</p> <p>&#160;</p> <h5>api文档:</h5> <p><a href="http://www.asterisk.org/astdocs/api/index.html">http://www.asterisk.org/astdocs/api/index.html</a></p> <p>最新版本AGI AMI 文档:</p> <p><a href="https://wiki.asterisk.org/wiki/display/AST/Asterisk+Command+Reference">https://wiki.asterisk.org/wiki/display/AST/Asterisk+Command+Reference</a></p> <p>Asterisk权威文档(第3版).pdf <a href="http://ishare.iask.sina.com.cn/f/24400557.html">http://ishare.iask.sina.com.cn/f/24400557.html</a></p> <p>&#160;</p> <h5>以下是权威文档笔记:</h5> <p>Asterisk简称为AST</p> <p>Zapata是连接pstn与计算机的项目，现在发展为Digium Asterisk Hardware Device Interface (DAHDI)，可以说它是AST的pstn 引擎。</p> <h6>第二章 Asterisk结构</h6> <blockquote> <p>Asterisk Dialplan 处理各种channel的方式是一致的。</p> <p>AST基于Modules, 分为:</p> <p>• Applications</p> <p>extensions.conf里面的dialplan将会使用的程序</p> <p> <br />• Bridging modules</p> <p>1.8新特性，主要被app_confbridge使用</p> <p> <br />• Call detail recording (CDR) modules</p> <p>通话记录，书中说没什么用，推荐的记录方式应该使用channel event logging</p> <p> <br />• Channel event logging (CEL) modules</p> <p>事件记录</p> <p> <br />• Channel drivers</p> <p>channel驱动，例如sip驱动</p> <p> <br />• Codec translators</p> <p>不同语音流编码之间的转换，例如pstn到sip</p> <p> <br />• Format interpreters</p> <p>语音文件格式转换，如wav到目标channel</p> <p> <br />• Dialplan functions</p> <p>dialplan app用到的函数</p> <p> <br />• PBX modules</p> <p>外围的pbx配置，加强机制。</p> <p> <br />• Resource modules</p> <p>ast与外界资源，如odbc连接</p> <p> <br />• Addons modules</p> <p>社区贡献的加强模块，默认是没安装的。</p> <p> <br />• Test modules</p> <p>开发者使用的测试模块</p> </blockquote> <blockquote> <p>文件结构：</p> <p>配置在/etc/asterisk/中</p> <p>模块文件夹默认在/usr/lib/asterisk/modules，注意，当更新asterisk使用menuselect选项的话，不会自动删除无用的模块，需要手动删除或使用make uninstall</p> <p>资源文件夹为/var/lib/asterisk ，包含moh,系统提示，AGI脚本等</p> <p>临时文件 /var/spool/asterisk 存储录音，text到语音</p> <p>日志文件夹 /var/log/asterisk</p> </blockquote> <blockquote> <p>dialplan 有三种写法:</p> <p>/etc/asterisk/extensions.conf 使用传统写法，这个方式最常用</p> <p>在/etc/asterisk/extensions.ael 里使用Asterisk Extension Logic (AEL) </p> <p>在/etc/asterisk/extensions.lua里使用lua</p> <p>连接到pstn需要硬件</p> </blockquote> <h6>第四章 配置 </h6> <blockquote> <p><font color="#0000ff">主配置在/etc/asterisk/asterisk.conf 中</font></p> <p>可在启动时指定主配置asterisk -C /custom/path/to/asterisk.conf</p> <p>AGI默认加载文件夹:</p> <p>astagidir =&gt; /var/lib/asterisk/agi-bin</p> <p><font color="#0000ff">modules.conf&#160; 模块加载配置</font></p> <p>推荐的做法是，写明不加载的(autoload=yes + noload =&gt; xxx)。没必要一条条写明加载的。</p> <p>indications.conf&#160; 语音（方言）配置,DAHDI不使用这个配置。</p> <p>musiconhold.conf&#160; 配置等待音乐</p> <p>asterisk等待音乐格式是sln结尾文件名，这是因为mp3这样的高压缩格式会消耗cpu性能，所以要转换成低采样率wav格式?</p> </blockquote> <h6>第五章 设备配置</h6> <p>SIP 可以是Peer-to-Peer但对一asterisk来说，是通过asterisk来桥接的。</p> <p>AST只有通道名的概念，而没有用户的概念，他只关注通道名称，而且，extension在AST里面不仅仅指分机，它的含义是指令集名称。</p> <p>名称只能由数字字母组成，无空白。推荐使用目标设备mac地址。</p> <p>最常用的协议时sip和iax(2)，配置分别在sip.conf 和 iax.conf中，对应驱动分别是chan_sip.so 和 chan_iax2.so </p> <p>Freepbx添加sip也是修改的文件sip.conf。</p> <p>AST加载配置的顺序：</p> <p>明确指明的块例如: [111]</p> <p>指定块的模板</p> <p>[general]</p> <p>代码硬编码的配置</p> <p>----</p> <p>channel配置与dialplan的关系如图:</p> <p><a href="http://kazge.com/wp-content/uploads/2012/08/image.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/assets/image_thumb.png" width="644" height="245" /></a> </p> <p>可见dialplan需要使用这些配置来决定接收目标和发送目标。</p> <blockquote> <p>channel配置不仅控制呼叫进入系统，也控制呼叫怎样离开系统，例如：</p> <p>1 call 2，channel配置不仅用于传递呼叫到dial plan，而且引导呼叫从dialplan到目标。</p> </blockquote> <p>&#160;</p> <p>示例:</p> <p>[office-phone](!)&#160;&#160;&#160;&#160; ; create a template for our devices</p> <p>&#160;</p> <p>[0000FFFF0001](office-phone)</p> <p>&#160;</p> <p>从上可见注释使用; ，模板(!), 继承模板(模板名)</p> <p>udpbindaddr=0.0.0.0&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ; listen for UDP requests on all interfaces(0.0.0.0表示所有)<br /> <br />tcpenable=no&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ; disable TCP support(要么tcp,udp都开，要么开一个，不能全部都关)</p> <p>type的类型:</p> <p>peer :使用请求的源端ip和端口匹配配置</p> <p>user:使用请求的From头来匹配配置</p> <p>支持ipv6</p> <p>第12章将会介绍dns(srvrecord)</p> <p>94页到98页缺失</p> <p>使用AST CLI:</p> <p>最有用的为，当修改sip或iax配置后，重新加载使配置生效：</p> <p>asterisk -r<br /> <br />*CLI&gt; module reload chan_sip.so </p> <p>*CLI&gt; module reload chan_iax2.so</p> <p>查看状态：</p> <p>*CLI&gt; sip show peers ；这个显示当前连接、注册状态<br /> <br />*CLI&gt; sip show users&#160; ;这个直接将密码都打出来了,相当于配置信息 </p> <p>*CLI&gt; iax2 show peers </p> <p>*CLI&gt; iax2 show users</p> <p>介绍了模拟电话安装,这个需要硬件，还有DAHDI配置。</p> <p>dialplan重新加载命令：</p> <p>asterisk -rx &quot;dialplan reload&quot;</p> <p>或</p> <p>*CLI&gt; dialplan reload</p> <p>背靠背的User Agent：</p> <p>呼叫流程：sip1 –&gt;asterisk;&#160; asterisk—&gt;sip2</p> <p>实际是两个呼叫，AST将其桥接，所以叫做back to back(上图中两个AST背靠背)</p> <p>会话的过程状态可从CLI中看到，这个便于调试dialplan</p> <p>&#160;</p> <h6>第六章 dial plan基础</h6> <p>四个重要概念contexts, extensions, priorities, applications.</p> <p><strong>Contex</strong></p> <p>用于分类组，可用字母数字下划线和连字符组(-)成,不能超过79字符。各context是独立的除非他们互相交互</p> <p>[general], [default], and [globals]是三个固有的特殊上下文。</p> <p><a href="http://kazge.com/wp-content/uploads/2012/08/image1.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/assets/image_thumb1.png" width="644" height="163" /></a> </p> <p>上图可见context的作用。</p> <p>Context的最大用途是分配安全策略，见<a title="https://wiki.asterisk.org/wiki/display/AST/Important+Security+Considerations" href="https://wiki.asterisk.org/wiki/display/AST/Important+Security+Considerations">https://wiki.asterisk.org/wiki/display/AST/Important+Security+Considerations</a></p> <p><strong>Extensions</strong></p> <p>这个更像是控制流，定义为:</p> <p>exten =&gt; name,priority,application()</p> <p>例如exten =&gt; 123,1,Answer()</p> <p><strong>Priorities</strong></p> <p>如下例：</p> <p>exten =&gt; 123,1,Answer()<br /> <br />exten =&gt; 123,2,Hangup()</p> <p>那么2会在1后执行。</p> <p>使用n:</p> <p>exten =&gt; 123,1,Answer()<br /> <br />exten =&gt; 123,n,do something </p> <p>exten =&gt; 123,n,do something else </p> <p>exten =&gt; 123,n,do one last thing </p> <p>exten =&gt; 123,n,Hangup()</p> <p>n代表next,就是往下执行的意思，但是注意，1必须有，否则不起作用。</p> <p>使用 'same =&gt;'：</p> <p>exten =&gt; 123,1,Answer()<br /> <br />same =&gt; n,do something </p> <p>same =&gt; n,do something else </p> <p>same =&gt; n,do one last thing </p> <p>same =&gt; n,Hangup()</p> <p>这个一看就知道了怎么用了。</p> <p>使用Priority labels，这个稍后讲其用途:</p> <p>exten =&gt; 123,n(label),application() </p> <p><strong>Applications</strong></p> <p>例如Answer(), Playback(), and Hangup()这些东东。传参数在1.6之前可使用|,从1.6开始就不支持了。</p> <p>Answer() : 一般是不需要的，但是可以起确保下一步之前已经连接成功的作用。</p> <p>Progress()：一般不需要，向发起端回应当前呼叫状态。</p> <p>Playback()：播放上一次的输出（如果上一次为输入则跳过寻找上一次输出）</p> <p>Playback(/home/john/sounds/filename) ：播放/home/john/sounds/filename.wav 绝对路径</p> <p>Playback(filename) : 播放/var/lib/asterisk/sounds/filename.wav 默认路径</p> <p>Playback(custom/filename) 播放/var/lib/asterisk/sounds/custom/filename.wav 相对路径<br /> <br />以上都不能有扩展名。</p> <p>Background():类似PlayBack但是放音乐同时允许用户输入</p> <p>Hangup() ：</p> <p>在CLI中运行core show translation 可知道各音频格式转换消耗。</p> <p>&#160;</p> <p>对于这样一个hello world</p> <p>exten =&gt; 200,1,Answer()<br /> <br />same =&gt; n,Playback(hello-world) </p> <p>same =&gt; n,Hangup()</p> <p>我测试，可以运行，但是声音很卡。 </p> <p><strong>与用户交互</strong></p> <p>BackGround <a href="https://wiki.asterisk.org/wiki/display/AST/Application_BackGround">https://wiki.asterisk.org/wiki/display/AST/Application_BackGround</a></p> <p>与playback类似，但是允许用户输入，WaitExten则等待用户输入。</p> <p>如下例：</p> <blockquote> <p>[TestMenu]<br /> <br />exten =&gt; start,1,Answer()&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ;应答 </p> <p>same =&gt; n,Background(main-menu)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ;放main-menu.wav并等待用户输入 </p> <p>same =&gt; n,WaitExten(5)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ;音乐放完了还没有输入则等待用户输入5秒钟 </p> <p>exten =&gt; 1,1,Playback(digits/1)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ；当用户输入1时，播放1按键音 </p> <p>same =&gt; n,Goto(TestMenu,start,1)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ；转到TestMenu </p> <p>exten =&gt; 2,1,Playback(digits/2)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ;当用户输入2时，播放2按键音 </p> <p>same =&gt; n,Goto(TestMenu,start,1)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ；转到Testmenu </p> <p>exten =&gt; i,1,Playback(pbx-invalid)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ；i代表其他输入&#160;&#160;&#160;&#160;&#160; <br />same =&gt; n,Goto(TestMenu,start,1) </p> <p>exten =&gt; t,1,Playback(vm-goodbye)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ；t代表超时，用户没有输入 </p> <p>same =&gt; n,Hangup()</p> </blockquote> <p>Dial <a href="https://wiki.asterisk.org/wiki/display/AST/Application_Dial">https://wiki.asterisk.org/wiki/display/AST/Application_Dial</a></p> <p>拨出电话，</p> <p>一般只拨一个号码如 exten =&gt; 105,1,Dial(DAHDI/1) ；转拨到DAHDI通道1</p> <p>也可以一次拨多个 exten =&gt; 105,1,Dial(DAHDI/1&amp;SIP/0004F2001122&amp;IAX2/Softphone) ；使用&amp;连接多个通道，但是这个不是电话会议的功能，起作用时，同时拨这三个通道，但是一旦有通道应答，则与之建立连接，其它通道不再响铃。</p> <p>Dial允许直接拨未配置的远端资源：</p> <p>Dial(technology/user[:password]@remote_host[:port][/remote_extension])</p> <p>可以尝试一下Dial(<a href="mailto:IAX2/guest@misery.digium.com/s">IAX2/guest@misery.digium.com/s</a>) 这个是Digium提供的测试资源。</p> <p>Dial的第二个参数为超时时间，如果在超时前连接成功，则此dialplan就结束了（失去控制？），如果超时，则向后执行：</p> <p>exten =&gt; 201,1,Dial(DAHDI/1,10)<br /> <br />same =&gt; n,Playback(vm-nobodyavail) </p> <p>same =&gt; n,Hangup()</p> <p>Dial的三个参数是选项，最常用的是m,表示呼叫方在连接之前会听到hold music而不是响铃音。</p> <p>第四个参数很少用就不讲了</p> <p>跳过参数：exten =&gt; 1,1,Dial(DAHDI/1,,m)&#160; ；这里跳过了第二个参数但设置了第三个参数。</p> <p><strong>dialplan的变量</strong></p> <blockquote> <p>exten =&gt; 301,1,Set(LEIF=SIP/0000FFFF0001)&#160;&#160; ；设置变量LEIF<br /> <br />same =&gt; n,Dial(${LEIF})&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ;引用变量LEIF</p> </blockquote> <p>变量区分大小写，一般全局变量用全大写，channel变量用驼峰命名法，可使用下划线。</p> <p>CHANNEL 和 EXTEN是asterisk固有的变量。</p> <p>全局变量可由所有通道共享，必须定义在globals中：</p> <p>[globals]<br /> <br />LEIF=SIP/0000FFFF0001</p> <p>通道变量只在通道中可见，对于参与会话的其他通道也可见：</p> <p>exten =&gt; 202,1,Set(MagicNumber=42)<br /> <br />same =&gt; n,SayNumber(${MagicNumber})</p> <p>环境变量:</p> <p>${ENV(var)} 获得linux系统环境变量值var是变量名</p> <p><strong>模式匹配：</strong></p> <p>以下划线开始：</p> <p>X 单个0到9的数字</p> <p>Z 单个1到9的数字</p> <p>N 单个2到9的数字</p> <p>[15-7] 方括号， 此例表示1，或是5到7的单个数字</p> <p>.&#160; 一到多个字符，例如：</p> <blockquote> <p>_.&#160; 这个表示所有匹配，一般很少用</p> <p>_X. 以数字开始的所有字符串</p> <p>_[0-9a-zA-Z]. 这个就匹配所有的了</p> </blockquote> <p>! 0到多个字符</p> <p>多组匹配的情况，会优先选取最精确地（从左到右），例如</p> <p>exten =&gt; _555XXXX,1,Playback(silence/1&amp;digits/1)<br /> <br />exten =&gt; _55512XX,1,Playback(silence/1&amp;digits/2)</p> <p>那么555120会匹配第二个，因为它的精确度高。</p> <p><strong>匹配示例 127页</strong></p> <p>这里主要介绍了北美的一些有用的模式，还有NANP：北美号码计划</p> <p>在dialplan中，可以使用${EXTEN}来获得当前呼叫的号码，这对于使用了匹配的dialplan来说很有用。</p> <p>${EXTEN:x:y} 的用法</p> <p>假如呼叫94169671111</p> <p>• ${EXTEN:1:3}&#160; = 416<br /> <br />• ${EXTEN:4:7}&#160; =&#160; 9671111 </p> <p>• ${EXTEN:-4:4}&#160; = 1111&#160;&#160;&#160; ;最末往前数4位，然后返回此位置向后的四位 </p> <p>• ${EXTEN:2:-4}&#160; = 16967 ;从第2位（0为起始索引）开始，但是排除最末4位 </p> <p>• ${EXTEN:-6:-4}&#160; = 67&#160; ; 最末往前数6位，排除最末4位 </p> <p>• ${EXTEN:1}&#160; = 4169671111 ；第一位之后的</p> <p><strong>include 语法（注意这与include引导符不一样 #include）</strong></p> <p>include =&gt; context</p> <p>引入其他context</p> <p>首先会匹配当前的extention，如果没有匹配再会匹配被引入的context。</p> <p>详见第七章</p> <p class="read-more">Continue reading <a class="heading" href="/voip/2012/08/13/askterisk-e7-ac-94-e8-ae-b0.html" data-flip="title">askterisk笔记【一】</a></p> </article> <article id="post-voip/2012/08/09/asterisk-freepbx-freeswitch-trixbox-elastix-freeiris-opensips-fusionpbx-%e7%ad%89%e7%ad%89" class="post mb6" role="article"> <header> <h1 class="post-title"> <a href="/voip/2012/08/09/asterisk-freepbx-freeswitch-trixbox-elastix-freeiris-opensips-fusionpbx-e7-ad-89-e7-ad-89.html" data-flip="title"> asterisk freepbx freeswitch trixbox elastix freeiris opensips fusionpbx 等等 </a> </h1> <p class="post-date heading"> <time datetime="2012-08-09T23:51:22+08:00">09 Aug 2012</time> in <span>Voip</span> on <span>Asterisk</span>, <span>Freeswich</span>, <span>Opensips</span> </p> <div class="hr" style="padding-bottom:0"></div> </header> <p>voip这开源框架太多，都有点糊涂了，这里整理一下他们的关系：</p> <p>asterisk <a href="http://www.asterisk.org/">http://www.asterisk.org/</a></p> <blockquote><p>这个不用多说</p> </blockquote> <p>freepbx <a href="http://www.freepbx.org/">http://www.freepbx.org/</a></p> <blockquote><p>FreePBX 是一个用来控制 <a href="http://www.oschina.net/p/asterisk">Asterisk</a> 的图形化接口。</p> </blockquote> <p>Elastix <a href="http://www.elastix.org/">http://www.elastix.org/</a></p> <blockquote><p>系统集成了最优秀的工具，它使 <a href="http://www.oschina.net/p/asterisk">Asterisk</a> PBX 拥有一个简单易操作的界面，还增加了自己的设备，允许外界创新，使其成为开源通讯最好的软件包。Elastix 的目标就是要发展成为一个稳定、可调节和易操作的软件系统。这些特点使 Elastix 成为 Asterisk PBX 的首选。</p> <p>集成<a href="http://www.oschina.net/p/sugarcrm">SugarCRM</a>和电话计费系统； <br />集成即时信息服务器 (<a href="http://www.oschina.net/p/openfire">Openfire</a>)；</p> </blockquote> <p>trixbox <a href="http://fonality.com/trixbox/">http://fonality.com/trixbox/</a></p> <blockquote><p>正是为了解决 Asterisk<sup>[1]</sup><a name="ref_[1]_1175459"></a> 难于配置的问题，大约在两年前，Asterisk @Home 项目悄悄地出现了。它提供了日渐完善的一体化安装方案，普通用户也可以在安装向导的指引下，完成从 Linux 系统安装到 PBX 系统配置的全部过程。2006年5月，当 AAH2.8 出现的时候，它已经整合了Asterisk<sup>[1]</sup><a name="ref_[1]_1175459"></a>、FreePBX（一套基于Web的 Asterisk<sup>[1]</sup><a name="ref_[1]_1175459"></a> 配置管理系统）、MySQL 和 <font color="#0000ff">SugarCRM</font><sup>[2]</sup><a name="ref_[2]_1175459"></a>。在全球范围内得到了包括企业和行业用户在内的广泛用户支持。在这种形式下，社区的主要开发者开始谋求改变 AAH的本名和原定位，将 AAH 发展成一个真正的产品，于是，Trixbox1.0 产生了。2006年10月，VoIP 产品和解决方案提供商 Fonality 并购了Trixbox，使其有了进一步发展的坚实后盾。</p> <p>需要指出的是，Trixbox 并不是简单地把 Asterisk 和 SugarCRM<sup>[2]</sup><a name="ref_[2]_1175459"></a> 叠加在了一起，而是进行了深层次的整合，例如，在 SugarCRM <sup>[2]</sup><a name="ref_[2]_1175459"></a>中，只要点击客户的电话号码，VoIP 客户端软件就能够自动进行拨号动作。</p> </blockquote> <p>freeiris <a href="http://www.freeiris.org">http://www.freeiris.org</a></p> <blockquote><p>Freeiris(前身为Astercon2)是一款开源的电话通信平台，含盖了计费、注册管理、PBX、数字中继、呼叫中心等业务需要。系统基于<font color="#0000ff">Asterisk</font>、Perl、Linux、PHP等技术实现，在不修 改asterisk本身的情况下采用外挂形式开发。目前系统可以控制管理SIP、IAX、H323、等软协议的通信。在硬件层上，支持大量的硬件产品，包 括数字中继(ISDN PRI / ISDN BRI)，模拟中继(FXO / FXS)，以及各种SIP与IAX的终端设备等</p> <p><font color="#0000ff">似乎是国人写的</font></p> <p><font color="#0000ff"></font></p> </blockquote> <p>SER,OpenSER&#160; <a href="http://www.iptel.org/ser/">http://www.iptel.org/ser/</a></p> <blockquote><p>这个真有点昏，SER一般指Openser,现在停止开发了，而由在其基础上又出现两个开源框架Kamailio 和 OpenSIPS 。</p> <p>目前有SER+Asterisk组合，就是让SER承担SIP路由部分。</p> </blockquote> <p>Kamailio <a href="http://www.kamailio.org/w/">http://www.kamailio.org/w/</a></p> <blockquote><p>参见SER</p> </blockquote> <p>OpenSIPS <a href="http://www.opensips.org/">http://www.opensips.org/</a></p> <blockquote><p>OpenSIPS是一个成熟的开源SIP服务器，除了提供基本的SIP代理及SIP路由功能外，还提供了一些应用级的功能。OpenSIPS的结构非常灵活，其核心路由功能完全通过脚本来实现，可灵活定制各种路由策略，可灵活应用于语音、视频通信、IM以及Presence等多种应用。同时OpenSIPS性能上是目前最快的SIP服务器之一，可用于电信级产品构建。</p> </blockquote> <p>FreeSWITCH <a href="http://www.freeswitch.org/">http://www.freeswitch.org/</a></p> <blockquote><p>FreeSWITCH 是一个开源的电话交换平台，从一个简单的软电话客户端到运营商级的软交换设备几乎无所不能。能原生地运行于Windows、Max OS X、Linux、BSD 及 solaris 等诸多32/64位平台。可以用作一个简单的交换引擎、一个PBX，一个媒体网关或媒体支持IVR的服务器等。它支持SIP、H323、Skype、Google Talk等协议，并能很容易地与各种开源的PBX系统如sipXecs、Call Weaver、Bayonne、YATE及Asterisk等通信。 FreeSWITCH 遵循RFC并支持很多高级的SIP特性，如 presence、BLF、SLA以及TCP、TLS和sRTP等。它也可以用作一个SBC进行透明的SIP代理（proxy）以支持其它媒体如T.38等。FreeSWITCH 支持宽带及窄带语音编码，电话会议桥可同时支持8、12、16、24、32及48kHZ的语音. 而在传统的电话网络中，要做到三方通话或多方通话需要通过专门的芯片来处理，其它像预付费，彩铃等业务在PSTN网络中都需要依靠智能网(IN)才能实现，而且配置起来相当不灵活</p> </blockquote> <p>fusionpbx&#160; <a href="http://www.fusionpbx.com/">http://www.fusionpbx.com/</a></p> <blockquote><p>fusionpbx是<a href="http://www.oschina.net/p/freeswitch">freeswitch</a>图形WEB接口</p> </blockquote> <p>&#160;</p> <p>搞清楚了，原来说白了就三大家族asterisk和freeswich另加SER系列的。 而且freeswitch和asterisk还是有些渊源的。 参见<a title="http://kazge.com/archives/869.html" href="http://kazge.com/archives/869.html">http://kazge.com/archives/869.html</a></p> <p class="read-more">Continue reading <a class="heading" href="/voip/2012/08/09/asterisk-freepbx-freeswitch-trixbox-elastix-freeiris-opensips-fusionpbx-e7-ad-89-e7-ad-89.html" data-flip="title">asterisk freepbx freeswitch trixbox elastix freeiris opensips fusionpbx 等等</a></p> </article> <h2 class="sr-only">Pagination</h2> <nav class="pagination heading" role="navigation"> <ul> <li class="pagination-item older" > <a rel="next" href="/page-14/">Older</a> </li> <li class="pagination-item newer" > <a rel="prev" href="/page-12/">Newer</a> </li> </ul> </nav> <footer> <hr/> <p>© 2011 - 2017. All rights reserved.</p> <p> <code>Powered by <a href="https://qwtel.com/hydejack/">Hydejack</a> v<span id="_version">6.6.1</span></code> </p> </footer> </main> </div> <div id="_yDrawer"> <div id="_sidebar" class="sidebar"> <div class="sidebar-bg" style="background-color:#4f86aa;background-image:url()"></div> <header class="sidebar-sticky" role="banner"> <div class="sidebar-about"> <img src="https://avatars0.githubusercontent.com/u/4122902?v=4&s=460" class="me" /> </div> <div class="sidebar-about"> <h1><a id="_title" href="/">Ka's Blog</a></h1> <p>Ka’s blog description…</p> </div> <nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span> <ul> <li> <a class="sidebar-nav-item" href="/categories.html">Categories</a> </li> <li> <a class="sidebar-nav-item" href="/archive.html">Archive</a> </li> <li> <a class="sidebar-nav-item" href="/tags.html">Tags</a> </li> <li> <a class="sidebar-nav-item" href="/about.html">About</a> </li> </ul> </nav> <div class="sidebar-social"> <span class="sr-only">Social:</span> <ul> <li> <a href="https://twitter.com/imhazige" title="Twitter"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a> </li> <li> <a href="https://github.com/imhazige" title="GitHub"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a> </li> <li> <a href="mailto:imhazige@gmail.com" title="Email"> <span class="icon-mail"></span> <span class="sr-only">Email</span> </a> </li> <li> <a href="https://imhazige.github.io/myblog/feed.xml" title="RSS"> <span class="icon-rss2"></span> <span class="sr-only">RSS</span> </a> </li> </ul> </div> </header> </div> </div> </div> <!--[if gt IE 9]><!----> <script>loadJSDeferred('/assets/js/hydejack.js?v=6.6.1');</script> <!--<![endif]--> </body>
</html>
